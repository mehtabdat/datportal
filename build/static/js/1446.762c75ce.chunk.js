"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[1446],{31446:function(e,n,o){o.r(n),o.d(n,{default:function(){return A}});var t=o(1413),i=o(29439),r=o(47313),a=o(7532),d=o(25019),s=o(55291),c=o(82626),l=o(17327),u=o(49355),f=o(46646),p=o(40169),m=o(93873),v=o(48897),h=o(35997),Z=o(46417),g=function(e){var n,o,a,g,b=e.openModal,x=e.onCancel,j=e.type,P=e.record,k=e.reloadTableData,y=e.permissions,C=y.createBiometricsJob,w=y.updateBiometricsJob,R=d.Z.useForm(),B=(0,i.Z)(R,1)[0],T=(0,r.useMemo)((function(){return new m.E}),[]),I=(0,r.useMemo)((function(){return new h.U}),[]),L=(0,r.useState)(),S=(0,i.Z)(L,2),z=S[0],E=S[1],D=(0,r.useState)([]),N=(0,i.Z)(D,2),A=N[0],F=N[1],J=function(e){var n=(0,p.P)(e);if("string"==typeof n.message)E((0,t.Z)((0,t.Z)({},z),{},{error:n.message}));else{var o=(0,f.O)(n.message,[]);B.setFields(o),E((0,t.Z)((0,t.Z)({},z),{},{error:""}))}},M=(0,r.useCallback)((function(){I.getAllPublishedRecords().then((function(e){var n;F(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data)})).catch((function(e){s.ZP.error(e.response.data.message)}))}),[I]),U=(0,r.useCallback)((function(){E({loading:!0}),T.getRecordById(P).then((function(e){var n,o,i,r=null===e||void 0===e||null===(n=e.data)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.organization,a=null===e||void 0===e||null===(i=e.data)||void 0===i?void 0:i.data;E((0,t.Z)((0,t.Z)({},e.data),{},{loading:!1})),B.setFieldsValue((0,t.Z)((0,t.Z)({},a),{},{organizationId:null===r||void 0===r?void 0:r.id}))})).catch((function(e){J(e)}))}),[B,P,T]);return(0,r.useEffect)((function(){"edit"===j?(U(),M()):(B.resetFields(),M())}),[j,B]),(0,Z.jsx)(c.P0,{visible:b,closable:!0,onCancel:x,titleText:"edit"===j?"Edit Bulk Upload Job":"Add New Bulk Upload Job",showFooter:!1,children:null!==z&&void 0!==z&&z.loading?(0,Z.jsx)(u.Z,{items:10}):(0,Z.jsxs)(d.Z,{className:l.Z.form,onFinish:function(e){E((0,t.Z)((0,t.Z)({},z),{},{buttonLoading:!0}));var n=new FormData;if("new"===j){var o=["file"];Object.entries(e).forEach((function(e){o.includes(e[0])||n.append(e[0],e[1])})),e.file&&"string"!==typeof e.file&&e.file.fileList.length>0&&n.append("file",e.file.fileList[0].originFileObj)}switch(j){case"edit":var i;if(!0===w)T.updateRecord(e,null===z||void 0===z||null===(i=z.data)||void 0===i?void 0:i.id).then((function(e){k(),x(),E((function(e){return(0,t.Z)((0,t.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){J(e),E((function(e){return(0,t.Z)((0,t.Z)({},e),{},{buttonLoading:!1})}))}));else E((function(e){return(0,t.Z)((0,t.Z)({},e),{},{buttonLoading:!1})})),s.ZP.error("You don't have permission to update bulk upload job");break;case"new":!0===C?T.createRecord(n).then((function(e){k(),x(),E((function(e){return(0,t.Z)((0,t.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){J(e),E((function(e){return(0,t.Z)((0,t.Z)({},e),{},{buttonLoading:!1})}))})):(E((function(e){return(0,t.Z)((0,t.Z)({},e),{},{buttonLoading:!1})})),s.ZP.error("You don't have permission to create bulk upload job"))}},form:B,children:[(null===z||void 0===z?void 0:z.error)&&(0,Z.jsx)(c.EQ,{description:null===z||void 0===z?void 0:z.error,isClosable:!0,onClose:function(){E((0,t.Z)((0,t.Z)({},z),{},{error:""}))}}),(0,Z.jsx)("div",{children:(0,Z.jsx)(d.Z.Item,{name:"title",rules:[{required:!0,message:"Please add a title"}],children:(0,Z.jsx)(c.t7,{size:"w100",label:"Title",asterisk:!0,type:"text"})})}),(0,Z.jsx)("div",{children:(0,Z.jsx)(d.Z.Item,{name:"uploadFormatId",rules:[{required:!0,message:"Please add upload format id"}],children:(0,Z.jsx)(c.AP,{label:"Upload Format",asterisk:!0,options:null===A||void 0===A?void 0:A.map((function(e){return{label:null===e||void 0===e?void 0:e.title,value:null===e||void 0===e?void 0:e.id}}))})})}),"new"===j&&(0,Z.jsx)(c.wA,{name:"file",accept:".json,.xlsx,.csv"}),"edit"===j&&(0,Z.jsxs)("div",{className:"flex flex-col",children:[(0,Z.jsx)("label",{className:"font-size-normal",children:"File:"}),(0,Z.jsx)("a",{href:"".concat(v.lj).concat(null===z||void 0===z||null===(n=z.data)||void 0===n?void 0:n.file),target:"_blank",rel:"noopener noreferrer",className:"color-blue-yp font-size-normal",children:null===z||void 0===z||null===(o=z.data)||void 0===o||null===(a=o.file)||void 0===a||null===(g=a.split("public/bulk-upload/"))||void 0===g?void 0:g.pop()})]}),(0,Z.jsxs)("div",{className:l.Z.footer,children:[(0,Z.jsx)(c.op,{size:"normal",fontSize:"sm",onClick:x,type:"plain",children:"Cancel"}),(0,Z.jsx)(c.op,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:null===z||void 0===z?void 0:z.buttonLoading,children:"Submit"})]})]})})},b=o(86136),x=o(5900),j=o(72652),P=o(41586),k=o(98676),y=o(3109),C=o(77411),w=o(98505),R=o(85554),B=b.Z.TextArea,T=function(e){var n=e.record,o=e.onEditIconClick,a=e.reloadTableData,d=e.permissions.deleteBiometricsJob,c=(0,r.useState)({confirmLoading:!1,openPopConfirm:!1}),u=(0,i.Z)(c,2),f=u[0],p=u[1],v=(0,r.useMemo)((function(){return new m.E}),[]);return(0,Z.jsxs)("div",{className:l.Z.actions,children:[(0,Z.jsx)("span",{onClick:function(){return o(n)},children:(0,Z.jsx)("img",{src:"/images/editicon.svg",alt:""})}),(0,Z.jsx)(x.Z,{open:f.openPopConfirm,placement:"top",title:"Are you sure?",onConfirm:function(){if(p((0,t.Z)((0,t.Z)({},f),{},{confirmLoading:!0})),!1===d)return s.ZP.error("You don't have permission to delete this record, please contact your admin."),void p((0,t.Z)((0,t.Z)({},f),{},{openPopConfirm:!1}));v.deleteRecord(n.id).then((function(e){p((0,t.Z)((0,t.Z)({},f),{},{openPopConfirm:!1,confirmLoading:!1})),a()})).catch((function(e){p((0,t.Z)((0,t.Z)({},f),{},{confirmLoading:!1}))}))},onCancel:function(){return p((0,t.Z)((0,t.Z)({},f),{},{openPopConfirm:!1}))},okButtonProps:{loading:f.confirmLoading},okText:"Yes",cancelText:"No",onOpenChange:function(e){e||p((0,t.Z)((0,t.Z)({},f),{},{openPopConfirm:!1}))},children:(0,Z.jsx)(k.Z,{className:l.Z.bg__red,onClick:function(){p((0,t.Z)((0,t.Z)({},f),{},{openPopConfirm:!0}))}})})]})},I=function(e){var n=e.record,o=e.reloadTableData,t=(0,r.useState)(!1),a=(0,i.Z)(t,2),d=a[0],l=a[1],u=(0,r.useMemo)((function(){return new m.E}),[]);(0,r.useEffect)((function(){n.status!==C.P.processing||d||l(!0)}),[n.status]);var f=function(){l(!0),u.getProcessById(n.id).then((function(e){s.ZP.success("Processing started"),o()})).catch((function(e){var n,o;console.error(null===e||void 0===e||null===(n=e.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message)}))},p=function(){u.stopProcess(n.id).then((function(e){s.ZP.success("Job stopped"),o()})).catch((function(e){var n,o;console.error(null===e||void 0===e||null===(n=e.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message)}))};return n.status===C.P.completed?(0,Z.jsx)(y.Z,{color:"dark-sub",size:"sm",children:"Processed"}):d?(0,Z.jsxs)("div",{className:"text-center",children:[(0,Z.jsx)(j.Z,{}),(0,Z.jsx)(y.Z,{color:"dark-sub",size:"sm",children:"Processing in background, you can close the tab"}),(0,Z.jsx)(c.op,{onClick:p,size:"xs",type:"outlined",style:{margin:"auto"},children:"Stop"})]}):(0,Z.jsx)(c.op,{onClick:f,size:"xs",type:"outlined",children:"Process Now"})};function L(e){var n=e.tableData,o=e.tableLoading,t=e.onEditIconClick,i=e.reloadTableData,r=(0,R.v9)((function(e){return e.usersReducer})).userPermissions,a=[{title:"S.No",dataIndex:"index",key:"index",render:function(e,n,o){return o+1},width:"5%"},{title:"Title",dataIndex:"title",key:"title",render:function(e,n){return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(y.Z,{color:"dark-sub",size:"sm",children:e}),(0,Z.jsx)(y.Z,{color:"dark-sub",size:"xs",children:"ID: ".concat(n.id)}),(0,Z.jsx)("a",{href:"".concat(v.lj).concat(n.file),target:"_blank",rel:"noreferrer",children:"Preview"})]})}},{title:"Failed Report",dataIndex:"failedReport",key:"failedReport",render:function(e,n){return(0,Z.jsx)(B,{rows:4,value:JSON.stringify(n.failedReport,null,2)})},width:"300px"},{title:"Status",dataIndex:"processed",key:"processed",render:function(e,n){return(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(I,{record:n,reloadTableData:i})})},className:"text-center"},{title:"Date",dataIndex:"addedDate",key:"addedDate",render:function(e,n){return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(y.Z,{color:"dark-sub",size:"sm",children:"Added: ".concat((0,w.Ny)(e,"dd M,yy"))}),(0,Z.jsx)(y.Z,{color:"dark-sub",size:"sm",children:"Processed: ".concat((0,w.Ny)(n.processeStartDate,"dd M,yy"))})]})}},{title:"Others",dataIndex:"others",key:"others",render:function(e,n){return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(y.Z,{color:"dark-sub",size:"sm",children:"Success: ".concat(n.success)}),(0,Z.jsx)(y.Z,{color:"dark-sub",size:"sm",children:"Failed: ".concat(n.failed)}),(0,Z.jsx)(y.Z,{color:"dark-sub",size:"sm",children:"Total records: ".concat(n.totalRecords)})]})}},{title:"Actions",dataIndex:"actions",key:"actions",render:function(e,n){return(0,Z.jsx)(T,{record:n,onEditIconClick:t,reloadTableData:i,permissions:r})}}];return(0,Z.jsx)("div",{className:l.Z.antdTableWrapper,children:(0,Z.jsx)(P.Z,{sticky:!0,dataSource:n,columns:a,pagination:!1,scroll:{x:991},loading:o,rowKey:function(e){return"site-prop-bulk-upload-".concat(e.id)}})})}var S=o(42623),z=o(19723),E=o(18515),D=o(3798),N=[{text:"Home",isLink:!0,path:"/"},{isLink:!0,text:"Site Settings",path:"/siteSettings"},{isLink:!1,text:"Biometrics Bulk Upload Job"}];var A=function(){var e,n,o,d,l=(0,D.aY)(z.q),u=(0,R.v9)((function(e){return e.usersReducer})).userPermissions,f=u.readBiometricsJob,p=u.createBiometricsJob,v=u.updateBiometricsJob,h=(0,r.useState)({editType:"new",recordId:0,openModal:!1}),b=(0,i.Z)(h,2),x=b[0],j=b[1],P=(0,r.useMemo)((function(){return new m.E}),[]),k=(0,r.useState)(""),y=(0,i.Z)(k,2),C=y[0],w=(y[1],(0,S.N)(C,500)),B=(0,r.useState)({isLoading:!1,error:{},data:[]}),T=(0,i.Z)(B,2),I=T[0],A=T[1],F=function(){!1!==p?j((0,t.Z)((0,t.Z)({},x),{},{openModal:!x.openModal,editType:"new"})):s.ZP.error("You don't have permission to create new record")},J=(0,r.useCallback)((function(e){A((0,t.Z)((0,t.Z)({},I),{},{loading:!0})),P.getAllRecords(e).then((function(e){A(e.data)})).catch((function(e){var n,o;s.ZP.error(null===(n=e.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message)}))}),[I,P]);(0,r.useEffect)((function(){w?J({name:w}):J()}),[w]);var M=(0,r.useCallback)((function(e,n){A((0,t.Z)((0,t.Z)({},I),{},{loading:!0}));var o={page:e,perPage:n,name:w||void 0};P.getAllRecords(o).then((function(e){A((0,t.Z)((0,t.Z)({},e.data),{},{loading:!1}))})).catch((function(e){A((0,t.Z)((0,t.Z)({},I),{},{loading:!1}))}))}),[I,P]);return(0,Z.jsxs)(a.default,{permissionSlug:l,children:[(0,Z.jsx)(c.mr,{heading:"Biometrics Bulk Upload Job",buttonText:"New Upload Job",onButtonClick:F,breadCrumbData:N,showAdd:!0===p}),!0===f&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(L,{tableData:null===I||void 0===I?void 0:I.data,tableLoading:I.loading,onEditIconClick:function(e){!1!==v?j((0,t.Z)((0,t.Z)({},x),{},{editType:"edit",recordId:e.id,openModal:!0})):s.ZP.error("You don't have permission to update this record")},reloadTableData:J}),(0,Z.jsx)(c.tl,{total:null===I||void 0===I||null===(e=I.meta)||void 0===e?void 0:e.total,current:null===I||void 0===I||null===(n=I.meta)||void 0===n?void 0:n.page,defaultPageSize:null!==I&&void 0!==I&&null!==(o=I.meta)&&void 0!==o&&o.perPage?null===I||void 0===I||null===(d=I.meta)||void 0===d?void 0:d.perPage:10,pageSizeOptions:[10,20,50,100],onChange:M})]}),!1===f&&(0,Z.jsx)(E.a$,{mainMessage:"You don't have permission to view this data"}),x.openModal&&(0,Z.jsx)(g,{record:x.recordId,type:x.editType,reloadTableData:function(){var e,n;return J({page:null===I||void 0===I||null===(e=I.meta)||void 0===e?void 0:e.page,perPage:null===I||void 0===I||null===(n=I.meta)||void 0===n?void 0:n.perPage})},onCancel:F,openModal:x.openModal,permissions:u})]})}},35997:function(e,n,o){o.d(n,{U:function(){return a}});var t=o(43144),i=o(15671),r=o(49075),a=(0,t.Z)((function e(){var n=this;(0,i.Z)(this,e),this.endPoint="bulk-upload-format",this.getAllRecords=function(e){return r.Z.get(n.endPoint,{params:e})},this.getAllPublishedRecords=function(e){return r.Z.get(n.endPoint+"/find-published",{params:e})},this.getRecordById=function(e){return r.Z.get("".concat(n.endPoint,"/").concat(e))},this.deleteRecord=function(e){return r.Z.delete("".concat(n.endPoint,"/").concat(e))},this.createRecord=function(e){return r.Z.post(n.endPoint+"/",e)},this.updateRecord=function(e,o){return r.Z.patch("".concat(n.endPoint,"/").concat(o),e)}}))},93873:function(e,n,o){o.d(n,{E:function(){return d}});var t=o(43144),i=o(15671),r=o(49075),a=o(3135),d=(0,t.Z)((function e(){var n=this;(0,i.Z)(this,e),this.endPoint="biometrics-job",this.getAllRecords=function(e){return r.Z.get(n.endPoint,{params:e})},this.getRecordById=function(e){return r.Z.get("".concat(n.endPoint,"/").concat(e))},this.getProcessById=function(e){return r.Z.patch("".concat(n.endPoint,"/process/").concat(e))},this.stopProcess=function(e){return r.Z.patch("".concat(n.endPoint,"/stop/").concat(e))},this.deleteRecord=function(e){return r.Z.delete("".concat(n.endPoint,"/").concat(e))},this.createRecord=function(e){return r.Z.post(n.endPoint+"/",e,{headers:a.C})},this.updateRecord=function(e,o){return r.Z.patch("".concat(n.endPoint,"/").concat(o),e)}}))},19723:function(e,n,o){o.d(n,{q:function(){return t}});var t=function(e){return e.CREATE="createBiometricsJob",e.UPDATE="updateBiometricsJob",e.DELETE="deleteBiometricsJob",e.READ="readBiometricsJob",e.ROLLBACK="rollbackBiometricsJob",e}({})},77411:function(e,n,o){o.d(n,{P:function(){return t}});var t=function(e){return e[e.new=1]="new",e[e.processing=2]="processing",e[e.completed=3]="completed",e[e.failed=4]="failed",e[e.rollback=5]="rollback",e[e.force_stopped=6]="force_stopped",e}({})}}]);