"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[4174],{44174:function(e,t,n){n.r(t),n.d(t,{default:function(){return w}});var a=n(4942),i=n(1413),o=n(29439),d=n(47313),r=n(74165),c=n(15861),s=n(25019),l=n(55291),u=n(39180),v=n(82626),p=n(3113),g="styles_orderItem__XyNTm",f="styles_selected__gpShP",m="styles_total__s242E",h=n(49355),x=n(46646),Z=n(40169),k=n(43144),y=n(15671),P=n(49075),b=(0,k.Z)((function e(){var t=this;(0,y.Z)(this,e),this.endPoint="organization-credit-package",this.createRecord=function(e){return P.Z.post(t.endPoint+"/",e)},this.createTopUp=function(e){return P.Z.post("".concat(t.endPoint,"/topup-credits"),e)},this.createPaymentLinkById=function(e){return P.Z.post("".concat(t.endPoint,"/generate-payment-link/").concat(e))},this.getAllRecords=function(){return P.Z.get("".concat(t.endPoint,"/find-my-subscriptions"))},this.getAllOrgSubscriptions=function(e){return P.Z.get("".concat(t.endPoint,"/findAll"),{params:e})},this.getRecordById=function(e){return P.Z.get("".concat(t.endPoint,"/").concat(e))},this.getOrgPackageById=function(e){return P.Z.get("".concat(t.endPoint,"/find-packages-of-organization/").concat(e))},this.getMyBalance=function(){return P.Z.get("".concat(t.endPoint,"/find-my-balance"))},this.submitTransactionById=function(e){return P.Z.post("".concat(t.endPoint,"/submitTelrTransaction/").concat(e))},this.updateRecord=function(e,n){return P.Z.patch("".concat(t.endPoint,"/").concat(n),e)},this.updateSubscriptionById=function(e){return P.Z.get("".concat(t.endPoint,"/unsubscribe/").concat(e))},this.validateCouponCode=function(e){return P.Z.post("".concat(t.endPoint,"/validate-coupon-code"),e)}})),j=n(5227),C=n(46417),I=function(e){var t,n=e.openModal,a=e.onCancel,k=e.type,y=e.reloadTableData,P=s.Z.useForm(),I=(0,o.Z)(P,1)[0],z=(0,d.useMemo)((function(){return new j.G}),[]),S=(0,d.useMemo)((function(){return new b}),[]),R=(0,d.useState)({loading:!0,error:{},data:[]}),A=(0,o.Z)(R,2),N=A[0],D=A[1],T=(0,d.useState)(),E=(0,o.Z)(T,2),O=E[0],w=E[1],M=(0,d.useState)(""),_=(0,o.Z)(M,2),B=_[0],F=_[1],L=(0,d.useState)(),U=(0,o.Z)(L,2),G=U[0],X=U[1],H=(0,d.useState)(0),V=(0,o.Z)(H,2),q=V[0],K=V[1],Q=(0,d.useState)(null),W=(0,o.Z)(Q,2),Y=W[0],J=W[1],$=function(e){var t=(0,Z.P)(e);if("string"==typeof t.message)D((0,i.Z)((0,i.Z)({},N),{},{error:t.message}));else{var n=(0,x.O)(t.message,[]);I.setFields(n),D((0,i.Z)((0,i.Z)({},N),{},{error:""}))}},ee=function(){D((0,i.Z)((0,i.Z)({},N),{},{error:""}))},te=(0,d.useCallback)((function(){z.getAllPublished().then((function(e){e.data&&e.data.data&&D((0,i.Z)((0,i.Z)({},e.data),{},{loading:!1}))})).catch((function(e){console.error("Error getting credit packages",null===e||void 0===e?void 0:e.message)}))}),[z]);(0,d.useEffect)((function(){te()}),[te]);var ne=function(e){var t=e.target.value;w(t);var n=5*t.amount/100;X({vat:n,total:t.amount+n})},ae=function(){var e=(0,c.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(null===O||void 0===O?void 0:O.id)&&O){e.next=4;break}l.ZP.error("Please select a package"),e.next=11;break;case 4:if(B){e.next=8;break}l.ZP.error("Please add coupon code"),e.next=11;break;case 8:return t={couponCode:B,creditPackageId:null===O||void 0===O?void 0:O.id},e.next=11,S.validateCouponCode(t).then((function(e){var t,n,a=null===(t=e.data)||void 0===t?void 0:t.data;l.ZP.success(null===(n=e.data)||void 0===n?void 0:n.message);!function(){var e=null===O||void 0===O?void 0:O.amount;if("percentage"===(null===a||void 0===a?void 0:a.discountType)){var t=a.value/100*e,n=e-t,i=5*n/100;X({discount:t,vat:i,total:n+i})}else if("flat"===(null===a||void 0===a?void 0:a.discountType)){var o=(null===a||void 0===a?void 0:a.value)>e?e-1:null===a||void 0===a?void 0:a.value,d=e-o,r=5*d/100;X({discount:o,vat:r,total:d+r})}}(),ee()})).catch((function(e){$(e),I.setFieldsValue({couponCode:""})}));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,d.useEffect)((function(){q>0?J(setTimeout((function(){return K(q-1)}),1e3)):clearTimeout(Y)}),[q]),(0,C.jsx)(v.P0,{visible:n,closable:!0,onCancel:a,titleText:"edit"===k?"Edit Order":"Add New Order",showFooter:!1,children:null!==N&&void 0!==N&&N.loading?(0,C.jsx)(h.Z,{items:10}):(0,C.jsxs)(s.Z,{className:p.Z.form,onFinish:function(e){D((0,i.Z)((0,i.Z)({},N),{},{buttonLoading:!0}));var t={couponCode:B,creditPackageId:null===O||void 0===O?void 0:O.id};S.createRecord(t).then((function(e){K(3),y(),D((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})})),setInterval((function(){var t;window.location.href="/payment?id=".concat(null===(t=e.data)||void 0===t?void 0:t.data.id),a()}),3e3)})).catch((function(e){$(e),D((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})}))}))},form:I,children:[(null===N||void 0===N?void 0:N.error)&&(0,C.jsx)(v.EQ,{description:null===N||void 0===N?void 0:N.error,isClosable:!0,onClose:ee}),(0,C.jsx)("div",{className:"mb-4",children:(0,C.jsx)(u.ZP.Group,{name:"package",children:null===N||void 0===N||null===(t=N.data)||void 0===t?void 0:t.map((function(e){return(0,C.jsx)("label",{children:(0,C.jsx)("div",{className:"".concat(g," ").concat((null===O||void 0===O?void 0:O.id)===e.id?f:""),children:(0,C.jsxs)("div",{className:"py-2 d-flex",children:[(0,C.jsx)(u.ZP,{value:e,onChange:ne,className:"my-auto pr-3"}),(0,C.jsxs)("div",{className:"my-auto",children:[(0,C.jsx)("span",{className:"color-dark-main font-size-lg",children:e.localization.map((function(e){return e.title}))}),(0,C.jsx)("p",{className:"color-dark-sub font-size-sm mb-1",children:e.localization.map((function(e){return e.description}))})]}),(0,C.jsxs)("div",{className:"ml-auto mr-0 pr-2 my-auto",style:{textAlign:"right"},children:[(0,C.jsxs)("span",{className:"font-size-sm",children:[e.credits," Credits ","monthly"===e.packageType?"/per month":""]}),(0,C.jsxs)("p",{className:"font-size-md color-dark-main mb-0",children:["AED ",e.amount.toFixed(2)]})]})]})})},e.id)}))})}),(0,C.jsxs)("div",{children:[(0,C.jsx)(s.Z.Item,{name:"couponCode",rules:[{required:!1}],children:(0,C.jsx)(v.t7,{size:"sm",label:"Have Coupon?",type:"text",onChange:function(e){return F(e.currentTarget.value)},disabled:!(null===G||void 0===G||!G.discount)})}),(0,C.jsxs)("div",{className:"mt-5 d-flex",children:[(0,C.jsx)(v.op,{size:"normal",fontSize:"sm",type:"primary",onClick:ae,disabled:!(null===G||void 0===G||!G.discount),children:null!==G&&void 0!==G&&G.discount?"Coupon Applied":"Apply Coupon"}),(null===G||void 0===G?void 0:G.discount)&&(0,C.jsx)(v.op,{size:"normal",fontSize:"sm",type:"danger",onClick:function(){F(""),I.setFieldsValue({couponCode:""});var e=null===O||void 0===O?void 0:O.amount,t=5*e/100;X({vat:t,total:e+t})},children:"Remove Coupon"})]})]}),(0,C.jsx)("div",{children:(0,C.jsxs)("div",{className:m,children:[(0,C.jsxs)("p",{children:["Order Amount: AED ",null!==O&&void 0!==O&&O.amount?null===O||void 0===O?void 0:O.amount.toFixed(2):0]}),(0,C.jsxs)("p",{children:["Discount Applied: AED ",null!==G&&void 0!==G&&G.discount?null===G||void 0===G?void 0:G.discount.toFixed(2):0]}),(0,C.jsxs)("p",{children:["VAT (5%): AED ",null!==G&&void 0!==G&&G.vat?G.vat.toFixed(2):0]}),(0,C.jsxs)("p",{className:"font-size-md color-dark-main",children:["Total Amount:  AED ",null!==G&&void 0!==G&&G.total?null===G||void 0===G?void 0:G.total.toFixed(2):0]})]})}),(0,C.jsxs)("div",{className:p.Z.footer,children:[(0,C.jsx)(v.op,{size:"normal",fontSize:"sm",onClick:a,type:"plain",children:"Cancel"}),(0,C.jsx)(v.op,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:null===N||void 0===N?void 0:N.buttonLoading,disabled:!O,children:0===q?"Continue":"Proceeding to payment in "+q})]})]})})},z=n(66204),S=n(41586),R=n(3109),A=n(98505),N=n(3798);function D(e){var t=e.tableData,n=e.tableLoading,a=[{title:"S.No",dataIndex:"index",key:"index",render:function(e,t,n){return n+1},width:"60px"},{title:"Organization",dataIndex:"organization",key:"organization",render:function(e){return(0,C.jsx)("div",{children:(0,C.jsx)("div",{className:"d-flex",children:(0,C.jsx)("div",{className:"ml-2 my-auto",children:(0,C.jsx)(R.Z,{color:"dark-sub",size:"xs",children:"".concat(null===e||void 0===e?void 0:e.name)})})})})}},{title:"Package",dataIndex:"package",key:"package",render:function(e,t){return(0,C.jsx)(R.Z,{color:"dark-main",size:"sm",children:"".concat(t.creditPackage.localization.map((function(e){return e.title})))})}},{title:"Amount Paid",dataIndex:"amount",key:"amount",render:function(e,t){return(0,C.jsx)(R.Z,{color:"dark-sub",size:"sm",children:(0,N.xG)(e)})}},{title:"Credits",dataIndex:"credits",key:"credits",render:function(e,t){return(0,C.jsx)(R.Z,{color:"dark-sub",size:"sm",children:"".concat(e," credits ").concat("monthly"===t.creditPackage.packageType?"/per month":"")})}},{title:"Date Added",dataIndex:"addedDate",key:"addedDate",render:function(e){return(0,C.jsx)(R.Z,{color:"dark-sub",size:"sm",children:(0,A.Ny)(e,"dd M,yy")})}},{title:"Expiry Date",dataIndex:"expiresAt",key:"expiresAt",render:function(e){return(0,C.jsx)(R.Z,{color:"dark-sub",size:"sm",children:(0,A.Ny)(e,"dd M,yy")})}},{title:"Status",className:"text-center",dataIndex:"status",key:"status",render:function(e){return(0,C.jsx)("div",{className:"text-center",children:3===e&&(0,C.jsx)(z.Z,{color:"#ffcc00",children:"refund request"})})}}];return(0,C.jsx)("div",{className:p.Z.antdTableWrapper,children:(0,C.jsx)(S.Z,{sticky:!0,dataSource:t,columns:a,pagination:!1,scroll:{x:991},loading:n,rowKey:function(e){return"CreditsPackage-".concat(e.id)}})})}var T=function(e){return e.SUBSCRIBE="subscribeOrganizationCreditPackage",e.UPDATE="updateOrganizationCreditPackage",e.UNSUBSCRIBE="unsubscribeOrganizationCreditPackage",e.READ="readOrganizationCreditPackage",e.READ_BALANCE="readBalanceOrganizationCreditPackage",e.READ_OTHER_ORG_PACKAGES="readOtherOrganizationCreditPackage",e.TOPUP_CREDITS="topupCredits",e}({}),E=n(7532),O=[{text:"Home",isLink:!0,path:"/"},{isLink:!0,text:"Site Settings",path:"/siteSettings"},{isLink:!1,text:"Orders"}];var w=function(){var e,t,n,r,c=(0,N.aY)(T),s=(0,d.useState)({editType:"new",recordId:0,openModal:!1}),u=(0,o.Z)(s,2),p=u[0],g=u[1],f=(0,d.useMemo)((function(){return new b}),[]),m=(0,d.useState)({loading:!1,error:{},data:[]}),h=(0,o.Z)(m,2),x=h[0],Z=h[1],k=(0,d.useState)({organizationId:0,creditPackageId:0,status:0,dateRange:[""]}),y=(0,o.Z)(k,2),P=y[0],j=y[1],z=(0,d.useState)(!1),S=(0,o.Z)(z,2),R=S[0],w=S[1],M=function(e){var t=null===e||void 0===e?void 0:e.target,n=t.name,o=t.value;if(("organizationId"===n||"creditPackageId"===n||"status"===n)&&!(0,N.hj)(o)){var d="";switch(n){case"organizationId":d="Organization ID";break;case"creditPackageId":d="Credit Package ID";break;case"status":d="Status"}return l.ZP.error("".concat(d," should be a number"))}j((0,i.Z)((0,i.Z)({},P),{},(0,a.Z)({},n,o)))},_=(0,d.useCallback)((function(e,t){e&&(w(!0),j((0,i.Z)((0,i.Z)({},P),{},(0,a.Z)({},e,t))))}),[P]),B=(0,d.useCallback)((function(e){Z((0,i.Z)((0,i.Z)({},x),{},{loading:!0})),f.getAllOrgSubscriptions(e).then((function(e){Z((0,i.Z)({},e.data))})).catch((function(e){l.ZP.error(e.response.data.message)}))}),[f,x]),F=(0,d.useCallback)((function(){var e,t,n=(null===(e=P.dateRange)||void 0===e?void 0:e[0])||"",a=(null===(t=P.dateRange)||void 0===t?void 0:t[1])||"",i=n?(0,A.Ny)(n,"yy-mm-dd"):void 0,o=a?(0,A.Ny)(a,"yy-mm-dd"):void 0,d={organizationId:P.organizationId>0?P.organizationId:void 0,creditPackageId:P.creditPackageId>0?P.creditPackageId:void 0,status:P.status>0?P.status:void 0,fromDate:i,toDate:o};B(d)}),[P]),L=(0,d.useCallback)((function(e,t){var n,a,i=(null===(n=P.dateRange)||void 0===n?void 0:n[0])||"",o=(null===(a=P.dateRange)||void 0===a?void 0:a[1])||"",d=i?(0,A.Ny)(i,"yy-mm-dd"):void 0,r=o?(0,A.Ny)(o,"yy-mm-dd"):void 0,c={page:e,perPage:t,organizationId:P.organizationId>0?P.organizationId:void 0,creditPackageId:P.creditPackageId>0?P.creditPackageId:void 0,status:P.status>0?P.status:void 0,fromDate:d,toDate:r};B(c)}),[P]);return(0,d.useEffect)((function(){B()}),[]),(0,d.useEffect)((function(){R&&F();var e=setTimeout((function(){w(!1)}),2e3);return function(){return clearTimeout(e)}}),[R,P,F]),(0,C.jsxs)(E.default,{permissionSlug:c,children:[(0,C.jsx)(v.mr,{heading:"Orders",breadCrumbData:O,filters:(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{children:(0,C.jsx)(v.Xy,{type:"input",label:"Organization ID",name:"organizationId",value:Number(null===P||void 0===P?void 0:P.organizationId)>0?String(null===P||void 0===P?void 0:P.organizationId):"",onChange:M,onReset:function(){return _("organizationId",0)},onUpdate:F})}),(0,C.jsx)("div",{children:(0,C.jsx)(v.Xy,{type:"input",label:"Credit Package ID",name:"creditPackageId",value:Number(null===P||void 0===P?void 0:P.creditPackageId)>0?String(null===P||void 0===P?void 0:P.creditPackageId):"",onChange:M,onReset:function(){return _("creditPackageId",0)},onUpdate:F})}),(0,C.jsx)("div",{children:(0,C.jsx)(v.Xy,{type:"datepicker",label:"Date",name:"dateRange",onChange:function(e){j((0,i.Z)((0,i.Z)({},P),{},{dateRange:e}))},onReset:function(){return _("dateRange",[])},onUpdate:F})}),(0,C.jsx)("div",{children:(0,C.jsx)(v.Xy,{type:"radio",label:"Status",name:"status",value:null!==P&&void 0!==P&&P.status?String(null===P||void 0===P?void 0:P.status):"",onChange:M,onReset:function(){return _("status",0)},onUpdate:F,options:Object.entries([]).map((function(e){var t=(0,o.Z)(e,2),n=t[0],a=t[1];return{label:(0,N.kC)(n),value:String(a)}}))})})]})}),(0,C.jsx)(D,{tableData:x.data,tableLoading:x.loading,onEditIconClick:function(e){g((0,i.Z)((0,i.Z)({},p),{},{editType:"edit",recordId:e.id,openModal:!0}))},reloadTableData:B}),(0,C.jsx)(v.tl,{total:null===x||void 0===x||null===(e=x.meta)||void 0===e?void 0:e.total,current:null===x||void 0===x||null===(t=x.meta)||void 0===t?void 0:t.page,defaultPageSize:null!==x&&void 0!==x&&null!==(n=x.meta)&&void 0!==n&&n.perPage?null===x||void 0===x||null===(r=x.meta)||void 0===r?void 0:r.perPage:10,pageSizeOptions:[10,20,50,100],onChange:L}),p.openModal&&(0,C.jsx)(I,{type:p.editType,reloadTableData:B,onCancel:function(){g((0,i.Z)((0,i.Z)({},p),{},{openModal:!p.openModal,editType:"new"}))},openModal:p.openModal})]})}},5227:function(e,t,n){n.d(t,{G:function(){return r},d:function(){return c}});var a=n(43144),i=n(15671),o=n(49075),d=n(3135),r=(0,a.Z)((function e(){var t=this;(0,i.Z)(this,e),this.endPoint="credit-package",this.createRecord=function(e){return o.Z.post(t.endPoint+"/",e,{headers:d.C})},this.getAllRecords=function(){return o.Z.get(t.endPoint)},this.getAllPublished=function(){return o.Z.get(t.endPoint+"/findPublished")},this.getRecordById=function(e){return o.Z.get("".concat(t.endPoint,"/").concat(e,"?all=true"))},this.updateRecord=function(e,n){return o.Z.patch("".concat(t.endPoint,"/").concat(n),e,{headers:d.C})},this.deleteRecord=function(e){return o.Z.delete("".concat(t.endPoint,"/").concat(e))}})),c=(0,a.Z)((function e(){var t=this;(0,i.Z)(this,e),this.endPoint="credit-package-promotions",this.createRecord=function(e){return o.Z.post(t.endPoint+"/",e)},this.getAllRecords=function(){return o.Z.get(t.endPoint)},this.getRecordById=function(e){return o.Z.get("".concat(t.endPoint,"/").concat(e))},this.deleteMultipleRecords=function(e,n){return o.Z.delete("".concat(t.endPoint,"/removeMultiple/").concat(e),{params:{packageIds:n}})},this.deleteRecordById=function(e,n){return o.Z.delete("".concat(t.endPoint,"/").concat(e,"/").concat(n))},this.updateRecord=function(e){return o.Z.patch(t.endPoint+"/",e)}}))}}]);