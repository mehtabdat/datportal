"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[9930],{72603:function(e,o,n){n.r(o),n.d(o,{default:function(){return Me}});var t=n(74165),i=n(15861),l=n(93433),d=n(1413),r=n(29439),s=n(47313),a=n(2135),c=n(85554),u=n(15508),v=n(8570),m=n(55291),_=n(47312),h=n(67251),f=n(8773),p=n(37388),j=n(72652),g=n(21680),x=n(77278),y=n(59491),Z=n(63270),N=n(97258),w=n(87462),b={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M666.7 505.5l-246-178A8 8 0 00408 334v46.9c0 10.2 4.9 19.9 13.2 25.9L566.6 512 421.2 617.2c-8.3 6-13.2 15.6-13.2 25.9V690c0 6.5 7.4 10.3 12.7 6.5l246-178c4.4-3.2 4.4-9.8 0-13z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"right-circle",theme:"outlined"},C=n(16141),P=function(e,o){return s.createElement(C.Z,(0,w.Z)({},e,{ref:o,icon:b}))};var S=s.forwardRef(P),M={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M603.3 327.5l-246 178a7.95 7.95 0 000 12.9l246 178c5.3 3.8 12.7 0 12.7-6.5V643c0-10.2-4.9-19.9-13.2-25.9L457.4 512l145.4-105.2c8.3-6 13.2-15.6 13.2-25.9V334c0-6.5-7.4-10.3-12.7-6.5z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"left-circle",theme:"outlined"},k=function(e,o){return s.createElement(C.Z,(0,w.Z)({},e,{ref:o,icon:M}))};var I=s.forwardRef(k),z=n(53764),E=n(92466),R=n(40293),D=n(54060),T=n(82626),Y=n(32147),U=n(6050),L=n(29079),F=n(69591),B=n(96702),H=n(3798),K=n(48897),A=n(42623),V=n(10491),W=n(5900),Q=n(98676),O=n(39548),q=n(50385),G=n(40096),$=n(50725),J=n(70816),X=n.n(J),ee={layout:"styles_layout__iESdF",sider:"styles_sider__m0Jyh",myProjectList:"styles_myProjectList__dX1YU",activeProject:"styles_activeProject__wlTQI",sider_header:"styles_sider_header__K+0GR",badge:"styles_badge__DmmiN",sider_item_title:"styles_sider_item_title__gNYH9",sider_item_last_message:"styles_sider_item_last_message__dc4eJ",header:"styles_header__tgakA",header_content:"styles_header_content__BT6dQ",header_content_title:"styles_header_content_title__9CQkk",content:"styles_content__voZCx",content_empty_wrapper:"styles_content_empty_wrapper__5Fn6V",content_empty:"styles_content_empty__67vJG",content_loader:"styles_content_loader__bcprJ",content_item:"styles_content_item__SU2IU",card:"styles_card__mqgwK",card_wrapper_container:"styles_card_wrapper_container__gkIbn",card_wrapper:"styles_card_wrapper__ImiHV",card_wrapper_owner:"styles_card_wrapper_owner__ZwWdz",card_content:"styles_card_content__PlwK8",card_content_owner:"styles_card_content_owner__rTwCu",card_content_other:"styles_card_content_other__GqZdd",card_sender:"styles_card_sender__20yk9",card_sender_owner:"styles_card_sender_owner__YbMGc",card_sender_other:"styles_card_sender_other__LLjnF",card_sender_name:"styles_card_sender_name__EXwSo",card_sent_at:"styles_card_sent_at__nnhUQ",card_message:"styles_card_message__uveLg",card_message_mention:"styles_card_message_mention__xBpaS",conversations_footer:"styles_conversations_footer__2+1eO",conversations_form:"styles_conversations_form__z0pMp",conversations_form_wrapper:"styles_conversations_form_wrapper__9yflh",conversations_form_input_wrapper:"styles_conversations_form_input_wrapper__AFoPh",conversations_form_input:"styles_conversations_form_input__3Ga1k",conversations_form_send:"styles_conversations_form_send__Mr+U0",conversations_form_send_loader:"styles_conversations_form_send_loader__wSqgY",collapsed_sider:"styles_collapsed_sider__Kmj5L",collapsed_sider_header:"styles_collapsed_sider_header__g6smR",collapsed_sider_header_title:"styles_collapsed_sider_header_title__26xVz",sider_collapse_icon:"styles_sider_collapse_icon__m111d"},oe=n(46417),ne=function(e){var o,n,t,i,l,d,a,c=e.data,u=e.setSelectedFile,v=e.onRemoveConversation,m=e.projectMembers,_=G.Z.getUserData(),h=G.Z.getLocalAccessToken(),p=(null===c||void 0===c||null===(o=c.User)||void 0===o?void 0:o.id)===(null===_||void 0===_?void 0:_.id),j=new Date(null===c||void 0===c?void 0:c.addedDate).getTime()+9e5<(new Date).getTime(),x=(0,s.useState)(!1),y=(0,r.Z)(x,2),Z=y[0],N=y[1];return(0,oe.jsxs)("div",{className:"".concat(ee.card_wrapper_container," ").concat(p?ee.card_wrapper_owner:ee.card_wrapper),onMouseEnter:function(){return N(!0)},onMouseLeave:function(){return N(!1)},children:[p&&Z&&!j&&(0,oe.jsx)(W.Z,{title:"Are you sure you want to delete this conversation?",okText:"Yes",cancelText:"No",placement:"left",onConfirm:function(){return v(null===c||void 0===c?void 0:c.id)},children:(0,oe.jsx)(Q.Z,{style:{color:"red"}})}),(0,oe.jsxs)("div",{className:"".concat(ee.card),children:[(0,oe.jsx)("div",{className:ee.card_avatar,children:!p&&(0,oe.jsx)(f.C,{src:"".concat(K.lj).concat(null===c||void 0===c||null===(n=c.User)||void 0===n?void 0:n.profile),icon:(0,oe.jsx)(O.Z,{}),size:"default"})}),(0,oe.jsxs)("div",{className:"".concat(ee.card_content," ").concat(p?ee.card_content_owner:ee.card_content_other),children:[(0,oe.jsxs)("div",{className:"".concat(ee.card_sender," ").concat(p?ee.card_sender_owner:ee.card_sender_other),children:[!p&&(0,oe.jsx)(q.Z,{user:null===c||void 0===c?void 0:c.User,type:"user",children:(0,oe.jsx)("p",{className:ee.card_sender_name,children:"".concat(null===c||void 0===c||null===(t=c.User)||void 0===t?void 0:t.firstName," ").concat(null===c||void 0===c||null===(i=c.User)||void 0===i?void 0:i.lastName)})}),(0,oe.jsx)("span",{className:ee.card_sent_at,title:X()(c.addedDate).format("DD MMM, YYYY hh:mm A"),children:X()(c.addedDate).fromNow()})]}),(0,oe.jsx)("div",{className:ee.card_message,children:(0,oe.jsx)("div",{dangerouslySetInnerHTML:{__html:null===c||void 0===c||null===(l=c.message)||void 0===l?void 0:l.replace(/@(\w+\s*\w*)/g,(function(e,o){var n=o.replace(/@|\(|\)/g,"");return(null===m||void 0===m?void 0:m.find((function(e){var o,t,i;return null===(o="".concat(null===e||void 0===e||null===(t=e.User)||void 0===t?void 0:t.firstName," ").concat(null===e||void 0===e||null===(i=e.User)||void 0===i?void 0:i.lastName))||void 0===o?void 0:o.includes(n)})))?"<span class=".concat(ee.card_message_mention,">").concat(e,"</span>"):e}))}})}),(null===c||void 0===c||null===(d=c.Media)||void 0===d?void 0:d.length)>0&&(0,oe.jsx)("div",{className:ee.conversation__files,children:null===c||void 0===c||null===(a=c.Media)||void 0===a?void 0:a.map((function(e,o){var n;return(0,oe.jsx)("div",{className:ee.conversation__files_item,children:null!==(n=e.fileType)&&void 0!==n&&n.includes("image")?(0,oe.jsx)($.Z,{images:["".concat(K.Q7).concat(e.path,"?authKey=").concat(h)],width:300,height:150,style:{borderRadius:5,objectFit:"cover"}}):(0,oe.jsx)(g.Z,{src:"/images/doc.png",alt:"Document-".concat(o),preview:!1,width:300,height:150,style:{borderRadius:5,objectFit:"contain"},onClick:function(){return u({path:e.path,open:!0})}})},"media-".concat(o))}))})]})]})]})},te=n(49075),ie=n(66204),le=n(3109),de=n(37936),re=n(49355),se="style_details__UQ7q8",ae="style_details_card__59Ta5",ce="style_details_item__ndbtH",ue="style_details_item_label__8LVZn",ve="style_details_item_value__nK3fY",me="style_members__zTHY7",_e="style_members_item__SsPUi",he="style_members_item_name__Y48Vy",fe=n(15130),pe=n(99700),je=n(80235),ge=v.Z.Text,xe=function(e){var o,n,t,i,l,d,r,s,a,c,u,v,m,_,h=e.details,p=e.setIsManageMediaOpen,j=null===h||void 0===h?void 0:h.data,x=null===h||void 0===h?void 0:h.loading,Z=null===h||void 0===h?void 0:h.files,N=null===j||void 0===j?void 0:j.ProjectMembers;return(0,oe.jsx)("div",{className:se,children:x?(0,oe.jsx)(re.Z,{items:2}):(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsxs)("div",{className:ae,children:[(0,oe.jsxs)("div",{className:ce,children:[(0,oe.jsx)("p",{className:ue,children:"Client"}),(null===j||void 0===j?void 0:j.Client)&&(0,oe.jsxs)("div",{className:ve,children:[null!==j&&void 0!==j&&null!==(o=j.Client)&&void 0!==o&&o.logo?(0,oe.jsx)(g.Z,{src:"".concat(K.lj).concat(null===j||void 0===j||null===(n=j.Client)||void 0===n?void 0:n.logo),alt:null===j||void 0===j||null===(t=j.Client)||void 0===t?void 0:t.name,preview:!1,width:24,style:{objectFit:"contain"}}):(0,oe.jsx)(f.C,{size:24,icon:(0,oe.jsx)(O.Z,{}),style:{border:"1px solid var(--color-border)"}}),(0,oe.jsx)("p",{className:"mb-0",children:null===j||void 0===j||null===(i=j.Client)||void 0===i?void 0:i.name})]})]}),(0,oe.jsxs)("div",{className:ce,children:[(0,oe.jsx)("p",{className:ue,children:"Project Type"}),(0,oe.jsx)("p",{className:"".concat(ve," mb-0"),children:null===j||void 0===j||null===(l=j.ProjectType)||void 0===l?void 0:l.title})]}),(0,oe.jsxs)("div",{className:ce,children:[(0,oe.jsx)("p",{className:ue,children:"Project State"}),(0,oe.jsx)(ie.Z,{color:null===j||void 0===j||null===(d=j.ProjectState)||void 0===d?void 0:d.bgColor,children:(0,oe.jsx)(ge,{style:{width:"100%",maxWidth:250,color:null===j||void 0===j||null===(r=j.ProjectState)||void 0===r?void 0:r.textColor},ellipsis:{tooltip:null===j||void 0===j||null===(s=j.ProjectState)||void 0===s?void 0:s.title},children:null===j||void 0===j||null===(a=j.ProjectState)||void 0===a?void 0:a.title})})]}),(0,oe.jsxs)("div",{className:ce,children:[(0,oe.jsx)("p",{className:ue,children:"Reference Number"}),(0,oe.jsx)("p",{className:"".concat(ve," mb-0"),children:null===j||void 0===j?void 0:j.referenceNumber})]}),(0,oe.jsxs)("div",{className:ce,children:[(0,oe.jsx)("p",{className:ue,children:"Submission By"}),(null===j||void 0===j?void 0:j.SubmissionBy)&&(0,oe.jsxs)("div",{className:ve,children:[null!==j&&void 0!==j&&null!==(c=j.SubmissionBy)&&void 0!==c&&c.logo?(0,oe.jsx)(g.Z,{src:"".concat(K.lj).concat(null===j||void 0===j||null===(u=j.SubmissionBy)||void 0===u?void 0:u.logo),alt:null===j||void 0===j||null===(v=j.SubmissionBy)||void 0===v?void 0:v.name,preview:!1,width:24,style:{objectFit:"contain"}}):(0,oe.jsx)(f.C,{size:24,icon:(0,oe.jsx)(O.Z,{}),style:{border:"1px solid var(--color-border)"}}),(0,oe.jsx)("p",{className:"mb-0",children:null===j||void 0===j||null===(m=j.SubmissionBy)||void 0===m?void 0:m.name})]})]})]}),(0,oe.jsxs)("div",{className:ae,children:[(0,oe.jsxs)("div",{className:"d-flex align-center",children:[(0,oe.jsx)(le.Z,{color:"dark-sub",children:"Files"}),(0,oe.jsx)(y.Z,{type:"link",onClick:function(){return p(!0)},className:"ml-auto font-size-normal color-dark-sub",style:{padding:0,margin:0},children:"Manage"})]}),(null===Z||void 0===Z||null===(_=Z.data)||void 0===_?void 0:_.length)>0?(0,oe.jsx)(fe.Z,{data:null===Z||void 0===Z?void 0:Z.data,meta:null===Z||void 0===Z?void 0:Z.meta,onRefresh:null===Z||void 0===Z?void 0:Z.onRefresh,projectId:null===j||void 0===j?void 0:j.id,fromChat:!0}):(0,oe.jsx)(je.Z,{className:"mt-1",description:"No files"})]}),(0,oe.jsxs)("div",{className:ae,children:[(0,oe.jsxs)("div",{className:"d-flex align-center",children:[(0,oe.jsx)(le.Z,{color:"dark-sub",className:"ml-2",children:"".concat(null===N||void 0===N?void 0:N.length," ").concat((null===N||void 0===N?void 0:N.length)>1?"Members":"Member")}),(0,oe.jsxs)("a",{className:"ml-auto d-flex align-center",href:"/projects/".concat(null===j||void 0===j?void 0:j.slug,"?id=").concat(null===j||void 0===j?void 0:j.id),target:"_blank",rel:"noreferrer",children:[(0,oe.jsx)(le.Z,{color:"dark-sub",children:"Manage"}),(0,oe.jsx)(pe.O,{className:"mr-0"})]})]}),(null===N||void 0===N?void 0:N.length)>0?(0,oe.jsx)("div",{className:me,children:null===N||void 0===N?void 0:N.map((function(e){var o=e.User,n=e.projectRole===de.nV.projectIncharge;return(0,oe.jsx)("div",{className:_e,children:(0,oe.jsxs)(q.Z,{type:"user",user:o,className:"d-flex align-center",children:[(0,oe.jsx)(f.C,{size:32,src:"".concat(K.lj).concat(null===o||void 0===o?void 0:o.profile),icon:(0,oe.jsx)(O.Z,{}),style:{border:"1px solid var(--color-border)"}}),(0,oe.jsx)("p",{className:he,children:"".concat(null===o||void 0===o?void 0:o.firstName," ").concat(null===o||void 0===o?void 0:o.lastName)}),n&&(0,oe.jsx)(ie.Z,{color:"blue",className:"ml-2",children:"Incharge"})]})},null===o||void 0===o?void 0:o.uuid)}))}):(0,oe.jsx)(je.Z,{className:"mt-1",description:"No members"})]})]})})},ye=n(69928),Ze=n(86948),Ne=u.Z.Header,we=u.Z.Sider,be=u.Z.Content,Ce=u.Z.Footer,Pe=v.Z.Text,Se=v.Z.Title,Me=function(){var e,o,n,v,w,b,C,P,M,k,W,Q=(0,H.aY)(B.n),O=(0,c.v9)((function(e){return e.usersReducer})).userPermissions,q=m.ZP.useMessage(),$=(0,r.Z)(q,2),J=$[0],ie=$[1],le=G.Z.getUserData(),de=(0,a.lr)(),re=(0,r.Z)(de,2),se=re[0],ae=re[1],ce=se.get("projectId"),ue=(0,s.useState)(),ve=(0,r.Z)(ue,2),me=ve[0],_e=ve[1],he=(0,s.useState)(!1),fe=(0,r.Z)(he,2),pe=fe[0],je=fe[1],ge=(0,s.useState)(!1),Me=(0,r.Z)(ge,2),ke=Me[0],Ie=Me[1],ze=(0,s.useState)(),Ee=(0,r.Z)(ze,2),Re=Ee[0],De=Ee[1],Te=(0,A.N)(Re,500),Ye=(0,s.useState)({data:[],meta:{},loading:{default:!0,reload:!1},showEndMessage:!1}),Ue=(0,r.Z)(Ye,2),Le=Ue[0],Fe=Ue[1],Be=(0,s.useState)(!1),He=(0,r.Z)(Be,2),Ke=He[0],Ae=He[1],Ve=(0,s.useRef)(),We=(0,s.useRef)(null);Ve.current=Ke;var Qe=(0,s.useState)({content:"",loading:!1}),Oe=(0,r.Z)(Qe,2),qe=Oe[0],Ge=Oe[1],$e=(0,s.useState)([]),Je=(0,r.Z)($e,2),Xe=Je[0],eo=Je[1],oo=(0,s.useState)({path:"",open:!1}),no=(0,r.Z)(oo,2),to=no[0],io=no[1],lo=(0,s.useState)({collapsed:!1,fetched:!1}),ro=(0,r.Z)(lo,2),so=ro[0],ao=ro[1],co=(0,s.useState)(!1),uo=(0,r.Z)(co,2),vo=uo[0],mo=uo[1],_o=(0,s.useMemo)((function(){return new F.Q}),[]),ho=(0,s.useMemo)((function(){return!(null===me||void 0===me||!me.slug)&&so.fetched}),[so.fetched,null===me||void 0===me?void 0:me.slug]),fo=(0,s.useMemo)((function(){var e,o,n=Le;return(null===n||void 0===n||null===(e=n.data)||void 0===e?void 0:e.length)<(null===n||void 0===n||null===(o=n.meta)||void 0===o?void 0:o.total)}),[null===Le||void 0===Le||null===(e=Le.data)||void 0===e?void 0:e.length,null===Le||void 0===Le||null===(o=Le.meta)||void 0===o?void 0:o.total]),po=(0,L.$5)({method:_o.getProjectListForChat}),jo=po.data,go=po.onRefresh,xo=po.loading,yo=po.setData,Zo=(0,L.K2)({method:function(){return _o.getRecordBySlug(null===me||void 0===me?void 0:me.slug)},condition:ho}),No=Zo.data,wo=Zo.onRefresh,bo=Zo.loading,Co=(0,L.K2)({method:_o.getProjectResources,initialQuery:{projectId:null===me||void 0===me?void 0:me.id,perPage:12},condition:ho}),Po=Co.data,So=Co.onRefresh,Mo=Co.loading,ko=Co.meta,Io=(0,s.useMemo)((function(){var e;return null===me||void 0===me||null===(e=me.ProjectMembers)||void 0===e?void 0:e.map((function(e){var o,n,t,i="".concat(null===e||void 0===e||null===(o=e.User)||void 0===o?void 0:o.firstName," ").concat(null===e||void 0===e||null===(n=e.User)||void 0===n?void 0:n.lastName),l=null===e||void 0===e||null===(t=e.User)||void 0===t?void 0:t.id;return{label:i,value:"[".concat(i,"](").concat(l,")")}}))}),[null===me||void 0===me?void 0:me.ProjectMembers]),zo=(0,s.useMemo)((function(){var e;return null===me||void 0===me||null===(e=me.ProjectMembers)||void 0===e?void 0:e.map((function(e){var o;return null===e||void 0===e||null===(o=e.User)||void 0===o?void 0:o.firstName}))}),[null===me||void 0===me?void 0:me.ProjectMembers]),Eo=(0,s.useMemo)((function(){return null===zo||void 0===zo?void 0:zo.slice(0,3)}),[zo]),Ro=(0,s.useMemo)((function(){return(null===zo||void 0===zo?void 0:zo.length)-(null===Eo||void 0===Eo?void 0:Eo.length)}),[Eo,zo]),Do=(0,s.useCallback)((function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",n=null===e||void 0===e?void 0:e.projectId,t=(0,d.Z)({projectId:n},e);Fe((function(e){return(0,d.Z)((0,d.Z)({},e),{},{loading:"default"===o?{default:!0,reload:!1}:{default:!1,reload:!0}})})),_o.getProjectConversations(t).then((function(e){var n=null===e||void 0===e?void 0:e.data,t=n.data,i=n.meta,r=t.filter((function(e){var o;return!(null!==Le&&void 0!==Le&&null!==(o=Le.data)&&void 0!==o&&o.some((function(o){return o.id===e.id})))})),s="default"===o?t:[].concat((0,l.Z)(null===Le||void 0===Le?void 0:Le.data),(0,l.Z)(r));Fe((function(e){return(0,d.Z)((0,d.Z)({},e),{},{data:s,meta:i,loading:{default:!1,reload:!1},showEndMessage:s.length===(null===i||void 0===i?void 0:i.total)})}))})).catch((function(e){var o=(0,H.S3)(e);m.ZP.error(o||"Something went wrong!"),Fe((function(e){return(0,d.Z)((0,d.Z)({},e),{},{loading:{default:!1,reload:!1}})}))}))}),[Le]),To=(0,s.useCallback)((function(e){var o=null===me||void 0===me?void 0:me.id;o&&(!0===O.updateProject?(Ge((function(e){return(0,d.Z)((0,d.Z)({},e),{},{loading:!0})})),_o.addProjectConversation((0,d.Z)((0,d.Z)({},e),{},{projectId:o})).then((function(e){Ge({loading:!1,content:""});var o=e.data.data;o&&o.projectId&&Fe((function(e){return(0,d.Z)((0,d.Z)({},e),{},{loading:{default:!1,reload:!1},data:[o].concat((0,l.Z)(e.data))})}))})).catch((function(e){var o=(0,H.S3)(e);m.ZP.error(o||"Something went wrong"),Ge((function(e){return(0,d.Z)((0,d.Z)({},e),{},{loading:!1})}))}))):m.ZP.error("You do not have permission to add conversations"))}),[null===me||void 0===me?void 0:me.id,O]),Yo=function(e){var o=e.message,n=e._Project,t=e._ProjectConversations,i=e._ProjectMembers,d=e.unreadConversationCount,r={id:null===n||void 0===n?void 0:n.id,title:null===n||void 0===n?void 0:n.title,slug:null===n||void 0===n?void 0:n.slug,onHold:null===n||void 0===n?void 0:n.onHold,referenceNumber:null===n||void 0===n?void 0:n.referenceNumber,ProjectMembers:i,ProjectConversation:t,unreadConversationCount:(null===o||void 0===o?void 0:o.projectId)===Number(ce)?0:d};yo((function(e){var n=null===e||void 0===e?void 0:e.filter((function(e){return e.id!==o.projectId}));return[r].concat((0,l.Z)(n))}))},Uo=function(e,o){var n=null===o||void 0===o?void 0:o.id;if(e&&e.projectId){var t=function(e){var o;return{addedDate:null===e||void 0===e?void 0:e.addedDate,message:null===e||void 0===e?void 0:e.message,mediaCount:null===e||void 0===e||null===(o=e.Media)||void 0===o?void 0:o.length}}(e),i=e.Project,r=e.unreadConversationCount||0,s=e.Project.ProjectMembers;e.projectId===n&&function(e){Fe((function(o){return(0,d.Z)((0,d.Z)({},o),{},{loading:{default:!1,reload:!1},data:[e].concat((0,l.Z)(o.data.filter((function(o){return o.id!==e.id}))))})}))}(e),Ve.current&&e.userId!==(null===le||void 0===le?void 0:le.id)&&(0,H._P)(),e.projectId!==n&&Yo({message:e,_Project:i,_ProjectConversations:t,_ProjectMembers:s,unreadConversationCount:r})}},Lo=(0,s.useCallback)((function(e){var o=null===me||void 0===me?void 0:me.id;!0===O.updateProject?_o.removeProjectConversations(e).then((function(n){var t;m.ZP.success((null===n||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message)||"conversation deleted successfully"),Do({projectId:o},"reload"),Fe((function(o){return(0,d.Z)((0,d.Z)({},o),{},{data:o.data.filter((function(o){return o.id!==e}))})}))})).catch((function(e){var o=(0,H.S3)(e);m.ZP.error(o||"Something went wrong")})):m.ZP.error("You do not have permission to delete conversations")}),[null===me||void 0===me?void 0:me.id]),Fo=(0,s.useCallback)(function(){var e=(0,i.Z)((0,t.Z)().mark((function e(o){var n,i,l,d,r,s,a,c;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.onSuccess,i=o.onError,l=o.file,d=new FormData,r={headers:{"content-type":"multipart/form-data"}},d.append("files[]",l),s=null===me||void 0===me?void 0:me.id,a=function(){n&&n({status:200}),eo([]),Do({projectId:s},"reload")},c=function(e){var o=(0,H.S3)(e);eo([]);var n="You do not have permission to upload files"===o?"permission":"error";J.open({key:n,type:"error",duration:5,content:o}),i&&i(new Error("Upload failed"))},e.prev=7,!0!==O.updateProject){e.next=14;break}return e.next=11,te.Z.post("project/uploadConversationFiles/".concat(s),d,r);case 11:a(),e.next=15;break;case 14:throw new Error("You do not have permission to upload files");case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),c(e.t0);case 20:case"end":return e.stop()}}),e,null,[[7,17]])})));return function(o){return e.apply(this,arguments)}}(),[null===me||void 0===me?void 0:me.id]),Bo=(0,s.useCallback)((function(){var e,o,n=Le;if((null===n||void 0===n||null===(e=n.meta)||void 0===e?void 0:e.page)<(null===n||void 0===n||null===(o=n.meta)||void 0===o?void 0:o.pageCount)){var t,i,l,d=(null===n||void 0===n||null===(t=n.data)||void 0===t?void 0:t.length)||0,r=null===n||void 0===n||null===(i=n.data)||void 0===i||null===(l=i[d-1])||void 0===l?void 0:l.id,s={projectId:null===me||void 0===me?void 0:me.id,before:r};Do(s,"reload")}}),[Le,null===me||void 0===me?void 0:me.id]);(0,s.useEffect)((function(){We.current&&(We.current.scrollTop=We.current.scrollHeight)}),[null===Le||void 0===Le||null===(n=Le.data)||void 0===n?void 0:n.length]),(0,s.useEffect)((function(){ao((function(e){return(0,d.Z)((0,d.Z)({},e),{},{collapsed:!1})}))}),[null===me||void 0===me?void 0:me.id]),(0,s.useEffect)((function(){null!==me&&void 0!==me&&me.slug&&so.fetched&&wo()}),[null===me||void 0===me?void 0:me.slug,so.fetched]),(0,s.useEffect)((function(){void 0!==Te?go({title:Te}):""===Te&&go({})}),[Te]),(0,s.useEffect)((function(){if(ce){var e=null===jo||void 0===jo?void 0:jo.find((function(e){return(null===e||void 0===e?void 0:e.id)===Number(ce)}));e&&(_e(e),Do({projectId:null===e||void 0===e?void 0:e.id},"reload"),ao((function(e){return(0,d.Z)((0,d.Z)({},e),{},{fetched:!1})})))}}),[jo]),(0,s.useEffect)((function(){var e=(0,V.I)();return e.on("chat",(function(e){Uo(e,me)})),function(){e.disconnect(),(0,V.g)()}}),[me]);var Ho=function e(){Ae(!0),document.removeEventListener("click",e)};return(0,s.useEffect)((function(){var e=!1,o=function(){if("visible"===document.visibilityState){var o=Number(se.get("projectId"));o&&e&&(Do({projectId:o},"reload"),e=!1)}else setTimeout((function(){e=!0}),8e3)};return document.addEventListener("visibilitychange",o),function(){document.removeEventListener("visibilitychange",o)}}),[]),(0,s.useEffect)((function(){return document.addEventListener("click",Ho),function(){document.removeEventListener("click",Ho)}}),[]),(0,oe.jsxs)(oe.Fragment,{children:[ie,(0,oe.jsxs)(D.Z,{permissionSlug:Q,showSidebar:!1,children:[(0,oe.jsxs)(u.Z,{className:ee.layout,children:[(0,oe.jsxs)(we,{className:ee.sider,width:window.innerWidth<768?window.innerWidth-10:350,breakpoint:"lg",theme:"light",zeroWidthTriggerStyle:{borderRadius:"100%",width:40,height:40,right:window.innerWidth<768&&vo?0:-20},trigger:vo?(0,oe.jsx)(S,{onClick:function(){return mo(!vo)},style:{fontSize:20,color:"var(--color-dark-sub)"}}):(0,oe.jsx)(I,{onClick:function(){return mo(!vo)},style:{fontSize:20,color:"var(--color-dark-sub)"}}),collapsible:!0,collapsed:vo,onCollapse:function(e){return mo(e)},children:[(0,oe.jsx)("div",{className:ee.sider_header,children:(0,oe.jsx)(T.t7,{placeHolder:"Search...",value:Re,onChange:function(e){return De(e.target.value)},onClick:function(){return mo(!1)}})}),!xo&&0===(null===jo||void 0===jo?void 0:jo.length)&&(0,oe.jsx)("div",{className:ee.sider_empty,children:(0,oe.jsx)(T.I$,{description:"No projects found"})}),xo?(0,oe.jsx)(_.Z,{avatar:!0,paragraph:{rows:4},style:{padding:"0 1rem"}}):(0,oe.jsx)(h.Z,{mode:"inline",defaultSelectedKeys:["project-".concat(ce)],items:null===jo||void 0===jo?void 0:jo.map((function(e,o){var n,t,i,r,s,a,c,u,v,m=null===e||void 0===e?void 0:e.unreadConversationCount;return{key:"project-".concat(null===e||void 0===e?void 0:e.id,"-").concat(o,"-").concat(1e3*Math.random()),label:(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsx)(T.ZT,{className:ee.sider_item_title,color:vo?"light-100":"dark-main",size:"sm",style:{marginBottom:5},weight:m>0?"bold":"normal",children:"".concat(null===e||void 0===e?void 0:e.referenceNumber," | ").concat(null===e||void 0===e?void 0:e.title)}),(null===e||void 0===e||null===(n=e.ProjectConversation)||void 0===n?void 0:n.message)&&(0,oe.jsxs)("div",{className:"d-flex",children:[(0,oe.jsx)(T.ZT,{className:ee.sider_item_last_message,color:vo?"light-100":"dark-sub",size:"xs",weight:m>0?"bold":"normal",children:null===e||void 0===e||null===(t=e.ProjectConversation)||void 0===t?void 0:t.message}),(0,oe.jsxs)("div",{className:"ml-auto mr-0 d-flex",children:[(0,oe.jsx)(T.ZT,{className:ee.sider_item_last_message,color:"dark-sub",size:"xs",weight:"normal",title:X()(null===e||void 0===e||null===(i=e.ProjectConversation)||void 0===i?void 0:i.addedDate).format("DD MMM, YYYY hh:mm A"),children:X()(null===e||void 0===e||null===(r=e.ProjectConversation)||void 0===r?void 0:r.addedDate).fromNow()}),m>0&&(0,oe.jsx)("div",{className:ee.badge,children:m>9?"9+":m})]})]}),(null===e||void 0===e||null===(s=e.ProjectConversation)||void 0===s?void 0:s.mediaCount)>0&&(0,oe.jsxs)("div",{className:"d-flex justify-space-between",children:[(0,oe.jsx)(T.ZT,{className:ee.sider_item_last_message,color:"dark-sub",size:"xs",weight:m>0?"bold":"normal",children:"".concat(null===e||void 0===e||null===(a=e.ProjectConversation)||void 0===a?void 0:a.mediaCount," file").concat((null===e||void 0===e||null===(c=e.ProjectConversation)||void 0===c?void 0:c.mediaCount)>1?"s":"")}),(0,oe.jsx)(T.ZT,{className:ee.sider_item_last_message,color:"dark-sub",size:"xs",weight:"normal",title:X()(null===e||void 0===e||null===(u=e.ProjectConversation)||void 0===u?void 0:u.addedDate).format("DD MMM, YYYY hh:mm A"),children:X()(null===e||void 0===e||null===(v=e.ProjectConversation)||void 0===v?void 0:v.addedDate).fromNow()}),m>0&&(0,oe.jsx)("div",{className:ee.badge,children:m>9?"9+":m})]})]}),icon:(0,oe.jsx)(Y.BF,{width:20,height:20}),onClick:function(){(null===me||void 0===me?void 0:me.id)!==(null===e||void 0===e?void 0:e.id)&&(ae({projectId:e.id.toString()},{replace:!0}),yo((function(o){var n=null===o||void 0===o?void 0:o.find((function(o){return o.id===e.id}));return n&&(n.unreadConversationCount=0),(0,l.Z)(o)})),Fe((function(e){return(0,d.Z)((0,d.Z)({},e),{},{data:[],showEndMessage:!1,loading:{default:!1,reload:!0}})})),window.innerWidth<768&&mo((function(e){return!1===e||e})))},className:ee.myProjectList+" "+((null===me||void 0===me?void 0:me.id)===(null===e||void 0===e?void 0:e.id)?ee.activeProject:"")}}))})]}),(0,oe.jsxs)(u.Z,{children:[(null===me||void 0===me?void 0:me.id)&&(0,oe.jsxs)(Ne,{className:"".concat(ee.header," trigger cursor-pointer"),style:{position:"sticky",top:0,zIndex:1,width:"100%"},onClick:function(){return ao((function(e){return(0,d.Z)((0,d.Z)({},e),{},{fetched:!0,collapsed:!e.collapsed})}))},children:[(0,oe.jsx)(f.C,{icon:(0,oe.jsx)(Y.BF,{})}),(0,oe.jsxs)("div",{className:ee.header_content,children:[(0,oe.jsx)(Se,{level:5,className:ee.header_content_title,ellipsis:{rows:1,expandable:!1,tooltip:"".concat(null===me||void 0===me?void 0:me.referenceNumber," | ").concat(null===me||void 0===me?void 0:me.title)},children:"".concat(null===me||void 0===me?void 0:me.referenceNumber," | ").concat(null===me||void 0===me?void 0:me.title)}),(null===me||void 0===me||null===(v=me.ProjectMembers)||void 0===v?void 0:v.length)>0&&(0,oe.jsx)(T.ZT,{className:ee.header_content_members,color:"dark-sub",size:"xs",children:"".concat(null===Eo||void 0===Eo?void 0:Eo.join(", ")," ").concat(Ro>0?"and ".concat(Ro," others"):"")})]}),(0,oe.jsx)(p.Z,{title:"Refresh",placement:"left",children:(0,oe.jsx)(Y.Du,{onClick:function(e){e.stopPropagation(),Do({projectId:null===me||void 0===me?void 0:me.id},"reload")}})})]}),(0,oe.jsxs)(be,{ref:We,className:ee.content,style:{height:window.innerHeight-60,widows:"100%",position:"relative",flexDirection:(null===Le||void 0===Le||null===(w=Le.data)||void 0===w?void 0:w.length)>0?"column-reverse":"column"},children:[!(null!==me&&void 0!==me&&me.id)&&(0,oe.jsx)("div",{className:ee.content_empty_wrapper,children:(0,oe.jsx)("div",{className:ee.content_empty,children:(0,oe.jsx)(T.I$,{description:"Select a project to see conversations",imageStyle:{height:200}})})}),(null===Le||void 0===Le||null===(b=Le.loading)||void 0===b?void 0:b.default)&&(null===me||void 0===me?void 0:me.id)&&(0,oe.jsx)(_.Z,{active:!0}),(null===me||void 0===me?void 0:me.id)&&0===(null===Le||void 0===Le||null===(C=Le.data)||void 0===C?void 0:C.length)&&(0,oe.jsx)("div",{className:ee.content_empty_wrapper,children:(0,oe.jsx)("div",{className:ee.content_empty,children:(0,oe.jsx)(T.I$,{description:"No conversations yet"})})}),(null===Le||void 0===Le||null===(P=Le.loading)||void 0===P?void 0:P.reload)&&(0,oe.jsx)("div",{className:ee.content_loader,children:(0,oe.jsx)(j.Z,{indicator:(0,oe.jsx)(z.Z,{style:{fontSize:20},spin:!0})})}),(null===Le||void 0===Le||null===(M=Le.data)||void 0===M?void 0:M.length)>0&&(0,oe.jsx)(Ze.Z,{dataLength:null===Le||void 0===Le||null===(k=Le.data)||void 0===k?void 0:k.length,hasMore:fo,inverse:!0,height:window.innerHeight-180,style:{display:"flex",flexDirection:"column-reverse",overflowX:"hidden"},next:Bo,loader:(0,oe.jsx)("div",{className:ee.content_loader,children:(0,oe.jsx)(j.Z,{indicator:(0,oe.jsx)(z.Z,{style:{fontSize:20},spin:!0})})}),endMessage:(null===Le||void 0===Le?void 0:Le.showEndMessage)&&(0,oe.jsx)("p",{className:"font-size-xs color-dark-sub",style:{textAlign:"center"},children:"End of conversations"}),children:(null===me||void 0===me?void 0:me.id)&&(null===Le||void 0===Le||null===(W=Le.data)||void 0===W?void 0:W.map((function(e){return(0,oe.jsx)(ne,{data:e,setSelectedFile:io,onRemoveConversation:Lo,projectMembers:null===me||void 0===me?void 0:me.ProjectMembers},e.id)})))})]}),(null===me||void 0===me?void 0:me.id)&&(0,oe.jsx)(Ce,{className:ee.conversations_footer,children:(0,oe.jsx)("div",{className:ee.conversations_form,children:(0,oe.jsx)("div",{className:ee.conversations_form_wrapper,children:(0,oe.jsxs)("div",{className:ee.conversations_form_input_wrapper,children:[(0,oe.jsx)("div",{style:{width:30},children:(0,oe.jsx)(g.Z,{preview:!1,width:30,height:30,className:ee.conversations_form_avatar,src:"".concat(K.lj).concat(null===le||void 0===le?void 0:le.profile),alt:"".concat(null===le||void 0===le?void 0:le.firstName," ").concat(null===le||void 0===le?void 0:le.lastName),style:{objectFit:"cover",borderRadius:"100%"}})}),(0,oe.jsx)(x.Z,{fileList:Xe,customRequest:Fo,showUploadList:!1,multiple:!0,maxCount:10,onChange:function(e){var o=e.fileList;o.length>10?m.ZP.error("You can only upload 10 files at a time"):eo(o)},beforeUpload:function(e,o){return o.length<10?(eo(o),!0):(m.ZP.error("You can only upload 10 files at a time"),!1)},children:(0,oe.jsx)("div",{className:"px-1",children:(0,oe.jsx)(y.Z,{size:"small",type:"text",style:{backgroundColor:"transparent"},icon:(0,oe.jsx)(E.Z,{style:{fontSize:18}})})})}),(0,oe.jsx)(Z.Z,{placeholder:"Type a message...  Tips: (Shift + Enter to send) (@ to mention)",className:"".concat(ee.conversations_form_input," w-100"),autoSize:{minRows:1,maxRows:4},onKeyDown:function(e){if("Enter"===e.key&&pe){if(e.preventDefault(),""===qe.content.trim())return;To({message:null===qe||void 0===qe?void 0:qe.content})}else"Shift"===e.key&&je(!0)},onKeyUp:function(e){"Shift"===e.key&&je(!1)},options:Io,value:qe.content,onChange:function(e){var o=null===e||void 0===e?void 0:e.replace(/\[(.*?)\]\(.*?\)/g,"$1");Ge((function(e){return(0,d.Z)((0,d.Z)({},e),{},{content:o})}))}}),qe.loading?(0,oe.jsx)(j.Z,{indicator:(0,oe.jsx)(z.Z,{style:{fontSize:20},spin:!0}),className:ee.conversations_form_send_loader}):(0,oe.jsx)(Y.jE,{className:ee.conversations_form_send,onClick:function(){""!==qe.content.trim()&&To({message:null===qe||void 0===qe?void 0:qe.content})}})]})})})})]}),so.collapsed&&(0,oe.jsxs)(we,{className:ee.collapsed_sider,collapsible:!0,collapsed:so.collapsed,onCollapse:function(e){return ao((function(o){return(0,d.Z)((0,d.Z)({},o),{},{collapsed:e})}))},collapsedWidth:430,trigger:null,style:{overflow:"auto",width:"100%"},children:[(0,oe.jsxs)("div",{className:ee.collapsed_sider_header,children:[(0,oe.jsx)(R.Z,{style:{fontSize:18,color:"var(--color-dark-sub)",marginRight:10},onClick:function(){return ao((function(e){return(0,d.Z)((0,d.Z)({},e),{},{collapsed:!1})}))}}),(0,oe.jsx)(Pe,{className:ee.collapsed_sider_header_title,ellipsis:{tooltip:"".concat(null===me||void 0===me?void 0:me.referenceNumber," | ").concat(null===me||void 0===me?void 0:me.title)},children:"".concat(null===me||void 0===me?void 0:me.referenceNumber," | ").concat(null===me||void 0===me?void 0:me.title)}),(0,oe.jsx)("a",{className:"ml-1",target:"_blank",rel:"noreferrer",href:"/projects/".concat(null===me||void 0===me?void 0:me.slug,"?id=").concat(null===me||void 0===me?void 0:me.id),children:(0,oe.jsx)(Y.O1,{width:18,height:18,className:"ml-auto mt-2"})})]}),(0,oe.jsx)(xe,{details:{data:No,files:{data:Po||[],meta:ko,onRefresh:So},loading:bo},setIsManageMediaOpen:Ie})]})]}),to.open&&(0,oe.jsx)(N.Z,{open:to.open,zIndex:9999,width:window.innerWidth>768?700:"100%",title:"Preview File",placement:"right",onClose:function(){return io({path:"",open:!1})},children:(0,oe.jsx)(U.Z,{file:to.path})}),ke&&(0,oe.jsx)(ye.Z,{projectId:null===me||void 0===me?void 0:me.id,isManageMediaOpen:ke,setIsManageMediaOpen:Ie,media:{loading:Mo,data:Po||[],onRefresh:So,meta:ko}})]})]})}}}]);