"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[1588],{87971:function(e,t,n){var i=n(1413),o=n(45987),r=n(47313),a=n(86136),l=n(37388),d=n(67907),c=n(1623),u=n(46417),s=["label","hint","asterisk","helperText","className"],v=a.Z.TextArea,f=(0,r.forwardRef)((function(e,t){var n=e.label,r=e.hint,a=e.asterisk,f=e.helperText,m=e.className,p=(0,o.Z)(e,s);return(0,u.jsxs)(u.Fragment,{children:[n?(0,u.jsxs)("label",{className:c.Z.labelWrap,children:[(0,u.jsx)("span",{children:n}),r?(0,u.jsx)(l.Z,{title:r,children:(0,u.jsx)(d.Z,{})}):null,a?(0,u.jsx)("span",{className:c.Z.asterisk,children:"*"}):null]}):null,(0,u.jsx)(v,(0,i.Z)((0,i.Z)({ref:t},p),{},{className:"".concat(c.Z.inpt," ").concat(m)})),f?(0,u.jsx)("small",{className:c.Z.helperText,children:f}):null]})}));f.defaultProps={autoSize:{minRows:4},placeholder:"Enter text here",asterisk:!1,hint:""},t.Z=f},91588:function(e,t,n){n.r(t),n.d(t,{default:function(){return ie}});var i,o,r=n(93433),a=n(4942),l=n(1413),d=n(29439),c=n(47313),u=n(2135),s=n(82626),v=n(85554),f=n(55291),m=n(70638),p=n(18515),h=n(5140),Z=n(4619),y=n(54060),x=n(37388),g=n(41586),j=n(16067),b=n(3109),S=n(5900),w=n(98676),P=n(3113),I=n(46417),k=function(e){var t=e.record,n=e.onEditIconClick,i=e.reloadTableData,o=e.permissions.deletePermit,r=(0,c.useMemo)((function(){return new Z.C}),[]),a=(0,c.useState)({confirmLoading:!1,openPopConfirm:!1}),u=(0,d.Z)(a,2),s=u[0],v=u[1];return(0,I.jsxs)("div",{className:P.Z.actions,children:[(0,I.jsx)("span",{onClick:function(){return n(t)},children:(0,I.jsx)("img",{src:"/images/editicon.svg",alt:"Edit Icon"})}),(0,I.jsx)(S.Z,{open:s.openPopConfirm,placement:"rightBottom",title:"Are you sure?",onConfirm:function(){if(v((function(e){return(0,l.Z)((0,l.Z)({},e),{},{confirmLoading:!0})})),!1===o)return f.ZP.error("You don't have permission to delete this record, please contact your admin."),void v((function(e){return(0,l.Z)((0,l.Z)({},e),{},{confirmLoading:!1,openPopConfirm:!1})}));r.deleteRecord(t.id).then((function(){v((function(e){return(0,l.Z)((0,l.Z)({},e),{},{openPopConfirm:!1,confirmLoading:!1})})),i()})).catch((function(e){var t,n,i=null===e||void 0===e||null===(t=e.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message;f.ZP.error(i||"Something went wrong, please try again later."),v((function(e){return(0,l.Z)((0,l.Z)({},e),{},{confirmLoading:!1,openPopConfirm:!1})}))}))},onCancel:function(){return v((0,l.Z)((0,l.Z)({},s),{},{openPopConfirm:!1}))},okButtonProps:{loading:s.confirmLoading},okText:"Yes",cancelText:"No",onOpenChange:function(e){e||v((0,l.Z)((0,l.Z)({},s),{},{openPopConfirm:!1}))},children:(0,I.jsx)(w.Z,{className:P.Z.bg__red,onClick:function(){return v((function(e){return(0,l.Z)((0,l.Z)({},e),{},{openPopConfirm:!0})}))}})})]})},N=n(98505),C=n(99700),R=n(3798),E=n(28080),A=n(78267),_=n(45705),D=n(32344),T=n(37936),F=n(70584),z=n(83168),M={finance:{enum:T.dq,options:F.JY,colors:(i={},(0,a.Z)(i,T.dq["Pending Payment"],"var(--color-yellow-dark)"),(0,a.Z)(i,T.dq.Paid,"var(--color-primary-main)"),(0,a.Z)(i,T.dq.Canceled,"var(--color-red-yp)"),i)},client:{enum:T.B1,options:F.HH,colors:(o={},(0,a.Z)(o,T.B1["To be sent"],"var(--color-yellow-dark)"),(0,a.Z)(o,T.B1.Sent,"var(--color-primary-main)"),o)}},O=function(e){var t=e.status,n=e.recordId,i=e.reloadTableData,o=e.type,r=e.permissions.updatePermit,a=f.ZP.useMessage(),l=(0,d.Z)(a,2),u=l[0],s=l[1],v=(0,c.useMemo)((function(){return new Z.C}),[]),m=function(e){u.open({key:e.key,type:e.type,content:e.content,duration:"loading"===e.type?0:2})},p=(0,c.useState)(!1),h=(0,d.Z)(p,2),y=h[0],x=h[1],g=(0,I.jsx)(E.Z,{className:"".concat(z.Z.overlay," pa-2"),children:M[o].options.map((function(e,a){var l=Number(e.value),d=t===l;return(0,I.jsx)("div",{className:z.Z.overlay_item,onClick:function(){d||function(e){if(n&&!0===r){m({key:"update",type:"loading",content:"Updating..."});var t={financeStatus:"finance"===o?e:void 0,clientStatus:"client"===o?e:void 0};v.updateRecord(t,n).then((function(e){var t,n;null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.data&&(m({key:"update",type:"success",content:null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message}),x(!y),i())})).catch((function(e){var t=(0,R.S3)(e);m({key:"update",type:"error",content:t})}))}else m({key:"update",type:"error",content:"You don't have permission to change status"})}(l)},children:(0,I.jsx)("span",{className:d?z.Z.disabledButton:"",style:{width:"100%"},children:e.label})},"Permits-status-".concat(a))}))});return(0,I.jsxs)(I.Fragment,{children:[s,(0,I.jsx)(A.Z,{dropdownRender:function(){return g},trigger:!0===r?["click"]:[],open:!0===r&&y,onOpenChange:function(e){return x(e)},className:z.Z.dropdown,children:(0,I.jsxs)(_.Z,{style:{color:M[o].colors[t],padding:"0.2rem 0.5rem",borderRadius:"0.25rem",fontSize:"0.8rem"},children:[M[o].enum[t],!0===r&&(0,I.jsx)(D.Z,{})]})})]})},L=n(45960),B=function(e){var t=e.tableData,n=e.tableLoading,i=e.onEditIconClick,o=e.reloadTableData,r=e.permissions,a=(0,c.useState)(),l=(0,d.Z)(a,2),u=l[0],s=l[1],v=[{title:"S.No",dataIndex:"index",key:"index",render:function(e,t,n){return n+1},width:"6%"},{title:"Overview",dataIndex:"title",key:"title",render:function(e,t){var n,i,o;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:"d-flex justify-between",children:(0,I.jsx)(b.Z,{color:"dark-main",size:"sm",weight:"bold",children:e})}),(0,I.jsxs)("div",{className:"d-flex justify-between",children:[(0,I.jsx)(b.Z,{color:"dark-main",size:"sm",weight:"bold",children:"Authority:"}),(0,I.jsx)(b.Z,{color:"dark-main",size:"sm",className:"ml-1",children:t.Authority.title})]}),(0,I.jsxs)("div",{className:"d-flex justify-between",children:[(0,I.jsx)(b.Z,{color:"dark-main",size:"sm",weight:"bold",children:"Remarks:"}),(0,I.jsx)(b.Z,{color:"dark-main",size:"sm",className:"ml-1",children:t.remarks})]}),(0,I.jsxs)("div",{className:"d-flex align-center mt-1",children:[(0,I.jsx)(b.Z,{color:"dark-sub",size:"sm",className:"cursor-pointer",children:"".concat((null===t||void 0===t||null===(n=t._count)||void 0===n?void 0:n.Resources)>0?"".concat(null===t||void 0===t||null===(i=t._count)||void 0===i?void 0:i.Resources," files Attached"):"No Attachments"," ")}),(null===t||void 0===t||null===(o=t._count)||void 0===o?void 0:o.Resources)>0&&(0,I.jsx)(x.Z,{title:"View Attachments",children:(0,I.jsx)(j.Z,{className:"ml-2 cursor-pointer",onClick:function(){return s({open:!0,id:t.id})}})})]})]})}},{title:"Project",dataIndex:"Project",key:"Project",render:function(e){return(0,I.jsxs)("a",{href:"/projects/".concat(null===e||void 0===e?void 0:e.slug,"?id=").concat(null===e||void 0===e?void 0:e.id),target:"_blank",rel:"noreferrer",title:"View Project",className:"d-flex align-center",children:[(0,I.jsx)(b.Z,{color:"dark-main",size:"sm",children:null===e||void 0===e?void 0:e.title}),(0,I.jsx)(C.O,{})]})}},{title:"Date/Status",dataIndex:"date",key:"date",render:function(e,t){var n=(0,R.H8)(null===t||void 0===t?void 0:t.expiryDate,(new Date).toISOString()),i=(0,R.VB)(null===t||void 0===t?void 0:t.expiryDate,30);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("div",{className:"d-flex justify-between",children:[(0,I.jsx)(b.Z,{color:"dark-main",size:"sm",weight:"bold",children:"Approved:"}),(0,I.jsx)(b.Z,{color:"dark-main",size:"sm",className:"ml-1",children:(0,N.Ny)(t.approvedDate,"MM dd,yy")})]}),(0,I.jsxs)("div",{className:"d-flex justify-between",children:[(0,I.jsx)(b.Z,{color:"dark-main",size:"sm",weight:"bold",children:"Expiry:"}),(0,I.jsx)(b.Z,{color:"dark-main",size:"sm",className:"ml-1",children:(0,N.Ny)(t.expiryDate,"MM dd,yy")})]}),(0,I.jsxs)("div",{className:"d-flex justify-between mt-2",children:[(0,I.jsx)(b.Z,{color:"dark-main",size:"sm",weight:"bold",children:"Status:"}),(0,I.jsx)(b.Z,{size:"sm",className:"ml-1 ".concat(n?"color-red-yp":"color-primary-main"),children:"".concat(n?"Expired":"Active"," ").concat(!n&&i?"(Expiring Soon)":"")})]})]})},width:"250px"},{title:"Finance Status",dataIndex:"financeStatus",key:"financeStatus",render:function(e,t){return(0,I.jsx)(O,{type:"finance",recordId:t.id,permissions:r,status:e,reloadTableData:o})},width:"150px"},{title:"Client Status",dataIndex:"clientStatus",key:"clientStatus",render:function(e,t){return(0,I.jsx)(O,{type:"client",recordId:t.id,permissions:r,status:e,reloadTableData:o})},width:"150px"},{title:"Actions",dataIndex:"actions",key:"actions",render:function(e,t){return(0,I.jsx)(k,{record:t,onEditIconClick:i,reloadTableData:o,permissions:r})},width:"120px"}];return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(g.Z,{sticky:!0,dataSource:t,columns:v,pagination:!1,scroll:{x:991},loading:n,rowKey:function(e){return"permit-".concat(e.id)}}),(null===u||void 0===u?void 0:u.open)&&(0,I.jsx)(L.Z,{id:u.id,open:u.open,onClose:function(){return s({open:!1,id:0})}})]})},H=n(29079),V=n(25019),q=n(69309),Y=n(70816),U=n.n(Y),X=n(69591),J=n(42623),Q=n(86300),K=n(87971),W=n(48897),$=n(40096),G=function(e){var t,n=e.openModal,i=e.onCancel,o=e.type,a=e.record,u=e.projectId,v=e.reloadTableData,m=e.permissions,p=m.createPermit,h=m.updatePermit,y=$.Z.getLocalAccessToken(),x=V.Z.useForm(),g=(0,d.Z)(x,1)[0],j=(0,c.useMemo)((function(){return new Z.C}),[]),b=(0,c.useMemo)((function(){return new X.Q}),[]),S=(0,c.useMemo)((function(){return new Q.U}),[]),w=(0,c.useState)(""),k=(0,d.Z)(w,2),N=k[0],C=k[1],E=(0,J.N)(N,500),A=(0,c.useState)(""),_=(0,d.Z)(A,2),D=_[0],T=_[1],z=((0,J.N)(D,500),(0,c.useState)([])),M=(0,d.Z)(z,2),O=M[0],L=M[1],B=(0,c.useState)([]),Y=(0,d.Z)(B,2),G=Y[0],ee=Y[1],te=(0,H.K2)({method:function(){return j.getRecordById(a)},condition:"edit"===o&&0!==a}).data,ne=(0,c.useState)(!1),ie=(0,d.Z)(ne,2),oe=ie[0],re=ie[1];(0,c.useEffect)((function(){if("edit"===o&&te){var e=te.projectId,t=te.authorityId,n=te.expiryDate,i=te.approvedDate,r=te.financeStatus,a=te.clientStatus,l=te.title,d=te.remarks;g.setFieldsValue({projectId:e,authorityId:t,title:l,remarks:d,expiryDate:U()(n),approvedDate:U()(i),financeStatus:r,clientStatus:a})}else g.resetFields()}),[o,te]);var ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.title,n=e.ids;b.getAllRecords({title:t,ids:n}).then((function(e){var t=(null===e||void 0===e?void 0:e.data).data;L((function(e){var n=null===t||void 0===t?void 0:t.filter((function(t){return!(null!==e&&void 0!==e&&e.find((function(e){return e.id===t.id})))}));return[].concat((0,r.Z)(e),(0,r.Z)(n))}))})).catch((function(e){var t=(0,R.S3)(e);f.ZP.error(t)}))},le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.title,n=e.id;S.publishedRecords({title:t,id:n,perPage:100}).then((function(e){var t=(null===e||void 0===e?void 0:e.data).data;ee((function(e){var n=null===t||void 0===t?void 0:t.filter((function(t){return!(null!==e&&void 0!==e&&e.find((function(e){return e.id===t.id})))}));return[].concat((0,r.Z)(e),(0,r.Z)(n))}))})).catch((function(e){var t=(0,R.S3)(e);f.ZP.error(t)}))};return(0,c.useEffect)((function(){E&&ae({title:E})}),[E]),(0,c.useEffect)((function(){if(te){var e=te.authorityId,t=te.projectId;t&&ae({ids:[t]}),e&&le({id:e})}}),[null===te||void 0===te?void 0:te.projectId,null===te||void 0===te?void 0:te.authorityId]),(0,c.useEffect)((function(){"new"===o&&u&&(ae({ids:[u]}),g.setFieldsValue({projectId:u}))}),[u]),(0,c.useEffect)((function(){le()}),[]),(0,I.jsx)(s.P0,{visible:n,closable:!0,onCancel:i,showFooter:!1,titleText:"edit"===o?"Edit Permit":"Add New Permit",children:(0,I.jsxs)(V.Z,{className:P.Z.form,onFinish:function(e){var t,n,r,c;re(!0);var u=new FormData,s=null===e||void 0===e||null===(t=e.expiryDate)||void 0===t?void 0:t.toISOString(),m=null===e||void 0===e||null===(n=e.approvedDate)||void 0===n?void 0:n.toISOString(),Z=null===e||void 0===e||null===(r=e.files)||void 0===r||null===(c=r.fileList)||void 0===c?void 0:c.map((function(e){return null===e||void 0===e?void 0:e.originFileObj})),y=(0,l.Z)((0,l.Z)({},e),{},{expiryDate:s,approvedDate:m,files:Z});switch(Object.entries(y).forEach((function(e){var t=(0,d.Z)(e,2),n=t[0],i=t[1];i&&("files"===n&&("files"===n&&"string"!==typeof i&&"number"!==typeof i)?i.forEach((function(e){e&&u.append("files[]",e)})):u.append(n,i))})),o){case"new":!0===p?j.createRecord(u).then((function(e){var t;f.ZP.success((null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Permit created successfully"),v(),i()})).catch((function(e){var t=(0,R.S3)(e);f.ZP.error(t||"Something went wrong, please try again later.")})).finally((function(){re(!1)})):(re(!1),f.ZP.error("You don't have permission to create a new record"));break;case"edit":!0===h?j.updateRecord(u,a).then((function(e){v(),i()})).catch((function(e){var t=(0,R.S3)(e);f.ZP.error(t||"Something went wrong, please try again later.")})).finally((function(){re(!1)})):f.ZP.error("You don't have permission to update this record");break;default:re(!1)}},form:g,children:[(0,I.jsx)("div",{children:(0,I.jsx)(V.Z.Item,{name:"projectId",rules:[{required:!0,message:"Please select a project"}],children:(0,I.jsx)(s.Ld,{label:"Select Project",notFoundDescription:"No projects found., Please search for projects.",onSearch:function(e){return C(e)},options:null===O||void 0===O?void 0:O.map((function(e){return{label:"".concat(e.referenceNumber," | ").concat(e.title),value:e.id}})),onChange:function(e){return g.setFieldsValue({projectId:e})}})})}),(0,I.jsx)("div",{children:(0,I.jsx)(V.Z.Item,{name:"authorityId",rules:[{required:!0,message:"Please select a authority"}],children:(0,I.jsx)(s.Ld,{label:"Select Authority",notFoundDescription:"No authority found., Please search for authority.",onSearch:function(e){return T(e)},options:null===G||void 0===G?void 0:G.map((function(e){return{label:e.title,value:e.id}})),onChange:function(e){return g.setFieldsValue({authorityId:e})}})})}),(0,I.jsx)("div",{children:(0,I.jsx)(V.Z.Item,{name:"title",rules:[{required:!0,message:"Please add a title"}],children:(0,I.jsx)(s.t7,{label:"Title",asterisk:!0,size:"w100"})})}),(0,I.jsx)("div",{children:(0,I.jsx)(V.Z.Item,{name:"remarks",children:(0,I.jsx)(K.Z,{label:"Remarks",placeholder:"Add remarks"})})}),(0,I.jsxs)("div",{children:[(0,I.jsxs)("label",{style:{width:"100%"},className:"d-flex flex-column font-size-sm color-dark-main",children:["Approved Date",(0,I.jsx)(V.Z.Item,{name:"approvedDate",rules:[{required:!0,message:"Please add approved date"}],children:(0,I.jsx)(q.Z,{style:{width:"100%"}})})]}),(0,I.jsxs)("label",{style:{width:"100%"},className:"d-flex flex-column font-size-sm color-dark-main",children:["Expiry Date",(0,I.jsx)(V.Z.Item,{name:"expiryDate",rules:[{required:!0,message:"Please add expiry date"}],children:(0,I.jsx)(q.Z,{style:{width:"100%"}})})]})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(V.Z.Item,{name:"financeStatus",rules:[{required:!0,message:"Please select a finance status"}],children:(0,I.jsx)(s.AP,{label:"Finance Status",asterisk:!0,options:F.JY.map((function(e){return{label:e.label,value:e.value}}))})}),(0,I.jsx)(V.Z.Item,{name:"clientStatus",rules:[{required:!0,message:"Please select a client status"}],children:(0,I.jsx)(s.AP,{label:"Client Status",asterisk:!0,options:F.HH.map((function(e){return{label:e.label,value:e.value}}))})})]}),(0,I.jsx)("div",{children:(0,I.jsx)(s.wA,{name:"files",title:"File",required:"new"===o,multiple:!0,listType:"picture-card",defaultFileList:"edit"===o&&(null===te||void 0===te?void 0:te.Resources)&&(null===te||void 0===te||null===(t=te.Resources)||void 0===t?void 0:t.map((function(e){return{uid:"".concat(null===e||void 0===e?void 0:e.id),name:null===e||void 0===e?void 0:e.path,status:"done",url:"".concat(W.Q7).concat(e.path,"?authKey=").concat(y)}})))||[]})}),(0,I.jsxs)("div",{className:P.Z.footer,children:[(0,I.jsx)(s.op,{size:"normal",fontSize:"sm",onClick:i,type:"plain",children:"Cancel"}),(0,I.jsx)(s.op,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:oe,children:"Submit"})]})]})})},ee=n(48297),te=[{text:"Home",isLink:!0,path:"/"},{isLink:!1,text:"Permits"}],ne=[{label:"All",value:"all"},{label:"Active",value:"onlyActive"},{label:"Expired",value:"onlyExpired"}],ie=function(){var e,t,n,i=(0,R.aY)(h.O),o=(0,v.v9)((function(e){return e.usersReducer})).userPermissions,x=o.readPermit,g=o.createPermit,j=o.updatePermit,b=(0,u.lr)(),S=(0,d.Z)(b,2),w=S[0],P=S[1],k=w.get("id"),C=w.get("projectId"),E=w.get("actionType"),A=(0,c.useMemo)((function(){return new Z.C}),[]),_=(0,c.useMemo)((function(){return new X.Q}),[]),D=(0,c.useMemo)((function(){return new ee.V}),[]),T=(0,c.useMemo)((function(){return new Q.U}),[]),z=(0,H.$5)({method:A.getAllRecords,initialQuery:{onlyActive:!E||void 0,projectId:C?Number(C):void 0}}),M=z.data,O=z.onRefresh,L=z.meta,V=z.loading,q=(0,c.useState)("onlyActive"),Y=(0,d.Z)(q,2),U=Y[0],K=Y[1],W=(0,c.useState)({type:"new",recordId:0,open:!1}),$=(0,d.Z)(W,2),ie=$[0],oe=$[1],re=(0,c.useState)({dateRange:[""]}),ae=(0,d.Z)(re,2),le=ae[0],de=ae[1],ce=(0,c.useState)(!1),ue=(0,d.Z)(ce,2),se=ue[0],ve=ue[1],fe=(0,c.useState)(void 0),me=(0,d.Z)(fe,2),pe=me[0],he=me[1],Ze=(0,J.N)(pe,500),ye=(0,c.useState)(void 0),xe=(0,d.Z)(ye,2),ge=xe[0],je=xe[1],be=(0,J.N)(ge,500),Se=(0,c.useState)(void 0),we=(0,d.Z)(Se,2),Pe=we[0],Ie=we[1],ke=(0,J.N)(Pe,500),Ne=(0,c.useState)({data:[],loading:!1}),Ce=(0,d.Z)(Ne,2),Re=Ce[0],Ee=Ce[1],Ae=(0,c.useState)({data:[],loading:!1}),_e=(0,d.Z)(Ae,2),De=_e[0],Te=_e[1],Fe=(0,c.useState)({data:[],loading:!1}),ze=(0,d.Z)(Fe,2),Me=ze[0],Oe=ze[1],Le=function(){!1!==g?oe((0,l.Z)((0,l.Z)({},ie),{},{open:!ie.open,type:"new"})):f.ZP.error("You don't have permission to update this record")},Be=function(e){var t=null===e||void 0===e?void 0:e.target,n=t.name,i=t.value;if(("clientId"===n||"authorityId"===n||"projectId"===n)&&!(0,R.hj)(i)){var o="";switch(n){case"clientId":o="Client ID";break;case"authorityId":o="Authority ID";break;case"projectId":o="Project ID"}return f.ZP.error("".concat(o," should be a number"))}de((function(e){return(0,l.Z)((0,l.Z)({},e),{},(0,a.Z)({},n,i))}))},He=(0,c.useCallback)((function(e,t){e&&(ve(!0),de((0,l.Z)((0,l.Z)({},le),{},(0,a.Z)({},e,t))))}),[le]),Ve=(0,c.useCallback)((function(e){var t,n,i=(null===(t=le.dateRange)||void 0===t?void 0:t[0])||"",o=(null===(n=le.dateRange)||void 0===n?void 0:n[1])||"",r=i?(0,N.Ny)(i,"yy-mm-dd"):void 0,a=o?(0,N.Ny)(o,"yy-mm-dd"):void 0,d=(0,l.Z)({fromDate:r,toDate:a,clientId:le.clientId||void 0,projectId:le.projectId||void 0,authorityId:le.authorityId||void 0,financeStatus:le.financeStatus||void 0,clientStatus:le.clientStatus||void 0,onlyActive:!!le.onlyActive||void 0,onlyExpired:!!le.onlyExpired||void 0},e);O(d)}),[le]),qe=function(e){var t=e.title,n=e.ids;Ee((function(e){return(0,l.Z)((0,l.Z)({},e),{},{loading:!0})})),_.getAllRecords({title:t,ids:n}).then((function(e){var t=(null===e||void 0===e?void 0:e.data).data;Ee((function(e){return(0,l.Z)((0,l.Z)({},e),{},{data:t,loading:!1})}))})).finally((function(){Ee((function(e){return(0,l.Z)((0,l.Z)({},e),{},{loading:!1})}))}))},Ye=(0,c.useCallback)((function(){be&&(Te((function(e){return(0,l.Z)((0,l.Z)({},e),{},{loading:!0})})),D.findPublished({name:be}).then((function(e){var t,n=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.data;Te((function(e){var t=null===n||void 0===n?void 0:n.filter((function(t){var n;return!(null!==e&&void 0!==e&&null!==(n=e.data)&&void 0!==n&&n.find((function(e){return e.id===t.id})))}));return{data:[].concat((0,r.Z)(e.data),(0,r.Z)(t)),loading:!1}}))})).catch((function(e){var t=(0,R.S3)(e);f.ZP.error(t||"Something went wrong, please try again later."),Te((function(e){return(0,l.Z)((0,l.Z)({},e),{},{loading:!1})}))})))}),[be]),Ue=(0,c.useCallback)((function(){ke&&(Oe((function(e){return(0,l.Z)((0,l.Z)({},e),{},{loading:!0})})),T.getAllRecords({name:ke}).then((function(e){var t,n=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.data;Oe((function(e){var t=null===n||void 0===n?void 0:n.filter((function(t){var n;return!(null!==e&&void 0!==e&&null!==(n=e.data)&&void 0!==n&&n.find((function(e){return e.id===t.id})))}));return{data:[].concat((0,r.Z)(e.data),(0,r.Z)(t)),loading:!1}}))})).catch((function(e){var t=(0,R.S3)(e);f.ZP.error(t||"Something went wrong, please try again later."),Oe((function(e){return(0,l.Z)((0,l.Z)({},e),{},{loading:!1})}))})))}),[ke]);return(0,c.useEffect)((function(){se&&Ve();var e=setTimeout((function(){ve(!1)}),2e3);return function(){return clearTimeout(e)}}),[se,le,Ve]),(0,c.useEffect)((function(){Ze&&qe({title:Ze})}),[Ze]),(0,c.useEffect)((function(){Ye()}),[Ye]),(0,c.useEffect)((function(){Ue()}),[Ue]),(0,c.useEffect)((function(){var e=function(){K("all"),de((function(e){return(0,l.Z)((0,l.Z)({},e),{},{projectId:Number(C)})})),qe({ids:[Number(C)]})};switch(E){case"create":C&&(e(),oe((0,l.Z)((0,l.Z)({},ie),{},{open:!0,type:"new",projectId:Number(C)})),(0,R.nA)(["actionType","projectId"],P));break;case"edit":k&&C&&(e(),oe((0,l.Z)((0,l.Z)({},ie),{},{open:!0,type:"edit",recordId:Number(k),projectId:Number(C)})),(0,R.nA)(["actionType","id","projectId"],P));break;case"view":k&&C&&(e(),(0,R.nA)(["actionType","id","projectId"],P))}}),[E,C,k]),(0,I.jsxs)(y.Z,{permissionSlug:i,children:[(0,I.jsx)(s.mr,{heading:"Permits",buttonText:"Add Permit",onButtonClick:Le,breadCrumbData:te,showAdd:!!g,filters:x?(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{style:{overflow:"auto"},children:(0,I.jsx)(m.Z,{size:"middle",value:U,options:ne.map((function(e){return(0,l.Z)((0,l.Z)({},e),{},{title:e.label,value:e.value})})),style:{fontSize:"var(--font-size-sm)"},onChange:function(e){"all"===e?(Ve({onlyActive:void 0,onlyExpired:void 0}),de((function(e){return(0,l.Z)((0,l.Z)({},e),{},{onlyActive:void 0,onlyExpired:void 0})}))):(He(e,""),de((function(t){return(0,l.Z)((0,l.Z)({},t),{},{onlyActive:"onlyActive"===e||void 0,onlyExpired:"onlyExpired"===e||void 0})}))),K(e)}})}),(0,I.jsx)("div",{children:(0,I.jsx)(s.Xy,{type:"datepicker",label:"Expiry Date",name:"dateRange",onChange:function(e){return de((function(t){return(0,l.Z)((0,l.Z)({},t),{},{dateRange:e})}))},onReset:function(){return He("dateRange",[])},onUpdate:Ve})}),(0,I.jsx)("div",{children:(0,I.jsx)(s.Xy,{type:"radio",label:"Project",name:"projectId",withSearch:!0,options:null===Re||void 0===Re||null===(e=Re.data)||void 0===e?void 0:e.map((function(e){return{label:"".concat(e.referenceNumber," | ").concat(e.title),value:"".concat(e.id)}})),onChange:Be,value:Number(null===le||void 0===le?void 0:le.projectId)>0?String(null===le||void 0===le?void 0:le.projectId):"",onReset:function(){He("projectId",0),he("")},onUpdate:Ve,loading:null===Re||void 0===Re?void 0:Re.loading,searchTerm:pe||"",onSearch:function(e){return he(e.currentTarget.value)},defaultValue:Number(null===le||void 0===le?void 0:le.projectId)>0?String(null===le||void 0===le?void 0:le.projectId):""})}),(0,I.jsx)("div",{children:(0,I.jsx)(s.Xy,{type:"radio",label:"Client",name:"clientId",withSearch:!0,options:null===De||void 0===De||null===(t=De.data)||void 0===t?void 0:t.map((function(e){return{label:e.name,value:"".concat(e.id)}})),onChange:Be,value:Number(null===le||void 0===le?void 0:le.clientId)>0?String(null===le||void 0===le?void 0:le.clientId):"",onReset:function(){He("clientId",0),je("")},onUpdate:Ve,loading:null===De||void 0===De?void 0:De.loading,searchTerm:ge||"",onSearch:function(e){return je(e.currentTarget.value)}})}),(0,I.jsx)("div",{children:(0,I.jsx)(s.Xy,{type:"radio",label:"Authority",name:"authorityId",withSearch:!0,options:null===Me||void 0===Me||null===(n=Me.data)||void 0===n?void 0:n.map((function(e){return{label:e.title,value:"".concat(e.id)}})),onChange:Be,value:Number(null===le||void 0===le?void 0:le.authorityId)>0?String(null===le||void 0===le?void 0:le.authorityId):"",onReset:function(){He("authorityId",0),Ie("")},onUpdate:Ve,loading:null===Me||void 0===Me?void 0:Me.loading,searchTerm:Pe||"",onSearch:function(e){return Ie(e.currentTarget.value)}})}),(0,I.jsx)("div",{children:(0,I.jsx)(s.Xy,{type:"radio",label:"Finance Status",name:"financeStatus",options:null===F.JY||void 0===F.JY?void 0:F.JY.map((function(e){return{label:e.label,value:e.value}})),value:"".concat(null===le||void 0===le?void 0:le.financeStatus),onChange:Be,onReset:function(){return He("financeStatus","")},onUpdate:Ve})}),(0,I.jsx)("div",{children:(0,I.jsx)(s.Xy,{type:"radio",label:"Client Status",name:"clientStatus",options:null===F.HH||void 0===F.HH?void 0:F.HH.map((function(e){return{label:e.label,value:e.value}})),value:"".concat(null===le||void 0===le?void 0:le.clientStatus),onChange:Be,onReset:function(){return He("clientStatus","")},onUpdate:Ve})})]}):null}),!0===x&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(B,{tableData:M,tableLoading:V,onEditIconClick:function(e){!1!==j?oe((0,l.Z)((0,l.Z)({},ie),{},{open:!ie.open,type:"edit",recordId:e.id})):f.ZP.error("You don't have permission to update this record")},reloadTableData:O,permissions:o}),(0,I.jsx)(s.tl,{total:null===L||void 0===L?void 0:L.total,current:null===L||void 0===L?void 0:L.page,defaultPageSize:null!==L&&void 0!==L&&L.perPage?null===L||void 0===L?void 0:L.perPage:10,pageSizeOptions:[10,20,50,100],onChange:function(e,t){return Ve({page:e,perPage:t})}})]}),!1===x&&(0,I.jsx)(p.a$,{mainMessage:"You don't have permission to view this data"}),ie.open&&(0,I.jsx)(G,{type:ie.type,openModal:ie.open,record:ie.recordId,projectId:ie.projectId,onCancel:Le,reloadTableData:O,permissions:o})]})}},45960:function(e,t,n){var i=n(47313),o=n(8570),r=n(97258),a=n(47312),l=n(21680),d=n(37388),c=n(48897),u=n(29079),s=n(4619),v=n(83168),f=n(40096),m=n(99700),p=n(46417),h=o.Z.Text;t.Z=function(e){var t,n=e.onClose,o=e.open,Z=e.id,y=(0,i.useMemo)((function(){return new s.C}),[]),x=f.Z.getLocalAccessToken(),g=(0,u.K2)({method:function(){return y.getRecordById(Z)},condition:!!Z&&o&&Z>0}),j=g.data,b=g.loading;return(0,p.jsx)(r.Z,{open:o,onClose:n,width:window.innerWidth>500?500:"100%",title:"".concat(null===j||void 0===j?void 0:j.title," Files"),placement:"right",destroyOnClose:!0,bodyStyle:{padding:"0px 25px"},children:b?(0,p.jsx)(a.Z,{active:!0}):(0,p.jsx)(p.Fragment,{children:null===j||void 0===j||null===(t=j.Resources)||void 0===t?void 0:t.map((function(e,t){var n,i;return(0,p.jsxs)("div",{className:v.Z.permitFiles,children:[null!==(n=e.fileType)&&void 0!==n&&n.includes("image")?(0,p.jsx)(l.Z,{src:"".concat(c.Q7).concat(e.path,"?authKey=").concat(x),alt:e.title,width:100,height:70,style:{borderRadius:5,objectFit:"cover"}}):(0,p.jsx)(l.Z,{src:"/images/doc.png",alt:"Document-".concat(t),width:100,height:70,preview:!1,style:{objectFit:"contain"}}),(0,p.jsx)(h,{ellipsis:{tooltip:e.title},children:e.title||e.name}),!(null!==(i=e.fileType)&&void 0!==i&&i.includes("image"))&&(0,p.jsx)(d.Z,{title:"View Document",children:(0,p.jsx)("a",{href:"".concat(c.PO).concat(e.path),target:"_blank",rel:"noreferrer",children:(0,p.jsx)(m.O,{})})})]},t)}))})})}},86300:function(e,t,n){n.d(t,{U:function(){return a}});var i=n(43144),o=n(15671),r=n(49075),a=(0,i.Z)((function e(){var t=this;(0,o.Z)(this,e),this.endPoint="authorities",this.getAllRecords=function(e){return r.Z.get(t.endPoint,{params:e})},this.publishedRecords=function(e){return r.Z.get("".concat(t.endPoint,"/find-published"),{params:e})},this.getRecordById=function(e){return r.Z.get(r._+t.endPoint+"/"+e)},this.deleteRecord=function(e){return r.Z.delete(r._+t.endPoint+"/"+e)},this.createRecord=function(e){return r.Z.post(r._+t.endPoint,e)},this.updateRecord=function(e,n){return r.Z.patch(r._+t.endPoint+"/"+n,e)}}))},48297:function(e,t,n){n.d(t,{V:function(){return a}});var i=n(43144),o=n(15671),r=n(49075),a=(0,i.Z)((function e(){var t=this;(0,o.Z)(this,e),this.endPoint="client",this.getAllRecords=function(e){return r.Z.get(t.endPoint,{params:e})},this.getRecordById=function(e){return r.Z.get("".concat(t.endPoint,"/").concat(e))},this.findPublished=function(e){return r.Z.get("".concat(t.endPoint,"/find-published"),{params:e})},this.deleteRecord=function(e){return r.Z.delete("".concat(t.endPoint,"/").concat(e))},this.createRecord=function(e){return r.Z.post(t.endPoint,e)},this.updateRecord=function(e,n){return r.Z.patch("".concat(t.endPoint,"/").concat(n),e)}}))},4619:function(e,t,n){n.d(t,{C:function(){return l}});var i=n(43144),o=n(15671),r=n(49075),a=n(3135),l=(0,i.Z)((function e(){var t=this;(0,o.Z)(this,e),this.endPoint="permits",this.getAllRecords=function(e){return r.Z.get(t.endPoint,{params:e})},this.getRecordById=function(e){return r.Z.get("".concat(t.endPoint,"/").concat(e))},this.deleteRecord=function(e){return r.Z.delete("".concat(t.endPoint,"/").concat(e))},this.createRecord=function(e){return r.Z.post(t.endPoint,e,{headers:a.C})},this.updateRecord=function(e,n){return r.Z.patch("".concat(t.endPoint,"/").concat(n),e,{headers:a.C})}}))},70584:function(e,t,n){n.d(t,{HH:function(){return l},JY:function(){return a},Ug:function(){return d},hx:function(){return r},vA:function(){return u},xy:function(){return c}});var i=n(29439),o=n(37936),r=function(e){return Object.entries(e).filter((function(e){var t=(0,i.Z)(e,1)[0];return isNaN(Number(t))})).map((function(e){var t=(0,i.Z)(e,2);return{label:t[0],value:t[1]}}))},a=r(o.dq),l=r(o.B1),d=r(o.LN),c=r(o.PH),u=r(o.fk)},16067:function(e,t,n){var i=n(87462),o=n(47313),r=n(18822),a=n(16141),l=function(e,t){return o.createElement(a.Z,(0,i.Z)({},e,{ref:t,icon:r.Z}))};t.Z=o.forwardRef(l)},70638:function(e,t,n){n.d(t,{Z:function(){return N}});var i=n(4942),o=n(87462),r=n(71002),a=n(46123),l=n.n(a),d=n(29439),c=n(45987),u=n(1413),s=n(47313),v=n(10288),f=n(16945),m=n(205),p=n(25266),h=n(72846),Z=function(e){return e?{left:e.offsetLeft,right:e.parentElement.clientWidth-e.clientWidth-e.offsetLeft,width:e.clientWidth}:null},y=function(e){return void 0!==e?"".concat(e,"px"):void 0};function x(e){var t=e.prefixCls,n=e.containerRef,i=e.value,o=e.getValueIndex,r=e.motionName,a=e.onMotionStart,c=e.onMotionEnd,v=e.direction,m=s.useRef(null),x=s.useState(i),g=(0,d.Z)(x,2),j=g[0],b=g[1],S=function(e){var i,r=o(e),a=null===(i=n.current)||void 0===i?void 0:i.querySelectorAll(".".concat(t,"-item"))[r];return(null===a||void 0===a?void 0:a.offsetParent)&&a},w=s.useState(null),P=(0,d.Z)(w,2),I=P[0],k=P[1],N=s.useState(null),C=(0,d.Z)(N,2),R=C[0],E=C[1];(0,h.Z)((function(){if(j!==i){var e=S(j),t=S(i),n=Z(e),o=Z(t);b(i),k(n),E(o),e&&t?a():c()}}),[i]);var A=s.useMemo((function(){return y("rtl"===v?-(null===I||void 0===I?void 0:I.right):null===I||void 0===I?void 0:I.left)}),[v,I]),_=s.useMemo((function(){return y("rtl"===v?-(null===R||void 0===R?void 0:R.right):null===R||void 0===R?void 0:R.left)}),[v,R]);return I&&R?s.createElement(p.ZP,{visible:!0,motionName:r,motionAppear:!0,onAppearStart:function(){return{transform:"translateX(var(--thumb-start-left))",width:"var(--thumb-start-width)"}},onAppearActive:function(){return{transform:"translateX(var(--thumb-active-left))",width:"var(--thumb-active-width)"}},onAppearEnd:function(){k(null),E(null),c()}},(function(e,n){var i=e.className,o=e.style,r=(0,u.Z)((0,u.Z)({},o),{},{"--thumb-start-left":A,"--thumb-start-width":y(null===I||void 0===I?void 0:I.width),"--thumb-active-left":_,"--thumb-active-width":y(null===R||void 0===R?void 0:R.width)}),a={ref:(0,f.sQ)(m,n),style:r,className:l()("".concat(t,"-thumb"),i)};return s.createElement("div",a)})):null}var g=["prefixCls","direction","options","disabled","defaultValue","value","onChange","className","motionName"];function j(e){return e.map((function(e){if("object"===(0,r.Z)(e)&&null!==e){var t=function(e){return"undefined"!==typeof e.title?e.title:"object"!==(0,r.Z)(e.label)?null===(t=e.label)||void 0===t?void 0:t.toString():void 0;var t}(e);return(0,u.Z)((0,u.Z)({},e),{},{title:t})}return{label:null===e||void 0===e?void 0:e.toString(),title:null===e||void 0===e?void 0:e.toString(),value:e}}))}var b=function(e){var t=e.prefixCls,n=e.className,o=e.disabled,r=e.checked,a=e.label,d=e.title,c=e.value,u=e.onChange;return s.createElement("label",{className:l()(n,(0,i.Z)({},"".concat(t,"-item-disabled"),o))},s.createElement("input",{className:"".concat(t,"-item-input"),type:"radio",disabled:o,checked:r,onChange:function(e){o||u(e,c)}}),s.createElement("div",{className:"".concat(t,"-item-label"),title:d},a))},S=s.forwardRef((function(e,t){var n,r,a=e.prefixCls,u=void 0===a?"rc-segmented":a,p=e.direction,h=e.options,Z=e.disabled,y=e.defaultValue,S=e.value,w=e.onChange,P=e.className,I=void 0===P?"":P,k=e.motionName,N=void 0===k?"thumb-motion":k,C=(0,c.Z)(e,g),R=s.useRef(null),E=s.useMemo((function(){return(0,f.sQ)(R,t)}),[R,t]),A=s.useMemo((function(){return j(h)}),[h]),_=(0,v.Z)(null===(n=A[0])||void 0===n?void 0:n.value,{value:S,defaultValue:y}),D=(0,d.Z)(_,2),T=D[0],F=D[1],z=s.useState(!1),M=(0,d.Z)(z,2),O=M[0],L=M[1],B=function(e,t){Z||(F(t),null===w||void 0===w||w(t))},H=(0,m.Z)(C,["children"]);return s.createElement("div",(0,o.Z)({},H,{className:l()(u,(r={},(0,i.Z)(r,"".concat(u,"-rtl"),"rtl"===p),(0,i.Z)(r,"".concat(u,"-disabled"),Z),r),I),ref:E}),s.createElement("div",{className:"".concat(u,"-group")},s.createElement(x,{prefixCls:u,value:T,containerRef:R,motionName:"".concat(u,"-").concat(N),direction:p,getValueIndex:function(e){return A.findIndex((function(t){return t.value===e}))},onMotionStart:function(){L(!0)},onMotionEnd:function(){L(!1)}}),A.map((function(e){return s.createElement(b,(0,o.Z)({key:e.value,prefixCls:u,className:l()(e.className,"".concat(u,"-item"),(0,i.Z)({},"".concat(u,"-item-selected"),e.value===T&&!O)),checked:e.value===T,onChange:B},e,{disabled:!!Z||!!e.disabled}))}))))}));S.displayName="Segmented",S.defaultProps={options:[]};var w=S,P=n(74714),I=n(21631),k=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]])}return n};var N=s.forwardRef((function(e,t){var n,a=e.prefixCls,d=e.className,c=e.block,u=e.options,v=void 0===u?[]:u,f=e.size,m=void 0===f?"middle":f,p=k(e,["prefixCls","className","block","options","size"]),h=s.useContext(P.E_),Z=h.getPrefixCls,y=h.direction,x=Z("segmented",a),g=s.useContext(I.Z),j=m||g,b=s.useMemo((function(){return v.map((function(e){if(function(e){return"object"===(0,r.Z)(e)&&!!(null===e||void 0===e?void 0:e.icon)}(e)){var t=e.icon,n=e.label,i=k(e,["icon","label"]);return(0,o.Z)((0,o.Z)({},i),{label:s.createElement(s.Fragment,null,s.createElement("span",{className:"".concat(x,"-item-icon")},t),n&&s.createElement("span",null,n))})}return e}))}),[v,x]);return s.createElement(w,(0,o.Z)({},p,{className:l()(d,(n={},(0,i.Z)(n,"".concat(x,"-block"),c),(0,i.Z)(n,"".concat(x,"-sm"),"small"===j),(0,i.Z)(n,"".concat(x,"-lg"),"large"===j),n)),options:b,ref:t,prefixCls:x,direction:y}))}))},83168:function(e,t){t.Z={opacity_6:"styles_opacity_6__dSE+L",dropdown:"styles_dropdown__kCFpG",overlay:"styles_overlay__sHjx4",overlay_item:"styles_overlay_item__H5qIX",overlay_popConfirm:"styles_overlay_popConfirm__Tb0jB",disabledButton:"styles_disabledButton__HUZB9",permitFiles:"styles_permitFiles__d0BJX",permitFiles__details:"styles_permitFiles__details__0LeEx"}}}]);