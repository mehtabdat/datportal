"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[6867],{87971:function(e,n,t){var o=t(1413),a=t(45987),i=t(47313),s=t(86136),r=t(37388),l=t(67907),d=t(1623),c=t(46417),u=["label","hint","asterisk","helperText","className"],m=s.Z.TextArea,v=(0,i.forwardRef)((function(e,n){var t=e.label,i=e.hint,s=e.asterisk,v=e.helperText,p=e.className,h=(0,a.Z)(e,u);return(0,c.jsxs)(c.Fragment,{children:[t?(0,c.jsxs)("label",{className:d.Z.labelWrap,children:[(0,c.jsx)("span",{children:t}),i?(0,c.jsx)(r.Z,{title:i,children:(0,c.jsx)(l.Z,{})}):null,s?(0,c.jsx)("span",{className:d.Z.asterisk,children:"*"}):null]}):null,(0,c.jsx)(m,(0,o.Z)((0,o.Z)({ref:n},h),{},{className:"".concat(d.Z.inpt," ").concat(p)})),v?(0,c.jsx)("small",{className:d.Z.helperText,children:v}):null]})}));v.defaultProps={autoSize:{minRows:4},placeholder:"Enter text here",asterisk:!1,hint:""},n.Z=v},66867:function(e,n,t){t.r(n),t.d(n,{default:function(){return Pe}});var o=t(93433),a=t(4942),i=t(1413),s=t(29439),r=t(47313),l=t(55291),d=t(70638),c=t(85554),u=t(54060),m=t(29079),v=t(40982),p=t(33615),h=t(6027),f=t(18515),g=t(82626),x=t(41746),y=t(42623),j=t(37936),Z=t(3798),_=t(98505),b=t(45987),N=t(25019),w=t(97258),C=t(21680),k=t(37388),S=t(5900),T=t(63243),P=t(40169),I=t(46646),A=t(11850),z=t(49355),R=t(3113),E={actions:"styles_actions__0-YSm",bg__red:"styles_bg__red__nzFY8",form:"styles_form__4Arkm",footer:"styles_footer__6Vmia",opacity_6:"styles_opacity_6__6494v",dropdown:"styles_dropdown__gmNHN",overlay:"styles_overlay__nHFpp",overlay_item:"styles_overlay_item__b6qkh",overlay_popConfirm:"styles_overlay_popConfirm__TXz59",disabledButton:"styles_disabledButton__BpX0h",message:"styles_message__wwWH3",notesTitle:"styles_notesTitle__EoyrJ",note:"styles_note__tXBRm",qualifyButton:"styles_qualifyButton__XuPsV",status:"styles_status__TW1jM",manage_media_photo:"styles_manage_media_photo__xVUKY",manage_media_photo_image:"styles_manage_media_photo_image__8VW8u",manage_media_photo_content:"styles_manage_media_photo_content__knWVk",media_photo_actions:"styles_media_photo_actions__7zrwu",phoneCode:"styles_phoneCode__O4pTg",date_picker:"styles_date_picker__xexgY",z_index:"styles_z_index__N5SxP",date_footer:"styles_date_footer__soXVd"},q=t(87971),F=t(36153),D=t(48897),M=t(40096),B=t(59816),L=t(46417),Y=["note","attachments","phone","phoneCode"],U=function(e){var n,t,o=e.type,a=e.visible,d=e.onCancel,c=e.onRefresh,u=e.recordId,p=e.projectTypeData,h=e.permissions,f=h.readEnquiry,x=h.createEnquiry,y=h.updateEnquiry,_=M.Z.getLocalAccessToken(),U=N.Z.useForm(),V=(0,s.Z)(U,1)[0],O=(0,r.useMemo)((function(){return new v.g}),[]),X=(0,r.useMemo)((function(){return new B.Y}),[]),$=(0,r.useState)(""),H=(0,s.Z)($,2),W=H[0],K=H[1],J=(0,r.useState)(!1),Q=(0,s.Z)(J,2),G=Q[0],ee=Q[1],ne=(0,r.useMemo)((function(){return("edit"===o||"attachments"===o)&&(f&&a&&u>0)}),[o,a]),te=(0,m.K2)({method:function(){return O.getRecordById(u)},condition:ne}),oe=te.data,ae=te.loading,ie=te.error,se=te.onRefresh,re=(0,m.$5)({method:X.getAllRecords}).data,le=(0,r.useMemo)((function(){return"new"===o?"New Enquiry":"edit"===o?"Edit Enquiry":"attachments"===o?"Attachments":void 0}),[o]),de=function(e){var n=(0,P.P)(e);if("string"==typeof n.message)K(n.message);else{var t=(0,I.O)(n.message,[]);V.setFields(t),K("")}};return(0,r.useEffect)((function(){ie&&de(ie)}),[ie]),(0,r.useEffect)((function(){oe?V.setFieldsValue((0,i.Z)((0,i.Z)({},oe),{},{name:null===oe||void 0===oe?void 0:oe.name,email:null===oe||void 0===oe?void 0:oe.email,phone:null===oe||void 0===oe?void 0:oe.phone,phoneCode:null===oe||void 0===oe?void 0:oe.phoneCode,message:null===oe||void 0===oe?void 0:oe.message,projectTypeId:null===oe||void 0===oe?void 0:oe.projectTypeId})):V.setFieldValue("phoneCode","971")}),[oe]),(0,L.jsx)(w.Z,{open:a,onClose:function(){return d()},closable:!0,title:le,destroyOnClose:!0,width:window.innerWidth>768?700:"100%",bodyStyle:{padding:"0px 25px"},footer:(0,L.jsxs)("div",{className:E.footer,children:[(0,L.jsx)(g.op,{size:"normal",fontSize:"sm",onClick:d,type:"plain",children:"Cancel"}),(0,L.jsx)(g.op,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:G,onClick:function(){return V.submit()},children:"Submit"})]}),children:ae?(0,L.jsx)(z.Z,{items:2}):(0,L.jsxs)(N.Z,{className:R.Z.form,onFinish:function(e){var n;ee(!0);e.note;var t=e.attachments,a=e.phone,s=e.phoneCode,r=(0,b.Z)(e,Y),m=new FormData,v=null===t||void 0===t||null===(n=t.fileList)||void 0===n?void 0:n.map((function(e){return e.originFileObj}));if(null!==v&&void 0!==v&&v.length)for(var p=0;p<v.length;p++)m.append("files[]",v[p]);switch(o){case"new":var h=(0,i.Z)((0,i.Z)({},r),{},{phoneCode:s&&a?String(s):void 0,phone:a?String(a):void 0,slug:"admin-panel-enquiry",source:"manual"});!0===x?O.createRecord(h).then((function(e){var n,t=(null===e||void 0===e?void 0:e.data).data;null!==t&&void 0!==t&&t.id?(m.append("enquiryId",null===t||void 0===t||null===(n=t.id)||void 0===n?void 0:n.toString()),(null===v||void 0===v?void 0:v.length)>0&&O.uploadFile(m).catch((function(e){var n=(0,Z.S3)(e);l.ZP.error(n||"Something went wrong while uploading attachments")})),c({status:j.uc.Active}),d(),ee(!1)):(ee(!1),l.ZP.error("Something went wrong"))})).catch((function(e){de(e),ee(!1)})):(ee(!1),l.ZP.error("You don't have enough permission to create a new enquiry"));break;case"edit":if(!0===y){var f=(0,i.Z)((0,i.Z)({},r),{},{phoneCode:s&&a?String(s):void 0,phone:a?String(a):void 0});O.updateRecord(f,u).then((function(e){var n;null!==e&&void 0!==e&&null!==(n=e.data)&&void 0!==n&&n.data&&c(),d(),ee(!1)})).catch((function(e){de(e),ee(!1)}))}else ee(!1),l.ZP.error("You don't have enough permission to update an enquiry");break;case"attachments":(null===v||void 0===v?void 0:v.length)>0?(m.append("enquiryId",u.toString()),O.uploadFile(m).then((function(){ee(!1),se(),c(),V.setFieldsValue({attachments:null})})).catch((function(e){de(e),ee(!1)}))):(ee(!1),l.ZP.error("Please add attachments"))}},form:V,children:[W&&(0,L.jsx)(A.Z,{description:W,isClosable:!0,onClose:function(){return K("")}}),(0,L.jsxs)(L.Fragment,{children:["attachments"!==o&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{children:(0,L.jsx)(N.Z.Item,{name:"name",rules:[{required:!0,message:"Please add name"}],children:(0,L.jsx)(g.t7,{size:"w100",label:"Name",asterisk:!0,type:"text"})})}),(0,L.jsxs)("div",{children:[(0,L.jsx)("div",{children:(0,L.jsx)(N.Z.Item,{name:"phone",children:(0,L.jsx)(g.t7,{size:"w100",label:"Phone",type:"number",defaultValue:null===oe||void 0===oe?void 0:oe.phone,style:{width:"100%",border:"1px solid transparent"},addonBefore:(0,L.jsx)(N.Z.Item,{name:"phoneCode",style:{marginBottom:0},initialValue:"971",children:(0,L.jsx)(g.AP,{options:null===re||void 0===re?void 0:re.reverse().map((function(e){return{value:e.phoneCode,label:"".concat(e.flag).concat(e.phoneCode)}})),placeholder:"Select Country",style:{width:90}})})})})}),(0,L.jsx)(N.Z.Item,{name:"email",children:(0,L.jsx)(g.t7,{size:"w100",label:"Email",type:"text"})})]}),(0,L.jsx)("div",{children:(0,L.jsx)(N.Z.Item,{name:"projectTypeId",rules:[{required:!0,message:"Please select project type"}],children:(0,L.jsx)(g.AP,{options:null===p||void 0===p?void 0:p.map((function(e){return{value:e.id,label:e.title}})),placeholder:"Select Project Type",label:"Project Type",asterisk:!0})})}),(0,L.jsx)("div",{children:(0,L.jsx)(N.Z.Item,{name:"message",rules:[{required:!0,message:"Please add message"}],children:(0,L.jsx)(q.Z,{label:"Message",asterisk:!0})})})]}),"attachments"===o&&(0,L.jsxs)(L.Fragment,{children:[!ae&&0===(null===oe||void 0===oe||null===(n=oe.Attachments)||void 0===n?void 0:n.length)&&(0,L.jsx)(g.I$,{description:"No attachments found",className:"d-flex flex-column"}),!ae&&(null===oe||void 0===oe||null===(t=oe.Attachments)||void 0===t?void 0:t.map((function(e,n){var t;return(0,L.jsx)("div",{className:E.manage_media_photo,children:(0,L.jsxs)("div",{className:E.manage_media_photo_image,children:[null!==(t=e.mimeType)&&void 0!==t&&t.includes("image")?(0,L.jsx)(C.Z,{src:"".concat(D.Q7).concat(e.file,"?authKey=").concat(_),alt:e.title,width:100,height:70,style:{borderRadius:5,objectFit:"cover"},preview:!1}):(0,L.jsx)(C.Z,{src:"/images/doc.png",alt:"Document-".concat(n),width:100,height:70,preview:!1,style:{objectFit:"contain"}}),(0,L.jsx)("div",{className:E.manage_media_photo_content,children:(0,L.jsx)("span",{style:{cursor:"pointer"},className:E.manage_media_photo_name_label,children:e.title})}),(0,L.jsxs)("div",{className:E.media_photo_actions,children:[(0,L.jsx)(k.Z,{title:"Download",children:(0,L.jsx)("a",{href:"".concat(D.Q7).concat(e.file,"?authKey=").concat(_,"&download=true"),target:"_blank",style:{color:"var(--color-dark-sub)"},download:e.title,children:(0,L.jsx)(T.Z,{style:{fontSize:22,cursor:"pointer",marginTop:5}})})}),(0,L.jsx)(S.Z,{title:"Are you sure to delete this file?",onConfirm:function(){return n=e.id,void O.removeFile(n).then((function(e){var n;se(),c(),l.ZP.success((null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||"File removed successfully")}));var n},okText:"Yes",cancelText:"No",placement:"left",children:(0,L.jsx)(F.p,{cursor:"pointer",width:20})})]})]})},"".concat(e.title,"-").concat(n))})))]}),"edit"!==o&&(0,L.jsx)("div",{className:"attachments"===o?"mt-5":"",children:(0,L.jsx)(g.wA,{title:"Attachments",name:"attachments",multiple:!0})})]})]})})},V=t(8570),O=t(28080),X=t(59491),$=t(66204),H=t(41586),W=t(70816),K=t.n(W),J=t(32147),Q=t(84825),G=t(47312),ee=t(46155),ne=t(78267),te=t(45705),oe=t(8773),ae=t(39548),ie=function(e){var n=e.AssignedTo,t=e.users,o=e.loading,a=e.permissions.assignEnquiry,i=e.getUsers,d=e.enquiryId,c=e.reloadTableData,u=l.ZP.useMessage(),m=(0,s.Z)(u,2),p=m[0],h=m[1],f=(0,r.useMemo)((function(){return new v.g}),[]),x=(0,r.useState)(""),j=(0,s.Z)(x,2),_=j[0],b=j[1],N=(0,y.N)(_,500),w=function(e){p.open({key:e.key,type:e.type,content:e.content,duration:"loading"===e.type?0:2})},C=(0,r.useState)(!1),k=(0,s.Z)(C,2),S=k[0],T=k[1];(0,r.useEffect)((function(){N&&i({name:N})}),[N]);var P=(0,L.jsxs)(O.Z,{className:"".concat(E.overlay," pa-2"),children:[(0,L.jsx)(g.t7,{placeHolder:"Search User...",value:_,size:"w100",onChange:function(e){var n=e.target.value;_!==n&&b(n)},icon:(0,L.jsx)("img",{src:"/images/searchIcon.svg",alt:"Search Icon"})}),o?(0,L.jsx)(G.Z,{active:!0,className:"mt-1"}):(0,L.jsx)(L.Fragment,{children:(null===t||void 0===t?void 0:t.length)>0?(0,L.jsx)(L.Fragment,{children:null===t||void 0===t?void 0:t.map((function(e){return(0,L.jsxs)("div",{className:E.overlay_item,onClick:function(){if((null===n||void 0===n?void 0:n.id)!==(null===e||void 0===e?void 0:e.id)&&!0===a){var t=Number(null===e||void 0===e?void 0:e.id);(o=t)&&!0===a?(w({key:"update",type:"loading",content:"Updating..."}),f.assignEnquiry({assignedToId:o},d).then((function(e){var n,t;null!==e&&void 0!==e&&null!==(n=e.data)&&void 0!==n&&n.data&&(w({key:"update",type:"success",content:null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message}),T(!S),c())})).catch((function(e){var n=(0,Z.S3)(e);w({key:"update",type:"error",content:n||"Something went wrong"})}))):w({key:"update",type:"error",content:"You don't have permission to assign enquiry"})}var o},children:[(0,L.jsxs)("span",{className:(null===n||void 0===n?void 0:n.id)===(null===e||void 0===e?void 0:e.id)?E.disabledButton:"",children:[null===e||void 0===e?void 0:e.firstName," ",null===e||void 0===e?void 0:e.lastName," - ","(".concat(null===e||void 0===e?void 0:e.email,")")]}),(0,L.jsx)(ee.Z,{className:"my-0"})]},"users-".concat(null===e||void 0===e?void 0:e.id))}))}):(0,L.jsx)("div",{className:E.overlay_item_noData,children:(0,L.jsx)(g.I$,{description:N?"No results found, please modify your search term":"Please search for a user to assign this enquiry to"})})})]});return(0,L.jsxs)(L.Fragment,{children:[h,(0,L.jsx)(ne.Z,{dropdownRender:function(){return P},trigger:!0===a?["click"]:[],open:!0===a&&S,onOpenChange:function(e){return T(e)},className:E.dropdown,children:(0,L.jsx)(te.Z,{children:(0,L.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"100%",cursor:!0===a?"pointer":"default"},children:[(0,L.jsx)(oe.C,{src:"".concat(D.lj).concat(null===n||void 0===n?void 0:n.profile),icon:(0,L.jsx)(ae.Z,{}),size:30}),(0,L.jsx)(g.ZT,{color:"dark-sub",size:"sm",className:"ml-1",children:"".concat(null!==n&&void 0!==n&&n.firstName&&null!==n&&void 0!==n&&n.lastName?"".concat(null===n||void 0===n?void 0:n.firstName," ").concat(null===n||void 0===n?void 0:n.lastName):"Assign To")})]})})})]})},se=t(98676),re=function(e){var n=e.record,t=e.onEditIconClick,o=e.onAddNoteClick,a=e.reloadTableData,d=e.permissions,c=d.deleteEnquiry,u=d.updateEnquiry,m=(0,r.useMemo)((function(){return new v.g}),[]),p=(0,r.useState)({confirmLoading:!1,openPopConfirm:!1}),h=(0,s.Z)(p,2),f=h[0],g=h[1];return(0,L.jsxs)("div",{className:E.actions,children:[u&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("span",{onClick:function(){return t(n)},children:(0,L.jsx)("img",{src:"/images/editicon.svg",alt:"Edit Icon"})}),(0,L.jsx)("span",{onClick:function(){return o(n)},children:(0,L.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"#fff",width:19,height:19,children:(0,L.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"})})})]}),c&&(0,L.jsx)(S.Z,{open:f.openPopConfirm,placement:"rightBottom",title:"Are you sure?",onConfirm:function(){if(g((function(e){return(0,i.Z)((0,i.Z)({},e),{},{confirmLoading:!0})})),!1===c)return l.ZP.error("You don't have permission to delete this record, please contact your admin."),void g((function(e){return(0,i.Z)((0,i.Z)({},e),{},{confirmLoading:!1,openPopConfirm:!1})}));m.deleteRecord(n.id).then((function(){g((function(e){return(0,i.Z)((0,i.Z)({},e),{},{openPopConfirm:!1,confirmLoading:!1})})),a()})).catch((function(e){var n,t,o=null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message;l.ZP.error(o||"Something went wrong, please try again later."),g((function(e){return(0,i.Z)((0,i.Z)({},e),{},{confirmLoading:!1,openPopConfirm:!1})}))}))},onCancel:function(){return g((0,i.Z)((0,i.Z)({},f),{},{openPopConfirm:!1}))},okButtonProps:{loading:f.confirmLoading},okText:"Yes",cancelText:"No",onOpenChange:function(e){e||g((0,i.Z)((0,i.Z)({},f),{},{openPopConfirm:!1}))},children:(0,L.jsx)(se.Z,{className:E.bg__red,onClick:function(){return g((function(e){return(0,i.Z)((0,i.Z)({},e),{},{openPopConfirm:!0})}))}})})]})},le=t(28770),de=t(39180),ce=t(69309),ue=t(5190),me=t(70584),ve={1:"#FF9800",2:"#43A047",3:"#E53935",4:"#FF5722"},pe=[7,14,30,60,90],he=function(e){var n,t=e.status,a=e.record,d=e.reloadTableData,c=e.projectTypeData,u=e.permissions.updateEnquiryStatus,p=N.Z.useForm(),h=(0,s.Z)(p,1)[0],f=l.ZP.useMessage(),x=(0,s.Z)(f,2),_=x[0],b=x[1],w=(0,r.useMemo)((function(){return new v.g}),[]),C=(0,r.useMemo)((function(){return new ue.L}),[]),k=(0,r.useMemo)((function(){return new Q.z}),[]),T=(0,r.useState)(""),P=(0,s.Z)(T,2),I=P[0],A=P[1],z=(0,r.useState)({loading:!0,data:[]}),R=(0,s.Z)(z,2),q=(R[0],R[1]),F=(0,y.N)(I,500),M=(0,r.useState)({open:!1,loading:!1,value:null,clientType:"company"}),B=(0,s.Z)(M,2),Y=B[0],U=B[1],V=(0,r.useState)(!1),O=(0,s.Z)(V,2),$=O[0],H=O[1],W=(0,m.K2)({method:C.findPublished,condition:!!Y.open}),J=W.data,G=W.onRefresh,ee=(0,r.useState)({data:[],loading:!1}),ne=(0,s.Z)(ee,2),te=ne[0],ae=ne[1],ie=function(e){_.open({key:e.key,type:e.type,content:e.content,duration:"loading"===e.type?0:2})},se=(0,r.useState)(!1),re=(0,s.Z)(se,2),he=re[0],fe=re[1],ge=(0,r.useState)({open:!1,selected:null}),xe=(0,s.Z)(ge,2),ye=xe[0],je=xe[1],Ze=(0,me.hx)(j.uc).filter((function(e){return Number(e.value)===j.uc.Spam})),_e=(0,r.useCallback)((function(){var e;F&&(e={name:F},ae((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!0})})),(0,k.getAllRecords)(e).then((function(e){ae((function(n){var t,a,i=null===e||void 0===e||null===(t=e.data)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.filter((function(e){return!(null!==n&&void 0!==n&&n.data.find((function(n){return n.id===e.id})))}));return{data:[].concat((0,o.Z)(n.data),(0,o.Z)(i)),loading:!1}}))})).catch((function(e){l.ZP.error(e.response.data.message||"Something went wrong!"),ae((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!1})}))})))}),[F]);return(0,r.useEffect)((function(){_e()}),[_e]),(0,r.useEffect)((function(){h.setFieldsValue({clientType:Number(j.rj.individual),projectTypeId:null===a||void 0===a?void 0:a.projectTypeId,message:null===a||void 0===a?void 0:a.message})}),[]),(0,r.useEffect)((function(){!0===Y.open&&(C.getTenants().then((function(e){var n;e.data&&null!==(n=e.data)&&void 0!==n&&n.data&&q({loading:!1,data:e.data.data})})).catch((function(e){console.error("Error while fetching tenants",null===e||void 0===e?void 0:e.message)})),G())}),[Y.open]),(0,L.jsxs)(L.Fragment,{children:[b,(0,L.jsx)("div",{className:"d-flex justify-end align-center",children:t===j.uc.Active?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(X.Z,{type:"ghost",size:"small",className:E.qualifyButton,onClick:function(){return U((function(e){return(0,i.Z)((0,i.Z)({},e),{},{open:!0})}))},children:"Qualify"}),(0,L.jsx)(S.Z,{title:"Are you sure you want to disqualify this enquiry?",onConfirm:function(){return e=ye.selected,void(a.id&&!0===u?(ie({key:"update",type:"loading",content:"Updating..."}),w.changeStatus(a.id,e).then((function(e){var n,t;null!==e&&void 0!==e&&null!==(n=e.data)&&void 0!==n&&n.data&&(ie({key:"update",type:"success",content:null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message}),!0!==Y.open&&fe(!he),d())})).catch((function(e){var n=(0,Z.S3)(e);ie({key:"update",type:"error",content:n})}))):ie({key:"update",type:"error",content:"You don't have permission to change status"}));var e},onCancel:function(){return je((0,i.Z)((0,i.Z)({},ye),{},{open:!1}))},open:ye.open,children:(0,L.jsx)(g.Tr,{label:"Disqualify",onClick:function(){return je({open:!0,selected:j.uc.Unqualified})},items:Ze.map((function(e,n){return{key:"option-".concat(n),label:e.label,onClick:function(){var n=Number(e.value);je({open:!0,selected:n})}}})),trigger:["click"]})})]}):(0,L.jsx)("div",{className:E.status,style:{backgroundColor:ve[t]},children:j.uc[t]})}),Y.open&&(0,L.jsxs)(le.Z,{open:Y.open,onCancel:function(){return U((function(e){return(0,i.Z)((0,i.Z)({},e),{},{open:!1})}))},title:"Confirm Enquiry",okText:"Save",destroyOnClose:!0,footer:null,getContainer:!1,children:[(0,L.jsx)("div",{children:"This will create a new lead automatically and sent to the lead management team."}),(0,L.jsxs)(N.Z,{layout:"vertical",form:h,onFinish:function(e){U((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!0})}));var n=(0,i.Z)((0,i.Z)({},e),{},{clientType:Number(e.clientType),enquiryId:a.id});w.autoCreateLead(n).then((function(e){var n,t;null!==e&&void 0!==e&&null!==(n=e.data)&&void 0!==n&&n.data&&(U((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!1,open:!1})})),d(),ie({content:(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Lead created successfully",key:"update",type:"success"}))})).catch((function(e){var n=(0,Z.S3)(e);ie({key:"update",type:"error",content:n||"Something went wrong"}),U((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!1})}))}))},name:"confirmEnquiry",children:[(0,L.jsx)("label",{children:"Lead Type"}),(0,L.jsx)(N.Z.Item,{name:"clientType",initialValue:j.rj.individual,rules:[{required:!0,message:"Please select an option"}],style:{marginBottom:10},children:(0,L.jsx)(de.ZP.Group,{onChange:function(e){var n=e.target.value;U((function(e){return(0,i.Z)((0,i.Z)({},e),{},{leadType:n})}))},children:Object.entries(j.rj).map((function(e){var n=(0,s.Z)(e,2),t=n[0],o=n[1];return(0,L.jsx)(de.ZP,{value:Number(o),children:(0,Z.kC)(t)},t)}))})}),(0,L.jsx)(N.Z.Item,{name:"projectTypeId",style:{marginBottom:10},rules:[{required:!0,message:"Please select project type"}],children:(0,L.jsx)(g.AP,{options:null===c||void 0===c?void 0:c.map((function(e){return{value:e.id,label:e.title}})),placeholder:"Select Project Type",label:"Project Type",asterisk:!0})}),(0,L.jsx)(N.Z.Item,{name:"submissionById",style:{marginBottom:10},rules:[{required:!0,message:"Please select submission by company"}],children:(0,L.jsx)(g.AP,{asterisk:!0,label:"Submission By",options:null===J||void 0===J?void 0:J.map((function(e){return{value:(null===e||void 0===e?void 0:e.id)||"",label:null===e||void 0===e?void 0:e.name}}))})}),(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("label",{style:{color:"var(--color-dark-main)",fontSize:"var(--font-size-sm)"},children:"Due Date for Submission"}),(0,L.jsx)(N.Z.Item,{name:"dueDateForSubmissions",style:{marginBottom:10},children:(0,L.jsx)(ce.Z,{placeholder:"Due Date for Submission",className:E.date_picker,open:$,showToday:!1,onOpenChange:function(e){return H(e)},renderExtraFooter:function(){return(0,L.jsx)("div",{className:E.date_footer,children:pe.map((function(e){return(0,L.jsxs)(X.Z,{type:"ghost",size:"small",onClick:function(){var n=K()().add(e,"days");h.setFieldsValue({dueDateForSubmissions:n}),H(!1)},children:["In ",e," days"]},e)}))})}})})]}),(0,L.jsx)(N.Z.Item,{name:"assignedToId",style:{marginBottom:30},help:(0,L.jsx)("small",{children:"If you want to assign this lead to someone, please select from the list"}),children:(0,L.jsx)(g.Ld,{placeholder:"Select an user",label:"Assign To",asterisk:!1,notFoundDescription:"No user found, search with name",customOption:!0,onSearch:function(e){te.data.find((function(n){var t=n.firstName,o=n.lastName;return"".concat(t," ").concat(o).toLowerCase().includes(e.toLowerCase())}))||A(e)},options:null===(n=te.data)||void 0===n?void 0:n.map((function(e){return{label:"".concat(e.firstName," ").concat(e.lastName),value:e.id,icon:(0,L.jsx)(oe.C,{size:"small",src:"".concat(D.lj).concat(e.profile),alt:"".concat(e.firstName," ").concat(e.lastName)})}}))})}),(0,L.jsx)(N.Z.Item,{name:"message",help:(0,L.jsx)("small",{children:" Enter any additional message for the lead management team"}),children:(0,L.jsx)(g.t7,{defaultValue:a.message,label:"Message",type:"textArea",size:"w100"})}),(0,L.jsxs)("div",{className:"d-flex justify-end",style:{gap:"1rem"},children:[(0,L.jsx)(X.Z,{onClick:function(){U((function(e){return(0,i.Z)((0,i.Z)({},e),{},{open:!1})}))},children:"Cancel"},"cancel"),(0,L.jsx)(X.Z,{type:"primary",htmlType:"submit",loading:Y.loading,children:"Save"},"save")]})]})]})]})},fe=V.Z.Paragraph,ge=function(e){var n=e.tableLoading,t=e.tableData,o=e.onEditIconClick,a=e.reloadTableData,d=e.meta,c=e.onAddNoteClick,u=e.projectTypeData,m=e.permissions,v=e.onAttachmentClick,p=m.updateEnquiry,h=m.deleteEnquiry,f=(0,r.useMemo)((function(){return new Q.z}),[]),x=(0,r.useState)({data:[],loading:!1}),y=(0,s.Z)(x,2),b=y[0],N=y[1],w=function(e){var n;N((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!0})})),e={name:(null===(n=e)||void 0===n?void 0:n.name)||""},f.getAllRecords(e).then((function(e){var n,t=null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data;N({data:t,loading:!1})})).catch((function(e){var n,t;l.ZP.error((null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message)||"Something went wrong"),N((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!1})}))}))},C=[{title:"S.No",dataIndex:"index",key:"index",render:function(e,n,t){return(0,Z.k7)(t,d)},width:"60px"},{title:"User",dataIndex:"user",key:"user",render:function(e,n){return(0,L.jsx)("div",{className:"d-flex",children:(0,L.jsxs)("div",{className:"my-auto",children:[(0,L.jsx)(g.ZT,{color:"dark-main",weight:"bold",size:"sm",children:"".concat(n.name)}),(null===n||void 0===n?void 0:n.email)&&(0,L.jsx)(fe,{title:n.email,ellipsis:{rows:1,expandable:!1},copyable:{text:n.email},className:"font-size-xs color-dark-sub mb-0 mt-1",children:n.email}),(null===n||void 0===n?void 0:n.phone)&&"undefined"!==(null===n||void 0===n?void 0:n.phone)&&(0,L.jsx)(fe,{title:"+".concat(n.phoneCode).concat(n.phone),ellipsis:{rows:1,expandable:!1},copyable:{text:"+".concat(n.phoneCode).concat(n.phone)},className:"font-size-xs color-dark-sub mb-0 mt-1",children:"+".concat(n.phoneCode).concat(n.phone)}),(0,L.jsx)(g.ZT,{color:"dark-sub",size:"xs",children:"Source: ".concat(j.Lf[n.source])}),(0,L.jsxs)("div",{className:"d-flex flex-column",children:[(null===n||void 0===n?void 0:n.addedDate)&&(0,L.jsxs)("div",{className:"d-flex mt-1 align-center",children:[(0,L.jsx)(J.$$,{className:"mr-2",width:13}),(0,L.jsx)(g.ZT,{color:"dark-sub",size:"xs",className:"mt-1",children:"Added: ".concat((0,_.Ny)(n.addedDate,"dd MM yy"))||0})]}),(null===n||void 0===n?void 0:n.modifiedDate)&&(0,L.jsxs)("div",{className:"d-flex align-center",children:[(0,L.jsx)(J.$$,{className:"mr-2",width:13}),(0,L.jsx)(g.ZT,{color:"dark-sub",size:"xs",className:"mt-1",children:"Modified: ".concat((0,_.Ny)(n.modifiedDate,"dd MM yy"))||0})]})]})]})})},width:"200px"},{title:"Assigned To",dataIndex:"AssignedTo",key:"AssignedTo",render:function(e,n){return(0,L.jsx)(ie,{AssignedTo:e,enquiryId:n.id,permissions:m,loading:b.loading,users:b.data,getUsers:w,reloadTableData:a})},width:"200px"},{title:"Message/Note",dataIndex:"message",key:"message",render:function(e,n){var t,o=n.LeadEnquiryFollowUp;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{style:{backgroundColor:"var(--color-border)",padding:"10px",borderRadius:"2px",fontSize:"var(--font-size-sm)"},children:[(0,L.jsx)("div",{dangerouslySetInnerHTML:{__html:e}}),(0,L.jsxs)("span",{className:"font-size-sm color-dark-main font-weight-bold",children:["Project Type: ",null===n||void 0===n||null===(t=n.ProjectType)||void 0===t?void 0:t.title]}),(0,L.jsx)("div",{children:0===(null===o||void 0===o?void 0:o.length)&&(0,L.jsx)(g.op,{size:"xs",fontSize:"xs",type:"plain",className:"mt-1",onClick:function(){return c(n)},children:"Add Note"})})]}),(null===o||void 0===o?void 0:o.length)>0&&(0,L.jsx)(O.Z,{size:"small",title:(0,L.jsxs)("div",{className:"d-flex justify-space-between align-center",children:[(0,L.jsx)(g.ZT,{color:"dark-main",size:"sm",weight:"semi",children:"Notes"}),(0,L.jsx)(k.Z,{title:!1===p?"You don't have permission to add notes":"",children:(0,L.jsx)(X.Z,{type:"link",size:"small",onClick:function(){return c(n)},style:{padding:"0px 0.5rem",margin:0,fontSize:"12px",fontWeight:500,color:"var(--color-dark-sub)",backgroundColor:"var(--color-inactive)"},disabled:!1===p,children:"Manage Notes"})})]}),headStyle:{padding:"0px 0.5rem",margin:0},className:"mt-2",children:(null===o||void 0===o?void 0:o.length)>0?null===o||void 0===o?void 0:o.map((function(e,n){return(0,L.jsxs)("div",{className:"mb-2",style:{borderBottom:n===(null===o||void 0===o?void 0:o.length)-1?"":"1px solid var(--color-border)",paddingBottom:n===(null===o||void 0===o?void 0:o.length)-1?"":"0.5rem"},children:[(0,L.jsxs)("div",{className:"d-flex align-center",children:[(0,L.jsx)("span",{className:"font-size-sm color-dark-800",children:e.AddedBy.firstName+" "+e.AddedBy.lastName}),(0,L.jsxs)("span",{className:"font-size-xs color-dark-sub ml-2",style:{opacity:.7},children:[K()(null===e||void 0===e?void 0:e.addedDate).fromNow(),e.isConcern&&(0,L.jsx)($.Z,{color:"warning",className:"ml-2",children:"Concern"}),e.isResolved&&(0,L.jsx)($.Z,{color:"green",className:"ml-2",children:"Resolved"})]})]}),(0,L.jsx)(fe,{ellipsis:{rows:2,expandable:!0},className:"font-size-xs color-dark-sub mb-0",children:null===e||void 0===e?void 0:e.note})]},"notes-".concat(n))})):(0,L.jsx)("div",{className:"font-size-xs color-dark-sub text-center",children:"No Notes"})})]})},width:"450px"},{title:"Status",dataIndex:"status",key:"status",render:function(e,n){return(0,L.jsx)(he,{record:n,status:e,permissions:m,reloadTableData:a,projectTypeData:u})},width:"200px"},{title:"Attachments",dataIndex:"Attachments",key:"Attachments",render:function(e,n){return(0,L.jsx)(g.ZT,{color:"".concat((null===e||void 0===e?void 0:e.length)>0?"dark-main":"dark-sub"),className:"text-underline cursor-pointer",onClick:function(){return v(n)},children:"".concat((null===e||void 0===e?void 0:e.length)>0?(null===e||void 0===e?void 0:e.length)+" files":"  No Attachments"," ")})},width:"200px"}];return(!0===p||h)&&C.push({title:"Actions",dataIndex:"actions",key:"actions",render:function(e,n){return(0,L.jsx)(re,{record:n,onEditIconClick:o,reloadTableData:a,onAddNoteClick:c,permissions:m})},width:"120px"}),(0,L.jsx)(H.Z,{sticky:!0,dataSource:t,columns:C,pagination:!1,scroll:{x:991},loading:n,rowKey:function(e){return"enquiry-".concat(e.id)}})},xe=t(86136),ye=t(32697),je=t(72652),Ze=t(6929),_e=t(34450),be=t(53764),Ne={tabs:"styles_tabs__nAmhm",divider:"styles_divider__XimWw",notes:"styles_notes__+uBcJ",notes_wrapper:"styles_notes_wrapper__lOWYb",note:"styles_note__PBv8g",note_user_avatar:"styles_note_user_avatar__wFn-S",note_content_wrapper:"styles_note_content_wrapper__RRP49",note_header:"styles_note_header__J65I0",note_header_date:"styles_note_header_date__oJ63i",note_header_delete:"styles_note_header_delete__ly4Ir",note_content:"styles_note_content__yEZK7",notes_form_input_wrapper:"styles_notes_form_input_wrapper__4o54r",notes_form_avatar:"styles_notes_form_avatar__Ki3Xe",notes_form_input:"styles_notes_form_input__JQqa7",notes_form_send_loader:"styles_notes_form_send_loader__B4yRf",notes_form_send:"styles_notes_form_send__6nJu8"},we=V.Z.Paragraph,Ce=function(e){var n=e.data,t=e.loading,o=[{title:"S.No",dataIndex:"index",key:"index",render:function(e,n,t){return t+1},width:"60px"},{title:"User",dataIndex:"user",key:"user",render:function(e,n){return(0,L.jsx)("div",{className:"d-flex",children:(0,L.jsxs)("div",{className:"my-auto",children:[(0,L.jsx)(g.ZT,{color:"dark-main",size:"sm",children:"".concat(n.name)}),(null===n||void 0===n?void 0:n.email)&&(0,L.jsxs)(we,{title:n.email,ellipsis:{rows:1,expandable:!1},copyable:{text:n.email},className:"font-size-xs color-dark-sub mb-0 mt-1",children:["Email:  ",n.email]}),(null===n||void 0===n?void 0:n.phone)&&(0,L.jsxs)(we,{title:"+".concat(n.phoneCode).concat(n.phone),ellipsis:{rows:1,expandable:!1},copyable:{text:"+".concat(n.phoneCode).concat(n.phone)},className:"font-size-xs color-dark-sub mb-0 mt-1",children:["Phone:   ","+".concat(n.phoneCode).concat(n.phone)]}),(null===n||void 0===n?void 0:n.slug)&&(0,L.jsxs)(we,{title:n.slug,ellipsis:{rows:1,expandable:!1},copyable:{text:n.slug},className:"font-size-xs color-dark-sub mb-0 mt-1",children:["Slug:  ",n.slug]}),(null===n||void 0===n?void 0:n.source)&&(0,L.jsx)(g.ZT,{color:"dark-sub",size:"xs",children:"Source: ".concat(j.Lf[n.source])}),(0,L.jsxs)("div",{className:"d-flex mt-4",children:[(0,L.jsx)(J.$$,{className:"mr-2"}),(0,L.jsx)(g.ZT,{color:"dark-sub",size:"sm",children:"".concat((0,_.Ny)(n.addedDate,"dd MM yy"))})]})]})})}},{title:"Message",dataIndex:"message",key:"message",render:function(e){return(0,L.jsx)(g.ZT,{color:"dark-main",size:"sm",children:e})},width:"20%"},{title:"Note",dataIndex:"LeadEnquiryFollowUp",key:"LeadEnquiryFollowUp",render:function(e){return(0,L.jsx)(L.Fragment,{children:null===e||void 0===e?void 0:e.map((function(e){return(0,L.jsx)(we,{ellipsis:{rows:3,expandable:!0},className:"font-size-xs color-dark-sub mb-0 mt-1",children:e.note})}))})}}];return(0,L.jsx)(H.Z,{dataSource:n,columns:o,loading:t})},ke=xe.Z.TextArea,Se=function(e){var n,t,o,d=e.enquiryId,u=e.onRefresh,p=e.permissions,h=e.open,f=e.onCancel,x=(0,c.v9)((function(e){return e.usersReducer})).loggedInUserData,y=p.updateEnquiry,j=p.readEnquiry,_=(0,r.useMemo)((function(){return new v.g}),[]),b=(0,r.useState)("addNote"),N=(0,s.Z)(b,2),w=N[0],C=N[1],k=(0,r.useState)({}),T=(0,s.Z)(k,2),P=T[0],I=T[1],A=(0,r.useState)({content:"",loading:!1,isConcern:!1}),z=(0,s.Z)(A,2),R=z[0],E=z[1],q=(0,r.useState)({confirmLoading:!1,visible:!1}),F=(0,s.Z)(q,2),M=F[0],B=F[1],Y=(0,r.useMemo)((function(){return!!d&&!0===j&&"logs"===w}),[d,j,w]),U=(0,m.K2)({method:function(){return _.getNoteById(d)},condition:!!d&&!0===j}),V=U.data,O=U.onRefresh,X=U.loading,H=(0,m.K2)({method:function(){return _.getLogsById(d)},condition:Y}),W=H.data,Q=H.onRefresh,ee=H.loading;return(0,L.jsx)(le.Z,{title:"Notes",open:h,onCancel:f,width:700,footer:"addNote"!==w||X?null:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(ye.Z,{checked:R.isConcern,onChange:function(e){return E((function(n){return(0,i.Z)((0,i.Z)({},n),{},{isConcern:e.target.checked})}))},children:"Mark as a concern"}),(0,L.jsxs)("div",{className:Ne.notes_form_input_wrapper,children:[(0,L.jsx)(oe.C,{size:30,icon:(0,L.jsx)(ae.Z,{}),className:Ne.notes_form_avatar,src:"".concat(D.lj).concat(null===x||void 0===x||null===(n=x.data)||void 0===n?void 0:n.profile),alt:"".concat(null===x||void 0===x||null===(t=x.data)||void 0===t?void 0:t.firstName," ").concat(null===x||void 0===x||null===(o=x.data)||void 0===o?void 0:o.lastName)}),(0,L.jsx)(ke,{placeholder:"Add a note...",className:Ne.notes_form_input,autoSize:{minRows:1,maxRows:4},value:R.content,onChange:function(e){return E((function(n){return(0,i.Z)((0,i.Z)({},n),{},{content:e.target.value})}))}}),R.loading?(0,L.jsx)(je.Z,{indicator:(0,L.jsx)(be.Z,{style:{fontSize:20},spin:!0}),className:Ne.notes_form_send_loader}):(0,L.jsx)(J.jE,{width:30,height:30,className:Ne.notes_form_send,onClick:function(){return e=R.content,n=R.isConcern,void(e?d&&(!0===y?(E((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!0})})),_.addNote(d,{note:e,isConcern:n}).then((function(e){var n;l.ZP.success((null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||"Note added successfully"),E({content:"",loading:!1,isConcern:!1}),u(),O()})).catch((function(e){var n,t;l.ZP.error((null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message)||"Something went wrong"),E((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!1})}))}))):l.ZP.error("You do not have permission to add notes")):l.ZP.error("Please enter a note"));var e,n}})]})]}),children:(0,L.jsxs)(Ze.Z,{type:"card",defaultActiveKey:"addNote",onChange:function(e){C(e),"logs"===e&&Q()},children:[(0,L.jsx)(Ze.Z.TabPane,{tab:"Notes",children:(0,L.jsx)(_e.Z,{headStyle:{display:"unset",padding:0},bodyStyle:{padding:0},className:Ne.notes,children:(0,L.jsxs)("div",{className:Ne.notes_wrapper,children:[X&&(0,L.jsx)("div",{className:Ne.notes_loader,children:(0,L.jsx)(G.Z,{active:!0})}),0===(null===V||void 0===V?void 0:V.length)&&!X&&(0,L.jsx)("div",{className:Ne.notes_empty,children:(0,L.jsx)(g.I$,{description:"No notes found"})}),null===V||void 0===V?void 0:V.map((function(e,n){return(0,L.jsxs)("div",{className:Ne.note,onMouseEnter:function(){return I((0,a.Z)({},e.id,!0))},onMouseLeave:function(){return I({})},children:[(0,L.jsx)(oe.C,{size:40,icon:(0,L.jsx)(ae.Z,{}),className:Ne.note_user_avatar,src:"".concat(D.lj).concat(e.AddedBy.profile),alt:"".concat(e.AddedBy.firstName," ").concat(e.AddedBy.lastName)}),(0,L.jsxs)("div",{className:Ne.note_content_wrapper,children:[(0,L.jsxs)("div",{className:Ne.note_header,children:[(0,L.jsx)(g.ZT,{weight:"bold",color:"dark-main",children:"".concat(e.AddedBy.firstName," ").concat(e.AddedBy.lastName)}),(0,L.jsxs)("p",{className:Ne.note_header_date,title:K()(e.addedDate).format("DD MMM, YYYY hh:mm A"),children:[K()(e.addedDate).fromNow(),e.isConcern&&(0,L.jsx)($.Z,{color:"warning",className:"ml-2",children:"Concern"}),e.isResolved&&(0,L.jsx)($.Z,{color:"green",className:"ml-2",children:"Resolved"}),e.isConcern&&!e.isResolved&&(0,L.jsx)(S.Z,{title:"Are you sure to mark this concern as resolved?",okText:"Yes",cancelText:"No",placement:"bottomRight",open:M.visible,onOpenChange:function(e){return B((function(n){return(0,i.Z)((0,i.Z)({},n),{},{visible:e})}))},onCancel:function(){return B((function(e){return(0,i.Z)((0,i.Z)({},e),{},{visible:!1})}))},okButtonProps:{loading:M.confirmLoading},onConfirm:function(){!0===y?_.markConcernAsResolved(e.id).then((function(e){var n;l.ZP.success((null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||"Concern resolved successfully"),u(),O(),B((function(e){return(0,i.Z)((0,i.Z)({},e),{},{visible:!1})}))})).catch((function(e){var n=(0,Z.S3)(e);l.ZP.error(n||"Something went wrong")})):l.ZP.error("You do not have permission to resolve concerns")},children:(0,L.jsx)(ye.Z,{checked:!1,onChange:function(e){return B((function(n){return(0,i.Z)((0,i.Z)({},n),{},{visible:e.target.checked})}))},children:"Mark as resolved"})})]}),P[e.id]&&(0,L.jsx)(S.Z,{title:"Are you sure to delete this note?",onConfirm:function(){return n=e.id,void(!0===y?_.removeNote(n).then((function(e){var n;l.ZP.success((null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||"Note deleted successfully"),u(),O()})).catch((function(e){var n,t;l.ZP.error((null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message)||"Something went wrong")})):l.ZP.error("You do not have permission to delete notes"));var n},okText:"Yes",cancelText:"No",placement:"left",children:(0,L.jsx)(se.Z,{className:Ne.note_header_delete})})]}),(0,L.jsx)("p",{className:Ne.note_content,children:e.note})]})]},"note-".concat(n))}))]})})},"addNote"),(0,L.jsx)(Ze.Z.TabPane,{tab:"Logs",children:(0,L.jsx)(Ce,{data:W,loading:ee})},"logs")]})})},Te=[{text:"Home",isLink:!0,path:"/"},{isLink:!1,text:"Enquiries"}],Pe=function(){var e,n=(0,Z.aY)(p.H),t=(0,c.v9)((function(e){return e.usersReducer})).userPermissions,b=t.readEnquiry,N=t.createEnquiry,w=t.updateEnquiry,C=(0,r.useMemo)((function(){return new v.g}),[]),k=(0,r.useMemo)((function(){return new Q.z}),[]),S=(0,r.useMemo)((function(){return new h.i}),[]),T=(0,m.$5)({method:S.getPublishRecords,initialQuery:{perPage:100}}).data,P=(0,m.$5)({method:C.getAllRecords,initialQuery:{status:j.uc.Active}}),I=P.data,A=P.onRefresh,z=P.meta,E=P.loading,q=(0,m.$5)({method:C.getCounts}),F=q.data,D=q.onRefresh,M=(0,r.useState)({type:"new",recordId:0,open:!1}),B=(0,s.Z)(M,2),Y=B[0],V=B[1],O=(0,r.useState)({type:"notes",recordId:0,open:!1}),X=(0,s.Z)(O,2),$=X[0],H=X[1],W=(0,r.useState)({status:j.uc.Active,dateRange:[""]}),K=(0,s.Z)(W,2),J=K[0],G=K[1],ee=(0,r.useState)([]),ne=(0,s.Z)(ee,2),te=ne[0],oe=ne[1],ae=(0,r.useState)(!1),ie=(0,s.Z)(ae,2),se=ie[0],re=ie[1],le=(0,r.useState)([]),de=(0,s.Z)(le,2),ce=(de[0],de[1]),ue=(0,r.useState)(),me=(0,s.Z)(ue,2),ve=me[0],pe=me[1],he=(0,y.N)(ve,500),fe=(0,r.useState)(""),xe=(0,s.Z)(fe,2),ye=xe[0],je=xe[1],Ze=(0,y.N)(ye,500),_e=(0,r.useState)({data:[],loading:!1}),be=(0,s.Z)(_e,2),Ne=be[0],we=be[1],Ce=function(e){var n=null===e||void 0===e?void 0:e.target,t=n.name,o=n.value;G((function(e){return(0,i.Z)((0,i.Z)({},e),{},(0,a.Z)({},t,o))}))},ke=(0,r.useCallback)((function(e,n){e&&(re(!0),G((0,i.Z)((0,i.Z)({},J),{},(0,a.Z)({},e,n))))}),[J]),Pe=function(e){var n=e.type,t=e.recordId,o=e.open;return V({type:n,recordId:t,open:o})},Ie=(0,r.useCallback)((function(e){var n,t,o=(null===(n=J.dateRange)||void 0===n?void 0:n[0])||"",a=(null===(t=J.dateRange)||void 0===t?void 0:t[1])||"",s=o?(0,_.Ny)(o,"yy-mm-dd"):void 0,r=a?(0,_.Ny)(a,"yy-mm-dd"):void 0,l=(0,i.Z)({status:J.status||void 0,email:J.email||void 0,phone:J.phone||void 0,fromDate:s,toDate:r,name:J.name||void 0,source:J.source||void 0,userAgent:J.userAgent||void 0,userIP:J.userIP||void 0,hasConcerns:J.hasConcerns||void 0,assignedToId:J.assignedToId||void 0},e);A(l),D()}),[J]),Ae=[{label:"Email",value:"email"},{label:"Phone",value:"phone"},{label:"User IP",value:"userIP"},{label:"User Agent",value:"userAgent"}],ze={email:(0,L.jsx)(g.Xy,{type:"email",label:"Email",name:"email",value:null===J||void 0===J?void 0:J.email,onChange:Ce,onReset:function(){return ke("email","")},onUpdate:Ie,defaultVisible:te.includes("email")}),phone:(0,L.jsx)(g.Xy,{type:"input",label:"Phone",name:"phone",value:null===J||void 0===J?void 0:J.phone,onChange:Ce,onReset:function(){return ke("phone","")},onUpdate:Ie,defaultVisible:te.includes("phone")}),userIP:(0,L.jsx)(g.Xy,{type:"input",label:"User IP",name:"userIP",value:null===J||void 0===J?void 0:J.userIP,onChange:Ce,onReset:function(){return ke("userIP","")},onUpdate:Ie,defaultVisible:te.includes("userIP")}),userAgent:(0,L.jsx)(g.Xy,{type:"input",label:"User Agent",name:"userAgent",value:null===J||void 0===J?void 0:J.userAgent,onChange:Ce,onReset:function(){return ke("userAgent","")},onUpdate:Ie,defaultVisible:te.includes("userAgent")})},Re=(0,r.useCallback)((function(){Ze&&(we((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!0})})),k.getAllRecords({name:Ze}).then((function(e){var n,t=null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data;we((function(e){var n=null===t||void 0===t?void 0:t.filter((function(n){var t;return!(null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.find((function(e){return e.id===n.id})))}));return{data:[].concat((0,o.Z)(e.data),(0,o.Z)(n)),loading:!1}}))})).catch((function(e){var n=(0,Z.S3)(e);l.ZP.error(n||"Something went wrong, please try again later."),we((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!1})}))})))}),[Ze]),Ee=[];Object.entries(j.uc).forEach((function(e){var n=(0,s.Z)(e,2),t=n[0],o=n[1];(0,Z.hj)(t)||Ee.push({label:"".concat(t," (").concat((null===F||void 0===F?void 0:F[null===t||void 0===t?void 0:t.toLowerCase()])||0,")"),value:o})}));var qe=[{label:"All (".concat((null===F||void 0===F?void 0:F.all)||0,")"),value:"all"}].concat(Ee,[{label:"Has Concerns (".concat((null===F||void 0===F?void 0:F.hasConcerns)||0,")"),value:"hasConcerns"}]);(0,r.useEffect)((function(){se&&Ie();var e=setTimeout((function(){re(!1)}),2e3);return function(){return clearTimeout(e)}}),[se,J,Ie]),(0,r.useEffect)((function(){void 0!==he?Ie({name:he}):""===he&&Ie({name:void 0})}),[he]),(0,r.useEffect)((function(){Re()}),[Re]);var Fe=(0,r.useCallback)((function(){if(I&&I.length>0){var e=null===I||void 0===I?void 0:I.map((function(e){return{}}));ce(e)}}),[I]);return(0,r.useEffect)((function(){Fe()}),[Fe]),(0,L.jsxs)(u.Z,{permissionSlug:n,children:[(0,L.jsx)(g.mr,{heading:"Enquiries",breadCrumbData:Te,showAdd:!!N,buttonText:"Add Enquiry",onButtonClick:function(){!1!==N?Pe({type:"new",open:!0,recordId:0}):l.ZP.error("You don't have permission to create new record")},filters:b?(0,L.jsxs)("div",{children:[(0,L.jsx)("div",{children:(0,L.jsx)(g.t7,{name:"name",placeHolder:"Search by name",onChange:function(e){var n=e.currentTarget.value;pe(n),Ce(e)},value:ve,style:{maxWidth:200}})}),(0,L.jsx)("div",{style:{overflow:"auto"},children:(0,L.jsx)(d.Z,{size:"middle",options:qe.map((function(e){return(0,i.Z)((0,i.Z)({},e),{},{title:e.label,value:e.value})})),style:{fontSize:"var(--font-size-sm)"},value:(null===J||void 0===J?void 0:J.status)||"all",onChange:function(e){G((0,i.Z)((0,i.Z)({},J),{},{status:e})),"all"===e?ke("status",""):Ie("hasConcerns"===e?{hasConcerns:!0,status:void 0}:{status:e})}})}),(0,L.jsx)("div",{children:(0,L.jsx)(g.Xy,{type:"radio",label:"Source",name:"source",options:Object.entries(j.Lf).map((function(e){var n=(0,s.Z)(e,2),t=n[0];return{label:n[1],value:t}})),value:String(null===J||void 0===J?void 0:J.source),onChange:Ce,onReset:function(){return ke("source","")},onUpdate:Ie})}),(0,L.jsx)("div",{children:(0,L.jsx)(g.Xy,{type:"radio",label:"Assigned To",name:"assignedToId",withSearch:!0,options:null===Ne||void 0===Ne||null===(e=Ne.data)||void 0===e?void 0:e.map((function(e){return{label:"".concat(e.firstName," ").concat(e.lastName),value:"".concat(e.id)}})),onChange:Ce,value:Number(null===J||void 0===J?void 0:J.assignedToId)>0?String(null===J||void 0===J?void 0:J.assignedToId):"",onReset:function(){ke("assignedToId",0),je("")},onUpdate:Ie,loading:null===Ne||void 0===Ne?void 0:Ne.loading,searchTerm:ye,onSearch:function(e){return je(e.currentTarget.value)}})}),(0,L.jsx)("div",{children:(0,L.jsx)(g.Xy,{type:"datepicker",label:"Date",name:"dateRange",onChange:function(e){return G((function(n){return(0,i.Z)((0,i.Z)({},n),{},{dateRange:e})}))},onReset:function(){return ke("dateRange",[])},onUpdate:Ie})}),Object.keys(ze).map((function(e){var n=e;return null!==te&&void 0!==te&&te.includes(n)?ze[n]:null})),(0,L.jsx)("div",{children:(0,L.jsx)(x.Z,{options:null===Ae||void 0===Ae?void 0:Ae.map((function(e){return{label:e.label,value:e.value}})),onChange:function(e){return oe(e)},value:te})})]}):null}),!0===b&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{className:R.Z.antdTableWrapper,children:(0,L.jsx)(ge,{tableData:I,tableLoading:E,permissions:t,projectTypeData:T,reloadTableData:function(){A(),D()},onEditIconClick:function(e){!1!==w?Pe({type:"edit",open:!0,recordId:null===e||void 0===e?void 0:e.id}):l.ZP.error("You don't have permission to update record")},onAddNoteClick:function(e){!1!==w?H({type:"notes",open:!0,recordId:null===e||void 0===e?void 0:e.id}):l.ZP.error("You don't have permission to add notes")},onAttachmentClick:function(e){return Pe({type:"attachments",open:!0,recordId:null===e||void 0===e?void 0:e.id})},meta:z})}),(0,L.jsx)(g.tl,{total:null===z||void 0===z?void 0:z.total,current:null===z||void 0===z?void 0:z.page,defaultPageSize:null!==z&&void 0!==z&&z.perPage?null===z||void 0===z?void 0:z.perPage:10,pageSizeOptions:[10,20,50,100],onChange:function(e,n){return Ie({page:e,perPage:n})}})]}),!1===b&&(0,L.jsx)(f.a$,{mainMessage:"You don't have permission to view this data"}),Y.open&&(0,L.jsx)(U,{projectTypeData:T,visible:Y.open,type:Y.type,recordId:Y.recordId,permissions:t,onCancel:function(){return Pe({type:"new",recordId:0,open:!1})},onRefresh:function(){"new"===Y.type?(G({status:j.uc.Active}),Ie({status:j.uc.Active})):Ie(),D()}}),$.open&&(0,L.jsx)(Se,{open:$.open,permissions:t,enquiryId:$.recordId,onRefresh:function(){A(),D()},onCancel:function(){H({type:"new",recordId:0,open:!1})}})]})}},5190:function(e,n,t){t.d(n,{L:function(){return r}});var o=t(43144),a=t(15671),i=t(49075),s=t(3135),r=(0,o.Z)((function e(){var n=this;(0,a.Z)(this,e),this.endPoint="organization",this.getAllRecords=function(e){return i.Z.get(n.endPoint,{params:e})},this.findPublished=function(e){return i.Z.get(n.endPoint+"/find-published",{params:e})},this.getRecordById=function(e){return i.Z.get("".concat(n.endPoint,"/").concat(e))},this.deleteRecord=function(e){return i.Z.delete("".concat(n.endPoint,"/").concat(e))},this.createRecord=function(e){return i.Z.post(n.endPoint,e,{headers:s.C})},this.updateRecord=function(e,t){return i.Z.patch("".concat(n.endPoint,"/").concat(t),e,{headers:s.C})},this.getTenants=function(){return i.Z.get("xero/getTenants")}}))},63243:function(e,n,t){t.d(n,{Z:function(){return l}});var o=t(87462),a=t(47313),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M624 706.3h-74.1V464c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v242.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.7a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-download",theme:"outlined"},s=t(16141),r=function(e,n){return a.createElement(s.Z,(0,o.Z)({},e,{ref:n,icon:i}))};var l=a.forwardRef(r)}}]);