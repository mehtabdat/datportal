"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[5986],{42923:function(e,t,r){r.r(t),r.d(t,{default:function(){return fe}});var a=r(74165),n=r(15861),s=r(93433),i=r(1413),o=r(29439),l=r(47313),d=r(55291),c=r(86136),u=r(8773),v=r(37388),f=r(59491),m=r(28288),p=r(39548),h=r(87462),g={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-600 72h560v208H232V136zm560 480H232V408h560v208zm0 272H232V680h560v208zM304 240a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"database",theme:"outlined"},y=r(16141),x=function(e,t){return l.createElement(y.Z,(0,h.Z)({},e,{ref:t,icon:g}))};var Z=l.forwardRef(x),j={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 208H676V232h212v136zm0 224H676V432h212v160zM412 432h200v160H412V432zm200-64H412V232h200v136zm-476 64h212v160H136V432zm0-200h212v136H136V232zm0 424h212v136H136V656zm276 0h200v136H412V656zm476 136H676V656h212v136z"}}]},name:"table",theme:"outlined"},b=function(e,t){return l.createElement(y.Z,(0,h.Z)({},e,{ref:t,icon:j}))};var k=l.forwardRef(b),S=r(82626),I=r(54060),N="styles_onlyMyTask__84C5Y",_="styles_sortBy__bzDkT",C=r(37936),z=r(44727),w=r(55560),T=r(56033),M=r(26076),P=r(85554),U=r(2135),D=r(42623),R=r(69591),O=r(47312),H=r(10177),V="styles_board__eiY0U",B="styles_column__G0oLH",E="styles_columnHead__arD7s",L="styles_kanbanItem__V3jir",A="styles_kanbanItemBottom__OXke5",F="styles_priorityPill__b4cvh",G="styles_kanbanItemBottomBottom__q7LnC",J="styles_file__lNdis",X=r(26246),Y=r(73989),K=r(79117),$=r(23860),q=r(24754),Q=r.n(q),W=r(48897),ee=r(98505),te=r(86948),re=r(46417),ae=function(e){var t=e.searchParams,r=e.setSearchParams,a=e.tasks,n=e.setTasks,i=e.meta,o=e.setMeta,c=e.searchTerm,f=e.openDetailModal,m=e.setOpenDetailModal,h=e.setSelectedTask,g=e.module,y=e.isLoading,x=(0,l.useCallback)((function(e,t){var r=a[e];n(Q()(a,{$splice:[[e,1],[t,0,r]]})),g.updateOrder({order:e},r.id).catch((function(e){e.message?d.ZP.error(e.message):d.ZP.error("Something went wrong")}))}),[a]),Z=(0,l.useCallback)((function(e,t){var r=a[e];if(r.status!==t){var i=(0,s.Z)(a);i[e].status=t,n(i),g.updateRecord({status:t},r.id).then((function(e){})).catch((function(e){e.message?d.ZP.error(e.message):d.ZP.error("Something went wrong")}))}}),[a]);return(0,re.jsx)(X.W,{backend:$.PD,children:(0,re.jsx)("section",{className:V,children:[1,2,3].map((function(e){var l,d,j,b;return(0,re.jsx)(ne,{status:e,changeTaskStatus:Z,children:(0,re.jsxs)("div",{className:B,children:[(0,re.jsxs)("div",{className:E,children:[C.DM[e]," (",Number(null===(l=i[e-1])||void 0===l?void 0:l.total)?Number(null===(d=i[e-1])||void 0===d?void 0:d.total):"",")"]}),(0,re.jsx)("div",{children:(0,re.jsx)(te.Z,{dataLength:a.filter((function(t){return t.status===e})).length,next:function(){var t;g.getAllRecords({status:e,page:Number(null===(t=i[e-1])||void 0===t?void 0:t.page)+1}).then((function(t){n([].concat((0,s.Z)(a),(0,s.Z)(t.data.data)));var r=i;r[e-1]=t.data.meta,o(r)}))},hasMore:Number(null===(j=i[e-1])||void 0===j?void 0:j.pageCount)>Number(null===(b=i[e-1])||void 0===b?void 0:b.page),loader:(0,re.jsx)(O.Z,{active:!0}),height:"70vh",scrollThreshold:.75,className:"infinite-scroll-wrap",children:y?(0,re.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:Array(3).fill(0).map((function(e,t){return(0,re.jsx)(O.Z.Input,{size:"large",active:!0,style:{height:"3.5vw",width:"100%",borderRadius:"0.25rem"}},t)}))}):null===a||void 0===a?void 0:a.filter((function(t){return t.status===e})).filter((function(e){var t,r;return!c||(null===e||void 0===e||null===(t=e.title)||void 0===t||null===(r=t.toLowerCase())||void 0===r?void 0:r.includes(null===c||void 0===c?void 0:c.toLowerCase()))})).map((function(e){return(0,re.jsx)(se,{item:e,items:a,moveTask:x,children:(0,re.jsxs)("div",{className:L,onClick:function(){h(e.id),m(!f),t.set("taskId",e.id.toString()),r(t)},children:[(0,re.jsx)("div",{children:e.title}),(0,re.jsxs)("div",{className:A,children:[(0,re.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"flex-end"},children:[(0,re.jsx)("div",{className:F,style:{backgroundColor:C.tt[e.priority].color},children:C.tt[e.priority].title}),(0,re.jsx)("div",{style:{color:"var(--color-light-300)",fontSize:"var(--font-size-xs)"},children:(0,ee.Ny)((null===e||void 0===e?void 0:e.taskEndOn)||"","dd MM,yy")}),e._count.Resources>0&&(0,re.jsxs)("div",{className:J,children:[(0,re.jsx)(H.Z,{}),"\xa0",e._count.Resources]})]}),(0,re.jsx)("div",{className:G,children:(0,re.jsx)(u.C.Group,{children:e.TaskMembers.map((function(t){return(0,re.jsx)(v.Z,{overlayInnerStyle:{borderRadius:"0.25rem",fontSize:"var(--font-size-sm)"},placement:3===e.status?"left":"bottom",title:t.User.firstName+" "+t.User.lastName,children:(0,re.jsx)(u.C,{size:25,style:{border:"0.5px solid var(--color-light-200)"},src:W.lj+t.User.profile,icon:(0,re.jsx)(p.Z,{})})},t.User.uuid)}))})})]})]})},e.id)}))})})]})},e)}))})})},ne=function(e){var t=e.status,r=e.changeTaskStatus,a=e.children,n=(0,l.useRef)(null),s=(0,Y.L)({accept:"card",drop:function(e){r(e.index,t)}});return(0,(0,o.Z)(s,2)[1])(n),(0,re.jsxs)("div",{style:{flexGrow:1},ref:n,children:[" ",a]})},se=function(e){var t=e.children,r=e.item,a=e.items,n=e.moveTask,s=(0,l.useRef)(null),i=a.indexOf(r),d=(0,Y.L)({accept:"card",collect:function(e){var t=(e.getItem()||{}).index;return t===i?{}:{isOver:e.isOver(),dropClassName:t<i?" drop-over-downward":" drop-over-upward"}},drop:function(e){n(e.index,i)}}),c=(0,o.Z)(d,2)[1],u=(0,K.c)({type:"card",item:{index:i},collect:function(e){return{isDragging:e.isDragging()}}}),v=(0,o.Z)(u,2),f=v[0].isDragging?0:1;return c((0,v[1])(s)),(0,re.jsx)("div",{ref:s,style:{opacity:f},children:t})},ie=r(41586),oe=r(49958),le="style_priorityPill__y89-z",de=function(e){var t=e.tasks,r=e.searchParams,a=e.setSearchParams,n=e.openDetailModal,s=e.setOpenDetailModal,o=e.setSelectedTask,l=e.tableMeta,d=e.setTableMeta,c=[{title:"Title",dataIndex:"title",key:"title",render:function(e,t){return(0,re.jsx)("a",{onClick:function(){o(t.id),s(!n),r.set("taskId",t.id.toString()),a(r)},children:e})}},{title:"Status",dataIndex:"status",key:"status",render:function(e){return C.DM[e]}},{title:"Priority",dataIndex:"priority",key:"priority",render:function(e){return(0,re.jsx)("div",{className:le,style:{backgroundColor:C.tt[e].color},children:C.tt[e].title})}},{title:"Added Date",dataIndex:"addedDate",key:"addedDate",render:function(e){return(0,re.jsx)("div",{children:(0,ee.Ny)(e||"","dd MM,yy")})}},{title:"Assignees",dataIndex:"TaskMembers",key:"TaskMembers",render:function(e){return(0,re.jsx)(u.C.Group,{children:e.map((function(e){return(0,re.jsx)(v.Z,{overlayInnerStyle:{borderRadius:"0.25rem",fontSize:"var(--font-size-sm)"},title:e.User.firstName+" "+e.User.lastName,children:(0,re.jsx)(u.C,{size:32,style:{border:"1px solid var(--color-light-200)"},src:W.lj+e.User.profile,icon:(0,re.jsx)(p.Z,{})})},e.User.uuid)}))})}}];return(0,re.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"2rem"},children:[(0,re.jsx)(ie.Z,{dataSource:t,columns:c,size:"small",rowKey:"id",pagination:!1}),(0,re.jsx)(oe.Z,{style:{alignSelf:"flex-end"},current:null===l||void 0===l?void 0:l.page,defaultPageSize:null===l||void 0===l?void 0:l.perPage,total:null===l||void 0===l?void 0:l.total,onChange:function(e,t){return d((0,i.Z)((0,i.Z)({},l),{},{page:e,perPage:t}))}})]})},ce=function(e,t){var r=(0,l.useState)((function(){var r;try{r=JSON.parse(localStorage.getItem(e)||String(t))}catch(a){r=t}return r})),a=(0,o.Z)(r,2),n=a[0],s=a[1];return(0,l.useEffect)((function(){localStorage.setItem(e,JSON.stringify(n))}),[n,e]),[n,s]},ue=r(3798),ve=[{text:"Home",isLink:!0,path:"/"},{isLink:!1,text:"Tasks"}],fe=function(){var e,t,r=(0,l.useState)(!1),h=(0,o.Z)(r,2),g=h[0],y=h[1],x=ce("taskView","board"),j=(0,o.Z)(x,2),b=j[0],O=j[1],H=new w.h,V=new R.Q,B=(0,U.lr)(),E=(0,o.Z)(B,2),L=E[0],A=E[1],F=(0,l.useState)(!0),G=(0,o.Z)(F,2),J=G[0],X=G[1],Y=(0,l.useState)(!1),K=(0,o.Z)(Y,2),$=K[0],q=K[1],Q=(0,l.useState)(!1),ee=(0,o.Z)(Q,2),te=ee[0],ne=ee[1],se=(0,l.useState)(),ie=(0,o.Z)(se,2),oe=ie[0],le=ie[1],fe=(0,l.useState)([]),me=(0,o.Z)(fe,2),pe=me[0],he=me[1],ge=(0,l.useState)([]),ye=(0,o.Z)(ge,2),xe=ye[0],Ze=ye[1],je=(0,l.useState)(Array(3).fill({})),be=(0,o.Z)(je,2),ke=be[0],Se=be[1],Ie=(0,l.useState)(),Ne=(0,o.Z)(Ie,2),_e=Ne[0],Ce=Ne[1],ze=(0,l.useState)({type:L.get("type")||void 0,sortByField:"order",sortOrder:"asc",projectId:null!==L&&void 0!==L&&L.get("projectId")?Number(null===L||void 0===L?void 0:L.get("projectId")):void 0,userIds:null!==L&&void 0!==L&&L.get("userIds")?JSON.parse((null===L||void 0===L?void 0:L.get("userIds"))||""):[]}),we=(0,o.Z)(ze,2),Te=we[0],Me=we[1],Pe=(0,l.useState)(L.get("searchTerm")),Ue=(0,o.Z)(Pe,2),De=Ue[0],Re=Ue[1],Oe=(0,l.useState)(""),He=(0,o.Z)(Oe,2),Ve=He[0],Be=He[1],Ee=(0,D.N)(Ve,500),Le=(0,l.useState)({data:[],loading:!1}),Ae=(0,o.Z)(Le,2),Fe=Ae[0],Ge=Ae[1],Je=(0,P.v9)((function(e){return e.usersReducer})).userPermissions,Xe=(0,ue.aY)(z.r),Ye=Je,Ke=function(){var e=(0,n.Z)((0,a.Z)().mark((function e(t){var r,n,o,l,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y(!0),e.prev=1,"board"!==b){e.next=15;break}return r=[1,2,3].map((function(e){return H.getAllRecords((0,i.Z)({status:e},t))})),e.next=7,Promise.allSettled(r);case 7:n=e.sent,o=[],l=Array(3).fill({}),n.forEach((function(e,t){"fulfilled"===e.status&&(o.push.apply(o,(0,s.Z)(e.value.data.data)),l[t]=e.value.data.meta)})),Ze(o),Se(l),e.next=21;break;case 15:if("table"!==b){e.next=21;break}return e.next=18,H.getAllRecords((0,i.Z)((0,i.Z)({page:null===_e||void 0===_e?void 0:_e.page,perPage:null===_e||void 0===_e?void 0:_e.perPage},t),Te));case 18:d=e.sent,Ze((0,s.Z)(d.data.data)),Ce(d.data.meta);case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(1),console.error(e.t0,"Error fetching tasks");case 26:return e.prev=26,y(!1),e.finish(26);case 29:case"end":return e.stop()}}),e,null,[[1,23,26,29]])})));return function(t){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){J?(L.get("taskId")&&(q(!$),le(Number(L.get("taskId")))),X(!1)):J||(Te.type?(L.set("type",Te.type),A(L)):(L.delete("type"),A(L)),Ke((0,i.Z)({},Te)))}),[Te.type]),(0,l.useEffect)((function(){Ee?(Ge((0,i.Z)((0,i.Z)({},Fe),{},{loading:!0})),V.getAllRecords({title:Ee}).then((function(e){var t=(null===e||void 0===e?void 0:e.data).data;Ge((function(e){var r=null===t||void 0===t?void 0:t.filter((function(t){return!(null!==e&&void 0!==e&&e.data.find((function(e){return e.id===t.id})))}));return{data:[].concat((0,s.Z)(e.data),(0,s.Z)(r)),loading:!1}}))})).catch((function(e){d.ZP.error(e.response.data.message)}))):Te.projectId&&J&&(Ge((0,i.Z)((0,i.Z)({},Fe),{},{loading:!0})),V.getRecordById(Te.projectId).then((function(e){Ge((0,i.Z)((0,i.Z)({},Fe),{},{data:[e.data.data]}))})).catch((function(e){d.ZP.error(e.response.data.message)})))}),[Ee]),(0,l.useEffect)((function(){var e=[];xe.forEach((function(t){t.TaskMembers.forEach((function(t){e.some((function(e){return e.User.id===t.User.id}))||e.push(t)}))})),he(e)}),[xe]),(0,l.useEffect)((function(){Ke({type:Te.type,projectId:Te.projectId})}),[b,null===_e||void 0===_e?void 0:_e.page,null===_e||void 0===_e?void 0:_e.perPage]);var $e={board:ae,table:de}[b];return(0,re.jsxs)(I.Z,{permissionSlug:Xe,children:[(0,re.jsx)(S.mr,{heading:"Tasks",breadCrumbData:ve,showAdd:Ye.createTask,buttonText:"Add New Task",onButtonClick:function(){return ne(!te)},filters:(0,re.jsxs)("div",{children:[(0,re.jsx)(c.Z,{allowClear:!0,value:De||"",placeholder:"Search this board",onChange:function(e){var t,r;(Re(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value),e.target.value)?(L.set("searchTerm",null===e||void 0===e||null===(r=e.target)||void 0===r?void 0:r.value.toLowerCase()),A(L)):(L.delete("searchTerm"),A(L))},style:{width:220,borderRadius:"0.25rem"},suffix:(0,re.jsx)(m.Z,{})}),(0,re.jsx)(S.Xy,{type:"radio",label:"Project",name:"projectId",withSearch:!0,options:null===Fe||void 0===Fe||null===(e=Fe.data)||void 0===e?void 0:e.map((function(e){return{label:"".concat(e.referenceNumber," | ").concat(e.title),value:"".concat(e.id)}})),onChange:function(e){return Me((0,i.Z)((0,i.Z)({},Te),{},{projectId:Number(e.target.value)}))},value:null===Te||void 0===Te||null===(t=Te.projectId)||void 0===t?void 0:t.toString(),defaultValue:null===L||void 0===L?void 0:L.get("projectId"),onReset:function(){L.delete("projectId"),A(L);var e=(0,i.Z)((0,i.Z)({},Te),{},{projectId:void 0});Me(e),Ke(e)},onUpdate:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Te;Ke((0,i.Z)((0,i.Z)({},t),{},{projectId:Te.projectId})),null!==Te&&void 0!==Te&&Te.projectId&&L.set("projectId",null===Te||void 0===Te||null===(e=Te.projectId)||void 0===e?void 0:e.toString()),A(L)},loading:Fe.loading,searchTerm:Ve,onSearch:function(e){return Be(e.currentTarget.value)}}),(0,re.jsx)("div",{style:{backgroundColor:Te.type?"var(--color-dark-main)":void 0,color:Te.type?"var(--color-inactive)":void 0},className:N,onClick:function(){Me((0,i.Z)((0,i.Z)({},Te),{},{type:Te.type?void 0:"myTask"}))},children:"Only My Tasks"}),(0,re.jsx)("div",{children:(0,re.jsx)(u.C.Group,{maxCount:5,children:pe.map((function(e){var t;return(0,re.jsx)(v.Z,{overlayInnerStyle:{borderRadius:"0.25rem",fontSize:"var(--font-size-sm)"},title:e.User.firstName+" "+e.User.lastName,children:(0,re.jsx)(u.C,{size:32,onClick:function(){var t,r,a,n,s=Te.userIds;null!==(t=s)&&void 0!==t&&t.some((function(t){return t===e.User.id}))?s=null===(a=s)||void 0===a?void 0:a.filter((function(t){return t!==e.User.id})):null===(n=s)||void 0===n||n.push(e.User.id);null!==(r=s)&&void 0!==r&&r.length?L.set("userIds",JSON.stringify(s)):L.delete("userIds"),A(L),Ke((0,i.Z)((0,i.Z)({},Te),{},{userIds:s})),Me((0,i.Z)((0,i.Z)({},Te),{},{userIds:s}))},style:{border:null!==(t=Te.userIds)&&void 0!==t&&t.includes(e.User.id)?"2px solid var(--color-primary-main)":"0.5px solid var(--color-light-200)",cursor:"pointer"},src:W.lj+e.User.profile,icon:(0,re.jsx)(p.Z,{})})},e.User.uuid)}))})}),(0,re.jsxs)("div",{className:_,children:[(0,re.jsx)(S.Xy,{type:"radio",label:"Sort By",name:"sortBy",options:Object.entries(C.$g).map((function(e){var t=(0,o.Z)(e,2);return{label:t[0],value:t[1]}})),value:null===Te||void 0===Te?void 0:Te.sortByField,onChange:function(e){return Me((0,i.Z)((0,i.Z)({},Te),{},{sortByField:e.target.value}))},onReset:function(){var e=(0,i.Z)((0,i.Z)({},Te),{},{sortByField:void 0});Me(e),Ke(e)},onUpdate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Te;Ke((0,i.Z)((0,i.Z)({},e),{},{sortByField:Te.sortByField,sortOrder:e.sortOrder}))},withSort:!0}),(0,re.jsxs)("div",{children:["table"===b&&(0,re.jsx)(f.Z,{onClick:function(){return O("board")},icon:(0,re.jsx)(Z,{style:{fontSize:20}})}),"board"===b&&(0,re.jsx)(f.Z,{onClick:function(){return O("table")},icon:(0,re.jsx)(k,{style:{fontSize:20}})})]})]})]})}),(0,re.jsx)($e,{tasks:xe,setTasks:Ze,searchParams:L,setSearchParams:A,openDetailModal:$,setOpenDetailModal:q,setSelectedTask:le,meta:"board"===b?ke:_e,setMeta:"board"===b?Se:Ce,searchTerm:"board"===b?De:void 0,isLoading:"board"===b?g:void 0,module:"board"===b?H:void 0}),oe&&(0,re.jsx)(T.X,{openModal:$,onCancel:function(){q(!$),L.delete("taskId"),A(L)},id:oe,onUpdate:Ke}),te&&(0,re.jsx)(M.K,{onCancel:function(){return ne(!te)},openModal:te,permissions:Ye,onUpdate:Ke})]})}}}]);