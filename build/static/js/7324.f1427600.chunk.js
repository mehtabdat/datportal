"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[7324],{94441:function(e,n,t){t.r(n);var a=t(93433),o=t(4942),i=t(1413),r=t(29439),d=t(47313),l=t(55291),u=t(70638),c=t(85554),s=t(54060),v=t(29079),f=t(82626),g=t(18515),p=t(6447),h=t(54113),m=t(5883),Z=t(42954),j=t(96702),b=t(6027),w=t(69591),y=t(48297),S=t(3798),x=t(98505),I=t(42623),T=t(37936),C=t(4970),N=t(50008),R=t(84825),P=t(46417),k=[{text:"Home",isLink:!0,path:"/"},{isLink:!1,text:"Quotations"}];n.default=function(){var e,n,t,_,E=(0,S.aY)(h.L),D=(0,S.aY)(m.H),A=(0,S.aY)(j.n),Q=(0,c.v9)((function(e){return e.usersReducer})).userPermissions,z=Q.readQuotation,M=Q.createQuotation,Y=(0,d.useMemo)((function(){return new Z.K}),[]),q=(0,d.useMemo)((function(){return new b.i}),[]),U=(0,d.useMemo)((function(){return new w.Q}),[]),X=(0,d.useMemo)((function(){return new y.V}),[]),H=(0,d.useMemo)((function(){return new R.z}),[]),V={active:[T.nE.New,T.nE.Sent],confirmed:[T.nE.Confirmed],rejected:[T.nE.Rejected],draft:[T.nE.New],revised:[T.nE.Revised]},L=(0,v.$5)({method:Y.getAllRecords,initialQuery:{__status:V.active}}),B=L.data,W=L.onRefresh,$=L.meta,F=L.loading,G=(0,v.tM)(),K=G.drawer,O=G.setDrawer,J=(0,d.useState)({dateRange:[""],__status:V.active}),ee=(0,r.Z)(J,2),ne=ee[0],te=ee[1],ae=(0,d.useState)(!1),oe=(0,r.Z)(ae,2),ie=oe[0],re=oe[1],de=(0,d.useState)([]),le=(0,r.Z)(de,2),ue=le[0],ce=le[1],se=(0,v.G5)(),ve=se.newProject,fe=se.setNewProject,ge=(0,d.useState)(),pe=(0,r.Z)(ge,2),he=pe[0],me=pe[1],Ze=(0,I.N)(he,500),je=(0,d.useState)(""),be=(0,r.Z)(je,2),we=be[0],ye=be[1],Se=(0,I.N)(we,500),xe=(0,d.useState)(""),Ie=(0,r.Z)(xe,2),Te=Ie[0],Ce=Ie[1],Ne=(0,I.N)(Te,500),Re=(0,d.useState)(""),Pe=(0,r.Z)(Re,2),ke=Pe[0],_e=Pe[1],Ee=(0,I.N)(ke,500),De=(0,d.useState)(""),Ae=(0,r.Z)(De,2),Qe=Ae[0],ze=Ae[1],Me=(0,I.N)(Qe,500),Ye=(0,d.useState)({data:[],loading:!1}),qe=(0,r.Z)(Ye,2),Ue=qe[0],Xe=qe[1],He=(0,d.useState)({data:[],loading:!1}),Ve=(0,r.Z)(He,2),Le=Ve[0],Be=Ve[1],We=(0,d.useState)({data:[],loading:!1}),$e=(0,r.Z)(We,2),Fe=$e[0],Ge=$e[1],Ke=(0,d.useState)({data:[],loading:!1}),Oe=(0,r.Z)(Ke,2),Je=Oe[0],en=Oe[1],nn=function(e){var n=null===e||void 0===e?void 0:e.target,t=n.name,a=n.value;if(["clientId","projectTypeId","projectId","assignedToId"].includes(t)&&!(0,S.hj)(a)){var r="";switch(t){case"clientId":r="Client ID";break;case"projectTypeId":r="Project Type ID";break;case"projectId":r="Project ID";break;case"assignedToId":r="Assigned To ID"}return l.ZP.error("".concat(r," should be a number"))}te((function(e){return(0,i.Z)((0,i.Z)({},e),{},(0,o.Z)({},t,a))}))},tn=(0,d.useCallback)((function(e,n){e&&(re(!0),te((0,i.Z)((0,i.Z)({},ne),{},(0,o.Z)({},e,n))))}),[ne]),an=(0,d.useCallback)((function(e){var n,t,a=(null===(n=ne.dateRange)||void 0===n?void 0:n[0])||"",o=(null===(t=ne.dateRange)||void 0===t?void 0:t[1])||"",r=a?(0,x.Ny)(a,"yy-mm-dd"):void 0,d=o?(0,x.Ny)(o,"yy-mm-dd"):void 0,l=(0,i.Z)({fromDate:r,toDate:d,__status:ne.__status||void 0,clientId:ne.clientId||void 0,projectTypeId:ne.projectTypeId||void 0,projectId:ne.projectId||void 0,quoteNumber:Ze||void 0,assignedToId:ne.assignedToId||void 0},e);W(l)}),[ne]),on=(0,d.useCallback)((function(){Se&&(Xe((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!0})})),X.findPublished({name:Se}).then((function(e){var n,t=null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data;Xe((function(e){var n=null===t||void 0===t?void 0:t.filter((function(n){var t;return!(null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.find((function(e){return e.id===n.id})))}));return{data:[].concat((0,a.Z)(e.data),(0,a.Z)(n)),loading:!1}}))})).catch((function(e){var n=(0,S.S3)(e);l.ZP.error(n||"Something went wrong, please try again later."),Xe((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!1})}))})))}),[Se]),rn=(0,d.useCallback)((function(){Ne&&(Be((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!0})})),q.getPublishRecords({title:Ne}).then((function(e){var n,t=null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data;Be((function(e){var n=null===t||void 0===t?void 0:t.filter((function(n){var t;return!(null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.find((function(e){return e.id===n.id})))}));return{data:[].concat((0,a.Z)(e.data),(0,a.Z)(n)),loading:!1}}))})).catch((function(e){var n=(0,S.S3)(e);l.ZP.error(n||"Something went wrong, please try again later."),Be((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!1})}))})))}),[Ne]),dn=(0,d.useCallback)((function(){Ee&&(Ge((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!0})})),U.getAllRecords({title:Ee}).then((function(e){var n,t=null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data;Ge((function(e){var n=null===t||void 0===t?void 0:t.filter((function(n){var t;return!(null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.find((function(e){return e.id===n.id})))}));return{data:[].concat((0,a.Z)(e.data),(0,a.Z)(n)),loading:!1}}))})).catch((function(e){var n=(0,S.S3)(e);l.ZP.error(n||"Something went wrong, please try again later."),Ge((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!1})}))})))}),[Ee]),ln=(0,d.useCallback)((function(){Me&&(en((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!0})})),H.getAllRecords({name:Me}).then((function(e){var n,t=null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data;en((function(e){var n=null===t||void 0===t?void 0:t.filter((function(n){var t;return!(null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.find((function(e){return e.id===n.id})))}));return{data:[].concat((0,a.Z)(e.data),(0,a.Z)(n)),loading:!1}}))})).catch((function(e){var n=(0,S.S3)(e);l.ZP.error(n||"Something went wrong, please try again later."),en((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!1})}))})))}),[Me]);(0,d.useEffect)((function(){ie&&an();var e=setTimeout((function(){re(!1)}),2e3);return function(){return clearTimeout(e)}}),[ie,ne,an]);var un=(0,d.useCallback)((function(){if(B&&B.length>0){var e=null===B||void 0===B?void 0:B.map((function(e){return{}}));ce(e)}}),[B]);(0,d.useEffect)((function(){void 0!==Ze?an({quoteNumber:Ze}):""===Ze&&an({quoteNumber:void 0})}),[Ze]),(0,d.useEffect)((function(){un()}),[un]),(0,d.useEffect)((function(){on()}),[on]),(0,d.useEffect)((function(){rn()}),[rn]),(0,d.useEffect)((function(){dn()}),[dn]),(0,d.useEffect)((function(){ln()}),[ln]);return(0,P.jsxs)(s.Z,{permissionSlug:[].concat((0,a.Z)(E),(0,a.Z)(D),(0,a.Z)(A)),children:[(0,P.jsx)(f.mr,{heading:"Quotations",breadCrumbData:k,showAdd:!!M,buttonText:"Add Quotation",onButtonClick:function(){!1!==M?O((0,i.Z)((0,i.Z)({},K),{},{open:!0,type:"create"})):l.ZP.error("You don't have permission to create new record")},positionChildren:"new-line",filters:z?(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{children:(0,P.jsx)(f.t7,{name:"name",placeHolder:"Search by quotation id",onChange:function(e){var n=e.currentTarget.value;me(n),nn(e)},value:he,style:{maxWidth:200}})}),(0,P.jsx)("div",{style:{overflow:"auto"},children:(0,P.jsx)(u.Z,{size:"middle",defaultValue:"active",options:[{label:"All",value:"all"},{label:"Active",value:"active"},{label:"Confirmed",value:"confirmed"},{label:"Draft",value:"draft"},{label:"Revised",value:"revised"},{label:"Rejected",value:"rejected"}].map((function(e){return(0,i.Z)((0,i.Z)({},e),{},{title:e.label,value:e.value})})),style:{fontSize:"var(--font-size-sm)"},onChange:function(e){if("all"===e)tn("__status",""),te((function(e){return(0,i.Z)((0,i.Z)({},e),{},{__status:[]})}));else{var n=e;an({__status:V[n]}),te((function(e){return(0,i.Z)((0,i.Z)({},e),{},{__status:V[n]})}))}}})}),(0,P.jsx)("div",{children:(0,P.jsx)(f.Xy,{type:"radio",label:"Client",name:"clientId",withSearch:!0,options:null===Ue||void 0===Ue||null===(e=Ue.data)||void 0===e?void 0:e.map((function(e){return{label:e.name,value:"".concat(e.id)}})),onChange:nn,value:Number(null===ne||void 0===ne?void 0:ne.clientId)>0?String(null===ne||void 0===ne?void 0:ne.clientId):"",onReset:function(){tn("clientId",0),ye("")},onUpdate:an,loading:null===Ue||void 0===Ue?void 0:Ue.loading,searchTerm:we,onSearch:function(e){return ye(e.currentTarget.value)}})}),(0,P.jsx)("div",{children:(0,P.jsx)(f.Xy,{type:"radio",label:"Assigned To",name:"assignedToId",withSearch:!0,options:null===Je||void 0===Je||null===(n=Je.data)||void 0===n?void 0:n.map((function(e){return{label:"".concat(e.firstName," ").concat(e.lastName),value:"".concat(e.id)}})),onChange:nn,value:Number(null===ne||void 0===ne?void 0:ne.assignedToId)>0?String(null===ne||void 0===ne?void 0:ne.assignedToId):"",onReset:function(){tn("assignedToId",0),ze("")},onUpdate:an,loading:null===Je||void 0===Je?void 0:Je.loading,searchTerm:Qe,onSearch:function(e){return ze(e.currentTarget.value)}})}),(0,P.jsx)("div",{children:(0,P.jsx)(f.Xy,{type:"datepicker",label:"Date",name:"dateRange",onChange:function(e){return te((function(n){return(0,i.Z)((0,i.Z)({},n),{},{dateRange:e})}))},onReset:function(){return tn("dateRange",[])},onUpdate:an})}),(0,P.jsx)("div",{children:(0,P.jsx)(f.Xy,{type:"radio",label:"Project Type",name:"projectTypeId",withSearch:!0,options:null===Le||void 0===Le||null===(t=Le.data)||void 0===t?void 0:t.map((function(e){return{label:e.title,value:"".concat(e.id)}})),onChange:nn,value:Number(null===ne||void 0===ne?void 0:ne.projectTypeId)>0?String(null===ne||void 0===ne?void 0:ne.projectTypeId):"",onReset:function(){tn("projectTypeId",0),Ce("")},onUpdate:an,loading:null===Le||void 0===Le?void 0:Le.loading,searchTerm:Te,onSearch:function(e){return Ce(e.currentTarget.value)}})}),(0,P.jsx)("div",{children:(0,P.jsx)(f.Xy,{type:"radio",label:"Project",name:"projectId",withSearch:!0,options:null===Fe||void 0===Fe||null===(_=Fe.data)||void 0===_?void 0:_.map((function(e){return{label:"".concat(e.referenceNumber," | ").concat(e.title),value:"".concat(e.id)}})),onChange:nn,value:Number(null===ne||void 0===ne?void 0:ne.projectId)>0?String(null===ne||void 0===ne?void 0:ne.projectId):"",onReset:function(){tn("projectId",0),_e("")},onUpdate:an,loading:null===Fe||void 0===Fe?void 0:Fe.loading,searchTerm:ke,onSearch:function(e){return _e(e.currentTarget.value)}})})]}):null,excelExport:!0===z&&(null===B||void 0===B?void 0:B.length)>0&&(0,P.jsx)(f.jY,{fileName:"Quotations",headers:[{label:"Name",key:"name"},{label:"Email",key:"email"}],data:ue,icon:(0,P.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",className:"mr-1",children:(0,P.jsx)("path",{fill:"#42526E",d:"M16.19 2H7.81C4.17 2 2 4.17 2 7.81v8.37C2 19.83 4.17 22 7.81 22h8.37c3.64 0 5.81-2.17 5.81-5.81V7.81C22 4.17 19.83 2 16.19 2zm1.06 10.33c0 .41-.34.75-.75.75s-.75-.34-.75-.75V9.31l-7.72 7.72c-.15.15-.34.22-.53.22s-.38-.07-.53-.22a.754.754 0 010-1.06l7.72-7.72h-3.02c-.41 0-.75-.34-.75-.75s.34-.75.75-.75h4.83c.41 0 .75.34.75.75v4.83z"})})})}),!B&&F&&(0,P.jsx)("div",{style:{display:"flex",flexWrap:"wrap",width:"100%",gap:10},children:Array(6).fill(0).map((function(e,n){return(0,P.jsx)(N.t,{},"shimmerItem-".concat(n))}))}),!0===z&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(p.Z,{permissions:Q,data:{allQuotation:B,onRefresh:function(){return an({perPage:(null===$||void 0===$?void 0:$.perPage)||10,page:(null===$||void 0===$?void 0:$.page)||1})}},quotationDrawer:K,setQuotationDrawer:O,setNewProject:fe,newProject:ve}),(0,P.jsx)(f.tl,{total:null===$||void 0===$?void 0:$.total,current:null===$||void 0===$?void 0:$.page,defaultPageSize:(null===$||void 0===$?void 0:$.pageCount)||10,pageSizeOptions:[10,20,50,100],onChange:function(e,n){return an({page:e,perPage:n})}})]}),!1===z&&(0,P.jsx)(g.a$,{mainMessage:"You don't have permission to view this data"}),(null===K||void 0===K?void 0:K.open)&&(0,P.jsx)(C.Z,{drawer:K,setDrawer:O,permissions:Q,onRefresh:W,setNewProject:fe})]})}}}]);