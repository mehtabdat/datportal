"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[8711],{84943:function(e,n,t){t.d(n,{Z:function(){return z}});var o=t(4942),i=t(1413),r=t(29439),s=t(47313),a=t(86136),l=t(55291),c=t(28770),d=t(32697),u=t(8773),v=t(72652),f=t(47312),m=t(66204),p=t(5900),h=t(34450),_=t(39548),x=t(53764),Z=t(98676),j=t(70816),g=t.n(j),y=t(82626),k=t(32147),N=t(48897),w=t(85554),b=t(72333),C={tabs:"styles_tabs__hF6b4",divider:"styles_divider__otMLG",notes:"styles_notes__sN0Fb",notes_wrapper:"styles_notes_wrapper__wUhrQ",note:"styles_note__3a1Pq",note_user_avatar:"styles_note_user_avatar__aXIwA",note_content_wrapper:"styles_note_content_wrapper__23KhL",note_header:"styles_note_header__fToud",note_header_date:"styles_note_header_date__3jVfP",note_header_delete:"styles_note_header_delete__uCmQG",note_content:"styles_note_content__YVO+9",notes_form_input_wrapper:"styles_notes_form_input_wrapper__B-M2V",notes_form_avatar:"styles_notes_form_avatar__VLz1k",notes_form_input:"styles_notes_form_input__hYLi4",notes_form_send_loader:"styles_notes_form_send_loader__+Up7j",notes_form_send:"styles_notes_form_send__bLXjB"},I=t(29079),P=t(3798),S=t(46417),T=a.Z.TextArea,z=function(e){var n,t,a,j=e.invoiceId,z=e.onRefresh,D=e.permissions,A=e.open,M=e.onCancel,R=(0,w.v9)((function(e){return e.usersReducer})).loggedInUserData,Y=D.updateInvoice,F=D.readInvoice,L=(0,s.useMemo)((function(){return new b.b}),[]),B=(0,s.useState)("addNote"),U=(0,r.Z)(B,2),E=U[0],O=(U[1],(0,s.useState)({})),Q=(0,r.Z)(O,2),V=Q[0],q=Q[1],K=(0,s.useState)({content:"",loading:!1,isConcern:!1}),G=(0,r.Z)(K,2),X=G[0],J=G[1],$=(0,s.useState)({confirmLoading:!1,visible:!1}),H=(0,r.Z)($,2),W=H[0],ee=H[1],ne=(0,s.useMemo)((function(){return!!j&&!0===F&&"logs"===E}),[j,F,E]),te=(0,I.K2)({method:function(){return L.getNoteById(j)},condition:!!j&&!0===F}),oe=te.data,ie=te.onRefresh,re=te.loading,se=(0,I.K2)({method:function(){return L.getLogsById(j)},condition:ne});se.data,se.onRefresh,se.loading;return(0,S.jsx)(c.Z,{title:"Notes",open:A,onCancel:M,width:700,footer:"addNote"!==E||re?null:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(d.Z,{checked:X.isConcern,onChange:function(e){return J((function(n){return(0,i.Z)((0,i.Z)({},n),{},{isConcern:e.target.checked})}))},children:"Mark as a concern"}),(0,S.jsxs)("div",{className:C.notes_form_input_wrapper,children:[(0,S.jsx)(u.C,{size:30,icon:(0,S.jsx)(_.Z,{}),className:C.notes_form_avatar,src:"".concat(N.lj).concat(null===R||void 0===R||null===(n=R.data)||void 0===n?void 0:n.profile),alt:"".concat(null===R||void 0===R||null===(t=R.data)||void 0===t?void 0:t.firstName," ").concat(null===R||void 0===R||null===(a=R.data)||void 0===a?void 0:a.lastName)}),(0,S.jsx)(T,{placeholder:"Add a note...",className:C.notes_form_input,autoSize:{minRows:1,maxRows:4},value:X.content,onChange:function(e){return J((function(n){return(0,i.Z)((0,i.Z)({},n),{},{content:e.target.value})}))}}),X.loading?(0,S.jsx)(v.Z,{indicator:(0,S.jsx)(x.Z,{style:{fontSize:20},spin:!0}),className:C.notes_form_send_loader}):(0,S.jsx)(k.jE,{width:30,height:30,className:C.notes_form_send,onClick:function(){return e=X.content,n=X.isConcern,void(e?j&&(!0===Y?(J((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!0})})),L.addNote(j,{note:e,isConcern:n}).then((function(e){var n;l.ZP.success((null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||"Note added successfully"),J({content:"",loading:!1,isConcern:!1}),z(),ie()})).catch((function(e){var n,t;l.ZP.error((null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message)||"Something went wrong"),J((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!1})}))}))):l.ZP.error("You do not have permission to add notes")):l.ZP.error("Please enter a note"));var e,n}})]})]}),children:(0,S.jsx)(h.Z,{headStyle:{display:"unset",padding:0},bodyStyle:{padding:0},className:C.notes,children:(0,S.jsxs)("div",{className:C.notes_wrapper,children:[re&&(0,S.jsx)("div",{className:C.notes_loader,children:(0,S.jsx)(f.Z,{active:!0})}),0===(null===oe||void 0===oe?void 0:oe.length)&&!re&&(0,S.jsx)("div",{className:C.notes_empty,children:(0,S.jsx)(y.I$,{description:"No notes found"})}),null===oe||void 0===oe?void 0:oe.map((function(e,n){return(0,S.jsxs)("div",{className:C.note,onMouseEnter:function(){return q((0,o.Z)({},e.id,!0))},onMouseLeave:function(){return q({})},children:[(0,S.jsx)(u.C,{size:40,icon:(0,S.jsx)(_.Z,{}),className:C.note_user_avatar,src:"".concat(N.lj).concat(e.AddedBy.profile),alt:"".concat(e.AddedBy.firstName," ").concat(e.AddedBy.lastName)}),(0,S.jsxs)("div",{className:C.note_content_wrapper,children:[(0,S.jsxs)("div",{className:C.note_header,children:[(0,S.jsx)(y.ZT,{weight:"bold",color:"dark-main",children:"".concat(e.AddedBy.firstName," ").concat(e.AddedBy.lastName)}),(0,S.jsxs)("p",{className:C.note_header_date,title:g()(e.addedDate).format("DD MMM, YYYY hh:mm A"),children:[g()(e.addedDate).fromNow(),e.isConcern&&(0,S.jsx)(m.Z,{color:"warning",className:"ml-2",children:"Concern"}),e.isResolved&&(0,S.jsx)(m.Z,{color:"green",className:"ml-2",children:"Resolved"}),e.isConcern&&!e.isResolved&&(0,S.jsx)(p.Z,{title:"Are you sure to mark this concern as resolved?",okText:"Yes",cancelText:"No",placement:"bottomRight",open:W.visible,onOpenChange:function(e){return ee((function(n){return(0,i.Z)((0,i.Z)({},n),{},{visible:e})}))},onCancel:function(){return ee((function(e){return(0,i.Z)((0,i.Z)({},e),{},{visible:!1})}))},okButtonProps:{loading:W.confirmLoading},onConfirm:function(){!0===Y?L.markConcernAsResolved(e.id).then((function(e){var n;l.ZP.success((null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||"Concern resolved successfully"),z(),ie(),ee((function(e){return(0,i.Z)((0,i.Z)({},e),{},{visible:!1})}))})).catch((function(e){var n=(0,P.S3)(e);l.ZP.error(n||"Something went wrong")})):l.ZP.error("You do not have permission to resolve concerns")},children:(0,S.jsx)(d.Z,{checked:!1,onChange:function(e){return ee((function(n){return(0,i.Z)((0,i.Z)({},n),{},{visible:e.target.checked})}))},children:"Mark as resolved"})})]}),V[e.id]&&(0,S.jsx)(p.Z,{title:"Are you sure to delete this note?",onConfirm:function(){return n=e.id,void(!0===Y?L.removeNote(n).then((function(e){var n;l.ZP.success((null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||"Note deleted successfully"),z(),ie()})).catch((function(e){var n,t;l.ZP.error((null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message)||"Something went wrong")})):l.ZP.error("You do not have permission to delete notes"));var n},okText:"Yes",cancelText:"No",placement:"left",children:(0,S.jsx)(Z.Z,{className:C.note_header_delete})})]}),(0,S.jsx)("p",{className:C.note_content,children:e.note})]})]},"note-".concat(n))}))]})})})}},96723:function(e,n,t){t.d(n,{Z:function(){return A}});var o=t(29439),i=t(47313),r=t(8570),s=t(59491),a=t(41586),l=t(82626),c=t(4942),d=t(1413),u=t(55291),v=t(78267),f=t(5900),m=t(95366),p=t(99223),h=t(98676),_=t(37289),x=t(72333),Z="styles_actions__4SByJ",j="styles_container__gxK94",g="styles_button__cf-ge",y=t(37936),k=t(46417),N=function(e){var n=e.record,t=e.setDrawer,r=e.reloadTableData,s=e.permissions.deleteInvoice,a=e.setQuickUpdate,l=(0,i.useMemo)((function(){return new x.b}),[]),j=(0,i.useState)({}),g=(0,o.Z)(j,2),N=g[0],w=g[1],b=(0,i.useState)(!1),C=(0,o.Z)(b,2),I=C[0],P=C[1];return(0,k.jsx)(v.Z,{trigger:["click"],open:N[n.id],onOpenChange:function(e){return w((0,d.Z)((0,d.Z)({},N),{},(0,c.Z)({},n.id,e)))},menu:{items:[{label:"Edit",key:"edit",icon:(0,k.jsx)(m.Z,{}),onClick:function(e){e.domEvent.preventDefault(),n.status===y.UY.Generated?t({open:!0,id:n.id,type:"edit"}):u.ZP.error("You cannot edit this invoice because it is already ".concat(y.UY[n.status]))}},{key:"link-to-project",icon:(0,k.jsx)(p.Z,{}),label:" Link To Project",onClick:function(e){e.domEvent.preventDefault(),a({open:!0,invoiceId:n.id,initialProjectId:n.projectId}),w((0,c.Z)({},n.id,!1))}},{type:"divider"},{label:(0,k.jsx)(f.Z,{title:"Are you sure to delete this invoice?",onConfirm:function(){!1!==s?l.deleteRecord(n.id).then((function(){u.ZP.success("Invoice has been deleted successfully."),r&&r()})).catch((function(e){var n,t,o=null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message;u.ZP.error(o||"Something went wrong, please try again later.")})):u.ZP.error("You don't have permission to delete this record, please contact your admin."),P(!1),w((0,d.Z)((0,d.Z)({},N),{},(0,c.Z)({},n.id,!1)))},okText:"Yes",cancelText:"No",placement:"bottomLeft",open:I,onOpenChange:function(e){return P(e)},children:"Delete"}),key:"delete",icon:(0,k.jsx)(h.Z,{}),danger:!0,onClick:function(e){e.domEvent.preventDefault(),P(!I)}}]},children:(0,k.jsx)(_.Z,{className:Z,onClick:function(e){return e.preventDefault()}})})},w=t(3646),b=t(3798),C=t(93433),I=t(25019),P=t(28770),S=t(42623),T=t(69591),z=function(e){var n=e.open,t=e.onClose,r=e.invoiceId,s=e.initialProjectId,a=I.Z.useForm(),c=(0,o.Z)(a,1)[0],d=(0,i.useState)(!1),v=(0,o.Z)(d,2),f=v[0],m=v[1],p=(0,i.useMemo)((function(){return new x.b}),[]),h=(0,i.useMemo)((function(){return new T.Q}),[]),_=(0,i.useState)(""),Z=(0,o.Z)(_,2),j=Z[0],g=Z[1],y=(0,S.N)(j,500),N=(0,i.useState)([]),w=(0,o.Z)(N,2),z=w[0],D=w[1],A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.title,t=e.ids;h.getAllRecords({title:n,ids:t}).then((function(e){var n=(null===e||void 0===e?void 0:e.data).data;D((function(e){var t=null===n||void 0===n?void 0:n.filter((function(n){return!(null!==e&&void 0!==e&&e.find((function(e){return e.id===n.id})))}));return[].concat((0,C.Z)(e),(0,C.Z)(t))}))})).catch((function(e){var n=(0,b.S3)(e);u.ZP.error(n)}))};return(0,i.useEffect)((function(){y&&A({title:y})}),[y]),(0,i.useEffect)((function(){0!==s&&(A({ids:[s]}),c.setFieldsValue({projectId:s}))}),[s]),(0,k.jsx)(P.Z,{open:n,onCancel:t,zIndex:1e4,destroyOnClose:!0,title:"Quick Update",okText:"Update",cancelText:"Cancel",okButtonProps:{htmlType:"submit",form:"quick-update-form",loading:f},children:(0,k.jsx)(I.Z,{onFinish:function(e){m(!0),p.quickUpdate(r,e).then((function(e){u.ZP.success("Invoice has been updated successfully."),t()})).catch((function(e){var n=(0,b.S3)(e);u.ZP.error(n)})).finally((function(){return m(!1)}))},form:c,name:"quick-update-form",children:(0,k.jsx)(I.Z.Item,{name:"projectId",rules:[{required:!0,message:"Please select a project"}],children:(0,k.jsx)(l.Ld,{label:"Select Project",notFoundDescription:"No projects found., Please search for projects.",onSearch:function(e){return g(e)},onChange:function(e){return c.setFieldsValue({projectId:e})},options:null===z||void 0===z?void 0:z.map((function(e){return{label:"".concat(e.referenceNumber," | ").concat(e.title),value:e.id}}))})})})})},D=r.Z.Paragraph,A=function(e){var n=e.tableData,t=e.tableLoading,r=e.emptyText,c=e.reloadTableData,d=e.permissions,u=e.setDrawer,v=e.onAddNoteClick,f=(0,i.useState)({open:!1,invoiceId:0,initialProjectId:0}),m=(0,o.Z)(f,2),p=m[0],h=m[1],_=[{title:"S.No",dataIndex:"index",key:"index",render:function(e,n,t){return t+1},width:"60px"},{title:"Client",dataIndex:"Client",key:"Client",render:function(e,n){return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(l.ZT,{color:"dark-main",size:"sm",className:"mb-1",children:n.invoiceNumber}),(0,k.jsx)(l.ZT,{color:"dark-main",children:null===e||void 0===e?void 0:e.name}),(null===e||void 0===e?void 0:e.email)&&(0,k.jsx)(D,{ellipsis:{rows:1,expandable:!1},copyable:{text:null===e||void 0===e?void 0:e.email},className:"font-size-xs color-dark-sub mb-0",children:(0,k.jsx)("a",{href:"mailto:".concat(null===e||void 0===e?void 0:e.email),style:{color:"var(--color-dark-sub)"},children:null===e||void 0===e?void 0:e.email})}),(null===e||void 0===e?void 0:e.phone)&&(0,k.jsx)(D,{ellipsis:{rows:1,expandable:!1},copyable:{text:"".concat(null===e||void 0===e?void 0:e.phoneCode).concat(null===e||void 0===e?void 0:e.phone)},className:"font-size-xs color-dark-sub",children:(0,k.jsx)("a",{href:"tel:".concat(null===e||void 0===e?void 0:e.phoneCode," ").concat(null===e||void 0===e?void 0:e.phone),style:{color:"var(--color-dark-sub)"},children:"".concat(null===e||void 0===e?void 0:e.phoneCode).concat(null===e||void 0===e?void 0:e.phone)})})]})},width:"240px"},{title:"Project",dataIndex:"Project",key:"Project",render:function(e){return(0,k.jsx)(l.ZT,{color:"dark-main",children:"".concat((null===e||void 0===e?void 0:e.referenceNumber)||""," ").concat(null!==e&&void 0!==e&&e.referenceNumber?"|":""," ").concat((null===e||void 0===e?void 0:e.title)||"")})},width:"240px"},{title:"Message/Note",dataIndex:"message",key:"message",render:function(e,n){var t=n.InvoiceFollowUp;return(0,k.jsx)(k.Fragment,{children:(0,k.jsxs)("div",{className:j,style:{padding:"10px",borderRadius:"2px",fontSize:"var(--font-size-sm)"},children:[(null===t||void 0===t?void 0:t.length)>0?null===t||void 0===t?void 0:t.map((function(e,n){return(0,k.jsx)(D,{ellipsis:{rows:5},style:{fontSize:"var(--font-size-sm)",color:"var(--color-dark-main)"},children:e.note})})):(0,k.jsx)("p",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-dark-100)"},children:"No notes"}),(0,k.jsx)("div",{className:g,children:(0,k.jsx)(s.Z,{type:"ghost",size:"small",style:{fontSize:"var(--font-size-xs)"},onClick:function(){return v(n)},children:0===(null===t||void 0===t?void 0:t.length)?"Add Note":"Manage Notes"})})]})})},width:"400px"},{title:"Overview",dataIndex:"total",key:"total",render:function(e,n){return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(l.ZT,{color:"dark-main",children:"Total Amount: ".concat((0,b.xG)(e))}),(0,k.jsx)(s.Z,{type:"ghost",size:"small",style:{fontSize:"0.8rem"},className:"mt-1",onClick:function(){return u({open:!0,id:n.id,type:"preview"})},children:"Preview File"})]})},width:"150px"},{title:"Status",dataIndex:"status",key:"status",className:"text-center",render:function(e,n){return(0,k.jsx)(w.Z,{item:n,permissions:d,onRefresh:function(){return c()},setDrawer:u})},width:"180px"},{title:"Actions",dataIndex:"actions",key:"actions",render:function(e,n){return(0,k.jsx)(N,{record:n,setDrawer:u,reloadTableData:c,permissions:d,setQuickUpdate:h})},width:"120px"}];return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(a.Z,{sticky:!0,dataSource:n,columns:_,pagination:!1,scroll:{x:991},loading:t,rowKey:function(e){return"invoice-".concat(e.id)},locale:{emptyText:r}}),(null===p||void 0===p?void 0:p.open)&&(0,k.jsx)(z,{open:p.open,invoiceId:p.invoiceId,initialProjectId:p.initialProjectId,onClose:function(){h({open:!1,invoiceId:0,initialProjectId:0}),c()}})]})}},53764:function(e,n,t){var o=t(87462),i=t(47313),r=t(71100),s=t(16141),a=function(e,n){return i.createElement(s.Z,(0,o.Z)({},e,{ref:n,icon:r.Z}))};n.Z=i.forwardRef(a)}}]);