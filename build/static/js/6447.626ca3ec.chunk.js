"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[6447],{6447:function(e,n,i){i.d(n,{Z:function(){return G}});var t=i(1413),o=i(29439),d=i(47313),l=i(8570),r=i(55291),s=i(37388),a=i(55768),c=i(82626),u=i(32147),m=i(98505),v=i(16468),p=i(4942),f=i(78267),j=i(61677),h=i(39180),x=i(45705),Z=i(5900),y=i(95366),I=i(99223),b=i(98676),k=i(37289),P=i(80663),N=i(46417),g=function(e){var n=e.item,i=e.onDelete,t=e.onEdit,l=e.setNewProject,r=e.setQuickUpdate,s=(0,d.useState)({}),a=(0,o.Z)(s,2),c=a[0],u=a[1],m=(0,d.useState)(!1),v=(0,o.Z)(m,2),g=v[0],C=v[1];return(0,N.jsx)(N.Fragment,{children:(0,N.jsx)(f.Z,{trigger:["click"],open:c[n.id],destroyPopupOnHide:!0,onOpenChange:function(e){return u((0,p.Z)({},n.id,e))},menu:{items:[{key:"edit",label:"Edit",icon:(0,N.jsx)(y.Z,{}),onClick:function(){t(n),u((0,p.Z)({},n.id,!1))}},{key:"link-to-project",icon:(0,N.jsx)(I.Z,{}),label:(0,N.jsx)(j.Z,{placement:"top",trigger:"click",zIndex:9999,destroyTooltipOnHide:!0,content:(0,N.jsx)(h.ZP.Group,{children:(0,N.jsxs)(x.Z,{direction:"vertical",children:[(0,N.jsx)(h.ZP,{value:"existing",onClick:function(){var e,i,t,o;r({open:!0,quoteId:n.id,initialProjectId:n.projectId,initialSubmissionById:null===n||void 0===n||null===(e=n.Lead)||void 0===e||null===(i=e.SubmissionBy)||void 0===i?void 0:i.id,initialProjectTypeId:null===n||void 0===n||null===(t=n.Lead)||void 0===t||null===(o=t.ProjectType)||void 0===o?void 0:o.id}),u((0,p.Z)({},n.id,!1))},children:"Existing Project"}),(0,N.jsx)(h.ZP,{value:"new",onClick:function(){l({isOpen:!0,quoteId:n.id,loading:!1,submissionById:0,projectTypeId:0}),u((0,p.Z)({},n.id,!1))},children:"New Project"})]})}),children:"Link To Project"})},{type:"divider"},{key:"delete",label:(0,N.jsx)(Z.Z,{title:"Are you sure to delete this quotation?",onConfirm:function(){i(n.id),C(!1),u((0,p.Z)({},n.id,!1))},okText:"Yes",cancelText:"No",placement:"bottomLeft",open:g,destroyTooltipOnHide:!0,onOpenChange:function(e){return C(e)},zIndex:9999,children:"Delete"}),icon:(0,N.jsx)(b.Z,{}),onClick:function(e){e.domEvent.preventDefault(),C(!g)},danger:!0}]},children:(0,N.jsx)(k.Z,{className:P.Z.quotation_item_header_actions_more,onClick:function(e){return e.preventDefault()}})})})},C=i(55891),w=i(93433),q=i(32697),S=i(59491),_=i(41586),T=i(71703),L=i(37936),M=i(3798),D=i(42954),z=function(e){var n=e.item,i=e.setDrawer,l=e.onRefresh,a=n.QuotationMilestone,c=(0,d.useMemo)((function(){var e=[];return null===a||void 0===a||a.forEach((function(n){(null===n||void 0===n?void 0:n.status)!==L._W["Not Completed"]&&e.push(null===n||void 0===n?void 0:n.id)})),e}),[a]),u=(0,d.useState)({open:!1,ids:[],completedIds:c}),m=(0,o.Z)(u,2),v=m[0],p=m[1],f=(0,d.useMemo)((function(){return new D.K}),[]),j=function(e){var n=v.ids.filter((function(n){return n!==e}));p((function(e){return(0,t.Z)((0,t.Z)({},e),{},{open:!1,ids:n})}))},h=[{title:"",dataIndex:"id",key:"id",render:function(e,i,o){var d,a,c;return(0,N.jsx)("div",{className:"d-flex align-items-center",children:n.projectId?(0,N.jsx)(N.Fragment,{children:null!==(d=v.completedIds)&&void 0!==d&&d.includes(e)?(0,N.jsx)(s.Z,{title:"This milestone is already completed",children:(0,N.jsx)(T.Z,{style:{color:"var(--color-primary-main)"}})}):(0,N.jsx)(Z.Z,{title:"This will mark the milestone as completed. Are you sure?",okText:"Yes",cancelText:"No",zIndex:9999,onConfirm:function(){j(e),function(e){f.completeMilestone(e).then((function(n){var i;r.ZP.success((null===n||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)||"Milestone completed successfully");var o=v.ids.filter((function(n){return n!==e}));p((function(n){return(0,t.Z)((0,t.Z)({},n),{},{open:!1,ids:o,completedIds:[].concat((0,w.Z)(n.completedIds),[e])})})),l()})).catch((function(e){var n=(0,M.S3)(e);r.ZP.error(n||"Something went wrong")}))}(e)},onCancel:function(){return j(e)},onOpenChange:function(n){n||j(e)},children:(0,N.jsx)(q.Z,{checked:v.ids.includes(e),onChange:function(){return p((function(n){return(0,t.Z)((0,t.Z)({},n),{},{open:!0,ids:[].concat((0,w.Z)(n.ids),[e])})}))},disabled:null===(a=v.completedIds)||void 0===a?void 0:a.includes(e),defaultChecked:null===(c=v.completedIds)||void 0===c?void 0:c.includes(e)})})}):(0,N.jsxs)("span",{children:[o+1,"."]})})}},{title:"Title",dataIndex:"title",key:"title",render:function(e){return(0,N.jsx)("div",{className:"d-flex align-items-center",children:(0,N.jsx)("span",{children:e})})}},{title:"Amount",dataIndex:"amount",key:"amount",render:function(e){return(0,N.jsx)("span",{children:(0,M.xG)(e)})}},{title:"Status",dataIndex:"status",key:"status",render:function(e,t){return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("span",{children:L._W[e]}),e===L._W.Completed&&(0,N.jsx)("div",{children:(0,N.jsx)(S.Z,{type:"ghost",size:"small",style:{fontSize:"0.7rem",borderColor:"var(--color-primary-main)",color:"var(--color-primary-main)"},onClick:function(){i({type:"create",open:!0,quotation:n,id:t.invoiceId,projectId:n.projectId})},children:"Create Invoice"})}),e===L._W["Invoice Generated"]&&(0,N.jsx)("div",{children:(0,N.jsx)(S.Z,{type:"ghost",size:"small",style:{fontSize:"0.7rem",borderColor:"var(--color-primary-main)",color:"var(--color-primary-main)"},onClick:function(){i({open:!0,type:"preview",quotation:n,id:t.invoiceId,projectId:n.projectId})},children:"Submit Invoice"})})]})}}];return(0,N.jsx)(_.Z,{columns:h,dataSource:a||[],pagination:!1})},Q=function(e){var n=e.item;return(0,N.jsx)("div",{className:"mx-2 color-dark-sub ".concat(P.Z.accordianItem),dangerouslySetInnerHTML:{__html:null===n||void 0===n?void 0:n.scopeOfWork}})},B=i(76017),O=i(42623),R=i(5190),F=i(69591),A=i(25019),E=i(28770),U=i(29079),$=i(6027),W=function(e){var n=e.open,i=e.onClose,t=e.quickUpdate,l=A.Z.useForm(),s=(0,o.Z)(l,1)[0],a=(0,d.useState)(!1),u=(0,o.Z)(a,2),m=u[0],v=u[1],p=(0,d.useMemo)((function(){return new D.K}),[]),f=(0,d.useMemo)((function(){return new F.Q}),[]),j=(0,d.useMemo)((function(){return new R.L}),[]),h=(0,d.useMemo)((function(){return new $.i}),[]),x=(0,d.useState)(""),Z=(0,o.Z)(x,2),y=Z[0],I=Z[1],b=(0,O.N)(y,500),k=(0,U.K2)({method:j.findPublished,condition:n}).data,P=(0,U.K2)({method:h.getPublishRecords,condition:n,initialQuery:{perPage:100}}).data,g=(0,d.useState)([]),C=(0,o.Z)(g,2),q=C[0],S=C[1],_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.title,i=e.ids;f.getAllRecords({title:n,ids:i}).then((function(e){var n=(null===e||void 0===e?void 0:e.data).data;S((function(e){var i=null===n||void 0===n?void 0:n.filter((function(n){return!(null!==e&&void 0!==e&&e.find((function(e){return e.id===n.id})))}));return[].concat((0,w.Z)(e),(0,w.Z)(i))}))})).catch((function(e){var n=(0,M.S3)(e);r.ZP.error(n)}))};return(0,d.useEffect)((function(){b&&_({title:b})}),[b]),(0,d.useEffect)((function(){0!==(null===t||void 0===t?void 0:t.initialProjectId)&&(_({ids:[null===t||void 0===t?void 0:t.initialProjectId]}),s.setFieldsValue({projectId:null===t||void 0===t?void 0:t.initialProjectId}))}),[null===t||void 0===t?void 0:t.initialProjectId]),(0,N.jsx)(E.Z,{open:n,onCancel:i,zIndex:1e4,destroyOnClose:!0,title:"Quick Update",okText:"Update",cancelText:"Cancel",okButtonProps:{htmlType:"submit",form:"quick-update-form",loading:m},children:(0,N.jsxs)(A.Z,{onFinish:function(e){v(!0),p.quickUpdate(null===t||void 0===t?void 0:t.quoteId,e).then((function(e){r.ZP.success("Quotation updated successfully!"),i()})).catch((function(e){var n=(0,M.S3)(e);r.ZP.error(n)})).finally((function(){return v(!1)}))},form:s,name:"quick-update-form",children:[(0,N.jsx)(A.Z.Item,{name:"projectId",rules:[{required:!0,message:"Please select a project"}],children:(0,N.jsx)(c.Ld,{label:"Select Project",notFoundDescription:"No projects found., Please search for projects.",onSearch:function(e){return I(e)},onChange:function(e){return s.setFieldsValue({projectId:e})},options:null===q||void 0===q?void 0:q.map((function(e){return{label:"".concat(e.referenceNumber," | ").concat(e.title),value:e.id}}))})}),(0,N.jsx)(A.Z.Item,{name:"submissionById",initialValue:(null===t||void 0===t?void 0:t.initialSubmissionById)||void 0,rules:[{required:!0,message:"Please select a submission by!"}],children:(0,N.jsx)(c.AP,{label:"Submission By",asterisk:!0,options:null===k||void 0===k?void 0:k.map((function(e){return{label:e.name,value:e.id}}))})}),(0,N.jsx)(A.Z.Item,{name:"projectTypeId",initialValue:(null===t||void 0===t?void 0:t.initialProjectTypeId)||void 0,rules:[{required:!0,message:"Please select project type"}],children:(0,N.jsx)(c.AP,{label:"Project Type",asterisk:!0,placeholder:"Select Project Type",options:null===P||void 0===P?void 0:P.map((function(e){return{value:e.id,label:e.title}}))})})]})})},H=i(93082),K=l.Z.Paragraph,G=function(e){var n=e.data,i=e.permissions,l=e.setQuotationDrawer,p=e.setNewProject,f=e.newProject,j=n.onRefresh,h=n.allQuotation,x=(0,d.useMemo)((function(){return new D.K}),[]),Z=(0,U.bH)(),y=Z.drawer,I=Z.setDrawer,b=(0,d.useState)({open:!1,quoteId:0,initialProjectId:0,initialSubmissionById:0,initialProjectTypeId:0}),k=(0,o.Z)(b,2),w=k[0],q=k[1],S=function(e){!0===i.deleteQuotation?x.deleteRecord(e).then((function(){return j()})).catch((function(e){var n=(0,M.S3)(e);r.ZP.error(n||"Something went wrong, please try again later.")})):r.ZP.error("You don't have permission to delete this quotation, Please contact your admin")},_=function(e){!1!==i.updateQuotation?l((function(){var n,i;return{open:!0,type:"edit",quoteId:null===e||void 0===e?void 0:e.id,leadId:null===e||void 0===e?void 0:e.leadId,submissionById:null===e||void 0===e||null===(n=e.Lead)||void 0===n||null===(i=n.SubmissionBy)||void 0===i?void 0:i.id}})):r.ZP.error("You don't have permission to update record")};return(0,N.jsxs)(N.Fragment,{children:[0===(null===h||void 0===h?void 0:h.length)&&(0,N.jsx)(c.I$,{description:"No quotation found",className:"my-5"}),(0,N.jsx)("section",{className:P.Z.quotations,children:null===h||void 0===h?void 0:h.map((function(e,n){var o,d,r,v,f,h,x,Z;return(0,N.jsxs)("div",{className:P.Z.quotation_item,children:[(0,N.jsxs)("div",{className:P.Z.quotation_item_header,children:[(0,N.jsx)("div",{className:P.Z.quotation_item_header_left,children:(0,N.jsxs)("div",{children:[(0,N.jsx)(c.ZT,{className:P.Z.quotation_item_header_title,onClick:function(){return l((function(n){return(0,t.Z)((0,t.Z)({},n),{},{open:!0,quoteId:null===e||void 0===e?void 0:e.id,type:"preview",quotation:e})}))},color:"dark-main",size:"sm",children:(null===e||void 0===e?void 0:e.quoteNumber)||"No Quote Number"}),"Amount: ",(0,M.xG)((null===e||void 0===e?void 0:e.total)||0),(0,N.jsxs)("div",{className:"d-flex flex-column",children:[(null===e||void 0===e||null===(o=e.Lead)||void 0===o||null===(d=o.Client)||void 0===d?void 0:d.name)&&(0,N.jsx)(c.ZT,{color:"dark-sub",size:"sm",className:"mt-1 mb-0",children:null===e||void 0===e||null===(r=e.Lead)||void 0===r||null===(v=r.Client)||void 0===v?void 0:v.name}),(null===e||void 0===e||null===(f=e.Lead)||void 0===f||null===(h=f.Client)||void 0===h?void 0:h.email)&&(0,N.jsx)(K,{ellipsis:{rows:1,expandable:!1},copyable:{text:e.Lead.Client.email},className:"font-size-xs color-dark-sub mb-0",children:null===e||void 0===e||null===(x=e.Lead)||void 0===x||null===(Z=x.Client)||void 0===Z?void 0:Z.email}),"undefined"!==e.Lead.Client.phone&&e.Lead.Client.phone&&(0,N.jsx)(K,{ellipsis:{rows:1,expandable:!1},copyable:{text:"".concat(e.Lead.Client.phoneCode).concat(e.Lead.Client.phone)},className:"font-size-xs color-dark-sub mb-0",children:"+".concat(e.Lead.Client.phoneCode).concat(e.Lead.Client.phone)})]})]})}),(0,N.jsxs)("div",{className:P.Z.quotation_item_header_actions,children:[(0,N.jsxs)("div",{className:P.Z.quotation_item_header_actions_items,children:[(0,N.jsx)(B.Z,{item:e,onRefresh:j,permissions:i,setDrawer:l,setNewProject:p}),(0,N.jsx)(g,{item:e,onDelete:S,onEdit:_,setNewProject:p,setQuickUpdate:q})]}),(null===e||void 0===e?void 0:e.sentDate)&&(0,N.jsxs)("div",{className:"d-flex align-center",children:[(0,N.jsx)(u.$$,{className:"mr-2",width:13}),(0,N.jsx)(c.ZT,{color:"dark-sub",size:"xs",className:"mt-1",children:"Sent: ".concat((0,m.Ny)(e.addedDate,"dd MM yy"))||0})]}),(null===e||void 0===e?void 0:e.addedDate)&&(0,N.jsxs)("div",{className:"d-flex align-center",children:[(0,N.jsx)(u.$$,{className:"mr-2",width:13}),(0,N.jsx)(c.ZT,{color:"dark-sub",size:"xs",className:"mt-1",children:"Created: ".concat((0,m.Ny)(e.addedDate,"dd MM yy"))||0})]}),(null===e||void 0===e?void 0:e.modifiedDate)&&(0,N.jsxs)("div",{className:"d-flex align-center",children:[(0,N.jsx)(u.$$,{className:"mr-2",width:13}),(0,N.jsx)(c.ZT,{color:"dark-sub",size:"xs",className:"mt-1",children:"Modified: ".concat((0,m.Ny)(e.modifiedDate,"dd MM yy"))||0})]})]})]}),(0,N.jsxs)("div",{className:P.Z.quotation_item_body,children:[(0,N.jsx)(C.Z,{label:(0,N.jsx)("div",{className:P.Z.quotation_title,children:(0,N.jsxs)("div",{className:"d-flex align-center",children:[(0,N.jsx)(c.ZT,{color:"dark-main",size:"sm",children:"Milestones & Invoices"}),(0,N.jsx)(s.Z,{title:"Add Quotation",children:(0,N.jsx)(a.Z,{className:"ml-2",style:{fontSize:"1rem"},onClick:function(n){n.stopPropagation(),I((function(n){return(0,t.Z)((0,t.Z)({},n),{},{open:!0,type:"create",quotation:e,projectId:null===e||void 0===e?void 0:e.projectId})}))}})})]})}),children:(0,N.jsx)(z,{item:e,setDrawer:I,onRefresh:j})}),(0,N.jsx)(C.Z,{label:"Scope Of Work",placement:"bottomRight",children:(0,N.jsx)(Q,{item:e})})]})]},"invoice-".concat(n))}))}),y.open&&(0,N.jsx)(v.Z,{drawer:y,setDrawer:I,onRefresh:j,permissions:i}),(null===w||void 0===w?void 0:w.open)&&(0,N.jsx)(W,{open:w.open,quickUpdate:w,onClose:function(){q({open:!1,quoteId:0,initialProjectId:0,initialSubmissionById:0,initialProjectTypeId:0}),j()}}),(null===f||void 0===f?void 0:f.isOpen)&&(0,N.jsx)(H.Z,{setNewProject:p,newProject:f,onRefresh:j,permissions:i})]})}}}]);