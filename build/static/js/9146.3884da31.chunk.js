"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[9146],{89146:function(e,o,r){r.r(o),r.d(o,{default:function(){return L}});var n=r(1413),t=r(29439),i=r(47313),a=r(55291),s=r(5900),d=r(97258),l=r(66204),c=r(59491),u=r(72652),p=r(41586),f=r(98676),h=r(3109),m=r(3113),y=r(85554),Z=r(78593),x=r(98505),g=r(3798),v=r(46417),j=function(e){var o=e.record,r=(e.onEditIconClick,e.reloadTableData),d=e.permissions.deletePayrollCycle,l=(0,i.useState)({confirmLoading:!1,openPopConfirm:!1}),c=(0,t.Z)(l,2),u=c[0],p=c[1],h=new Z.f;return(0,v.jsx)("div",{className:m.Z.actions,children:!o.processed&&!o.processing&&(0,v.jsx)(s.Z,{open:u.openPopConfirm,placement:"top",title:"Are you sure?",onConfirm:function(){if(p((0,n.Z)((0,n.Z)({},u),{},{confirmLoading:!0})),!1===d)return a.ZP.error("You don't have permission to delete this record, please contact your admin."),void p((0,n.Z)((0,n.Z)({},u),{},{openPopConfirm:!1}));h.deleteRecord(o.id).then((function(e){p((0,n.Z)((0,n.Z)({},u),{},{openPopConfirm:!1,confirmLoading:!1})),r()})).catch((function(e){var o=(0,g.S3)(e);a.ZP.error(o),p((0,n.Z)((0,n.Z)({},u),{},{confirmLoading:!1}))}))},onCancel:function(){return p((0,n.Z)((0,n.Z)({},u),{},{openPopConfirm:!1}))},okButtonProps:{loading:u.confirmLoading},okText:"Yes",cancelText:"No",onOpenChange:function(e){e||p((0,n.Z)((0,n.Z)({},u),{},{openPopConfirm:!1}))},children:(0,v.jsx)(f.Z,{className:m.Z.bg__red,onClick:function(){p((0,n.Z)((0,n.Z)({},u),{},{openPopConfirm:!0}))}})})})};function P(e){var o=e.tableData,r=e.tableLoading,f=e.onEditIconClick,P=e.reloadTableData,b=e.meta,C=e.filters,k=(0,y.v9)((function(e){return e.usersReducer})).userPermissions,w=(0,i.useState)({report:[],open:!1}),R=(0,t.Z)(w,2),D=R[0],T=R[1],N=(0,i.useState)(!1),S=(0,t.Z)(N,2),I=S[0],z=S[1],F=k,L=new Z.f,M=function(){return(0,v.jsxs)(d.Z,{width:window.innerWidth>768?"50%":"100%",bodyStyle:{paddingRight:"1rem"},title:"Failed Report",placement:"right",onClose:function(){return T({report:[],open:!1})},open:D.open,children:[(0,v.jsx)("p",{className:"text-center font-weight-bold",style:{fontStyle:"italic"},children:"Note: This report is for developers, please ignore"}),(0,v.jsx)("ul",{children:D.report.length>0?D.report.map((function(e,o){return(0,v.jsx)("li",{className:"mt-5",children:"string"==typeof e?e:JSON.stringify(e)},o)})):"No reports found"})]})},A=[{title:"S.No",dataIndex:"index",key:"index",render:function(e,o,r){return r+1},width:"5%"},{title:"Period",dataIndex:"fromDate",key:"fromDate",render:function(e,o){return(0,v.jsxs)("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[(0,v.jsx)(h.Z,{color:"dark-sub",size:"sm",children:(0,x.Ny)(e,"dd M,yy")+" - "+(0,x.Ny)(o.toDate,"dd M,yy")}),(0,g.ZQ)(new Date,e,o.toDate)?(0,v.jsx)(l.Z,{color:"green",children:"Current"}):null]})},width:"25%"},{title:"Failed Report",dataIndex:"failedReport",key:"failedReport",render:function(e,o){return o.failedReport?(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(c.Z,{size:"small",onClick:function(){return T({open:!0,report:o.failedReport?o.failedReport:[]})},children:"View Report"})}):null}},{title:"Report",dataIndex:"addedDate",key:"addedDate",render:function(e,o){return(0,v.jsx)(v.Fragment,{children:o.processing?(0,v.jsx)(u.Z,{}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(h.Z,{color:"dark-sub",size:"sm",children:"Added: ".concat((0,x.Ny)(e,"dd M,yy"))}),(0,v.jsx)(h.Z,{color:"dark-sub",size:"sm",children:"Processed: ".concat(o.processed?(0,x.Ny)(o.processedDate,"dd M,yy"):"Not yet processed")}),!o.processing&&!o.processed&&(0,v.jsx)(s.Z,{placement:"top",title:"Are you sure?",onConfirm:function(){return e=o.id,z(!0),void L.processRecord(e).then((function(e){var o=null===e||void 0===e?void 0:e.data;z(!1),a.ZP.success(o.message),P()})).catch((function(e){var o=(0,g.S3)(e);a.ZP.error(o),z(!1)}));var e},okButtonProps:{loading:I},okText:"Yes",cancelText:"No",children:(0,v.jsx)(c.Z,{type:"ghost",size:"small",className:"mt-2 font-weight-semi",children:"Process Now"})})]})})}},{title:"Others",dataIndex:"others",key:"others",render:function(e,o){return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(h.Z,{color:"dark-sub",size:"sm",children:"Success: ".concat(o.success)}),(0,v.jsx)(h.Z,{color:"dark-sub",size:"sm",children:"Failed: ".concat(o.failed)}),(0,v.jsx)(h.Z,{color:"dark-sub",size:"sm",children:"Total records: ".concat(o.success+o.failed)})]})}},{title:"Actions",dataIndex:"actions",key:"actions",render:function(e,o){return(0,v.jsx)(j,{record:o,onEditIconClick:f,reloadTableData:P,permissions:F})}}];return(0,v.jsxs)("div",{className:m.Z.antdTableWrapper,children:[(0,v.jsx)(p.Z,{sticky:!0,dataSource:o,columns:A,pagination:{current:null===b||void 0===b?void 0:b.page,total:null===b||void 0===b?void 0:b.total,hideOnSinglePage:!1,pageSize:null===b||void 0===b?void 0:b.perPage,onChange:function(e,o){P((0,n.Z)((0,n.Z)({},C),{},{page:e,perPage:o}))}},scroll:{x:991},loading:r,rowKey:function(e){return"PayrollCycle-".concat(e.id)}}),D.open&&(0,v.jsx)(M,{})]})}var b=r(82626),C=r(18515),k=r(58381),w=r(29079),R=r(54060),D=r(25019),T=r(69309),N=r(49355),S=r(46646),I=r(40169),z=function(e){var o=e.openModal,r=e.onCancel,s=e.type,d=e.record,l=e.reloadTableData,c=e.permissions.createPayrollCycle,u=D.Z.useForm(),p=(0,t.Z)(u,1)[0],f=new Z.f,h=(0,i.useState)(),y=(0,t.Z)(h,2),x=y[0],g=y[1],j=function(e){var o=(0,I.P)(e);if("string"==typeof o.message)g((0,n.Z)((0,n.Z)({},x),{},{error:o.message}));else{var r=(0,S.O)(o.message,[]);p.setFields(r),g((0,n.Z)((0,n.Z)({},x),{},{error:""}))}},P=(0,i.useCallback)((function(){f.getRecordById(d).then((function(e){e.data&&e.data.data&&(p.setFieldsValue((0,n.Z)({},e.data.data)),g((0,n.Z)((0,n.Z)({},e.data),{},{loading:!1})))})).catch((function(e){j(e)}))}),[p,d,f]);(0,i.useEffect)((function(){"edit"===s?(g({loading:!0}),P()):p.resetFields()}),[]);return(0,v.jsx)(b.P0,{visible:o,closable:!0,onCancel:r,titleText:"Add Payroll Cycle",showFooter:!1,children:null!==x&&void 0!==x&&x.loading?(0,v.jsx)(N.Z,{items:3}):(0,v.jsxs)(D.Z,{className:m.Z.form,onFinish:function(e){if(g((0,n.Z)((0,n.Z)({},x),{},{buttonLoading:!0})),"new"===s)!0===c?f.createRecord(e).then((function(e){l(),r(),g((function(e){return(0,n.Z)((0,n.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){j(e),g((function(e){return(0,n.Z)((0,n.Z)({},e),{},{buttonLoading:!1})}))})):(g((function(e){return(0,n.Z)((0,n.Z)({},e),{},{buttonLoading:!1})})),a.ZP.error("You don't have permission to create this record"))},form:p,layout:"vertical",children:[(null===x||void 0===x?void 0:x.error)&&(0,v.jsx)(b.EQ,{description:null===x||void 0===x?void 0:x.error,isClosable:!0,onClose:function(){g((0,n.Z)((0,n.Z)({},x),{},{error:""}))}}),(0,v.jsx)("div",{children:(0,v.jsxs)("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-dark-main)",width:"100%",display:"block"},children:["From Date",(0,v.jsx)("span",{style:{color:"var(--color-red-yp)"},children:" *"}),(0,v.jsx)(D.Z.Item,{name:"fromDate",rules:[{required:!0,message:"Please select date "}],children:(0,v.jsx)(T.Z,{style:{borderRadius:"0.25rem",borderWidth:2,width:"100%",borderColor:"var(--color-border)"}})})]})}),(0,v.jsx)("div",{children:(0,v.jsxs)("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-dark-main)",width:"100%",display:"block"},children:["To Date",(0,v.jsx)("span",{style:{color:"var(--color-red-yp)"},children:" *"}),(0,v.jsx)(D.Z.Item,{name:"toDate",rules:[{required:!0,message:"Please select date "}],help:(0,v.jsx)("small",{children:"Note: Total days in the cycle is used to calculate per day salary"}),children:(0,v.jsx)(T.Z,{style:{borderRadius:"0.25rem",borderWidth:2,width:"100%",borderColor:"var(--color-border)"}})})]})}),(0,v.jsxs)("div",{className:"d-flex justify-end",children:[(0,v.jsx)(b.op,{size:"normal",fontSize:"sm",onClick:r,type:"plain",children:"Cancel"}),(0,v.jsx)(b.op,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:null===x||void 0===x?void 0:x.buttonLoading,children:"edit"===s?"Edit Payroll Cycle":"Add Payroll Cycle"})]})]})})},F=[{text:"Home",isLink:!0,path:"/"},{isLink:!1,text:"Payroll Cycle"}];var L=function(){var e=(0,g.aY)(k.v),o=(0,y.v9)((function(e){return e.usersReducer})).userPermissions,r=o.readPayrollCycle,s=o.createPayrollCycle,d=o.updatePayrollCycle,l=(0,i.useState)({editType:"new",recordId:0,openModal:!1}),c=(0,t.Z)(l,2),u=c[0],p=c[1],f=new Z.f,h=(0,i.useState)({page:1,perPage:10}),m=(0,t.Z)(h,2),x=m[0],j=(m[1],(0,w.$5)({method:f.getAllRecords,initialQuery:(0,n.Z)({},x)})),D=j.data,T=j.onRefresh,N=(j.setData,j.loading),S=j.meta,I=function(){!1!==s?p((0,n.Z)((0,n.Z)({},u),{},{openModal:!u.openModal,editType:"new"})):a.ZP.error("You don't have permission to create new record")};return(0,v.jsxs)(R.Z,{permissionSlug:e,children:[(0,v.jsx)(b.mr,{heading:"Payroll Cycle",buttonText:"Add Payroll Cycle",onButtonClick:I,breadCrumbData:F,showAdd:!0===s}),!0===r&&(0,v.jsx)(P,{tableData:D,tableLoading:N,onEditIconClick:function(e){!1!==d?p((0,n.Z)((0,n.Z)({},u),{},{editType:"edit",recordId:e.id,openModal:!0})):a.ZP.error("You don't have permission to update this record")},reloadTableData:T,meta:S,filters:x}),!1===r&&(0,v.jsx)(C.a$,{mainMessage:"You don't have permission to view this data"}),u.openModal&&(0,v.jsx)(z,{record:u.recordId,type:u.editType,reloadTableData:T,onCancel:I,openModal:u.openModal,permissions:o})]})}},78593:function(e,o,r){r.d(o,{f:function(){return a}});var n=r(43144),t=r(15671),i=r(49075),a=(0,n.Z)((function e(){var o=this;(0,t.Z)(this,e),this.endPoint="payroll-cycle",this.getAllRecords=function(e){return i.Z.get(o.endPoint,{params:e})},this.getRecordById=function(e){return i.Z.get(i._+o.endPoint+"/"+e)},this.deleteRecord=function(e){return i.Z.delete(i._+o.endPoint+"/"+e)},this.createRecord=function(e){return i.Z.post(i._+o.endPoint,e)},this.updateRecord=function(e,r){return i.Z.patch(i._+o.endPoint+"/"+r,e)},this.processRecord=function(e){return i.Z.patch(i._+o.endPoint+"/process/"+e)}}))}}]);