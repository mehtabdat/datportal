"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[309],{62911:function(e,t,n){n.r(t),n.d(t,{default:function(){return fe}});var o=n(93433),a=n(1413),r=n(29439),i=n(47313),d=n(69309),l=n(25019),s=n(55291),c=n(31513),u=n(98276),h=n(82626),f=n(3113),m=n(49355),v=n(46646),g=n(40169),p=n(42623),y=n(51812),Z=n(84825),x=n(70816),b=n.n(x),j=n(46417),k=d.Z.TimePicker,w=function(e){var t,n=e.openModal,x=e.onCancel,w=e.type,I=e.record,S=e.reloadTableData,P=e.permissions,C=P.createAttendance,D=P.updateAttendance,N=e.employeeId,R=e.date,z=l.Z.useForm(),A=(0,r.Z)(z,1)[0],M=new y.s,_=(0,i.useState)(),O=(0,r.Z)(_,2),L=O[0],E=O[1],F=(0,i.useState)(""),T=(0,r.Z)(F,2),H=T[0],q=T[1],B=(0,p.N)(H,500),U=(0,i.useState)([]),V=(0,r.Z)(U,2),Y=V[0],W=V[1],$=(0,i.useMemo)((function(){return new Z.z}),[]),J=(0,i.useCallback)((function(){B&&$.getAllRecords({name:B}).then((function(e){W((function(t){var n,a,r=null===e||void 0===e||null===(n=e.data)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.filter((function(e){return!(null!==t&&void 0!==t&&t.find((function(t){return t.id===e.id})))}));return[].concat((0,o.Z)(t),(0,o.Z)(r))}))})).catch((function(e){s.ZP.error(e.response.data.message)}))}),[B]);(0,i.useEffect)((function(){J()}),[J]);var K=function(e){var t=(0,g.P)(e);if("string"==typeof t.message)E((0,a.Z)((0,a.Z)({},L),{},{error:t.message}));else{var n=(0,v.O)(t.message,[]);A.setFields(n),E((0,a.Z)((0,a.Z)({},L),{},{error:""}))}},Q=(0,i.useCallback)((function(){M.getRecordById(I).then((function(e){var t,n,o=null===e||void 0===e||null===(t=e.data)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.userId;e.data&&e.data.data&&(A.setFieldsValue((0,a.Z)((0,a.Z)({},e.data.data),{},{userId:o,checkIn:b()(e.data.data.checkIn),checkOut:b()(e.data.data.checkOut),date:b()(e.data.data.checkIn)})),E((0,a.Z)((0,a.Z)({},e.data),{},{loading:!1})),o&&$.getRecordById(o).then((function(e){var t;W([null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.data])})).catch((function(e){s.ZP.error(e.response.data.message)})))})).catch((function(e){K(e)}))}),[A,I,M]);(0,i.useEffect)((function(){"edit"===w?(E({loading:!0}),Q()):A.resetFields()}),[]),(0,i.useEffect)((function(){N&&($.getRecordById(N).then((function(e){W([null===e||void 0===e?void 0:e.data.data])})).catch((function(e){console.log(e)})),A.setFieldValue("userId",N)),R&&A.setFieldValue("date",b()(R).add(1,"d"))}),[N,R]);return(0,j.jsx)(h.P0,{visible:n,closable:!0,onCancel:x,titleText:"edit"===w?"Edit Attendance":"Add New Attendance",showFooter:!1,children:null!==L&&void 0!==L&&L.loading?(0,j.jsx)(m.Z,{items:3}):(0,j.jsxs)(l.Z,{className:f.Z.form,onFinish:function(e){E((0,a.Z)((0,a.Z)({},L),{},{buttonLoading:!0}));var t={};switch(e.checkIn&&(t.checkIn=e.date._d.toISOString().substring(0,10)+e.checkIn._d.toISOString().substring(10)),e.checkOut&&(t.checkOut=e.date._d.toISOString().substring(0,10)+e.checkOut._d.toISOString().substring(10)),w){case"edit":!0===D?M.updateRecord((0,a.Z)((0,a.Z)({},e),t),I).then((function(e){S(),x(),E((function(e){return(0,a.Z)((0,a.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){K(e),E((function(e){return(0,a.Z)((0,a.Z)({},e),{},{buttonLoading:!1})}))})):(E((function(e){return(0,a.Z)((0,a.Z)({},e),{},{buttonLoading:!1})})),s.ZP.error("You don't have permission to update this record"));break;case"new":!0===C?M.createRecord((0,a.Z)((0,a.Z)({},e),t)).then((function(e){S(),x(),E((function(e){return(0,a.Z)((0,a.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){K(e),E((function(e){return(0,a.Z)((0,a.Z)({},e),{},{buttonLoading:!1})}))})):(E((function(e){return(0,a.Z)((0,a.Z)({},e),{},{buttonLoading:!1})})),s.ZP.error("You don't have permission to create this record"))}},form:A,children:[(null===L||void 0===L?void 0:L.error)&&(0,j.jsx)(h.EQ,{description:null===L||void 0===L?void 0:L.error,isClosable:!0,onClose:function(){E((0,a.Z)((0,a.Z)({},L),{},{error:""}))}}),"new"===w&&(0,j.jsx)("div",{children:(0,j.jsxs)(l.Z.Item,{name:"userId",rules:[{required:!0,message:"Please select an employee"}],children:[(0,j.jsxs)("label",{className:"font-size-sm",children:["Employee  ",(0,j.jsx)("span",{className:"color-red-yp",children:"*"})]}),(0,j.jsx)(c.Z,{allowClear:!0,style:{width:"100%"},defaultValue:(null===L||void 0===L||null===(t=L.data)||void 0===t?void 0:t.userId)||N,placeholder:"Search for the employee",className:"selectAntdCustom",onChange:function(e){return A.setFieldsValue({userId:e})},showSearch:!0,onSearch:function(e){return q(e)},optionFilterProp:"label",options:null===Y||void 0===Y?void 0:Y.map((function(e){return{label:e.firstName+" "+e.lastName,value:e.id}})),notFoundContent:(0,j.jsx)(u.Z,{image:"https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg",imageStyle:{height:100},description:(0,j.jsx)("span",{children:"No data found, Please search for the employee"})})})]})}),(0,j.jsx)("div",{children:(0,j.jsx)(l.Z.Item,{name:"note",children:(0,j.jsx)(h.t7,{size:"w100",label:"Note",type:"text",placeHolder:"Enter note"})})}),(0,j.jsxs)("div",{style:{width:"100%"},children:[(0,j.jsxs)("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-dark-main)",width:"33%"},children:["Date",(0,j.jsx)("span",{style:{color:"var(--color-red-yp)"},children:" *"}),(0,j.jsx)(l.Z.Item,{name:"date",rules:[{required:!0,message:"Please select date "}],children:(0,j.jsx)(d.Z,{style:{borderRadius:"0.25rem",borderWidth:2,width:"100%",borderColor:"var(--color-border)"}})})]}),(0,j.jsxs)("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-dark-main)",width:"33%"},children:["Check in time",(0,j.jsx)("span",{style:{color:"var(--color-red-yp)"},children:" *"}),(0,j.jsx)(l.Z.Item,{name:"checkIn",rules:[{required:!0,message:"Please select date "}],children:(0,j.jsx)(k,{showSecond:!1,style:{borderRadius:"0.25rem",borderWidth:2,width:"100%",borderColor:"var(--color-border)"}})})]}),(0,j.jsxs)("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-dark-main)",width:"33%"},children:["Check out time",(0,j.jsx)("span",{style:{color:"var(--color-red-yp)"},children:" *"}),(0,j.jsx)(l.Z.Item,{name:"checkOut",rules:[{required:!0,message:"Please select date "}],children:(0,j.jsx)(k,{showSecond:!1,style:{borderRadius:"0.25rem",borderWidth:2,width:"100%",borderColor:"var(--color-border)"}})})]})]}),(0,j.jsxs)("div",{className:"d-flex justify-end",children:[(0,j.jsx)(h.op,{size:"normal",fontSize:"sm",onClick:x,type:"plain",children:"Cancel"}),(0,j.jsx)(h.op,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:null===L||void 0===L?void 0:L.buttonLoading,children:"edit"===w?"Edit Attendance":"Add Attendance"})]})]})})},I=n(82183),S=n(85554),P=n(59491),C=n(70638),D=n(18515),N=n(54060),R=n(29079),z=n(37936),A=n(59109),M=n(3798),_="styles_view_as__qk+hi",O="styles_monthPicker__qYntM",L="styles_yearPicker__d8g4-",E=n(32344),F=n(44658),T=n(4106),H=n(41549),q=(n(64605),n(48897)),B=(0,H.Zt)(b()),U=function(e){var t=e.data,n=e.month,o=e.year,d=e.onCellClick;console.log("year",o),console.log("month",n);var l=(0,i.useState)([]),s=(0,r.Z)(l,2),c=s[0],u=s[1],h=[];t.workingHour.hours.forEach((function(e){e.closed&&h.push(e.day)}));var f=(0,i.useCallback)((function(e){var o,r,i,d,l;return(0,a.Z)((0,a.Z)((0,a.Z)((0,a.Z)((0,a.Z)((0,a.Z)({},Number(null===(o=t.attendanceData)||void 0===o||null===(r=o.find((function(t){return b()(t.day).get("D")===b()(e).get("D")})))||void 0===r?void 0:r.status)===z.H8.incomplete&&{className:"incomplete-hours",style:{backgroundColor:"rgba(255, 140, 0, 0.6)"}}),(null===t||void 0===t||null===(i=t.attendanceData.find((function(t){return b()(t.day).get("D")===b()(e).get("D")})))||void 0===i?void 0:i.status)===z.H8.absent&&{className:"absent",style:{backgroundColor:"rgba(247,5,5, 0.4)"}}),(null===t||void 0===t||null===(d=t.attendanceData.find((function(t){return b()(t.day).get("D")===b()(e).get("D")})))||void 0===d?void 0:d.status)===z.H8.late&&{className:"late",style:{backgroundColor:"rgba(245,188,2, 0.4)"}}),(null===t||void 0===t||null===(l=t.attendanceData.find((function(t){return b()(t.day).get("D")===b()(e).get("D")})))||void 0===l?void 0:l.status)===z.H8.complete&&{style:{backgroundColor:"white"}}),(h.includes(b()(e).day())||b()(e).month()!==n)&&{style:{backgroundColor:"var(--color-light-50)"}}),(0,M.H8)(new Date,e)&&{className:"incomplete-hours",style:{background:'url("'.concat(q.lj,'public/icons/lines.png")'),backgroundRepeat:"no-repeat",backgroundSize:"cover"}})}),[c]);return(0,i.useEffect)((function(){var e,n,o=[];null===(e=t.leaves)||void 0===e||e.forEach((function(e){o.push({id:e.id,start:b()(e.leaveFrom).toDate(),end:b()(e.leaveTo).toDate(),title:(null===e||void 0===e?void 0:e.purpose)+" (On leave)"})})),null===(n=t.publicHolidays)||void 0===n||n.forEach((function(e){o.push({id:e.id,start:b()(e.date).toDate(),end:b()(e.date).toDate(),title:null===e||void 0===e?void 0:e.title})})),u(o)}),[t.leaves]),(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[(0,j.jsx)(H.f,{components:{month:{dateHeader:function(e){var o=e.date,a=e.label;return(0,j.jsx)("div",{onClick:function(e){var a,r,i=null===t||void 0===t||null===(a=t.attendanceData)||void 0===a||null===(r=a.find((function(e){return b()(e.day).get("D")===b()(o).get("D")})))||void 0===r?void 0:r.recordId;h.includes(b()(o).day())||b()(o).month()!==n||(0,M.H8)(new Date,o)||d(i?"edit":"new",o,i)},style:{width:"100%",height:"8vh",cursor:h.includes(b()(o).day())||b()(o).month()!==n||(0,M.H8)(new Date,o)?"not-allowed":"pointer",fontSize:"var(--font-size-lg)",fontWeight:"600"},children:a})}}},localizer:B,date:o&&n?new Date("".concat(o,"/").concat(n+1,"/01")):new Date,defaultView:"month",events:c,style:{height:"70vh",color:"var(--color-dark-main)"},views:["month"],dayPropGetter:f,toolbar:!1}),(0,j.jsx)("div",{style:{alignSelf:"flex-start"},children:(0,j.jsxs)("div",{style:{border:"1px solid var(--color-border)",display:"flex",padding:"0.5rem",gap:"0.5rem",alignItems:"flex-start"},children:[(0,j.jsxs)("div",{style:{display:"flex",gap:"0.5rem",fontSize:"var(--font-size-sm)"},children:[(0,j.jsx)("div",{style:{width:"1rem",height:"1rem",backgroundColor:"rgba(247,5,5, 0.4)",borderRadius:"50%"}}),(0,j.jsx)("p",{style:{margin:0},children:"Absent"})]}),(0,j.jsxs)("div",{style:{display:"flex",gap:"0.5rem",fontSize:"var(--font-size-sm)"},children:[(0,j.jsx)("div",{style:{width:"1rem",height:"1rem",backgroundColor:"rgba(255, 140, 0, 0.6)",borderRadius:"50%"}}),(0,j.jsx)("p",{style:{margin:0},children:"Incomplete hours"})]}),(0,j.jsxs)("div",{style:{display:"flex",gap:"0.5rem",fontSize:"var(--font-size-sm)",alignSelf:"flex-start"},children:[(0,j.jsx)("div",{style:{width:"1rem",height:"1rem",backgroundColor:"rgba(245,188,2, 0.4)",borderRadius:"50%"}}),(0,j.jsx)("p",{style:{margin:0},children:"Late"})]}),(0,j.jsxs)("div",{style:{display:"flex",gap:"0.5rem",fontSize:"var(--font-size-sm)",alignSelf:"flex-start"},children:[(0,j.jsx)("div",{style:{width:"1rem",height:"1rem",backgroundColor:"var(--color-light-50)",borderRadius:"50%"}}),(0,j.jsx)("p",{style:{margin:0},children:"Weekend"})]})]})})]})},V=n(2135),Y=n(98505),W=n(40096),$=n(74165),J=n(70804),K=n(45987),Q=n(15861),G=n(28770),X="styles_date_picker__cqNKA",ee="styles_date_footer__Npo7F",te=n(85336),ne=n(70584),oe=function(e){return e.all="all",e.users="users",e.department="department",e.organization="organization",e}({}),ae=n(38859),re=n(5190),ie=["date_range"],de=d.Z.RangePicker,le=[{text:"This Month",value:[b()().startOf("month"),b()().endOf("month")]},{text:"Last Month",value:[b()().subtract(1,"month").startOf("month"),b()().subtract(1,"month").endOf("month")]}],se=function(e){var t,n,d,c=e.isModalOpen,u=e.setIsModalOpen,f=l.Z.useForm(),m=(0,r.Z)(f,1)[0],v=(0,i.useState)("all"),g=(0,r.Z)(v,2),x=g[0],b=g[1],k=(0,i.useState)(!1),w=(0,r.Z)(k,2),I=w[0],S=w[1],C=(0,i.useState)(!1),D=(0,r.Z)(C,2),N=D[0],R=D[1],z=(0,i.useMemo)((function(){return new y.s}),[]),A=(0,i.useMemo)((function(){return new Z.z}),[]),_=(0,i.useMemo)((function(){return new ae.o}),[]),O=(0,i.useMemo)((function(){return new re.L}),[]),L=(0,i.useState)(""),E=(0,r.Z)(L,2),F=E[0],T=E[1],H=(0,i.useState)({loading:!1,data:[]}),q=(0,r.Z)(H,2),B=q[0],U=q[1],V=(0,p.N)(F,500),Y=(0,i.useState)({loading:!1,data:[]}),W=(0,r.Z)(Y,2),se=W[0],ce=W[1],ue=(0,i.useState)({loading:!1,data:[]}),he=(0,r.Z)(ue,2),fe=he[0],me=he[1],ve=function(){var e=(0,Q.Z)((0,$.Z)().mark((function e(t){var n,o,r,i,d,l,c,u,h,f;return(0,$.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.date_range,o=(0,K.Z)(t,ie),e.prev=1,r=(0,a.Z)((0,a.Z)({},o),{},{fromDate:new Date((null===n||void 0===n?void 0:n[0].toISOString())||""),toDate:new Date((null===n||void 0===n?void 0:n[1].toISOString())||"")}),R(!0),e.next=6,z.generateReport(r);case 6:i=e.sent,d=i.headers["content-disposition"],c=(l=(0,J.Z)(/filename=(.*)/,{filename:1}).exec(d))&&l.groups&&l.groups.filename?l.groups.filename:"downloaded_file.xlsx",s.ZP.success("Report downloaded successfully"),u=window.URL.createObjectURL(new Blob([i.data])),(h=document.createElement("a")).href=u,h.download=c,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(u),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(1),f=(0,M.S3)(e.t0),s.ZP.error(f||"Something went wrong while downloading the file");case 25:return e.prev=25,R(!1),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[1,21,25,28]])})));return function(t){return e.apply(this,arguments)}}(),ge=(0,i.useCallback)((function(){ce((function(e){return(0,a.Z)((0,a.Z)({},e),{},{loading:!0})})),(0,_.getAllRecords)().then((function(e){var t=e.data.data;ce((function(e){var n=null===t||void 0===t?void 0:t.filter((function(t){return!(null!==e&&void 0!==e&&e.data.find((function(e){return(null===e||void 0===e?void 0:e.id)===t.id})))}));return{data:[].concat((0,o.Z)(e.data),(0,o.Z)(n)),loading:!1}}))})).catch((function(e){var t=(0,M.S3)(e);s.ZP.error(t||"Something went wrong"),ce((function(e){return(0,a.Z)((0,a.Z)({},e),{},{loading:!1})}))}))}),[_]),pe=(0,i.useCallback)((function(){me((function(e){return(0,a.Z)((0,a.Z)({},e),{},{loading:!0})})),(0,O.getAllRecords)().then((function(e){var t=(null===e||void 0===e?void 0:e.data).data;me((function(e){var n=null===t||void 0===t?void 0:t.filter((function(t){return!(null!==e&&void 0!==e&&e.data.find((function(e){return(null===e||void 0===e?void 0:e.id)===t.id})))}));return{data:[].concat((0,o.Z)(e.data),(0,o.Z)(n)),loading:!1}}))})).catch((function(e){var t=(0,M.S3)(e);s.ZP.error(t||"Something went wrong"),me((function(e){return(0,a.Z)((0,a.Z)({},e),{},{loading:!1})}))}))}),[O]),ye=(0,i.useCallback)((function(e){b(e),e===oe.department&&0===se.data.length&&ge(),e===oe.organization&&0===fe.data.length&&pe()}),[ge,pe,se.data.length,fe.data.length]);return(0,i.useEffect)((function(){var e;""!==V&&(e=V,U((function(e){return(0,a.Z)((0,a.Z)({},e),{},{loading:!0})})),(0,A.getAllRecords)({name:e}).then((function(e){var t=e.data.data;U((function(e){var n=null===t||void 0===t?void 0:t.filter((function(t){return!(null!==e&&void 0!==e&&e.data.find((function(e){return(null===e||void 0===e?void 0:e.id)===t.id})))}));return{data:[].concat((0,o.Z)(e.data),(0,o.Z)(n)),loading:!1}}))})).catch((function(e){var t=(0,M.S3)(e);s.ZP.error(t||"Something went wrong"),U((function(e){return(0,a.Z)((0,a.Z)({},e),{},{loading:!1})}))})))}),[V]),(0,j.jsx)(G.Z,{title:"Export to Excel",open:c,onCancel:function(){return u(!1)},okText:"Export",okButtonProps:{form:"export_form",htmlType:"submit",loading:N},children:(0,j.jsxs)(l.Z,{layout:"vertical",form:m,onFinish:ve,name:"export_form",children:[(0,j.jsx)(l.Z.Item,{name:"date_range",label:"Date Range",requiredMark:"optional",rules:[{required:!0,message:"Please select a date range"}],style:{marginBottom:0},children:(0,j.jsx)(de,{className:X,open:I,onOpenChange:function(e){return S(e)},renderExtraFooter:function(){return(0,j.jsxs)("div",{className:ee,children:[le.map((function(e,t){return(0,j.jsx)(P.Z,{type:"ghost",size:"small",onClick:function(){var t,n,o=null===e||void 0===e||null===(t=e.value)||void 0===t?void 0:t[0],a=null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n[1];m.setFieldsValue({date_range:[o,a]})},children:e.text},"date_preset_".concat(t))})),(0,j.jsx)(P.Z,{style:{marginRight:0,marginLeft:"auto"},type:"primary",onClick:function(){return S(!1)},children:"Ok"})]})}})}),(0,j.jsx)(l.Z.Item,{name:"reportType",requiredMark:"optional",style:{marginBottom:0},rules:[{required:!0,message:"Please select a report type"}],children:(0,j.jsx)(te.Z,{label:"Report Type",options:(0,ne.hx)(oe).map((function(e){return{label:(0,M.kC)(null===e||void 0===e?void 0:e.label),value:null===e||void 0===e?void 0:e.value}})),value:x,onChange:function(e){return ye(e)}})}),(0,j.jsxs)("div",{className:"mt-3",children:[x===oe.users&&(0,j.jsx)(l.Z.Item,{name:"userIds",requiredMark:"optional",rules:[{required:!0,message:"Please select a user"}],children:(0,j.jsx)(h.Ld,{asterisk:!1,label:"Users",loading:null===B||void 0===B?void 0:B.loading,mode:"multiple",options:null===B||void 0===B||null===(t=B.data)||void 0===t?void 0:t.map((function(e){return{label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(null===e||void 0===e?void 0:e.lastName),value:"".concat(null===e||void 0===e?void 0:e.id)}})),onSearch:function(e){return T(e)},notFoundDescription:"".concat(F&&!B.loading?"No employees found, modify your search and try again":"Search for employees to generate report for")})}),x===oe.department&&(0,j.jsx)(l.Z.Item,{name:"departmentId",requiredMark:"optional",rules:[{required:!0,message:"Please select a department"}],children:(0,j.jsx)(h.Ld,{asterisk:!1,label:"Departments",loading:null===se||void 0===se?void 0:se.loading,options:null===se||void 0===se||null===(n=se.data)||void 0===n?void 0:n.map((function(e){return{label:null===e||void 0===e?void 0:e.title,value:"".concat(null===e||void 0===e?void 0:e.id)}})),onSearch:function(){}})})]}),x===oe.organization&&(0,j.jsx)(l.Z.Item,{name:"organizationId",requiredMark:"optional",rules:[{required:!0,message:"Please select an organization"}],children:(0,j.jsx)(h.Ld,{asterisk:!1,label:"Organizations",loading:null===fe||void 0===fe?void 0:fe.loading,options:null===fe||void 0===fe||null===(d=fe.data)||void 0===d?void 0:d.map((function(e){return{label:null===e||void 0===e?void 0:e.name,value:"".concat(null===e||void 0===e?void 0:e.id)}})),onSearch:function(){}})})]})})},ce=d.Z.MonthPicker,ue=d.Z.YearPicker,he=[{text:"Home",isLink:!0,path:"/"},{isLink:!1,text:"Attendance"}];var fe=function(){var e,t=(0,V.lr)(),n=(0,r.Z)(t,2),d=n[0],l=n[1],f=W.Z.getUserData(),m=(0,i.useState)(),v=(0,r.Z)(m,2),g=v[0],x=v[1],k=(0,M.aY)(A.L),H=(0,S.v9)((function(e){return e.usersReducer})).userPermissions,q=H.readAttendance,B=H.createAttendance,$=H.updateAttendance,J=H.readAllAttendance,K=(0,i.useState)((function(){return"calendar"===localStorage.getItem("attendanceViewAs")?"calendar":"table"})),Q=(0,r.Z)(K,2),G=Q[0],X=Q[1],ee=(0,i.useState)({editType:"new",recordId:0,openModal:!1}),te=(0,r.Z)(ee,2),ne=te[0],oe=te[1],ae=(0,i.useState)(!1),re=(0,r.Z)(ae,2),ie=re[0],de=re[1],le=(0,i.useState)([]),fe=(0,r.Z)(le,2),me=(fe[0],fe[1]),ve=(0,i.useState)({type:void 0,year:Number(d.get("year"))||b()(new Date).year(),month:Number(d.get("month"))||b()(new Date).month(),userId:localStorage.getItem("attendanceUser")&&J?Number(JSON.parse((null===(e=localStorage)||void 0===e?void 0:e.getItem("attendanceUser"))||"")):f.id}),ge=(0,r.Z)(ve,2),pe=ge[0],ye=ge[1],Ze=new y.s,xe=(0,R.$5)({method:Ze.getUserAttendance,initialQuery:pe}),be=xe.data,je=xe.onRefresh,ke=xe.setData,we=xe.loading,Ie=function(){!1!==B?oe((0,a.Z)((0,a.Z)({},ne),{},{openModal:!ne.openModal,editType:"new"})):s.ZP.error("You don't have permission to create new record")},Se=function(e,t,n){!1!==$?(oe(n?(0,a.Z)((0,a.Z)({},ne),{},{editType:e,recordId:n,openModal:!0}):{editType:"new",recordId:0,openModal:!0}),t&&x(new Date(t).toISOString())):s.ZP.error("You don't have permission to update this record")},Pe=(0,i.useState)(""),Ce=(0,r.Z)(Pe,2),De=Ce[0],Ne=Ce[1],Re=(0,p.N)(De,500),ze=(0,i.useState)([]),Ae=(0,r.Z)(ze,2),Me=Ae[0],_e=Ae[1],Oe=(0,i.useMemo)((function(){return new Z.z}),[]),Le=(0,i.useCallback)((function(){Re?Oe.getAllRecords({name:Re}).then((function(e){_e((function(t){var n,a,r=null===e||void 0===e||null===(n=e.data)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.filter((function(e){return!(null!==t&&void 0!==t&&t.find((function(t){return t.id===e.id})))}));return[].concat((0,o.Z)(t),(0,o.Z)(r))}))})).catch((function(e){s.ZP.error(e.response.data.message)})):pe.userId&&Oe.getRecordById(pe.userId).then((function(e){var t;_e([null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.data])})).catch((function(e){s.ZP.error(e.response.data.message)}))}),[Re]);(0,i.useEffect)((function(){Le()}),[Le,pe.userId]);var Ee=(0,i.useCallback)((function(){if(be&&be.attendanceData.length>0){var e=null===be||void 0===be?void 0:be.attendanceData.map((function(e){return{date:(0,Y.Ny)(null===e||void 0===e?void 0:e.day,"dd MM,yy"),day:Y.c1[new Date(e.day).getDay()],hours:null===e||void 0===e?void 0:e.hoursWorked,status:(0,M.kC)(z.H8[e.status]),proRatedDeduction:e.proRatedDeduction,note:e.note}}));me(e)}}),[be]);return(0,i.useEffect)((function(){Ee()}),[Ee]),(0,j.jsxs)(N.Z,{permissionSlug:k,children:[(0,j.jsx)(h.mr,{heading:"Attendance",buttonText:"Add Attendance",onButtonClick:Ie,breadCrumbData:he,showAdd:!0===B,excelExport:(0,j.jsx)(P.Z,{style:{marginRight:15,display:"flex",alignItems:"center"},onClick:function(){return de(!0)},icon:(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",className:"mr-1",children:(0,j.jsx)("path",{fill:"#42526E",d:"M16.19 2H7.81C4.17 2 2 4.17 2 7.81v8.37C2 19.83 4.17 22 7.81 22h8.37c3.64 0 5.81-2.17 5.81-5.81V7.81C22 4.17 19.83 2 16.19 2zm1.06 10.33c0 .41-.34.75-.75.75s-.75-.34-.75-.75V9.31l-7.72 7.72c-.15.15-.34.22-.53.22s-.38-.07-.53-.22a.754.754 0 010-1.06l7.72-7.72h-3.02c-.41 0-.75-.34-.75-.75s.34-.75.75-.75h4.83c.41 0 .75.34.75.75v4.83z"})}),children:"Export to Excel"}),filters:(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{children:(0,j.jsx)(c.Z,{allowClear:!0,placeholder:"Search for the employee",className:"selectAntdCustom",disabled:!J,onChange:function(e){var t=(0,a.Z)((0,a.Z)({},pe),{},{userId:e});ye(t),e?(localStorage.setItem("attendanceUser",String(e)),je(t)):(localStorage.removeItem("attendanceUser"),ke(void 0))},value:pe.userId?pe.userId:void 0,showSearch:!0,onSearch:function(e){return Ne(e)},optionFilterProp:"label",options:null===Me||void 0===Me?void 0:Me.map((function(e){return{label:e.firstName+" "+e.lastName,value:e.id}})),notFoundContent:(0,j.jsx)(u.Z,{image:"https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg",imageStyle:{height:100},description:(0,j.jsx)("span",{children:"No data found, Please search for the employee"})})})}),(0,j.jsx)("div",{children:(0,j.jsx)("label",{children:(0,j.jsx)(ce,{onChange:function(e){var t=null===e||void 0===e?void 0:e.month(),n=pe.year?pe.year:b()(new Date).year(),o=(0,a.Z)((0,a.Z)({},pe),{},{month:t,year:n});ye(o),je(o),t?d.set("month",t.toString()):0===t&&d.set("month","0"),d.set("year",n.toString()),l(d)},className:O,suffixIcon:(0,j.jsx)(E.Z,{}),clearIcon:!1,format:"MMMM",placeholder:"Month",value:void 0!==pe.month&&null!==pe.month?b()(new Date).month(pe.month):void 0})})}),(0,j.jsx)("div",{children:(0,j.jsx)("label",{children:(0,j.jsx)(ue,{onChange:function(e){var t=null===e||void 0===e?void 0:e.year(),n=(0,a.Z)((0,a.Z)({},pe),{},{year:t});ye(n),je(n),t&&d.set("year",t.toString()),l(d)},placeholder:"Year",className:L,suffixIcon:(0,j.jsx)(E.Z,{}),clearIcon:!1,value:pe.year?b()(new Date).year(pe.year):void 0,disabledDate:function(e){return e>b()(new Date)}})})}),(0,j.jsx)("div",{className:_,style:{overflow:"auto"},children:(0,j.jsx)(C.Z,{options:[{label:"Table",value:"table",icon:(0,j.jsx)(F.Z,{})},{label:"Calendar",value:"calendar",icon:(0,j.jsx)(T.Z,{})}],onChange:function(e){X(e),function(e){localStorage.setItem("attendanceViewAs",e)}(e)},value:G})})]})}),!0===q&&"table"===G&&(0,j.jsx)(I.Z,{tableData:be||{},tableLoading:we,onEditIconClick:Se,reloadTableData:function(){return je(pe)},emptyText:(0,j.jsx)(h.I$,{description:pe.userId?"No records found":"Please select an employee to get started"})}),!0===q&&"calendar"===G&&(pe.month||0===pe.month)&&pe.year&&(be?(0,j.jsx)(U,{onCellClick:Se,data:be,month:pe.month,year:pe.year}):(0,j.jsx)(u.Z,{description:"Please select an employee to get started"})),!1===q&&(0,j.jsx)(D.a$,{mainMessage:"You don't have permission to view this data"}),ne.openModal&&(0,j.jsx)(w,{record:ne.recordId,type:ne.editType,reloadTableData:function(){return je(pe)},onCancel:Ie,openModal:ne.openModal,permissions:H,employeeId:pe.userId,date:g||null}),ie&&(0,j.jsx)(se,{isModalOpen:ie,setIsModalOpen:de})]})}},82183:function(e,t,n){n.d(t,{Z:function(){return f}});var o=n(41586),a=n(3109),r=n(3113),i=n(85554),d=n(98505),l=n(3798),s=n(37936),c=n(70816),u=n.n(c),h=n(46417);function f(e){var t,n,c=e.tableData,f=e.tableLoading,m=e.onEditIconClick,v=(e.reloadTableData,e.emptyText),g=(0,i.v9)((function(e){return e.usersReducer})).userPermissions,p=[];null===(t=c.workingHour)||void 0===t||null===(n=t.hours)||void 0===n||n.forEach((function(e){e.closed&&p.push(e.day)}));var y=[{title:"S.No",dataIndex:"index",key:"index",render:function(e,t,n){return n+1},width:"7.5%"},{title:"Date",dataIndex:"day",key:"day",render:function(e,t){var n,o;return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{className:"d-flex",children:[(0,h.jsx)(a.Z,{className:"cursor-pointer",color:m?"primary-main":"dark-main",size:"sm",weight:"bold",onClick:function(){m&&m(t.recordId?"edit":"new",e,t.recordId)},children:(0,d.Ny)(e,"dd M,yy")}),(0,h.jsx)("small",{className:"pl-2 color-dark-sub",children:"\n\t\t\t\t\t".concat(t.checkIn?"["+u()(t.checkIn).format("hh:mm A"):"","\n\t\t\t\t\t").concat(t.checkOut?" - "+u()(t.checkOut).format("hh:mm A")+"]":"","\n\t\t\t\t\t")})]}),t.ModifiedBy&&(0,h.jsxs)("small",{style:{color:"var(--color-dark-sub)",fontSize:"0.6rem"},children:[(0,h.jsx)("span",{children:"Modified on "}),(0,h.jsxs)("span",{children:[" ",t.modifiedDate&&(0,d.Ny)(t.modifiedDate,"dd M,yy")]}),(0,h.jsx)("span",{children:" by "}),(0,h.jsx)("span",{className:"inline-block",children:(null===(n=t.ModifiedBy)||void 0===n?void 0:n.firstName)+" "+(null===(o=t.ModifiedBy)||void 0===o?void 0:o.lastName)+" "})]}),(0,h.jsx)("div",{})]})},width:"250px"},{title:"Day",dataIndex:"day",key:"day",render:function(e){return(0,h.jsx)(a.Z,{color:"dark-main",size:"sm",weight:"bold",children:d.c1[new Date(e).getDay()]})}},{title:"Hours worked",dataIndex:"hoursWorked",key:"hoursWorked",render:function(e){return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(a.Z,{color:"dark-main",size:"sm",weight:"bold",children:e?e+" hours":"N/A"})})}},{title:"Status",dataIndex:"status",key:"status",render:function(e,t){return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(a.Z,{style:{color:s.vo[e-1]},size:"sm",weight:"bold",children:(0,l.H8)(new Date,t.day)?"-":(0,l.kC)(s.H8[e])})})}},{title:"Pro Rated Deduction",dataIndex:"proRatedDeduction",key:"proRatedDeduction",render:function(e){return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(a.Z,{color:"dark-main",size:"sm",weight:"bold",children:e})})}},{title:"Note",dataIndex:"note",key:"note",render:function(e){return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(a.Z,{color:"dark-main",size:"xs",weight:"normal",children:e})})},width:"200px"},g.updateAttendance?{title:"Actions",dataIndex:"actions",key:"actions",render:function(e,t){return g.updateAttendance&&!(0,l.H8)(new Date,t.day)&&(0,h.jsx)("div",{className:r.Z.actions,children:(0,h.jsx)("span",{onClick:function(){m&&m(t.recordId?"edit":"new",t.day,t.recordId)},children:(0,h.jsx)("img",{src:"/images/editicon.svg",alt:""})})})},width:"100px"}:{}];return(0,h.jsx)("div",{style:{maxHeight:"calc(100vh - 80px)",clear:"both",maxWidth:"100%",overflow:"auto"},children:(0,h.jsx)(o.Z,{sticky:!0,dataSource:null===c||void 0===c?void 0:c.attendanceData,columns:y,scroll:{x:991},pagination:!1,loading:f,rowKey:function(e){return"Attendance-type-".concat(e.day)},locale:{emptyText:v}})})}},51812:function(e,t,n){n.d(t,{s:function(){return i}});var o=n(43144),a=n(15671),r=n(49075),i=(0,o.Z)((function e(){var t=this;(0,a.Z)(this,e),this.endPoint="attendance",this.getAllRecords=function(e){return r.Z.get(t.endPoint,{params:e})},this.getRecordById=function(e){return r.Z.get("".concat(t.endPoint,"/").concat(e))},this.getUserAttendance=function(e){return r.Z.get(t.endPoint+"/getUserAttendance",{params:e})},this.findUserAttendanceForPayroll=function(e){return r.Z.get(t.endPoint+"/findUserAttendanceForPayroll",{params:e})},this.findPublished=function(e){return r.Z.get("".concat(t.endPoint,"/published"),{params:e})},this.deleteRecord=function(e){return r.Z.delete("".concat(t.endPoint,"/").concat(e))},this.createRecord=function(e){return r.Z.post(t.endPoint,e)},this.updateRecord=function(e,n){return r.Z.patch("".concat(t.endPoint,"/").concat(n),e)},this.generateReport=function(e){return r.Z.post("".concat(t.endPoint,"/generateReport"),e,{responseType:"blob"})}}))},38859:function(e,t,n){n.d(t,{o:function(){return i}});var o=n(43144),a=n(15671),r=n(49075),i=(0,o.Z)((function e(){var t=this;(0,a.Z)(this,e),this.endPoint="department",this.getAllRecords=function(e){return r.Z.get(t.endPoint,{params:e})},this.getAllPublishedRecords=function(e){return r.Z.get(t.endPoint+"/find-published",{params:e})},this.getRecordById=function(e){return r.Z.get(t.endPoint+"/"+e)},this.deleteRecord=function(e){return r.Z.delete(t.endPoint+"/"+e)},this.createRecord=function(e){return r.Z.post(t.endPoint,e)},this.updateRecord=function(e,n){return r.Z.patch(t.endPoint+"/"+n,e)}}))},5190:function(e,t,n){n.d(t,{L:function(){return d}});var o=n(43144),a=n(15671),r=n(49075),i=n(3135),d=(0,o.Z)((function e(){var t=this;(0,a.Z)(this,e),this.endPoint="organization",this.getAllRecords=function(e){return r.Z.get(t.endPoint,{params:e})},this.findPublished=function(e){return r.Z.get(t.endPoint+"/find-published",{params:e})},this.getRecordById=function(e){return r.Z.get("".concat(t.endPoint,"/").concat(e))},this.deleteRecord=function(e){return r.Z.delete("".concat(t.endPoint,"/").concat(e))},this.createRecord=function(e){return r.Z.post(t.endPoint,e,{headers:i.C})},this.updateRecord=function(e,n){return r.Z.patch("".concat(t.endPoint,"/").concat(n),e,{headers:i.C})},this.getTenants=function(){return r.Z.get("xero/getTenants")}}))},70584:function(e,t,n){n.d(t,{HH:function(){return d},JY:function(){return i},Ug:function(){return l},hx:function(){return r},vA:function(){return c},xy:function(){return s}});var o=n(29439),a=n(37936),r=function(e){return Object.entries(e).filter((function(e){var t=(0,o.Z)(e,1)[0];return isNaN(Number(t))})).map((function(e){var t=(0,o.Z)(e,2);return{label:t[0],value:t[1]}}))},i=r(a.dq),d=r(a.B1),l=r(a.LN),s=r(a.PH),c=r(a.fk)}}]);