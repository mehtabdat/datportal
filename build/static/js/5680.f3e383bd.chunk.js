"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[5680],{25680:function(e,t,n){n.r(t),n.d(t,{default:function(){return L}});var o=n(1413),a=n(29439),r=n(47313),i=n(7532),d=n(25019),l=n(55291),s=n(82626),u=n(17327),c=n(49355),m=n(46646),p=n(40169),f=n(35997),v=n(46417),Z=function(e){var t,n,i=e.openModal,Z=e.onCancel,g=e.type,h=e.record,x=e.reloadTableData,k=e.permissions,b=k.createBulkUploadFormat,j=k.updateBulkUploadFormat,P=d.Z.useForm(),y=(0,a.Z)(P,1)[0],C=(0,r.useMemo)((function(){return new f.U}),[]),S=(0,r.useState)(),F=(0,a.Z)(S,2),w=F[0],T=F[1],I=function(e){var t=(0,p.P)(e);if("string"==typeof t.message)T((0,o.Z)((0,o.Z)({},w),{},{error:t.message}));else{var n=(0,m.O)(t.message,[]);y.setFields(n),T((0,o.Z)((0,o.Z)({},w),{},{error:""}))}},N=(0,r.useCallback)((function(){T({loading:!0}),C.getRecordById(h).then((function(e){var t,n=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.data;e.data&&n&&(y.setFieldsValue((0,o.Z)((0,o.Z)({},n),{},{format:JSON.stringify(null===n||void 0===n?void 0:n.format),sample:JSON.stringify(null===n||void 0===n?void 0:n.sample)})),T((0,o.Z)((0,o.Z)({},e.data),{},{loading:!1})))})).catch((function(e){I(e)}))}),[y,h,C]);return(0,r.useEffect)((function(){"edit"===g?N():y.resetFields()}),[g,y,N]),(0,v.jsx)(s.P0,{visible:i,closable:!0,onCancel:Z,titleText:"edit"===g?"Edit Bulk Upload Format ":"Add New Bulk Upload Format",showFooter:!1,children:null!==w&&void 0!==w&&w.loading?(0,v.jsx)(c.Z,{items:10}):(0,v.jsxs)(d.Z,{className:u.Z.form,onFinish:function(e){switch(T((0,o.Z)((0,o.Z)({},w),{},{buttonLoading:!0})),g){case"edit":var t;if(!0===j)C.updateRecord(e,null===w||void 0===w||null===(t=w.data)||void 0===t?void 0:t.id).then((function(e){x(),Z(),T((function(e){return(0,o.Z)((0,o.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){I(e),T((function(e){return(0,o.Z)((0,o.Z)({},e),{},{buttonLoading:!1})}))}));else T((function(e){return(0,o.Z)((0,o.Z)({},e),{},{buttonLoading:!1})})),l.ZP.error("You don't have permission to update bulk upload format");break;case"new":!0===b?C.createRecord(e).then((function(e){x(),Z(),T((function(e){return(0,o.Z)((0,o.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){I(e),T((function(e){return(0,o.Z)((0,o.Z)({},e),{},{buttonLoading:!1})}))})):(T((function(e){return(0,o.Z)((0,o.Z)({},e),{},{buttonLoading:!1})})),l.ZP.error("You don't have permission to create bulk upload format"))}},form:y,children:[(null===w||void 0===w?void 0:w.error)&&(0,v.jsx)(s.EQ,{description:null===w||void 0===w?void 0:w.error,isClosable:!0,onClose:function(){T((0,o.Z)((0,o.Z)({},w),{},{error:""}))}}),(0,v.jsx)("div",{children:(0,v.jsx)(d.Z.Item,{name:"title",rules:[{required:!0,message:"Please add a title"}],children:(0,v.jsx)(s.t7,{size:"w100",label:"Title",asterisk:!0,type:"text"})})}),(0,v.jsx)("div",{children:(0,v.jsx)(d.Z.Item,{name:"comment",rules:[{required:!1,message:"Please add a comment"}],children:(0,v.jsx)(s.t7,{size:"w100",label:"Comment",type:"text"})})}),(0,v.jsx)("div",{children:(0,v.jsx)(d.Z.Item,{name:"format",rules:[{validator:function(e,t){if(t)try{return JSON.parse(t),Promise.resolve()}catch(n){return Promise.reject("Please enter a valid JSON")}return e.required=!0,e.message="Please add a format",Promise.reject(e.message)}}],children:(0,v.jsx)(s.t7,{size:"w100",label:"Format",asterisk:!0,type:"textArea",defaultValue:JSON.stringify(null===w||void 0===w||null===(t=w.data)||void 0===t?void 0:t.format,null,2)})})}),(0,v.jsx)("div",{children:(0,v.jsx)(d.Z.Item,{name:"sample",rules:[{validator:function(e,t){if(t)try{return JSON.parse(t),Promise.resolve()}catch(n){return Promise.reject("Please enter a valid JSON")}return e.required=!0,e.message="Please add a sample",Promise.reject(e.message)}}],children:(0,v.jsx)(s.t7,{size:"w100",label:"Sample",asterisk:!0,type:"textArea",defaultValue:JSON.stringify(null===w||void 0===w||null===(n=w.data)||void 0===n?void 0:n.sample,null,2)})})}),(0,v.jsxs)("div",{className:u.Z.footer,children:[(0,v.jsx)(s.op,{size:"normal",fontSize:"sm",onClick:Z,type:"plain",children:"Cancel"}),(0,v.jsx)(s.op,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:null===w||void 0===w?void 0:w.buttonLoading,children:"Submit"})]})]})})},g=n(86136),h=n(5900),x=n(41586),k=n(98676),b=n(3109),j=n(98505),P=n(85554),y=g.Z.TextArea,C=function(e){var t=e.record,n=e.onEditIconClick,i=e.reloadTableData,d=e.permissions.deleteBulkUploadFormat,s=(0,r.useState)({confirmLoading:!1,openPopConfirm:!1}),c=(0,a.Z)(s,2),m=c[0],p=c[1],Z=(0,r.useMemo)((function(){return new f.U}),[]);return(0,v.jsxs)("div",{className:u.Z.actions,children:[(0,v.jsx)("span",{onClick:function(){return n(t)},children:(0,v.jsx)("img",{src:"/images/editicon.svg",alt:""})}),(0,v.jsx)(h.Z,{open:m.openPopConfirm,placement:"top",title:"Are you sure?",onConfirm:function(){if(p((0,o.Z)((0,o.Z)({},m),{},{confirmLoading:!0})),!1===d)return l.ZP.error("You don't have permission to delete this record, please contact your admin."),void p((0,o.Z)((0,o.Z)({},m),{},{openPopConfirm:!1}));Z.deleteRecord(t.id).then((function(e){p((0,o.Z)((0,o.Z)({},m),{},{openPopConfirm:!1,confirmLoading:!1})),i()})).catch((function(e){p((0,o.Z)((0,o.Z)({},m),{},{confirmLoading:!1}))}))},onCancel:function(){return p((0,o.Z)((0,o.Z)({},m),{},{openPopConfirm:!1}))},okButtonProps:{loading:m.confirmLoading},okText:"Yes",cancelText:"No",onOpenChange:function(e){e||p((0,o.Z)((0,o.Z)({},m),{},{openPopConfirm:!1}))},children:(0,v.jsx)(k.Z,{className:u.Z.bg__red,onClick:function(){p((0,o.Z)((0,o.Z)({},m),{},{openPopConfirm:!0}))}})})]})};function S(e){var t=e.tableData,n=e.tableLoading,o=e.onEditIconClick,a=e.reloadTableData,r=(0,P.v9)((function(e){return e.usersReducer})).userPermissions,i=[{title:"S.No",dataIndex:"index",key:"index",render:function(e,t,n){return n+1},width:"5%"},{title:"Title",dataIndex:"title",key:"title",render:function(e,t){return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(b.Z,{color:"dark-sub",size:"sm",children:e}),(0,v.jsx)(b.Z,{color:"dark-sub",size:"xs",children:"ID: ".concat(t.id)})]})}},{title:"Comments",dataIndex:"comment",key:"comment",render:function(e){return(0,v.jsx)(b.Z,{color:"dark-sub",size:"sm",children:e})}},{title:"Format",dataIndex:"format",key:"format",render:function(e,t){return(0,v.jsx)(y,{rows:4,value:JSON.stringify(t.format,null,2)})}},{title:"Sample",dataIndex:"sample",key:"sample",render:function(e,t){return(0,v.jsx)(y,{rows:4,value:JSON.stringify(t.sample,null,2)})}},{title:"Date Added",dataIndex:"addedDate",key:"addedDate",render:function(e){return(0,v.jsx)(b.Z,{color:"dark-sub",size:"sm",children:(0,j.Ny)(e,"dd M,yy")})}},{title:"Actions",dataIndex:"actions",key:"actions",render:function(e,t){return(0,v.jsx)(C,{record:t,onEditIconClick:o,reloadTableData:a,permissions:r})}}];return(0,v.jsx)("div",{className:u.Z.antdTableWrapper,children:(0,v.jsx)(x.Z,{sticky:!0,dataSource:t,columns:i,pagination:!1,scroll:{x:991},loading:n,rowKey:function(e){return"site-prop-bulk-upload-".concat(e.id)}})})}var F=n(42623),w=function(e){return e.CREATE="createBulkUploadFormat",e.UPDATE="updateBulkUploadFormat",e.DELETE="deleteBulkUploadFormat",e.READ="readBulkUploadFormat",e}({}),T=n(18515),I=n(3798),N=[{text:"Home",isLink:!0,path:"/"},{isLink:!0,text:"Site Settings",path:"/siteSettings"},{isLink:!1,text:"Bulk Upload Format"}];var L=function(){var e,t,n,d,u=(0,I.aY)(w),c=(0,P.v9)((function(e){return e.usersReducer})).userPermissions,m=c.readBulkUploadFormat,p=c.createBulkUploadFormat,g=c.updateBulkUploadFormat,h=(0,r.useState)({editType:"new",recordId:0,openModal:!1}),x=(0,a.Z)(h,2),k=x[0],b=x[1],j=(0,r.useMemo)((function(){return new f.U}),[]),y=(0,r.useState)(""),C=(0,a.Z)(y,2),L=C[0],U=(C[1],(0,F.N)(L,500)),B=(0,r.useState)({isLoading:!1,error:{},data:[]}),D=(0,a.Z)(B,2),R=D[0],A=D[1],E=function(){!1!==p?b((0,o.Z)((0,o.Z)({},k),{},{openModal:!k.openModal,editType:"new"})):l.ZP.error("You don't have permission to create new record")},z=(0,r.useCallback)((function(e){A((0,o.Z)((0,o.Z)({},R),{},{loading:!0})),j.getAllRecords(e).then((function(e){A(e.data)})).catch((function(e){var t,n;l.ZP.error(null===(t=e.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)}))}),[R,j]);(0,r.useEffect)((function(){U?z({name:U}):z()}),[U]);var M=(0,r.useCallback)((function(e,t){A((0,o.Z)((0,o.Z)({},R),{},{loading:!0}));var n={page:e,perPage:t,name:U||void 0};j.getAllRecords(n).then((function(e){A((0,o.Z)((0,o.Z)({},e.data),{},{loading:!1}))})).catch((function(e){A((0,o.Z)((0,o.Z)({},R),{},{loading:!1}))}))}),[R,j]);return(0,v.jsxs)(i.default,{permissionSlug:u,children:[(0,v.jsx)(s.mr,{heading:"Bulk Upload Format",buttonText:"New Upload Format",onButtonClick:E,breadCrumbData:N,showAdd:!0===p}),!0===m&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(S,{tableData:null===R||void 0===R?void 0:R.data,tableLoading:R.loading,onEditIconClick:function(e){!1!==g?b((0,o.Z)((0,o.Z)({},k),{},{editType:"edit",recordId:e.id,openModal:!0})):l.ZP.error("You don't have permission to update this record")},reloadTableData:z}),(0,v.jsx)(s.tl,{total:null===R||void 0===R||null===(e=R.meta)||void 0===e?void 0:e.total,current:null===R||void 0===R||null===(t=R.meta)||void 0===t?void 0:t.page,defaultPageSize:null!==R&&void 0!==R&&null!==(n=R.meta)&&void 0!==n&&n.perPage?null===R||void 0===R||null===(d=R.meta)||void 0===d?void 0:d.perPage:10,pageSizeOptions:[10,20,50,100],onChange:M})]}),!1===m&&(0,v.jsx)(T.a$,{mainMessage:"You don't have permission to view this data"}),k.openModal&&(0,v.jsx)(Z,{record:k.recordId,type:k.editType,reloadTableData:function(){var e,t;return z({page:null===R||void 0===R||null===(e=R.meta)||void 0===e?void 0:e.page,perPage:null===R||void 0===R||null===(t=R.meta)||void 0===t?void 0:t.perPage})},onCancel:E,openModal:k.openModal,permissions:c})]})}},35997:function(e,t,n){n.d(t,{U:function(){return i}});var o=n(43144),a=n(15671),r=n(49075),i=(0,o.Z)((function e(){var t=this;(0,a.Z)(this,e),this.endPoint="bulk-upload-format",this.getAllRecords=function(e){return r.Z.get(t.endPoint,{params:e})},this.getAllPublishedRecords=function(e){return r.Z.get(t.endPoint+"/find-published",{params:e})},this.getRecordById=function(e){return r.Z.get("".concat(t.endPoint,"/").concat(e))},this.deleteRecord=function(e){return r.Z.delete("".concat(t.endPoint,"/").concat(e))},this.createRecord=function(e){return r.Z.post(t.endPoint+"/",e)},this.updateRecord=function(e,n){return r.Z.patch("".concat(t.endPoint,"/").concat(n),e)}}))}}]);