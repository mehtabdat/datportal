"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[8120],{70815:function(e,n,t){t.d(n,{r:function(){return f}});var i=t(1413),o=t(29439),a=t(45987),r=t(55291),d=t(86345),s=t(47313),c=t(40169),l=t(46417),u=["onChange","checked","recordId","allowChange"],f=function(e){var n=e.onChange,t=e.checked,f=e.recordId,m=e.allowChange,h=void 0===m||m,p=(0,a.Z)(e,u),Z=(0,s.useState)({loading:!1,checked:!1}),g=(0,o.Z)(Z,2),v=g[0],x=g[1];return(0,s.useEffect)((function(){x((0,i.Z)((0,i.Z)({},v),{},{checked:t}))}),[t]),(0,l.jsx)(d.Z,{checked:v.checked,onChange:function(e){!0===h?(x((0,i.Z)((0,i.Z)({},v),{},{loading:!0})),n(e,f,p).then((function(n){x((0,i.Z)((0,i.Z)({},v),{},{checked:e,loading:!1})),r.ZP.success(n.data.message)})).catch((function(e){x((0,i.Z)((0,i.Z)({},v),{},{loading:!1}));var n=(0,c.P)(e);"string"===typeof n.message?r.ZP.error(n.message):r.ZP.error("Something went wrong")}))):r.ZP.error("You don't have permission to change this record, please contact your admin.")},loading:v.loading})}},8120:function(e,n,t){t.r(n),t.d(n,{default:function(){return M}});var i=t(1413),o=t(29439),a=t(47313),r=t(7532),d=t(25019),s=t(55291),c=t(82626),l=t(17327),u=t(49355),f=t(48897),m=t(3798),h=t(46646),p=t(40169),Z=t(43144),g=t(15671),v=t(49075),x=t(3135),b=(0,Z.Z)((function e(){var n=this;(0,g.Z)(this,e),this.endPoint="amenity",this.getAllRecords=function(){return v.Z.get(n.endPoint)},this.getRecordById=function(e){return v.Z.get("".concat(n.endPoint,"/").concat(e,"?all=true"))},this.deleteRecord=function(e){return v.Z.delete("".concat(n.endPoint,"/").concat(e))},this.createRecord=function(e){return v.Z.post(n.endPoint+"/",e,{headers:x.C})},this.updateRecord=function(e,t){return v.Z.patch("".concat(n.endPoint,"/").concat(t),e,{headers:x.C})}})),j=t(46417),y=function(e){var n,t,r,Z,g,v=e.openModal,x=e.onCancel,y=e.type,C=e.record,k=e.reloadTableData,P=e.permissions,w=P.updateAmenity,A=P.createAmenity,I=d.Z.useForm(),L=(0,o.Z)(I,1)[0],T=(0,a.useMemo)((function(){return new b}),[]),E=(0,a.useState)({loading:!1}),S=(0,o.Z)(E,2),z=S[0],N=S[1],R=function(e){var n=(0,p.P)(e);if("string"==typeof n.message)N((0,i.Z)((0,i.Z)({},z),{},{error:n.message}));else{var t=(0,h.O)(n.message,[]);L.setFields(t),N((0,i.Z)((0,i.Z)({},z),{},{error:""}))}},D=(0,a.useCallback)((function(){T.getRecordById(C).then((function(e){e.data&&e.data.data&&(L.setFieldsValue((0,i.Z)((0,i.Z)({translations:e.data.data.localization},e.data.data),{},{isPublished:e.data.data.isPublished})),N((0,i.Z)((0,i.Z)({},e.data),{},{loading:!1})))})).catch((function(e){R(e)}))}),[L,C,T]);(0,a.useEffect)((function(){"edit"===y?(N({loading:!0}),D()):L.resetFields()}),[v,y,L,D]);return(0,j.jsx)(c.P0,{visible:v,closable:!0,onCancel:x,titleText:"edit"===y?"Edit Amenity":"Add New Amenity",showFooter:!1,children:null!==z&&void 0!==z&&z.loading?(0,j.jsx)(u.Z,{items:10}):(0,j.jsxs)(d.Z,{className:l.Z.form,onFinish:function(e){N((0,i.Z)((0,i.Z)({},z),{},{buttonLoading:!0}));var n=new FormData,t=["icon","translations"];switch(Object.entries(e).forEach((function(e){t.includes(e[0])||n.append(e[0],e[1])})),e.icon&&"string"!==typeof e.icon&&e.icon.fileList.length>0&&n.append("icon",e.icon.fileList[0].originFileObj),e.translations&&e.translations.forEach((function(e,t){n.append("translations[".concat(t+1,"][language]"),e.language),n.append("translations[".concat(t+1,"][title]"),e.title)})),y){case"edit":!0===w?T.updateRecord(n,null===z||void 0===z?void 0:z.data.id).then((function(e){k(),x(),N((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){R(e),N((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})}))})):(N((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})})),s.ZP.error("You don't have permission to update this record"));break;case"new":!0===A?T.createRecord(n).then((function(e){k(),x(),N((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){R(e),N((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})}))})):(N((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})})),s.ZP.error("You don't have permission to create a new record"))}},form:L,children:[(null===z||void 0===z?void 0:z.error)&&(0,j.jsx)(c.EQ,{description:null===z||void 0===z?void 0:z.error,isClosable:!0,onClose:function(){N((0,i.Z)((0,i.Z)({},z),{},{error:""}))}}),(0,j.jsx)("div",{children:(0,j.jsx)(d.Z.Item,{name:"slug",rules:[{required:!0,message:"Please add a slug"}],children:(0,j.jsx)(c.t7,{onChange:function(e){var n=e.target,t=(0,m.V3)(n.value);L.setFieldsValue({slug:t})},size:"w100",label:"Slug",asterisk:!0,type:"text"})})}),(0,j.jsx)(c.WH,{title:"Title & Description",formName:"translations",defaultValue:null===z||void 0===z||null===(n=z.data)||void 0===n?void 0:n.localization}),(0,j.jsxs)("div",{children:[(0,j.jsx)(d.Z.Item,{name:"isPublished",children:(0,j.jsx)(c.AP,{label:"Published",options:[{value:!0,label:"Yes"},{value:!1,label:"No"}]})}),(0,j.jsx)(d.Z.Item,{name:"abbreviation",children:(0,j.jsx)(c.t7,{size:"w100",label:"Abbreviation",type:"text",placeHolder:"Enter abbreviation"})})]}),(0,j.jsx)("div",{children:(0,j.jsx)(d.Z.Item,{name:"acronyms",children:(0,j.jsx)(c.t7,{size:"w100",label:"Acronyms",type:"text",placeHolder:"Enter acronyms"})})}),(0,j.jsx)("div",{children:(0,j.jsx)(c.wA,{name:"icon",defaultFileList:"edit"===y&&z&&(null===(t=z.data)||void 0===t?void 0:t.icon)&&[{uid:null===(r=z.data)||void 0===r?void 0:r.id,name:null===(Z=z.data)||void 0===Z?void 0:Z.icon,status:"done",url:f.lj+(null===(g=z.data)||void 0===g?void 0:g.icon)}]})}),(0,j.jsxs)("div",{className:l.Z.footer,children:[(0,j.jsx)(c.op,{size:"normal",fontSize:"sm",onClick:x,type:"plain",children:"Cancel"}),(0,j.jsx)(c.op,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:null===z||void 0===z?void 0:z.buttonLoading,children:"Submit"})]})]})})},C=t(74165),k=t(15861),P=t(5900),w=t(21680),A=t(41586),I=t(98676),L=t(3109),T=t(70815),E=t(85554),S=function(e){var n=e.record,t=e.onEditIconClick,r=e.reloadTableData,d=e.permissions.deleteAmenity,c=(0,a.useState)({confirmLoading:!1,openPopConfirm:!1}),u=(0,o.Z)(c,2),f=u[0],m=u[1],h=(0,a.useMemo)((function(){return new b}),[]);return(0,j.jsxs)("div",{className:l.Z.actions,children:[(0,j.jsx)("span",{onClick:function(){return t(n)},children:(0,j.jsx)("img",{src:"/images/editicon.svg",alt:""})}),(0,j.jsx)(P.Z,{open:f.openPopConfirm,placement:"top",title:"Are you sure?",onConfirm:function(){if(m((0,i.Z)((0,i.Z)({},f),{},{confirmLoading:!0})),!1===d)return s.ZP.error("You don't have permission to delete this record, please contact your admin."),void m((0,i.Z)((0,i.Z)({},f),{},{openPopConfirm:!1}));h.deleteRecord(n.id).then((function(e){m((0,i.Z)((0,i.Z)({},f),{},{openPopConfirm:!1,confirmLoading:!1})),r()})).catch((function(e){m((0,i.Z)((0,i.Z)({},f),{},{confirmLoading:!1}))}))},onCancel:function(){return m((0,i.Z)((0,i.Z)({},f),{},{openPopConfirm:!1}))},okButtonProps:{loading:f.confirmLoading},okText:"Yes",cancelText:"No",onOpenChange:function(e){e||m((0,i.Z)((0,i.Z)({},f),{},{openPopConfirm:!1}))},children:(0,j.jsx)(I.Z,{className:l.Z.bg__red,onClick:function(){m((0,i.Z)((0,i.Z)({},f),{},{openPopConfirm:!0}))}})})]})};function z(e){var n=(0,E.v9)((function(e){return e.usersReducer})).userPermissions,t=e.tableData,i=e.tableLoading,o=e.onEditIconClick,a=e.reloadTableData,r=new b,d=function(){var e=(0,k.Z)((0,C.Z)().mark((function e(n,t){return(0,C.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.updateRecord({isPublished:n},t));case 1:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),s=[{title:"S.No",dataIndex:"index",key:"index",render:function(e,n,t){return t+1},width:"5%"},{title:"Title",dataIndex:"description",key:"description",render:function(e,n){return(0,j.jsx)(j.Fragment,{children:n.localization.map((function(e,n){return(0,j.jsxs)("div",{children:[(0,j.jsx)(L.Z,{color:"dark-main",size:"sm",children:e.title}),(0,j.jsx)("p",{className:"color-light-800 font-size-sm",children:e.language})]},n)}))})}},{title:"Slug",dataIndex:"slug",key:"slug",render:function(e,n){return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(L.Z,{color:"dark-main",size:"sm",children:n.slug})})}},{title:"Published",dataIndex:"isPublished",key:"isPublished",render:function(e,t){return(0,j.jsx)(T.r,{checked:e,onChange:function(){return d(e,t.id)},recordId:t.id,allowChange:n.updateAmenity})}},{title:"Icon",dataIndex:"icon",key:"icon",render:function(e){return e?(0,j.jsx)(w.Z,{width:20,height:20,src:"".concat(f.lj).concat(e),preview:!1,rootClassName:"object-fit-contain"}):(0,j.jsx)(j.Fragment,{})}},{title:"Abreviation",dataIndex:"abbreviation",key:"abbreviation",render:function(e){return(0,j.jsx)(L.Z,{color:"dark-main",size:"sm",children:e})}},{title:"Acronyms",dataIndex:"acronyms",key:"acronyms",render:function(e){return(0,j.jsx)(L.Z,{color:"dark-main",size:"sm",children:e})}},{title:"Actions",dataIndex:"actions",key:"actions",render:function(e,t){return(0,j.jsx)(S,{record:t,onEditIconClick:o,reloadTableData:a,permissions:n})}}];return(0,j.jsx)("div",{className:l.Z.antdTableWrapper,children:(0,j.jsx)(A.Z,{sticky:!0,dataSource:t,columns:s,pagination:!1,scroll:{x:991},loading:i,rowKey:function(e){return"site-amenity-".concat(e.id)}})})}var N=t(42623),R=function(e){return e.CREATE="createAmenity",e.UPDATE="updateAmenity",e.DELETE="deleteAmenity",e.READ="readAmenity",e}({}),D=t(18515),F=[{text:"Home",isLink:!0,path:"/"},{isLink:!0,text:"Site Settings",path:"/siteSettings"},{isLink:!1,text:"Amenities"}];var M=function(){var e=(0,m.aY)(R),n=(0,E.v9)((function(e){return e.usersReducer})).userPermissions,t=n.readAmenity,d=n.createAmenity,l=n.updateAmenity,u=(0,a.useState)({editType:"new",recordId:0,openModal:!1}),f=(0,o.Z)(u,2),h=f[0],p=f[1],Z=new b,g=(0,a.useState)({isLoading:!1,error:{},data:[]}),v=(0,o.Z)(g,2),x=v[0],C=v[1],k=(0,a.useState)(""),P=(0,o.Z)(k,2),w=P[0],A=P[1],I=(0,N.N)(w,500),L=(0,a.useState)(),T=(0,o.Z)(L,2),S=T[0],M=T[1],Y=function(){!1!==d?p((0,i.Z)((0,i.Z)({},h),{},{openModal:!h.openModal,editType:"new"})):s.ZP.error("You don't have permission to create new record")},H=function(){C((0,i.Z)((0,i.Z)({},x),{},{loading:!0})),Z.getAllRecords().then((function(e){C(e.data)})).catch((function(e){}))};(0,a.useEffect)((function(){H()}),[]);var B=(0,a.useCallback)((function(){if(I){var e=(null===x||void 0===x?void 0:x.data).filter((function(e){return e.localization[0].title.toLowerCase().includes(I.toLowerCase())}));M(e)}else M(void 0)}),[I,null===x||void 0===x?void 0:x.data]);return(0,a.useEffect)((function(){B()}),[B]),(0,j.jsxs)(r.default,{permissionSlug:e,children:[(0,j.jsx)(c.mr,{heading:"Amenities",buttonText:"Add New Amenity",onButtonClick:Y,breadCrumbData:F,showAdd:!0===d,filters:!0===t?(0,j.jsx)("div",{children:(0,j.jsx)("div",{children:(0,j.jsx)(c.t7,{placeHolder:"Search...",icon:(0,j.jsx)("img",{src:"/images/searchIcon.svg",alt:"Search Icon"}),size:"w100",className:"py-1",value:w,onChange:function(e){var n=e.currentTarget.value;A(n)}})})}):null}),!0===t&&(0,j.jsx)(z,{tableData:S||x.data,tableLoading:x.loading,onEditIconClick:function(e){!1!==l?p((0,i.Z)((0,i.Z)({},h),{},{editType:"edit",recordId:e.id,openModal:!0})):s.ZP.error("You don't have permission to update record")},reloadTableData:H}),!1===t&&(0,j.jsx)(D.a$,{mainMessage:"You don't have permission to view this data"}),h.openModal&&(0,j.jsx)(y,{record:h.recordId,type:h.editType,reloadTableData:H,onCancel:Y,openModal:h.openModal,permissions:n})]})}}}]);