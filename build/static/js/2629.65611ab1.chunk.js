"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[2629],{52629:function(e,n,t){t.r(n),t.d(n,{default:function(){return O}});var i=t(1413),o=t(29439),r=t(47313),a=t(55291),s=t(85554),d=t(93433),l=t(25019),c=t(31513),u=t(98276),m=t(82626),p=t(3113),f=t(49355),h=t(46646),v=t(40169),g=t(42623),Z=t(84825),x=t(1824),b=t(37936),j=t(3798),y=t(38859),P=t(46417),w=function(e){var n,t,s=e.openModal,w=e.onCancel,C=(e.type,e.record,e.reloadTableData),k=e.permissions.createNotification,S=l.Z.useForm(),N=(0,o.Z)(S,1)[0],A=new x.P,I=(0,r.useState)(),z=(0,o.Z)(I,2),R=z[0],D=z[1],F=(0,r.useState)("broadcast"),T=(0,o.Z)(F,2),M=T[0],L=T[1],E=(0,r.useState)(""),O=(0,o.Z)(E,2),V=O[0],q=O[1],H=(0,g.N)(V,500),U=(0,r.useState)([]),Y=(0,o.Z)(U,2),B=Y[0],$=Y[1],Q=(0,r.useMemo)((function(){return new Z.z}),[]),_=(0,r.useCallback)((function(){H&&Q.getAllRecords({name:H}).then((function(e){$((function(n){var t,i,o=null===e||void 0===e||null===(t=e.data)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.filter((function(e){return!(null!==n&&void 0!==n&&n.find((function(n){return n.id===e.id})))}));return[].concat((0,d.Z)(n),(0,d.Z)(o))}))})).catch((function(e){a.ZP.error(e.response.data.message)}))}),[H]);(0,r.useEffect)((function(){_()}),[_]);var G=(0,r.useState)(""),K=(0,o.Z)(G,2),W=K[0],J=K[1],X=(0,g.N)(W,500),ee=(0,r.useState)([]),ne=(0,o.Z)(ee,2),te=ne[0],ie=ne[1],oe=(0,r.useMemo)((function(){return new y.o}),[]),re=(0,r.useCallback)((function(){(X||0===te.length)&&oe.getAllPublishedRecords({name:X}).then((function(e){ie((function(n){var t,i,o=null===e||void 0===e||null===(t=e.data)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.filter((function(e){return!(null!==n&&void 0!==n&&n.find((function(n){return n.id===e.id})))}));return[].concat((0,d.Z)(n),(0,d.Z)(o))}))})).catch((function(e){a.ZP.error(e.response.data.message)}))}),[X]);(0,r.useEffect)((function(){re()}),[re]);(0,r.useEffect)((function(){N.resetFields()}),[]);return(0,P.jsx)(m.P0,{visible:s,closable:!0,onCancel:w,titleText:"Add New Announcement",showFooter:!1,children:null!==R&&void 0!==R&&R.loading?(0,P.jsx)(f.Z,{items:3}):(0,P.jsxs)(l.Z,{className:p.Z.form,onFinish:function(e){console.log("here",e);var n=new FormData,t=["file","type","userIds"];(Object.entries(e).forEach((function(e){t.includes(e[0])||n.append(e[0],e[1])})),e.file&&"string"!==typeof e.file&&e.file.fileList.length>0&&n.append("file",e.file.fileList[0].originFileObj),n.append("type",M),e.userIds)&&N.getFieldValue("userIds")[0].forEach((function(e,t){n.append("userIds["+t+"]",e)}));!0===k?A.createRecord(n).then((function(e){C(),w(),D((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){!function(e){var n=(0,v.P)(e);if("string"==typeof n.message)D((0,i.Z)((0,i.Z)({},R),{},{error:n.message}));else{var t=(0,h.O)(n.message,[]);N.setFields(t),D((0,i.Z)((0,i.Z)({},R),{},{error:""}))}}(e),D((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})}))})):(D((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})})),a.ZP.error("You don't have permission to create this record"))},form:N,children:[(null===R||void 0===R?void 0:R.error)&&(0,P.jsx)(m.EQ,{description:null===R||void 0===R?void 0:R.error,isClosable:!0,onClose:function(){D((0,i.Z)((0,i.Z)({},R),{},{error:""}))}}),(0,P.jsx)("div",{children:(0,P.jsx)(l.Z.Item,{name:"type",children:(0,P.jsx)(m.AP,{asterisk:!0,label:"Announcement Type",options:Object.keys(b.k$).map((function(e){return{label:(0,j.kC)(e),value:e}})),defaultValue:"broadcast",placeholder:"Select Announcement Type",onChange:function(e){return L(e)}})})}),"user"===M&&(0,P.jsx)("div",{children:(0,P.jsxs)(l.Z.Item,{name:"userIds",rules:[{required:!0,message:"Please select an employee"}],children:[(0,P.jsxs)("label",{className:"font-size-sm",children:["Employee  ",(0,P.jsx)("span",{className:"color-red-yp",children:"*"})]}),(0,P.jsx)(c.Z,{mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"Search for the employee",className:"selectAntdCustom",onChange:function(e){return N.setFieldsValue({userIds:[e]})},showSearch:!0,onSearch:function(e){return q(e)},optionFilterProp:"label",options:null===B||void 0===B?void 0:B.map((function(e){return{label:e.firstName+" "+e.lastName,value:e.id}})),notFoundContent:(0,P.jsx)(u.Z,{image:"https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg",imageStyle:{height:100},description:(0,P.jsx)("span",{children:"No data found, Please search for the employee"})})})]})}),"department"===M&&(0,P.jsx)("div",{children:(0,P.jsxs)(l.Z.Item,{name:"departmentId",rules:[{required:!0,message:"Please select a department"}],children:[(0,P.jsxs)("label",{className:"font-size-sm",children:["Department  ",(0,P.jsx)("span",{className:"color-red-yp",children:"*"})]}),(0,P.jsx)(c.Z,{allowClear:!0,style:{width:"100%"},defaultValue:null===R||void 0===R||null===(n=R.data)||void 0===n||null===(t=n.Department)||void 0===t?void 0:t.id,placeholder:"Search for the department",className:"selectAntdCustom",onChange:function(e){return N.setFieldsValue({departmentId:e})},showSearch:!0,onSearch:function(e){return J(e)},optionFilterProp:"label",options:null===te||void 0===te?void 0:te.map((function(e){return{label:e.title,value:e.id}})),notFoundContent:(0,P.jsx)(u.Z,{image:"https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg",imageStyle:{height:100},description:(0,P.jsx)("span",{children:"No data found, Please search for the department"})})})]})}),(0,P.jsx)("div",{children:(0,P.jsx)(l.Z.Item,{name:"message",rules:[{required:!0,message:"Please provide message"}],children:(0,P.jsx)(m.t7,{asterisk:!0,size:"w100",label:"Message",type:"textArea",autoSize:{minRows:2},placeHolder:"Enter message"})})}),(0,P.jsx)("div",{children:(0,P.jsx)(m.wA,{name:"file",required:!1})}),(0,P.jsxs)("div",{className:"d-flex justify-end",children:[(0,P.jsx)(m.op,{size:"normal",fontSize:"sm",onClick:w,type:"plain",children:"Cancel"}),(0,P.jsx)(m.op,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:null===R||void 0===R?void 0:R.buttonLoading,children:"Add Announcement"})]})]})})},C=t(8773),k=t(37388),S=t(41586),N=t(39548),A=t(3109),I=t(98505),z=t(5599),R=t(48897);function D(e){var n=e.tableData,t=e.tableLoading,o=(e.onEditIconClick,e.reloadTableData),r=e.meta,a=e.filters,d=((0,s.v9)((function(e){return e.usersReducer})).userPermissions,new z.r,[{title:"S.No",dataIndex:"index",key:"index",render:function(e,n,t){return t+1},width:"5%"},{title:"Message",dataIndex:"message",key:"message",render:function(e){return(0,P.jsx)(A.Z,{color:"dark-main",size:"sm",weight:"bold",children:e})}},{title:"Added date",dataIndex:"addedDate",key:"addedDate",render:function(e){return(0,P.jsx)(P.Fragment,{children:(0,P.jsx)(A.Z,{color:"dark-main",size:"sm",weight:"bold",children:(0,I.Ny)(e,"dd M,yy")})})}},{title:"Type",dataIndex:"type",key:"type",render:function(e){return(0,P.jsx)(A.Z,{color:"dark-main",size:"sm",weight:"bold",children:(0,j.kC)(e)})}},{title:"Subscribers",dataIndex:"subscribers",key:"subscribers",render:function(e,n){var t,i;return"user"===n.type?(0,P.jsx)(C.C.Group,{maxCount:5,children:null===n||void 0===n||null===(t=n.Subscribers)||void 0===t?void 0:t.map((function(e){var n,t,i,o;return(0,P.jsx)(k.Z,{title:"".concat(null===e||void 0===e||null===(t=e.User)||void 0===t?void 0:t.firstName," ").concat(null===e||void 0===e||null===(i=e.User)||void 0===i?void 0:i.lastName),children:(0,P.jsx)(C.C,{size:25,style:{border:"0.5px solid var(--color-light-200)"},src:R.lj+(null===e||void 0===e||null===(o=e.User)||void 0===o?void 0:o.profile),icon:(0,P.jsx)(N.Z,{})})},null===e||void 0===e||null===(n=e.User)||void 0===n?void 0:n.uuid)}))}):"department"===n.type?(0,P.jsx)(A.Z,{color:"dark-main",size:"sm",weight:"bold",children:(null===n||void 0===n||null===(i=n.Department)||void 0===i?void 0:i.title)+" Department"}):(0,P.jsx)(A.Z,{color:"dark-main",size:"sm",weight:"bold",children:"All Employees"})}}]);return(0,P.jsx)("div",{className:p.Z.antdTableWrapper,children:(0,P.jsx)(S.Z,{sticky:!0,dataSource:n,columns:d,pagination:{current:null===r||void 0===r?void 0:r.page,total:null===r||void 0===r?void 0:r.total,hideOnSinglePage:!0,pageSize:null===r||void 0===r?void 0:r.perPage,onChange:function(e,n){o((0,i.Z)((0,i.Z)({},a),{},{page:e,perPage:n}))}},scroll:{x:991},loading:t,rowKey:function(e){return"biometric-type-".concat(e.id)}})})}var F=t(18515),T=t(54060),M=t(29079),L=t(86761),E=[{text:"Home",isLink:!0,path:"/"},{isLink:!1,text:"Notifications"}];var O=function(){var e=(0,j.aY)(L.o),n=(0,s.v9)((function(e){return e.usersReducer})).userPermissions,t=n.readNotification,d=n.createNotification,l=(0,r.useState)({editType:"new",recordId:0,openModal:!1}),c=(0,o.Z)(l,2),u=c[0],p=c[1],f=(0,r.useState)({page:1,perPage:10}),h=(0,o.Z)(f,2),v=h[0],g=(h[1],new x.P),Z=(0,M.$5)({method:g.getAnnouncements,initialQuery:(0,i.Z)({},v)}),b=Z.data,y=Z.onRefresh,C=(Z.setData,Z.loading),k=Z.meta,S=function(){!1!==d?p((0,i.Z)((0,i.Z)({},u),{},{openModal:!u.openModal,editType:"new"})):a.ZP.error("You don't have permission to create new record")};return(0,P.jsxs)(T.Z,{permissionSlug:e,children:[(0,P.jsx)(m.mr,{heading:"Announcements",buttonText:"Add Announcement",onButtonClick:S,breadCrumbData:E,showAdd:!0===d}),!0===t&&(0,P.jsx)(D,{tableData:b,tableLoading:C,onEditIconClick:function(){},reloadTableData:y,meta:k,filters:v}),!1===t&&(0,P.jsx)(F.a$,{mainMessage:"You don't have permission to view this data"}),u.openModal&&(0,P.jsx)(w,{record:u.recordId,type:u.editType,reloadTableData:y,onCancel:S,openModal:u.openModal,permissions:n})]})}},5599:function(e,n,t){t.d(n,{r:function(){return a}});var i=t(43144),o=t(15671),r=t(49075),a=(0,i.Z)((function e(){var n=this;(0,o.Z)(this,e),this.endPoint="biometrics",this.getAllRecords=function(e){return r.Z.get(n.endPoint,{params:e})},this.getRecordById=function(e){return r.Z.get("".concat(n.endPoint,"/").concat(e))},this.findPublished=function(e){return r.Z.get("".concat(n.endPoint,"/published"),{params:e})},this.deleteRecord=function(e){return r.Z.delete("".concat(n.endPoint,"/").concat(e))},this.createRecord=function(e){return r.Z.post(n.endPoint,e)},this.updateRecord=function(e,t){return r.Z.patch("".concat(n.endPoint,"/").concat(t),e)}}))},38859:function(e,n,t){t.d(n,{o:function(){return a}});var i=t(43144),o=t(15671),r=t(49075),a=(0,i.Z)((function e(){var n=this;(0,o.Z)(this,e),this.endPoint="department",this.getAllRecords=function(e){return r.Z.get(n.endPoint,{params:e})},this.getAllPublishedRecords=function(e){return r.Z.get(n.endPoint+"/find-published",{params:e})},this.getRecordById=function(e){return r.Z.get(n.endPoint+"/"+e)},this.deleteRecord=function(e){return r.Z.delete(n.endPoint+"/"+e)},this.createRecord=function(e){return r.Z.post(n.endPoint,e)},this.updateRecord=function(e,t){return r.Z.patch(n.endPoint+"/"+t,e)}}))}}]);