"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[9529],{9529:function(e,n,o){o.r(n),o.d(n,{default:function(){return J}});var t=o(1413),i=o(29439),r=o(47313),a=o(25019),d=o(55291),s=o(82626),c=o(3113),l=o(49355),u=o(46646),f=o(40169),p=o(93873),m=o(48897),v=o(35997),h=o(46417),Z=function(e){var n,o,Z,g,b=e.openModal,x=e.onCancel,j=e.type,P=e.record,k=e.reloadTableData,y=e.permissions,C=y.createBiometricsJob,w=y.updateBiometricsJob,R=a.Z.useForm(),B=(0,i.Z)(R,1)[0],T=(0,r.useMemo)((function(){return new p.E}),[]),L=(0,r.useMemo)((function(){return new v.U}),[]),I=(0,r.useState)(),E=(0,i.Z)(I,2),z=E[0],S=E[1],D=(0,r.useState)([]),M=(0,i.Z)(D,2),A=M[0],N=M[1],F=function(e){var n=(0,f.P)(e);if("string"==typeof n.message)S((0,t.Z)((0,t.Z)({},z),{},{error:n.message}));else{var o=(0,u.O)(n.message,[]);B.setFields(o),S((0,t.Z)((0,t.Z)({},z),{},{error:""}))}},J=(0,r.useCallback)((function(){L.getAllPublishedRecords().then((function(e){var n;N(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data)})).catch((function(e){d.ZP.error(e.response.data.message)}))}),[L]),U=(0,r.useCallback)((function(){S({loading:!0}),T.getRecordById(P).then((function(e){var n,o,i,r=null===e||void 0===e||null===(n=e.data)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.organization,a=null===e||void 0===e||null===(i=e.data)||void 0===i?void 0:i.data;S((0,t.Z)((0,t.Z)({},e.data),{},{loading:!1})),B.setFieldsValue((0,t.Z)((0,t.Z)({},a),{},{organizationId:null===r||void 0===r?void 0:r.id}))})).catch((function(e){F(e)}))}),[B,P,T]);return(0,r.useEffect)((function(){"edit"===j?(U(),J()):(B.resetFields(),J())}),[j,B]),(0,h.jsx)(s.P0,{visible:b,closable:!0,onCancel:x,titleText:"edit"===j?"Edit Bulk Upload Job":"Add New Bulk Upload Job",showFooter:!1,children:null!==z&&void 0!==z&&z.loading?(0,h.jsx)(l.Z,{items:10}):(0,h.jsxs)(a.Z,{className:c.Z.form,onFinish:function(e){S((0,t.Z)((0,t.Z)({},z),{},{buttonLoading:!0}));var n=new FormData;if("new"===j){var o=["file"];Object.entries(e).forEach((function(e){o.includes(e[0])||n.append(e[0],e[1])})),e.file&&"string"!==typeof e.file&&e.file.fileList.length>0&&n.append("file",e.file.fileList[0].originFileObj)}switch(j){case"edit":var i;if(!0===w)T.updateRecord(e,null===z||void 0===z||null===(i=z.data)||void 0===i?void 0:i.id).then((function(e){k(),x(),S((function(e){return(0,t.Z)((0,t.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){F(e),S((function(e){return(0,t.Z)((0,t.Z)({},e),{},{buttonLoading:!1})}))}));else S((function(e){return(0,t.Z)((0,t.Z)({},e),{},{buttonLoading:!1})})),d.ZP.error("You don't have permission to update bulk upload job");break;case"new":!0===C?T.createRecord(n).then((function(e){k(),x(),S((function(e){return(0,t.Z)((0,t.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){F(e),S((function(e){return(0,t.Z)((0,t.Z)({},e),{},{buttonLoading:!1})}))})):(S((function(e){return(0,t.Z)((0,t.Z)({},e),{},{buttonLoading:!1})})),d.ZP.error("You don't have permission to create bulk upload job"))}},form:B,children:[(null===z||void 0===z?void 0:z.error)&&(0,h.jsx)(s.EQ,{description:null===z||void 0===z?void 0:z.error,isClosable:!0,onClose:function(){S((0,t.Z)((0,t.Z)({},z),{},{error:""}))}}),(0,h.jsx)("div",{children:(0,h.jsx)(a.Z.Item,{name:"title",rules:[{required:!0,message:"Please add a title"}],children:(0,h.jsx)(s.t7,{size:"w100",label:"Title",asterisk:!0,type:"text"})})}),(0,h.jsx)("div",{children:(0,h.jsx)(a.Z.Item,{name:"uploadFormatId",rules:[{required:!0,message:"Please add upload format id"}],children:(0,h.jsx)(s.AP,{label:"Upload Format",asterisk:!0,options:null===A||void 0===A?void 0:A.map((function(e){return{label:null===e||void 0===e?void 0:e.title,value:null===e||void 0===e?void 0:e.id}}))})})}),"new"===j&&(0,h.jsx)(s.wA,{name:"file",accept:".json,.xlsx,.csv"}),"edit"===j&&(0,h.jsxs)("div",{className:"flex flex-col",children:[(0,h.jsx)("label",{className:"font-size-normal",children:"File:"}),(0,h.jsx)("a",{href:"".concat(m.lj).concat(null===z||void 0===z||null===(n=z.data)||void 0===n?void 0:n.file),target:"_blank",rel:"noopener noreferrer",className:"color-blue-yp font-size-normal",children:null===z||void 0===z||null===(o=z.data)||void 0===o||null===(Z=o.file)||void 0===Z||null===(g=Z.split("public/bulk-upload/"))||void 0===g?void 0:g.pop()})]}),(0,h.jsxs)("div",{className:c.Z.footer,children:[(0,h.jsx)(s.op,{size:"normal",fontSize:"sm",onClick:x,type:"plain",children:"Cancel"}),(0,h.jsx)(s.op,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:null===z||void 0===z?void 0:z.buttonLoading,children:"Submit"})]})]})})},g=o(86136),b=o(5900),x=o(72652),j=o(41586),P=o(98676),k=o(3109),y=o(77411),C=o(98505),w=o(85554),R=o(49075),B=o(40096),T=g.Z.TextArea,L=function(e){var n=e.record,o=e.onEditIconClick,a=e.reloadTableData,s=e.permissions.deleteBiometricsJob,l=(0,r.useState)({confirmLoading:!1,openPopConfirm:!1}),u=(0,i.Z)(l,2),f=u[0],m=u[1],v=(0,r.useMemo)((function(){return new p.E}),[]);return(0,h.jsxs)("div",{className:c.Z.actions,children:[(0,h.jsx)("span",{onClick:function(){return o(n)},children:(0,h.jsx)("img",{src:"/images/editicon.svg",alt:""})}),(0,h.jsx)(b.Z,{open:f.openPopConfirm,placement:"top",title:"Are you sure?",onConfirm:function(){if(m((0,t.Z)((0,t.Z)({},f),{},{confirmLoading:!0})),!1===s)return d.ZP.error("You don't have permission to delete this record, please contact your admin."),void m((0,t.Z)((0,t.Z)({},f),{},{openPopConfirm:!1}));v.deleteRecord(n.id).then((function(e){m((0,t.Z)((0,t.Z)({},f),{},{openPopConfirm:!1,confirmLoading:!1})),a()})).catch((function(e){m((0,t.Z)((0,t.Z)({},f),{},{confirmLoading:!1}))}))},onCancel:function(){return m((0,t.Z)((0,t.Z)({},f),{},{openPopConfirm:!1}))},okButtonProps:{loading:f.confirmLoading},okText:"Yes",cancelText:"No",onOpenChange:function(e){e||m((0,t.Z)((0,t.Z)({},f),{},{openPopConfirm:!1}))},children:(0,h.jsx)(P.Z,{className:c.Z.bg__red,onClick:function(){m((0,t.Z)((0,t.Z)({},f),{},{openPopConfirm:!0}))}})})]})},I=function(e){var n=e.record,o=e.reloadTableData,t=(0,r.useState)(!1),a=(0,i.Z)(t,2),c=a[0],l=a[1],u=(0,r.useMemo)((function(){return new p.E}),[]);(0,r.useEffect)((function(){n.status!==y.P.processing||c||l(!0)}),[n.status]);var f=function(){l(!0),u.getProcessById(n.id).then((function(e){d.ZP.success("Processing started"),o()})).catch((function(e){var n,o;console.error(null===e||void 0===e||null===(n=e.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message)}))},m=function(){u.stopProcess(n.id).then((function(e){d.ZP.success("Job stopped"),o()})).catch((function(e){var n,o;console.error(null===e||void 0===e||null===(n=e.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message)}))};return n.status===y.P.completed?(0,h.jsx)(k.Z,{color:"dark-sub",size:"sm",children:"Processed"}):c?(0,h.jsxs)("div",{className:"text-center",children:[(0,h.jsx)(x.Z,{}),(0,h.jsx)(k.Z,{color:"dark-sub",size:"sm",children:"Processing in background, you can close the tab"}),(0,h.jsx)(s.op,{onClick:m,size:"xs",type:"outlined",style:{margin:"auto"},children:"Stop"})]}):(0,h.jsx)(s.op,{onClick:f,size:"xs",type:"outlined",children:"Process Now"})};function E(e){var n=e.tableData,o=e.tableLoading,t=e.onEditIconClick,i=e.reloadTableData,r=(0,w.v9)((function(e){return e.usersReducer})).userPermissions,a=B.Z.getLocalAccessToken(),d=[{title:"S.No",dataIndex:"index",key:"index",render:function(e,n,o){return o+1},width:"5%"},{title:"Title",dataIndex:"title",key:"title",render:function(e,n){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(k.Z,{color:"dark-sub",size:"sm",children:e}),(0,h.jsx)(k.Z,{color:"dark-sub",size:"xs",children:"ID: ".concat(n.id)}),(0,h.jsx)("a",{href:"".concat(R._,"resources/all/").concat(n.file,"?authKey=").concat(a),target:"_blank",rel:"noreferrer",children:"Preview"})]})}},{title:"Failed Report",dataIndex:"failedReport",key:"failedReport",render:function(e,n){return(0,h.jsx)(T,{rows:4,value:JSON.stringify(n.failedReport,null,2)})},width:"300px"},{title:"Status",dataIndex:"processed",key:"processed",render:function(e,n){return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(I,{record:n,reloadTableData:i})})},className:"text-center"},{title:"Date",dataIndex:"addedDate",key:"addedDate",render:function(e,n){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(k.Z,{color:"dark-sub",size:"sm",children:"Added: ".concat((0,C.Ny)(e,"dd M,yy"))}),(0,h.jsx)(k.Z,{color:"dark-sub",size:"sm",children:"Processed: ".concat((0,C.Ny)(n.processeStartDate,"dd M,yy"))})]})}},{title:"Others",dataIndex:"others",key:"others",render:function(e,n){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(k.Z,{color:"dark-sub",size:"sm",children:"Success: ".concat(n.success)}),(0,h.jsx)(k.Z,{color:"dark-sub",size:"sm",children:"Failed: ".concat(n.failed)}),(0,h.jsx)(k.Z,{color:"dark-sub",size:"sm",children:"Total records: ".concat(n.totalRecords)})]})}},{title:"Actions",dataIndex:"actions",key:"actions",render:function(e,n){return(0,h.jsx)(L,{record:n,onEditIconClick:t,reloadTableData:i,permissions:r})}}];return(0,h.jsx)("div",{className:c.Z.antdTableWrapper,children:(0,h.jsx)(j.Z,{sticky:!0,dataSource:n,columns:d,pagination:!1,scroll:{x:991},loading:o,rowKey:function(e){return"site-prop-bulk-upload-".concat(e.id)}})})}var z=o(42623),S=o(19723),D=o(18515),M=o(54060),A=o(2135),N=o(3798),F=[{text:"Home",isLink:!0,path:"/"},{isLink:!0,text:"Biometrics",path:"/biometrics"},{isLink:!1,text:"Biometrics Bulk Upload Job"}];var J=function(){var e,n,o,a,c=(0,N.aY)(S.q),l=(0,w.v9)((function(e){return e.usersReducer})).userPermissions,u=(0,A.lr)(),f=(0,i.Z)(u,2),m=f[0],v=f[1],g=l,b=g.readBiometricsJob,x=g.createBiometricsJob,j=g.updateBiometricsJob,P=(0,r.useState)({editType:"new",recordId:0,openModal:"true"===m.get("openModal")}),k=(0,i.Z)(P,2),y=k[0],C=k[1],R=(0,r.useMemo)((function(){return new p.E}),[]),B=(0,r.useState)(""),T=(0,i.Z)(B,2),L=T[0],I=(T[1],(0,z.N)(L,500)),J=(0,r.useState)({isLoading:!1,error:{},data:[]}),U=(0,i.Z)(J,2),_=U[0],O=U[1],Y=function(){!1!==x?C((0,t.Z)((0,t.Z)({},y),{},{openModal:!y.openModal,editType:"new"})):d.ZP.error("You don't have permission to create new record")},q=(0,r.useCallback)((function(e){O((0,t.Z)((0,t.Z)({},_),{},{loading:!0})),R.getAllRecords(e).then((function(e){O(e.data)})).catch((function(e){var n,o;d.ZP.error(null===(n=e.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message)}))}),[_,R]);(0,r.useEffect)((function(){I?q({name:I}):q()}),[I]);var K=(0,r.useCallback)((function(e,n){O((0,t.Z)((0,t.Z)({},_),{},{loading:!0}));var o={page:e,perPage:n,name:I||void 0};R.getAllRecords(o).then((function(e){O((0,t.Z)((0,t.Z)({},e.data),{},{loading:!1}))})).catch((function(e){O((0,t.Z)((0,t.Z)({},_),{},{loading:!1}))}))}),[_,R]);return(0,r.useEffect)((function(){m.set("openModal",y.openModal.toString()),v(m)}),[y.openModal]),(0,h.jsxs)(M.Z,{permissionSlug:c,children:[(0,h.jsx)(s.mr,{heading:"Biometrics Bulk Upload Job",buttonText:"New Upload Job",onButtonClick:Y,breadCrumbData:F,showAdd:!0===x}),!0===b&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(E,{tableData:null===_||void 0===_?void 0:_.data,tableLoading:_.loading,onEditIconClick:function(e){!1!==j?C((0,t.Z)((0,t.Z)({},y),{},{editType:"edit",recordId:e.id,openModal:!0})):d.ZP.error("You don't have permission to update this record")},reloadTableData:q}),(0,h.jsx)(s.tl,{total:null===_||void 0===_||null===(e=_.meta)||void 0===e?void 0:e.total,current:null===_||void 0===_||null===(n=_.meta)||void 0===n?void 0:n.page,defaultPageSize:null!==_&&void 0!==_&&null!==(o=_.meta)&&void 0!==o&&o.perPage?null===_||void 0===_||null===(a=_.meta)||void 0===a?void 0:a.perPage:10,pageSizeOptions:[10,20,50,100],onChange:K})]}),!1===b&&(0,h.jsx)(D.a$,{mainMessage:"You don't have permission to view this data"}),y.openModal&&(0,h.jsx)(Z,{record:y.recordId,type:y.editType,reloadTableData:function(){var e,n;return q({page:null===_||void 0===_||null===(e=_.meta)||void 0===e?void 0:e.page,perPage:null===_||void 0===_||null===(n=_.meta)||void 0===n?void 0:n.perPage})},onCancel:Y,openModal:y.openModal,permissions:g})]})}},35997:function(e,n,o){o.d(n,{U:function(){return a}});var t=o(43144),i=o(15671),r=o(49075),a=(0,t.Z)((function e(){var n=this;(0,i.Z)(this,e),this.endPoint="bulk-upload-format",this.getAllRecords=function(e){return r.Z.get(n.endPoint,{params:e})},this.getAllPublishedRecords=function(e){return r.Z.get(n.endPoint+"/find-published",{params:e})},this.getRecordById=function(e){return r.Z.get("".concat(n.endPoint,"/").concat(e))},this.deleteRecord=function(e){return r.Z.delete("".concat(n.endPoint,"/").concat(e))},this.createRecord=function(e){return r.Z.post(n.endPoint+"/",e)},this.updateRecord=function(e,o){return r.Z.patch("".concat(n.endPoint,"/").concat(o),e)}}))},93873:function(e,n,o){o.d(n,{E:function(){return d}});var t=o(43144),i=o(15671),r=o(49075),a=o(3135),d=(0,t.Z)((function e(){var n=this;(0,i.Z)(this,e),this.endPoint="biometrics-job",this.getAllRecords=function(e){return r.Z.get(n.endPoint,{params:e})},this.getRecordById=function(e){return r.Z.get("".concat(n.endPoint,"/").concat(e))},this.getProcessById=function(e){return r.Z.patch("".concat(n.endPoint,"/process/").concat(e))},this.stopProcess=function(e){return r.Z.patch("".concat(n.endPoint,"/stop/").concat(e))},this.deleteRecord=function(e){return r.Z.delete("".concat(n.endPoint,"/").concat(e))},this.createRecord=function(e){return r.Z.post(n.endPoint+"/",e,{headers:a.C})},this.updateRecord=function(e,o){return r.Z.patch("".concat(n.endPoint,"/").concat(o),e)}}))},19723:function(e,n,o){o.d(n,{q:function(){return t}});var t=function(e){return e.CREATE="createBiometricsJob",e.UPDATE="updateBiometricsJob",e.DELETE="deleteBiometricsJob",e.READ="readBiometricsJob",e.ROLLBACK="rollbackBiometricsJob",e}({})},77411:function(e,n,o){o.d(n,{P:function(){return t}});var t=function(e){return e[e.new=1]="new",e[e.processing=2]="processing",e[e.completed=3]="completed",e[e.failed=4]="failed",e[e.rollback=5]="rollback",e[e.force_stopped=6]="force_stopped",e}({})}}]);