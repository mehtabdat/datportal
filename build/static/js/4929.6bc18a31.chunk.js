"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[4929],{70815:function(e,n,t){t.d(n,{r:function(){return m}});var i=t(1413),o=t(29439),r=t(45987),a=t(55291),s=t(86345),d=t(47313),c=t(40169),l=t(46417),u=["onChange","checked","recordId","allowChange"],m=function(e){var n=e.onChange,t=e.checked,m=e.recordId,f=e.allowChange,h=void 0===f||f,p=(0,r.Z)(e,u),Z=(0,d.useState)({loading:!1,checked:!1}),g=(0,o.Z)(Z,2),v=g[0],P=g[1];return(0,d.useEffect)((function(){P((0,i.Z)((0,i.Z)({},v),{},{checked:t}))}),[t]),(0,l.jsx)(s.Z,{checked:v.checked,onChange:function(e){!0===h?(P((0,i.Z)((0,i.Z)({},v),{},{loading:!0})),n(e,m,p).then((function(n){P((0,i.Z)((0,i.Z)({},v),{},{checked:e,loading:!1})),a.ZP.success(n.data.message)})).catch((function(e){P((0,i.Z)((0,i.Z)({},v),{},{loading:!1}));var n=(0,c.P)(e);"string"===typeof n.message?a.ZP.error(n.message):a.ZP.error("Something went wrong")}))):a.ZP.error("You don't have permission to change this record, please contact your admin.")},loading:v.loading})}},44929:function(e,n,t){t.r(n),t.d(n,{default:function(){return O}});var i=t(1413),o=t(29439),r=t(47313),a=t(7532),s=t(25019),d=t(55291),c=t(82626),l=t(17327),u=t(49355),m=t(48897),f=t(46646),h=t(40169),p=t(2135),Z=t(17),g=t(50753),v=t(46417),P=function(e){var n,t,a,P,x,b=e.openModal,j=e.onCancel,y=e.type,k=e.record,I=e.reloadTableData,R=e.permissions,C=R.createPermissions,w=R.updatePermissions,S=s.Z.useForm(),L=(0,o.Z)(S,1)[0],M=(0,r.useMemo)((function(){return new g.z}),[]),T=(0,r.useMemo)((function(){return new Z.B}),[]),z=(0,r.useState)(),E=(0,o.Z)(z,2),A=E[0],F=E[1],N=(0,r.useState)([]),D=(0,o.Z)(N,2),V=D[0],O=D[1],B=(0,p.lr)(),Y=(0,o.Z)(B,1)[0].get("moduleId");Y&&L.setFieldsValue({moduleId:Y});var _=function(e){var n=(0,h.P)(e);if("string"==typeof n.message)F((0,i.Z)((0,i.Z)({},A),{},{error:n.message}));else{var t=(0,f.O)(n.message,[]);L.setFields(t),F((0,i.Z)((0,i.Z)({},A),{},{error:""}))}},q=(0,r.useCallback)((function(){T.getRecordById(k).then((function(e){e.data&&e.data.data&&(L.setFieldsValue((0,i.Z)((0,i.Z)({translations:e.data.data.localization},e.data.data),{},{isPublished:e.data.data.isPublished})),F((0,i.Z)((0,i.Z)({},e.data),{},{loading:!1})))})).catch((function(e){_(e)}))}),[L,k,M,T]),H=(0,r.useCallback)((function(){M.getAllRecords().then((function(e){e.data&&e.data.data&&O(e.data.data)}))}),[M]);(0,r.useEffect)((function(){"edit"===y?(F({loading:!0}),q(),H()):(H(),L.resetFields(["name","action"]),L.setFieldsValue({order:99}))}),[b,y,L]);var K=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];F((0,i.Z)((0,i.Z)({},A),{},{buttonLoading:!0}));var t=new FormData,o=["icon"];switch(Object.entries(e).forEach((function(e){o.includes(e[0])||t.append(e[0],e[1])})),e.icon&&"string"!==typeof e.icon&&e.icon.fileList.length>0&&t.append("icon",e.icon.fileList[0].originFileObj),y){case"edit":!0===w?T.updateRecord(t,null===A||void 0===A?void 0:A.data.id).then((function(e){I(),n&&j(),d.ZP.success("Permission edited successfully"),F((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){_(e),F((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})}))})):(F((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})})),d.ZP.error("You don't have permission to update this record"));break;case"new":!0===C?T.createRecord(t).then((function(e){I(),n?j():L.resetFields(["action","name"]),d.ZP.success("Permission added successfully"),F((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){_(e),F((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})}))})):(F((function(e){return(0,i.Z)((0,i.Z)({},e),{},{buttonLoading:!1})})),d.ZP.error("You don't have permission to create this record"))}};return(0,v.jsx)(c.P0,{visible:b,size:"900px",closable:!0,onCancel:j,titleText:"edit"===y?"Edit Module Permission":"Add New Permission",showFooter:!1,children:null!==A&&void 0!==A&&A.loading?(0,v.jsx)(u.Z,{items:10}):(0,v.jsxs)(s.Z,{className:l.Z.form,onFinish:K,form:L,children:[(null===A||void 0===A?void 0:A.error)&&(0,v.jsx)(c.EQ,{description:null===A||void 0===A?void 0:A.error,isClosable:!0,onClose:function(){F((0,i.Z)((0,i.Z)({},A),{},{error:""}))}}),(0,v.jsxs)("div",{children:[(0,v.jsx)(s.Z.Item,{name:"name",rules:[{required:!0,message:"Please add a name"}],children:(0,v.jsx)(c.t7,{size:"w100",label:"Name",asterisk:!0,type:"text"})}),(0,v.jsx)(s.Z.Item,{name:"action",rules:[{required:!0,message:"Please add an action"}],children:(0,v.jsx)(c.t7,{size:"w100",label:"Action",asterisk:!0,type:"text"})})]}),(0,v.jsx)("div",{children:(0,v.jsx)(s.Z.Item,{name:"moduleId",rules:[{required:!0,message:"Please select a module"}],children:(0,v.jsx)(c.AP,{label:"System Module",placeholder:"Please select a section",defaultValue:Y||"",options:null===V||void 0===V?void 0:V.map((function(e){return{label:e.name,value:e.id.toString()}})),asterisk:!0})})}),(0,v.jsxs)("div",{children:[(0,v.jsx)(s.Z.Item,{name:"url",rules:[{required:!1,message:"Please add a url"}],children:(0,v.jsx)(c.t7,{size:"w100",label:"URL",type:"text"})}),(0,v.jsx)(s.Z.Item,{name:"order",rules:[{required:!0,message:"Please add order"}],children:(0,v.jsx)(c.t7,{size:"w100",defaultValue:L.getFieldValue("order")?L.getFieldValue("order"):99,label:"Order",asterisk:!0,type:"number"})})]}),(0,v.jsxs)("div",{children:[(0,v.jsx)(s.Z.Item,{name:"isMenuItem",children:(0,v.jsx)(c.AP,{label:"Menu Item?",defaultValue:"true",options:[{value:!0,label:"Yes"},{value:!1,label:"No"}]})}),(0,v.jsx)(s.Z.Item,{name:"visibility",children:(0,v.jsx)(c.AP,{label:"Visibility",defaultValue:"system",options:[{value:"organization",label:"Organization"},{value:"system",label:"System"}]})})]}),(0,v.jsxs)("div",{children:[(0,v.jsx)(s.Z.Item,{name:"description",rules:[{required:!1,message:"Please add a description"}],children:(0,v.jsx)(c.t7,{size:"w100",label:"Description",type:"textArea"})}),(0,v.jsxs)("div",{children:[(0,v.jsx)("p",{className:"mb-0",children:"\xa0"}),(0,v.jsx)(c.wA,{name:"icon",defaultFileList:"edit"===y&&A&&(null===(n=A.data)||void 0===n?void 0:n.icon)&&[{uid:null===(t=A.data)||void 0===t?void 0:t.id,name:null!==(a=A.data)&&void 0!==a&&a.icon?"..."+(null===(P=A.data)||void 0===P?void 0:P.icon.substr(A.data.icon.length-20,A.data.icon.length)):"",status:"done",url:m.lj+(null===(x=A.data)||void 0===x?void 0:x.icon)}]})]})]}),(0,v.jsxs)("div",{className:l.Z.footer,children:[(0,v.jsx)(c.op,{size:"normal",fontSize:"sm",onClick:j,type:"plain",children:"Cancel"}),"edit"!==y?(0,v.jsx)(c.op,{type:"primary",size:"normal",fontSize:"sm",htmlType:"button",onClick:function(){L.validateFields().then((function(e){K(e,!1)})).catch((function(e){}))},loading:null===A||void 0===A?void 0:A.buttonLoading,children:"Submit & Add More"}):"",(0,v.jsx)(c.op,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:null===A||void 0===A?void 0:A.buttonLoading,children:"Submit"})]})]})})},x=t(74165),b=t(15861),j=t(8570),y=t(5900),k=t(21680),I=t(41586),R=t(98676),C=t(3109),w=t(70815),S=t(37261),L=t(85554),M=j.Z.Paragraph,T=function(e){var n=e.record,t=e.onEditIconClick,a=e.reloadTableData,s=e.permissions.deletePermissions,c=(0,r.useState)({confirmLoading:!1,openPopConfirm:!1}),u=(0,o.Z)(c,2),m=u[0],f=u[1],h=(0,r.useMemo)((function(){return new Z.B}),[]);return(0,v.jsxs)("div",{className:l.Z.actions,children:[(0,v.jsx)("span",{onClick:function(){return t(n)},children:(0,v.jsx)("img",{src:"/images/editicon.svg",alt:""})}),(0,v.jsx)(y.Z,{open:m.openPopConfirm,placement:"top",title:"Are you sure?",onConfirm:function(){if(f((0,i.Z)((0,i.Z)({},m),{},{confirmLoading:!0})),!1===s)return d.ZP.error("You don't have permission to delete this record, please contact your admin."),void f((0,i.Z)((0,i.Z)({},m),{},{openPopConfirm:!1}));h.deleteRecord(n.id).then((function(e){f((0,i.Z)((0,i.Z)({},m),{},{openPopConfirm:!1,confirmLoading:!1})),a()})).catch((function(e){f((0,i.Z)((0,i.Z)({},m),{},{confirmLoading:!1}))}))},onCancel:function(){return f((0,i.Z)((0,i.Z)({},m),{},{openPopConfirm:!1}))},okButtonProps:{loading:m.confirmLoading},okText:"Yes",cancelText:"No",onOpenChange:function(e){e||f((0,i.Z)((0,i.Z)({},m),{},{openPopConfirm:!1}))},children:(0,v.jsx)(R.Z,{className:l.Z.bg__red,onClick:function(){f((0,i.Z)((0,i.Z)({},m),{},{openPopConfirm:!0}))}})})]})};function z(e){var n=e.tableData,t=e.tableLoading,i=e.onEditIconClick,r=e.reloadTableData,a=(0,L.v9)((function(e){return e.usersReducer})).userPermissions,s=a.updatePermissions,u=new Z.B,f=function(e,n){return u.updateRecord({isMenuItem:e},n)},h=function(){var e=(0,b.Z)((0,x.Z)().mark((function e(n,t){var i;return(0,x.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==s){e.next=7;break}return(i=new FormData).append("visibility",n),e.next=5,u.updateRecord(i,t).then((function(){d.ZP.success("Visibility updated successfully")})).catch((function(e){var n,t;d.ZP.error(null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message)}));case 5:e.next=8;break;case 7:d.ZP.error("You don't have permission to update this record, please contact your admin.");case 8:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),p=[{title:"S.No",dataIndex:"index",key:"index",render:function(e,n,t){return t+1},width:"5%"},{title:"Title",dataIndex:"name",key:"name",render:function(e,n){return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(C.Z,{color:"dark-main",size:"sm",weight:"bold",children:e}),(0,v.jsx)(M,{title:n.action,ellipsis:{rows:1,expandable:!1},copyable:{text:n.action},className:"font-size-sm color-dark-sub mb-0",children:n.action}),(0,v.jsx)("p",{className:"font-size-sm color-dark-sub",children:n.description})]})}},{title:"Icon",dataIndex:"icon",key:"icon",render:function(e,n){return e?(0,v.jsx)(k.Z,{width:50,height:50,src:"".concat(m.lj).concat(e),preview:!1,rootClassName:"object-fit-contain"}):(0,v.jsx)(v.Fragment,{})}},{title:"Access to Roles",dataIndex:"RolePermissions",key:"RolePermissions",render:function(e){return(0,v.jsx)("div",{children:(0,v.jsx)("ul",{className:"pa-0 ma-0",children:e&&(null===e||void 0===e?void 0:e.map((function(e){var n;return(0,v.jsx)("li",{className:"pa-0 ma-0 font-size-xs",children:null===e||void 0===e||null===(n=e.Role)||void 0===n?void 0:n.title})})))})})}},{title:"Menu Item",dataIndex:"isMenuItem",key:"isMenuItem",render:function(e,n){return(0,v.jsx)(w.r,{checked:e,onChange:f,recordId:n.id,allowChange:s})}},{title:"Visibility",key:"visibility",render:function(e,n){return(0,v.jsx)(c.AP,{options:Object.entries(S.R).map((function(e){var n=(0,o.Z)(e,2);return{label:n[0],value:n[1]}})),defaultValue:n.visibility,onChange:function(e){return h(e,n.id)},disabled:!1===s})}},{title:"Actions",dataIndex:"actions",key:"actions",render:function(e,n){return(0,v.jsx)(T,{record:n,onEditIconClick:i,reloadTableData:r,permissions:a})}}];return(0,v.jsx)("div",{className:l.Z.antdTableWrapper,children:(0,v.jsx)(I.Z,{sticky:!0,dataSource:n,columns:p,pagination:!1,scroll:{x:991},loading:t,rowKey:function(e){return"site-permissions-".concat(e.id)}})})}var E=t(31513),A=t(98276),F=t(44857),N=t(18515),D=t(3798),V=[{text:"Home",isLink:!0,path:"/"},{isLink:!0,text:"Site Settings",path:"/siteSettings"},{isLink:!0,text:"System Modules",path:"/siteSettings/system-modules"},{isLink:!1,text:"System Modules Permissions"}];var O=function(){var e,n=(0,D.aY)(F.M),t=(0,L.v9)((function(e){return e.usersReducer})).userPermissions,s=t.readPermissions,l=t.createPermissions,u=t.updatePermissions,m=(0,r.useState)({editType:"new",recordId:0,openModal:!1}),f=(0,o.Z)(m,2),h=f[0],Z=f[1],x=new g.z,b=(0,p.lr)(),j=(0,o.Z)(b,2),y=j[0],k=j[1],I=Number(y.get("moduleId")),R=(0,r.useState)({isLoading:!1,error:{},data:[]}),C=(0,o.Z)(R,2),w=C[0],S=C[1],M=(0,r.useState)({isLoading:!1,error:{},data:[]}),T=(0,o.Z)(M,2),O=T[0],B=T[1],Y=(0,r.useState)([]),_=(0,o.Z)(Y,2),q=_[0],H=_[1],K=function(){!1!==l?Z((0,i.Z)((0,i.Z)({},h),{},{openModal:!h.openModal,editType:"new"})):d.ZP.error("You don't have permission to create new record")},U=function(){S((0,i.Z)((0,i.Z)({},w),{},{loading:!0})),x.getRecordById(I).then((function(e){S((0,i.Z)((0,i.Z)({},w),e.data))})).catch((function(e){}))};return(0,r.useEffect)((function(){B((0,i.Z)((0,i.Z)({},O),{},{loading:!0})),x.getAllRecords().then((function(e){var n;H(null===(n=e.data)||void 0===n?void 0:n.data),B(e.data)})).catch((function(e){}))}),[]),(0,r.useEffect)((function(){U()}),[I]),(0,v.jsxs)(a.default,{permissionSlug:n,children:[(0,v.jsx)(c.mr,{heading:"System Module Of",buttonText:"Add New Permission",onButtonClick:K,breadCrumbData:V,showAdd:!0===l,children:(0,v.jsx)("div",{children:(0,v.jsx)(E.Z,{onChange:function(e){return k({moduleId:e.toString()})},className:"w-200",defaultValue:I,placeholder:"Choose module",loading:O.loading,showSearch:!0,optionFilterProp:"label",options:null===q||void 0===q?void 0:q.map((function(e){return{label:e.name,value:e.id}}))})})}),I?(0,v.jsxs)(v.Fragment,{children:[!0===s&&(0,v.jsx)(z,{tableData:null===w||void 0===w||null===(e=w.data)||void 0===e?void 0:e.Permissions,tableLoading:w.loading,onEditIconClick:function(e){!1!==u?Z((0,i.Z)((0,i.Z)({},h),{},{editType:"edit",recordId:e.id,openModal:!0})):d.ZP.error("You don't have permission to update this record")},reloadTableData:U}),!1===s&&(0,v.jsx)(N.a$,{mainMessage:"You don't have permission to view this data"}),h.openModal&&(0,v.jsx)(P,{record:h.recordId,type:h.editType,reloadTableData:U,onCancel:K,openModal:h.openModal,permissions:t})]}):(0,v.jsx)(A.Z,{image:"https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg",imageStyle:{height:150},description:(0,v.jsx)("span",{children:"Please select system module"})})]})}},17:function(e,n,t){t.d(n,{B:function(){return s}});var i=t(43144),o=t(15671),r=t(49075),a=t(3135),s=(0,i.Z)((function e(){var n=this;(0,o.Z)(this,e),this.endPoint="permissions",this.getAllRecords=function(){return r.Z.get(n.endPoint)},this.getRecordById=function(e){return r.Z.get("".concat(n.endPoint,"/").concat(e))},this.deleteRecord=function(e){return r.Z.delete("".concat(n.endPoint,"/").concat(e))},this.createRecord=function(e){return r.Z.post(n.endPoint+"/",e,{headers:a.C})},this.updateRecord=function(e,t){return r.Z.patch("".concat(n.endPoint,"/").concat(t),e,{headers:a.C})},this.getRolePermissions=function(e){return r.Z.get("".concat(n.endPoint,"/getRolePermissions/").concat(e))},this.getRolePermissionsByModuleId=function(e,t){return r.Z.get("".concat(n.endPoint,"/getRolePermissions/").concat(e,"/").concat(t))},this.grantPrivilegesToRole=function(e){return r.Z.post("".concat(n.endPoint,"/grantPrivilegesToRole"),e)},this.revokePrivilegesFromRole=function(e){return r.Z.post("".concat(n.endPoint,"/revokePrivilegesFromRole"),e)}}))},44857:function(e,n,t){t.d(n,{M:function(){return i}});var i=function(e){return e.CREATE="createPermissions",e.UPDATE="updatePermissions",e.DELETE="deletePermissions",e.READ="readPermissions",e.GRANT="grantPrivilegesToRole",e.REVOKE="revokePrivilegesFromRole",e.READ_ROLE_PERMISSIONS="readRolePermissions",e.VIEW_PERMISSIONS_LIST="viewPermissonsList",e}({})},50753:function(e,n,t){t.d(n,{z:function(){return s}});var i=t(43144),o=t(15671),r=t(49075),a=t(3135),s=(0,i.Z)((function e(){var n=this;(0,o.Z)(this,e),this.endPoint="system-modules",this.getAllRecords=function(){return r.Z.get(n.endPoint)},this.getRecordById=function(e){return r.Z.get("".concat(n.endPoint,"/").concat(e))},this.deleteRecord=function(e){return r.Z.delete("".concat(n.endPoint,"/").concat(e))},this.createRecord=function(e){return r.Z.post(n.endPoint+"/",e,{headers:a.C})},this.updateRecord=function(e,t){return r.Z.patch("".concat(n.endPoint,"/").concat(t),e,{headers:a.C})}}))},37261:function(e,n,t){t.d(n,{R:function(){return i}});var i=function(e){return e.Organization="organization",e.System="system",e}({})}}]);