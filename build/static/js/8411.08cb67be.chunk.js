"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[8411],{28411:function(e,t,n){n.r(t),n.d(t,{default:function(){return W}});var o=n(4942),a=n(1413),i=n(29439),s=n(47313),c=n(55291),d=n(47312),r=n(37831),l="styles_rolePermissionAsideContainer__t-wfv",u="styles_active__xMVnK",h="styles_adminNavPanelsWrap__8v8IL",m="styles_textWithIcon__6QWup",f="styles_divider__WMwuJ",v="styles_negAnimateTranslation__8251y",g="styles_header__IKoVa",Z="styles_content__z3-z+",_="styles_contentHeader__uOT6w",x="styles_content__layout__ltaw7",P="styles_content__layout__header__SrmJY",p="styles_content__layout__content__n1rSN",j="styles_content__layout__footer__f4Tim",I="styles_content__layout__footer__button__hiasX",y=n(3109),N=n(42623),w=n(48897),R=n(50753),k=n(46417),b=function(e){var t,n=e.moduleId,o=e.setModuleId,g=(0,s.useState)(""),Z=(0,i.Z)(g,2),_=Z[0],x=Z[1],P=(0,N.N)(_,500),p=new R.z,j=(0,s.useState)({loading:!1,data:[]}),I=(0,i.Z)(j,2),b=I[0],C=I[1],S=(0,s.useState)({data:[]}),z=(0,i.Z)(S,2),E=z[0],T=z[1],A=(0,s.useCallback)((function(e){x(e.target.value)}),[]);return(0,s.useEffect)((function(){C((0,a.Z)((0,a.Z)({},b),{},{loading:!0})),p.getAllRecords().then((function(e){e.data&&e.data.data&&(C((0,a.Z)((0,a.Z)({},b),{},{data:e.data.data,loading:!1})),T({data:e.data.data}))})).catch((function(e){C((0,a.Z)((0,a.Z)({},b),{},{loading:!1})),c.ZP.error("Something went wrong")}))}),[]),(0,s.useEffect)((function(){if(P){var e=E.data.filter((function(e){return e.name.toLowerCase().includes(P.toLowerCase())}));C((0,a.Z)((0,a.Z)({},b),{},{data:e}))}else C((0,a.Z)((0,a.Z)({},b),{},{data:E.data}))}),[P]),(0,k.jsxs)("div",{className:l,children:[(0,k.jsx)(r.Z,{size:"w100",label:"",placeHolder:"Search",icon:(0,k.jsx)("img",{src:"/images/searchIcon.svg",alt:"Search Icon"}),onChange:A}),(0,k.jsx)("div",{className:h+" "+v,children:b.loading?(0,k.jsx)(d.Z,{paragraph:{rows:18}}):null===(t=b.data)||void 0===t?void 0:t.map((function(e){return function(e){return(0,k.jsxs)("span",{className:"".concat(m," ").concat((null===e||void 0===e?void 0:e.id)===n?u:""),onClick:function(){return o(e.id?e.id:0)},children:[(0,k.jsx)("div",{}),e.icon?(0,k.jsx)("img",{src:"".concat(w.lj).concat(e.icon),alt:"",width:15}):null,(0,k.jsx)(y.Z,{type:"span",size:"sm",color:"dark-main",children:e.name})]},e.name)}(e)}))}),(0,k.jsx)("div",{className:f})]})},C=n(7532),S=n(82626),z=n(25019),E=n(98276),T=n(32697),A=n(31513),F=n(99420),M=n(49355),B=n(17),V=n(32147),D=n(2135),W=function(){var e,t,n,d,r,l=(0,s.useState)(0),u=(0,i.Z)(l,2),h=u[0],m=u[1],f=(0,s.useState)(!1),v=(0,i.Z)(f,2),y=v[0],N=v[1],w=(0,s.useState)({loading:!1}),W=(0,i.Z)(w,2),L=W[0],H=W[1],J=(0,D.lr)(),K=(0,i.Z)(J,2),U=K[0],Y=K[1],O=U.get("roleId"),Q=U.get("moduleId"),X=(0,s.useState)({data:[],loading:!1,selectedId:0}),q=(0,i.Z)(X,2),G=q[0],$=q[1],ee=(0,s.useMemo)((function(){return new F.U}),[]),te=(0,s.useMemo)((function(){return new R.z}),[]),ne=(0,s.useMemo)((function(){return new B.B}),[]),oe=z.Z.useForm(),ae=(0,i.Z)(oe,1)[0],ie=(0,s.useState)({initialData:[],data:{}}),se=(0,i.Z)(ie,2),ce=se[0],de=se[1];return(0,s.useEffect)((function(){h&&0!==h&&G.selectedId&&0!==G.selectedId&&(G.selectedId===Number(O)&&h===Number(Q)||function(e,t){Y((0,D.fW)({roleId:String(e),moduleId:String(t)}))}(G.selectedId,h)),0!==h&&0!==G.selectedId&&ne.getRolePermissionsByModuleId(G.selectedId,h).then((function(e){var t,n,i={};null===e||void 0===e||null===(t=e.data)||void 0===t||null===(n=t.data)||void 0===n||n.forEach((function(e,t){return i=(0,a.Z)((0,a.Z)({},i),{},(0,o.Z)({},e.Permission.action,!0))})),de((0,a.Z)((0,a.Z)({},ce),{},{initialData:e.data.data,data:i})),ae.setFieldsValue(i)})).catch((function(e){var t;c.ZP.error((null===(t=e.data)||void 0===t?void 0:t.message)||"Something went wrong 3")}))}),[h,G.selectedId]),(0,s.useEffect)((function(){Q&&m(Number(Q))}),[Q]),(0,s.useEffect)((function(){$((0,a.Z)((0,a.Z)({},G),{},{selectedId:Number(O),loading:!0})),ee.getAllRecords().then((function(e){$((0,a.Z)((0,a.Z)({},G),{},{data:e.data.data,selectedId:Number(O),loading:!1}))}))}),[ee]),(0,s.useEffect)((function(){0!==h&&(H((0,a.Z)((0,a.Z)({},L),{},{loading:!0})),te.getRecordById(h).then((function(e){H({data:e.data.data,loading:!1})})))}),[h,te]),(0,k.jsx)(C.default,{className:"pa-0",children:(0,k.jsxs)("div",{className:"d-flex overflow-hidden",children:[(0,k.jsx)("div",{children:(0,k.jsx)(b,{setModuleId:m,moduleId:h})}),(0,k.jsxs)("div",{className:"d-flex flex-column w-100 px-4",children:[(0,k.jsxs)("div",{className:g+" d-flex py-4",children:[(0,k.jsx)("div",{className:"my-auto color-dark-main",children:"You are changing permission of"}),(0,k.jsx)("div",{className:"ml-3",children:(0,k.jsx)(A.Z,{onChange:function(e){return $((0,a.Z)((0,a.Z)({},G),{},{selectedId:e}))},placeholder:"Choose role",allowClear:!0,style:{width:200},className:"selectAntdCustom",loading:G.loading,options:null===G||void 0===G||null===(e=G.data)||void 0===e?void 0:e.map((function(e){return{label:e.title,value:e.id}})),defaultValue:Number(O)&&0!==Number(O)?Number(O):null})})]}),(0,k.jsx)("div",{className:"overflow-auto w-max-100 w-100",children:(0,k.jsx)("div",{className:Z,children:L.loading?(0,k.jsx)(M.Z,{items:16}):0!==h&&h?(0,k.jsxs)(z.Z,{onFinish:function(){var e;if(0===G.selectedId)return c.ZP.error("Please choose a role"),!1;var t=[];null===(e=L.data)||void 0===e||e.Permissions.forEach((function(e){!0===ae.getFieldValue(e.action)&&t.push(e.id)})),t.length>0&&ne.grantPrivilegesToRole({roleId:G.selectedId,permissionIds:t}).then((function(e){var t;c.ZP.success(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)})).catch((function(e){var t;c.ZP.error((null===(t=e.data)||void 0===t?void 0:t.message)||"Something went wrong 1")}));var n=[];ce.initialData.forEach((function(e){t.includes(e.Permission.id)||n.push(e.Permission.id)})),n.length>0&&ne.revokePrivilegesFromRole({roleId:G.selectedId,permissionIds:n}).then((function(e){var t;c.ZP.success(null===(t=e.data)||void 0===t?void 0:t.message)})).catch((function(e){var t;c.ZP.error((null===(t=e.data)||void 0===t?void 0:t.message)||"Something went wrong 2")}))},form:ae,className:"w-100 mb-10",children:[(0,k.jsxs)("div",{className:_,children:[(0,k.jsx)(V.xC,{}),(0,k.jsx)(S.ZT,{size:"lg",color:"dark-main",weight:"semi",children:"Permissions"}),(0,k.jsx)("div",{})]}),(0,k.jsxs)("div",{className:x,children:[(0,k.jsxs)("div",{className:P,children:[(0,k.jsxs)("div",{children:[(0,k.jsx)(S.ZT,{size:"md",color:"dark-main",weight:"semi",children:null===(t=L.data)||void 0===t?void 0:t.name}),(0,k.jsx)(S.ZT,{size:"xs",color:"dark-sub",className:"pt-1",children:null===(n=L.data)||void 0===n?void 0:n.description})]}),(0,k.jsx)(T.Z,{onChange:function(e){var t,n={};null===(t=L.data)||void 0===t||t.Permissions.forEach((function(t){n[t.action]=e.target.checked})),de((0,a.Z)((0,a.Z)({},ce),{},{data:n})),N(e.target.checked),ae.setFieldsValue(n)},checked:y,className:"scaledCheckbox font-size-sm user-select-none",children:"Select All"})]}),null===L||void 0===L||null===(d=L.data)||void 0===d||null===(r=d.Permissions)||void 0===r?void 0:r.map((function(e){return(0,k.jsxs)("div",{className:"".concat(P," ").concat(p),children:[(0,k.jsxs)("div",{children:[(0,k.jsx)(S.ZT,{size:"sm",color:"dark-main",weight:"semi",children:null===e||void 0===e?void 0:e.name}),(0,k.jsx)(S.ZT,{size:"xs",color:"dark-sub",className:"pt-1",children:null===e||void 0===e?void 0:e.description})]}),(0,k.jsx)(z.Z.Item,{name:null===e||void 0===e?void 0:e.action,children:(0,k.jsx)(T.Z,{className:"my-auto scaledCheckbox",onChange:function(t){return function(e,t){ae.setFieldsValue((0,o.Z)({},t,e.target.checked)),de((0,a.Z)((0,a.Z)({},ce),{},{data:(0,a.Z)((0,a.Z)({},ce.data),{},(0,o.Z)({},t,e.target.checked))})),e.target.checked||N(!1)}(t,e.action)},defaultChecked:ce.data[e.action],checked:ce.data[e.action]})})]},"permissions___"+e.id)}))]}),(0,k.jsx)("div",{className:j,children:(0,k.jsx)("button",{type:"submit",className:I,children:"Save"})})]}):(0,k.jsx)(E.Z,{image:"https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg",imageStyle:{height:200},description:(0,k.jsx)("span",{children:"Please select a module from the sidebar"})})})})]})]})})}},17:function(e,t,n){n.d(t,{B:function(){return c}});var o=n(43144),a=n(15671),i=n(49075),s=n(3135),c=(0,o.Z)((function e(){var t=this;(0,a.Z)(this,e),this.endPoint="permissions",this.getAllRecords=function(){return i.Z.get(t.endPoint)},this.getRecordById=function(e){return i.Z.get("".concat(t.endPoint,"/").concat(e))},this.deleteRecord=function(e){return i.Z.delete("".concat(t.endPoint,"/").concat(e))},this.createRecord=function(e){return i.Z.post(t.endPoint+"/",e,{headers:s.C})},this.updateRecord=function(e,n){return i.Z.patch("".concat(t.endPoint,"/").concat(n),e,{headers:s.C})},this.getRolePermissions=function(e){return i.Z.get("".concat(t.endPoint,"/getRolePermissions/").concat(e))},this.getRolePermissionsByModuleId=function(e,n){return i.Z.get("".concat(t.endPoint,"/getRolePermissions/").concat(e,"/").concat(n))},this.grantPrivilegesToRole=function(e){return i.Z.post("".concat(t.endPoint,"/grantPrivilegesToRole"),e)},this.revokePrivilegesFromRole=function(e){return i.Z.post("".concat(t.endPoint,"/revokePrivilegesFromRole"),e)}}))},99420:function(e,t,n){n.d(t,{U:function(){return s}});var o=n(43144),a=n(15671),i=n(49075),s=(0,o.Z)((function e(){var t=this;(0,a.Z)(this,e),this.endPoint="role",this.getAllRecords=function(e){return i.Z.get(t.endPoint,{params:e})},this.getRecordById=function(e){return i.Z.get("".concat(t.endPoint,"/").concat(e,"?all=true"))},this.deleteRecord=function(e){return i.Z.delete("".concat(t.endPoint,"/").concat(e))},this.createRecord=function(e){return i.Z.post(t.endPoint+"/",e)},this.updateRecord=function(e,n){return i.Z.patch("".concat(t.endPoint,"/").concat(n),e)},this.addElements=function(e,n){return i.Z.post("".concat(t.endPoint,"/addDashboardElement/").concat(n),e)},this.removeElements=function(e,n){return i.Z.post("".concat(t.endPoint,"/removeDashboardElement/").concat(n),e)}}))},50753:function(e,t,n){n.d(t,{z:function(){return c}});var o=n(43144),a=n(15671),i=n(49075),s=n(3135),c=(0,o.Z)((function e(){var t=this;(0,a.Z)(this,e),this.endPoint="system-modules",this.getAllRecords=function(){return i.Z.get(t.endPoint)},this.getRecordById=function(e){return i.Z.get("".concat(t.endPoint,"/").concat(e))},this.deleteRecord=function(e){return i.Z.delete("".concat(t.endPoint,"/").concat(e))},this.createRecord=function(e){return i.Z.post(t.endPoint+"/",e,{headers:s.C})},this.updateRecord=function(e,n){return i.Z.patch("".concat(t.endPoint,"/").concat(n),e,{headers:s.C})}}))}}]);