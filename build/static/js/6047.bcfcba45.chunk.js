(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[6047],{50008:function(e,n,t){"use strict";t.d(n,{t:function(){return s}});var o=t(47312),r="styles_card__cH2rF",i=t(46417),s=function(){return(0,i.jsx)("div",{className:r,children:(0,i.jsx)(o.Z,{active:!0})})}},87629:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return R}});var o=t(93433),r=t(1413),i=t(29439),s=t(82626),a=t(54060),u=t(96369),l=t(47313),d=t(87927),c=t(55291),f=t(49958),v=t(29079),p=t(8875),m=t(25019),h=t(3113),Z=t(49355),g=t(46646),x=t(40169),j=t(46417),b=function(e){var n=e.openModal,t=e.onCancel,o=e.reloadTableData,a=e.permissions.createCashAdvance,u=m.Z.useForm(),d=(0,i.Z)(u,1)[0],f=new p.a,v=(0,l.useState)(),b=(0,i.Z)(v,2),C=b[0],w=b[1];(0,l.useEffect)((function(){d.resetFields()}),[n]);return(0,j.jsx)(s.P0,{visible:n,closable:!0,onCancel:t,titleText:"Add New Request",showFooter:!1,children:null!==C&&void 0!==C&&C.loading?(0,j.jsx)(Z.Z,{items:10}):(0,j.jsxs)(m.Z,{className:h.Z.form,onFinish:function(e){var n;w((0,r.Z)((0,r.Z)({},C),{},{buttonLoading:!0}));var i=e.files,s=new FormData,u=["files"];Object.entries(e).forEach((function(e){u.includes(e[0])||s.append(e[0],e[1])}));var l=null===i||void 0===i||null===(n=i.fileList)||void 0===n?void 0:n.map((function(e){return e.originFileObj}));if(null!==l&&void 0!==l&&l.length)for(var v=0;v<l.length;v++)s.append("files[]",l[v]);!0===a?f.createRecord(s).then((function(e){o(),t(),w((function(e){return(0,r.Z)((0,r.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){!function(e){var n=(0,x.P)(e);if("string"==typeof n.message)w((0,r.Z)((0,r.Z)({},C),{},{error:n.message}));else{var t=(0,g.O)(n.message,[]);d.setFields(t),w((0,r.Z)((0,r.Z)({},C),{},{error:""}))}}(e),w((function(e){return(0,r.Z)((0,r.Z)({},e),{},{buttonLoading:!1})}))})):(w((function(e){return(0,r.Z)((0,r.Z)({},e),{},{buttonLoading:!1})})),c.ZP.error("You don't have permission to create this record"))},form:d,children:[(null===C||void 0===C?void 0:C.error)&&(0,j.jsx)(s.EQ,{description:null===C||void 0===C?void 0:C.error,isClosable:!0,onClose:function(){w((0,r.Z)((0,r.Z)({},C),{},{error:""}))}}),(0,j.jsx)("div",{children:(0,j.jsx)(m.Z.Item,{name:"purpose",rules:[{required:!0,message:"Please add a purpose"}],children:(0,j.jsx)(s.t7,{size:"w100",label:"Purpose",asterisk:!0,type:"textArea",placeHolder:"Enter Purpose"})})}),(0,j.jsx)("div",{children:(0,j.jsx)(m.Z.Item,{name:"requestAmount",rules:[{required:!0,message:"Please enter request amount."}],children:(0,j.jsx)(s.t7,{prefix:"AED",size:"w100",label:"Request amount",asterisk:!0,placeHolder:"Enter request amount"})})}),(0,j.jsx)("div",{children:(0,j.jsx)(s.wA,{name:"files",required:!1,multiple:!0})}),(0,j.jsxs)("div",{className:"d-flex justify-end mt-4",children:[(0,j.jsx)(s.op,{size:"normal",fontSize:"sm",onClick:t,type:"plain",children:"Cancel"}),(0,j.jsx)(s.op,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:null===C||void 0===C?void 0:C.buttonLoading,children:"Add Request"})]})]})})},C=t(85554),w=t(77448),A=t(51093),y=t(42623),P=t(84825),S=t(50008),k=t(3798),q=[{text:"Home",isLink:!0,path:"/"},{isLink:!0,text:"My Services",path:"/myservices"},{isLink:!1,text:"Cash Advance Request"}],R=function(){var e=(0,k.aY)(w.S),n=(0,C.v9)((function(e){return e.usersReducer})).userPermissions,t=n.createCashAdvance,m=(0,l.useState)({recordId:0,openModal:!1}),h=(0,i.Z)(m,2),Z=h[0],g=h[1],x=(0,l.useState)(!1),R=(0,i.Z)(x,2),L=R[0],M=R[1],z=(0,l.useMemo)((function(){return new p.a}),[]),F=(0,l.useState)({page:1,perPage:6}),N=(0,i.Z)(F,1)[0],D=(0,v.$5)({method:z.getOwnRecords,initialQuery:(0,r.Z)({},N)}),E=D.data,I=D.onRefresh,T=D.loading,O=D.meta,_=function(){!1!==t?g((0,r.Z)((0,r.Z)({},Z),{},{openModal:!Z.openModal})):c.ZP.error("You don't have permission to create new record")},H=(0,l.useState)(""),Y=(0,i.Z)(H,1)[0],Q=(0,y.N)(Y,500),$=(0,l.useState)([]),B=(0,i.Z)($,2),G=(B[0],B[1]),J=(0,l.useMemo)((function(){return new P.z}),[]),K=(0,l.useCallback)((function(){Q&&J.getAllRecords({name:Q}).then((function(e){G((function(n){var t,r,i=null===e||void 0===e||null===(t=e.data)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.filter((function(e){return!(null!==n&&void 0!==n&&n.find((function(n){return n.id===e.id})))}));return[].concat((0,o.Z)(n),(0,o.Z)(i))}))})).catch((function(e){c.ZP.error(e.response.data.message)}))}),[Q]);return(0,l.useEffect)((function(){K()}),[K]),(0,j.jsxs)(a.Z,{permissionSlug:e,children:[(0,j.jsx)(s.mr,{heading:"Cash Advance Request",breadCrumbData:q,showAdd:!0===t,buttonText:"New Request",onButtonClick:_}),(0,j.jsx)("section",{className:u.Z.container,children:T?(0,o.Z)(new Array(6)).map((function(e,n){return(0,j.jsx)(S.t,{},"shimmer".concat(n))})):0!==(null===E||void 0===E?void 0:E.length)?null===E||void 0===E?void 0:E.map((function(e,n){return(0,j.jsx)(A.R,{cashAdvance:e,onClick:function(){g((0,r.Z)((0,r.Z)({},Z),{},{recordId:e.id})),M(!0)}},"cashAdvance-".concat(n))})):(0,j.jsx)("div",{style:{margin:"auto"},children:(0,j.jsx)(s.I$,{description:"No requests found for the given filters"})})}),(0,j.jsx)(f.Z,{hideOnSinglePage:!0,current:null===O||void 0===O?void 0:O.page,total:null===O||void 0===O?void 0:O.total,pageSize:(null===O||void 0===O?void 0:O.perPage)||0,onChange:function(e,n){I((0,r.Z)((0,r.Z)({},N),{},{page:e,perPage:n}))},style:{alignSelf:"flex-end"}}),L&&(0,j.jsx)(d.e,{openDrawer:L,onClose:function(){return M(!1)},permissions:n,record:Z.recordId,reloadTableData:I}),(0,j.jsx)(b,{reloadTableData:I,onCancel:_,openModal:Z.openModal,permissions:n})]})}},93414:function(){},70172:function(){},2001:function(){},33779:function(){},66558:function(){},82258:function(){}}]);