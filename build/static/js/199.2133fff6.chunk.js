"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[199],{199:function(e,t,n){n.r(t),n.d(t,{default:function(){return H}});var o=n(4942),a=n(1413),i=n(29439),s=n(47313),c=n(2135),d=n(55291),r=n(47312),l=n(37831),u="styles_rolePermissionAsideContainer__1E8iX",h="styles_active__9HRG3",m="styles_adminNavPanelsWrap__Knn+K",f="styles_textWithIcon__buvci",v="styles_divider__ye+58",Z="styles_negAnimateTranslation__Ro8+4",g="styles_header__1wNC1",_="styles_content__22XdE",p="styles_contentHeader__tZnXv",x="styles_content__layout__hRXyQ",P="styles_content__layout__header__4SMFh",j="styles_content__layout__content__GcYPJ",y="styles_content__layout__footer__U8MN3",I="styles_content__layout__footer__button__hMI4W",N=n(3109),R=n(42623),b=n(48897),k=n(50753),w=n(46417),C=function(e){var t=e.moduleId,n=e.setModuleId,o=(0,s.useState)(""),c=(0,i.Z)(o,2),g=c[0],_=c[1],p=(0,R.N)(g,500),x=new k.z,P=(0,s.useState)({loading:!1,data:[]}),j=(0,i.Z)(P,2),y=j[0],I=j[1],C=(0,s.useState)({data:[]}),S=(0,i.Z)(C,2),E=S[0],z=S[1],F=(0,s.useCallback)((function(e){_(e.target.value)}),[]);return(0,s.useEffect)((function(){I((0,a.Z)((0,a.Z)({},y),{},{loading:!0})),x.getAllRecords().then((function(e){e.data&&e.data.data&&(I((0,a.Z)((0,a.Z)({},y),{},{data:e.data.data,loading:!1})),z({data:e.data.data}))})).catch((function(e){I((0,a.Z)((0,a.Z)({},y),{},{loading:!1})),d.ZP.error("Something went wrong")}))}),[]),(0,s.useEffect)((function(){if(p){var e=E.data.filter((function(e){return e.name.toLowerCase().includes(p.toLowerCase())}));I((0,a.Z)((0,a.Z)({},y),{},{data:e}))}else I((0,a.Z)((0,a.Z)({},y),{},{data:E.data}))}),[p]),(0,w.jsxs)("div",{className:u,children:[(0,w.jsx)(l.Z,{size:"w100",label:"",placeHolder:"Search",icon:(0,w.jsx)("img",{src:"/images/searchIcon.svg",alt:"Search Icon"}),onChange:F}),(0,w.jsx)("div",{className:m+" "+Z,children:y.loading?(0,w.jsx)(r.Z,{paragraph:{rows:18}}):y.data.map((function(e){return function(e){return(0,w.jsxs)("span",{className:"".concat(f," ").concat((null===e||void 0===e?void 0:e.id)===t?h:""),onClick:function(){return n(e.id?e.id:0)},children:[(0,w.jsx)("div",{}),e.icon?(0,w.jsx)("img",{src:"".concat(b.lj).concat(e.icon),alt:"",width:15}):null,(0,w.jsx)(N.Z,{type:"span",size:"sm",color:"dark-main",children:e.name})]},e.name)}(e)}))}),(0,w.jsx)("div",{className:v})]})},S=n(82626),E=n(25019),z=n(98276),F=n(32697),M=n(31513),A=n(99420),T=n(49355),B=n(17),D=n(32147),V=n(54060),H=function(){var e,t,n,r=(0,s.useState)(0),l=(0,i.Z)(r,2),u=l[0],h=l[1],m=(0,s.useState)(!1),f=(0,i.Z)(m,2),v=f[0],Z=f[1],N=(0,s.useState)({loading:!1}),R=(0,i.Z)(N,2),b=R[0],H=R[1],W=(0,c.lr)(),X=(0,i.Z)(W,2),L=X[0],U=X[1],G=L.get("roleId"),K=L.get("moduleId"),Y=(0,s.useState)({data:[],loading:!1,selectedId:0}),J=(0,i.Z)(Y,2),Q=J[0],q=J[1],O=(0,s.useMemo)((function(){return new A.U}),[]),$=(0,s.useMemo)((function(){return new k.z}),[]),ee=(0,s.useMemo)((function(){return new B.B}),[]),te=E.Z.useForm(),ne=(0,i.Z)(te,1)[0],oe=(0,s.useState)({initialData:[],data:{}}),ae=(0,i.Z)(oe,2),ie=ae[0],se=ae[1];(0,s.useEffect)((function(){u&&0!==u&&Q.selectedId&&0!==Q.selectedId&&(Q.selectedId===Number(G)&&u===Number(K)||function(e,t){U((0,c.fW)({roleId:String(e),moduleId:String(t)}))}(Q.selectedId,u)),0!==u&&Q.selectedId&&0!==Q.selectedId&&ee.getRolePermissionsByModuleId(Q.selectedId,u).then((function(e){var t,n,i={};null===e||void 0===e||null===(t=e.data)||void 0===t||null===(n=t.data)||void 0===n||n.forEach((function(e,t){return i=(0,a.Z)((0,a.Z)({},i),{},(0,o.Z)({},e.permission.action,!0))})),se((0,a.Z)((0,a.Z)({},ie),{},{initialData:e.data.data,data:i})),ne.setFieldsValue(i)})).catch((function(e){d.ZP.error(e.message)}))}),[u,Q.selectedId]),(0,s.useEffect)((function(){K&&h(Number(K))}),[K]),(0,s.useEffect)((function(){q((0,a.Z)((0,a.Z)({},Q),{},{selectedId:Number(G),loading:!0})),O.getAllRecords().then((function(e){q((0,a.Z)((0,a.Z)({},Q),{},{data:e.data.data,selectedId:Number(G),loading:!1}))}))}),[O]),(0,s.useEffect)((function(){0!==u&&(H((0,a.Z)((0,a.Z)({},b),{},{loading:!0})),$.getRecordById(u).then((function(e){H({data:e.data.data,loading:!1})})))}),[u,$]);return(0,w.jsx)(V.Z,{className:"pa-0",children:(0,w.jsxs)("div",{className:"d-flex overflow-hidden",children:[(0,w.jsx)("div",{children:(0,w.jsx)(C,{setModuleId:h,moduleId:u})}),(0,w.jsxs)("div",{className:"d-flex flex-column w-100",children:[(0,w.jsxs)("div",{className:g+" d-flex py-4",children:[(0,w.jsx)("div",{className:"my-auto color-dark-main",children:"You are changing permission of"}),(0,w.jsx)("div",{className:"ml-3",children:(0,w.jsx)(M.Z,{onChange:function(e){return q((0,a.Z)((0,a.Z)({},Q),{},{selectedId:e}))},placeholder:"Choose role",allowClear:!0,style:{width:200},className:"selectAntdCustom",loading:Q.loading,options:function(){var e,t=[];return null===Q||void 0===Q||null===(e=Q.data)||void 0===e||e.map((function(e){"organization"===(null===e||void 0===e?void 0:e.visibility)&&t.push({label:null===e||void 0===e?void 0:e.title,value:null===e||void 0===e?void 0:e.id})})),t}(),defaultValue:Number(G)&&0!==Number(G)?Number(G):null})})]}),(0,w.jsx)("div",{className:"overflow-auto",children:(0,w.jsx)("div",{className:_,children:b.loading?(0,w.jsx)(T.Z,{items:16}):0!==u&&u?(0,w.jsxs)(E.Z,{onFinish:function(){var e;if(0===Q.selectedId)return d.ZP.error("Please choose a role"),!1;var t=[];null===(e=b.data)||void 0===e||e.Permissions.forEach((function(e){!0===ne.getFieldValue(e.action)&&t.push(e.id)})),t.length>0&&ee.grantPrivilegesToRole({roleId:Q.selectedId,permissionIds:t}).then((function(e){var t;d.ZP.success(null===(t=e.data)||void 0===t?void 0:t.message)})).catch((function(e){d.ZP.error(e.data.message)}));var n=[];ie.initialData.forEach((function(e){t.includes(e.permission.id)||n.push(e.permission.id)})),n.length>0&&ee.revokePrivilegesFromRole({roleId:Q.selectedId,permissionIds:n}).then((function(e){var t;d.ZP.success(null===(t=e.data)||void 0===t?void 0:t.message)})).catch((function(e){d.ZP.error(e.data.message)}))},form:ne,className:"w-100",children:[(0,w.jsxs)("div",{className:p,children:[(0,w.jsx)(D.xC,{}),(0,w.jsx)(S.ZT,{size:"lg",color:"dark-main",weight:"semi",children:"Permissions"}),(0,w.jsx)("div",{})]}),(0,w.jsxs)("div",{className:x,children:[(0,w.jsxs)("div",{className:P,children:[(0,w.jsxs)("div",{children:[(0,w.jsx)(S.ZT,{size:"md",color:"dark-main",weight:"semi",children:null===(e=b.data)||void 0===e?void 0:e.name}),(0,w.jsx)(S.ZT,{size:"xs",color:"dark-sub",className:"pt-1",children:null===(t=b.data)||void 0===t?void 0:t.description})]}),(0,w.jsx)(F.Z,{onChange:function(e){var t,n={};null===(t=b.data)||void 0===t||t.Permissions.forEach((function(t){n[t.action]=e.target.checked})),se((0,a.Z)((0,a.Z)({},ie),{},{data:n})),Z(e.target.checked),ne.setFieldsValue(n)},checked:v,className:"scaledCheckbox font-size-sm user-select-none",children:"Select\xa0All"})]}),null===(n=b.data)||void 0===n?void 0:n.Permissions.map((function(e){return(0,w.jsxs)("div",{className:"".concat(P," ").concat(j),children:[(0,w.jsxs)("div",{children:[(0,w.jsx)(S.ZT,{size:"sm",color:"dark-main",weight:"semi",children:null===e||void 0===e?void 0:e.name}),(0,w.jsx)(S.ZT,{size:"xs",color:"dark-sub",className:"pt-1",children:null===e||void 0===e?void 0:e.description})]}),(0,w.jsx)(E.Z.Item,{name:null===e||void 0===e?void 0:e.action,children:(0,w.jsx)(F.Z,{className:"my-auto scaledCheckbox",onChange:function(t){return function(e,t){ne.setFieldsValue((0,o.Z)({},t,e.target.checked)),se((0,a.Z)((0,a.Z)({},ie),{},{data:(0,a.Z)((0,a.Z)({},ie.data),{},(0,o.Z)({},t,e.target.checked))})),e.target.checked||Z(!1)}(t,e.action)},defaultChecked:ie.data[e.action],checked:ie.data[e.action]})})]},"permissions___"+e.id)}))]}),(0,w.jsx)("div",{className:y,children:(0,w.jsx)("button",{type:"submit",className:I,children:"Save"})})]}):(0,w.jsx)(z.Z,{image:"https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg",imageStyle:{height:200},description:(0,w.jsx)("span",{children:"Please select a module from the sidebar"})})})})]})]})})}},17:function(e,t,n){n.d(t,{B:function(){return c}});var o=n(43144),a=n(15671),i=n(49075),s=n(3135),c=(0,o.Z)((function e(){var t=this;(0,a.Z)(this,e),this.endPoint="permissions",this.getAllRecords=function(){return i.Z.get(t.endPoint)},this.getRecordById=function(e){return i.Z.get("".concat(t.endPoint,"/").concat(e))},this.deleteRecord=function(e){return i.Z.delete("".concat(t.endPoint,"/").concat(e))},this.createRecord=function(e){return i.Z.post(t.endPoint+"/",e,{headers:s.C})},this.updateRecord=function(e,n){return i.Z.patch("".concat(t.endPoint,"/").concat(n),e,{headers:s.C})},this.getRolePermissions=function(e){return i.Z.get("".concat(t.endPoint,"/getRolePermissions/").concat(e))},this.getRolePermissionsByModuleId=function(e,n){return i.Z.get("".concat(t.endPoint,"/getRolePermissions/").concat(e,"/").concat(n))},this.grantPrivilegesToRole=function(e){return i.Z.post("".concat(t.endPoint,"/grantPrivilegesToRole"),e)},this.revokePrivilegesFromRole=function(e){return i.Z.post("".concat(t.endPoint,"/revokePrivilegesFromRole"),e)}}))},99420:function(e,t,n){n.d(t,{U:function(){return s}});var o=n(43144),a=n(15671),i=n(49075),s=(0,o.Z)((function e(){var t=this;(0,a.Z)(this,e),this.endPoint="role",this.getAllRecords=function(e){return i.Z.get(t.endPoint,{params:e})},this.getRecordById=function(e){return i.Z.get("".concat(t.endPoint,"/").concat(e,"?all=true"))},this.deleteRecord=function(e){return i.Z.delete("".concat(t.endPoint,"/").concat(e))},this.createRecord=function(e){return i.Z.post(t.endPoint+"/",e)},this.updateRecord=function(e,n){return i.Z.patch("".concat(t.endPoint,"/").concat(n),e)},this.addElements=function(e,n){return i.Z.post("".concat(t.endPoint,"/addDashboardElement/").concat(n),e)},this.removeElements=function(e,n){return i.Z.post("".concat(t.endPoint,"/removeDashboardElement/").concat(n),e)}}))},50753:function(e,t,n){n.d(t,{z:function(){return c}});var o=n(43144),a=n(15671),i=n(49075),s=n(3135),c=(0,o.Z)((function e(){var t=this;(0,a.Z)(this,e),this.endPoint="system-modules",this.getAllRecords=function(){return i.Z.get(t.endPoint)},this.getRecordById=function(e){return i.Z.get("".concat(t.endPoint,"/").concat(e))},this.deleteRecord=function(e){return i.Z.delete("".concat(t.endPoint,"/").concat(e))},this.createRecord=function(e){return i.Z.post(t.endPoint+"/",e,{headers:s.C})},this.updateRecord=function(e,n){return i.Z.patch("".concat(t.endPoint,"/").concat(n),e,{headers:s.C})}}))}}]);