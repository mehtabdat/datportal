"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[1279],{43823:function(e,t,r){r.r(t),r.d(t,{default:function(){return q}});var s=r(74165),n=r(93433),a=r(1413),i=r(15861),o=r(29439),l=r(47313),d=r(86136),u=r(8773),c=r(37388),v=r(39548),m=r(28288),f=r(82626),h=r(54060),p=r(37936),x=r(44727),y=r(55560),g=r(24922),Z=r(85554),j=r(2135),b=r(55291),k=r(47312),S=r(10177),_={board:"styles_board__iCV9b",column:"styles_column__AYz5K",columnHead:"styles_columnHead__eMEwZ",kanbanItem:"styles_kanbanItem__UOz3X",kanbanItemBottom:"styles_kanbanItemBottom__-VXvK",priorityPill:"styles_priorityPill__g2Rr1",kanbanItemBottomBottom:"styles_kanbanItemBottomBottom__LksdC",file:"styles_file__dqCAy"},N=r(26246),C=r(73989),I=r(79117),w=r(23860),B=r(24754),T=r.n(B),U=r(48897),z=r(98505),R=r(86948),A=r(46417),M=function(e){var t=e.searchParams,r=e.setSearchParams,s=e.tasks,a=e.setTasks,i=e.meta,o=e.setMeta,d=e.searchTerm,m=e.openDetailModal,f=e.setOpenDetailModal,h=e.setSelectedTask,x=e.module,y=e.isLoading,g=(0,l.useCallback)((function(e,t){var r=s[e];a(T()(s,{$splice:[[e,1],[t,0,r]]})),x.updateOrder({order:e},r.id).catch((function(e){e.message?b.ZP.error(e.message):b.ZP.error("Something went wrong")}))}),[s]),Z=(0,l.useCallback)((function(e,t){var r=s[e];if(r.status!==t){var i=(0,n.Z)(s);i[e].status=t,a(i),x.updateRecord({status:t},r.id).then((function(e){})).catch((function(e){e.message?b.ZP.error(e.message):b.ZP.error("Something went wrong")}))}}),[s]);return(0,A.jsx)(N.W,{backend:w.PD,children:(0,A.jsx)("section",{className:_.board,children:[1,2,3].map((function(e){var l,j,b,N;return(0,A.jsx)(O,{status:e,changeTaskStatus:Z,children:(0,A.jsxs)("div",{className:_.column,children:[(0,A.jsxs)("div",{className:_.columnHead,children:[p.S7[e]," (",Number(null===(l=i[e-1])||void 0===l?void 0:l.total)?Number(null===(j=i[e-1])||void 0===j?void 0:j.total):"",")"]}),(0,A.jsx)("div",{children:(0,A.jsx)(R.Z,{dataLength:s.filter((function(t){return t.status===e})).length,next:function(){var t;x.getAllRecords({status:e,page:Number(null===(t=i[e-1])||void 0===t?void 0:t.page)+1}).then((function(t){a([].concat((0,n.Z)(s),(0,n.Z)(t.data.data)));var r=i;r[e-1]=t.data.meta,o(r)}))},hasMore:Number(null===(b=i[e-1])||void 0===b?void 0:b.pageCount)>Number(null===(N=i[e-1])||void 0===N?void 0:N.page),loader:(0,A.jsx)(k.Z,{active:!0}),height:"70vh",scrollThreshold:.75,className:"infinite-scroll-wrap",children:y?(0,A.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:Array(3).fill(0).map((function(e,t){return(0,A.jsx)(k.Z.Input,{size:"large",active:!0,style:{height:"3.5vw",width:"100%",borderRadius:"0.25rem"}},t)}))}):null===s||void 0===s?void 0:s.filter((function(t){return t.status===e})).filter((function(e){var t,r;return!d||(null===e||void 0===e||null===(t=e.title)||void 0===t||null===(r=t.toLowerCase())||void 0===r?void 0:r.includes(null===d||void 0===d?void 0:d.toLowerCase()))})).map((function(e){var n,a,i,o,l;return(0,A.jsx)(P,{item:e,items:s,moveTask:g,children:(0,A.jsxs)("div",{className:_.kanbanItem,onClick:function(){h(e.id),f(!m),t.set("taskId",e.id.toString()),r(t)},children:[(0,A.jsx)("div",{children:e.title}),(0,A.jsxs)("div",{className:_.kanbanItemBottom,children:[(0,A.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"flex-end"},children:[(0,A.jsx)("div",{className:_.cardBodyEnd,children:(0,A.jsx)("div",{style:{color:"var(--color-light-300)",fontSize:"var(--font-size-xs)"},children:(0,z.Ny)(e.addedDate,"dd M,yy")})}),(0,A.jsx)("div",{style:{color:"var(--color-light-300)",fontSize:"var(--font-size-xs)"},children:(0,z.Ny)((null===e||void 0===e?void 0:e.taskEndOn)||"","dd MM,yy")}),(null===e||void 0===e||null===(n=e._count)||void 0===n?void 0:n.Resources)>0&&(0,A.jsxs)("div",{className:_.file,children:[(0,A.jsx)(S.Z,{}),"\xa0",e._count.Resources]})]}),(0,A.jsxs)("div",{className:_.kanbanItemBottomBottom,children:[(0,A.jsx)(u.C.Group,{children:e.TaskMembers.map((function(t){return(0,A.jsx)(c.Z,{overlayInnerStyle:{borderRadius:"0.25rem",fontSize:"var(--font-size-sm)"},placement:3===e.status?"left":"bottom",title:t.User.firstName+" "+t.User.lastName,children:(0,A.jsx)(u.C,{size:25,style:{border:"0.5px solid var(--color-light-200)"},src:U.lj+t.User.profile,icon:(0,A.jsx)(v.Z,{})})},t.User.uuid)}))}),e.AddedBy&&(0,A.jsx)(c.Z,{overlayInnerStyle:{borderRadius:"0.25rem",fontSize:"var(--font-size-sm)"},placement:3===e.status?"left":"bottom",title:"Added by: "+(null===(i=e.AddedBy)||void 0===i?void 0:i.firstName)+" "+(null===(o=e.AddedBy)||void 0===o?void 0:o.lastName),children:(0,A.jsx)(u.C,{size:25,style:{border:"0.5px solid var(--color-light-200)"},src:U.lj+(null===(l=e.AddedBy)||void 0===l?void 0:l.profile),icon:(0,A.jsx)(v.Z,{})})},null===(a=e.AddedBy)||void 0===a?void 0:a.uuid)]})]})]})},e.id)}))})})]})},e)}))})})},O=function(e){var t=e.status,r=e.changeTaskStatus,s=e.children,n=(0,l.useRef)(null),a=(0,C.L)({accept:"card",drop:function(e){r(e.index,t)}});return(0,(0,o.Z)(a,2)[1])(n),(0,A.jsxs)("div",{style:{flexGrow:1},ref:n,children:[" ",s]})},P=function(e){var t=e.children,r=e.item,s=e.items,n=e.moveTask,a=(0,l.useRef)(null),i=s.indexOf(r),d=(0,C.L)({accept:"card",collect:function(e){var t=(e.getItem()||{}).index;return t===i?{}:{isOver:e.isOver(),dropClassName:t<i?" drop-over-downward":" drop-over-upward"}},drop:function(e){n(e.index,i)}}),u=(0,o.Z)(d,2)[1],c=(0,I.c)({type:"card",item:{index:i},collect:function(e){return{isDragging:e.isDragging()}}}),v=(0,o.Z)(c,2),m=v[0].isDragging?0:1;return u((0,v[1])(a)),(0,A.jsx)("div",{ref:a,style:{opacity:m},children:t})},D=r(26773),L=r(3798),E="styles_sortBy__AgqNC",F=[{text:"Home",isLink:!0,path:"/"},{isLink:!1,text:"Tech Support"}],q=function(){var e=(0,l.useState)(!1),t=(0,o.Z)(e,2),r=t[0],b=t[1],k=new y.h,S=(0,j.lr)(),_=(0,o.Z)(S,2),N=_[0],C=_[1],I=(0,l.useState)(!0),w=(0,o.Z)(I,2),B=w[0],T=w[1],z=(0,l.useState)(!1),R=(0,o.Z)(z,2),O=R[0],P=R[1],q=(0,l.useState)(!1),H=(0,o.Z)(q,2),X=H[0],G=H[1],J=(0,l.useState)(),K=(0,o.Z)(J,2),V=K[0],Y=K[1],$=(0,l.useState)([]),W=(0,o.Z)($,2),Q=W[0],ee=W[1],te=(0,l.useState)([]),re=(0,o.Z)(te,2),se=re[0],ne=re[1],ae=(0,l.useState)(Array(3).fill({})),ie=(0,o.Z)(ae,2),oe=ie[0],le=ie[1],de=(0,l.useState)({sortByField:"order",sortOrder:"asc",userIds:null!==N&&void 0!==N&&N.get("userIds")?JSON.parse((null===N||void 0===N?void 0:N.get("userIds"))||""):[]}),ue=(0,o.Z)(de,2),ce=ue[0],ve=ue[1],me=(0,l.useState)(N.get("searchTerm")),fe=(0,o.Z)(me,2),he=fe[0],pe=fe[1],xe=(0,Z.v9)((function(e){return e.usersReducer})).userPermissions,ye=(0,L.aY)(x.r),ge=xe,Ze=function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t){var r,i,o,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),e.prev=1,r=[1,2,3].map((function(e){return k.getTechSupportRequest((0,a.Z)({status:e},t))})),e.next=6,Promise.allSettled(r);case 6:i=e.sent,o=[],l=Array(3).fill({}),i.forEach((function(e,t){"fulfilled"===e.status&&(o.push.apply(o,(0,n.Z)(e.value.data.data)),l[t]=e.value.data.meta)})),ne(o),le(l),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),console.error(e.t0,"Error fetching tasks");case 17:return e.prev=17,b(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[1,14,17,20]])})));return function(t){return e.apply(this,arguments)}}();return(0,l.useEffect)((function(){B&&(N.get("taskId")&&(P(!O),Y(Number(N.get("taskId")))),T(!1))}),[]),(0,l.useEffect)((function(){Ze((0,a.Z)({},ce))}),[]),(0,l.useEffect)((function(){var e=[];se.forEach((function(t){t.TaskMembers.forEach((function(t){e.some((function(e){return e.User.id===t.User.id}))||e.push(t)}))})),ee(e)}),[se]),(0,A.jsxs)(h.Z,{permissionSlug:ye,children:[(0,A.jsx)(f.mr,{heading:"Tech Support",breadCrumbData:F,showAdd:ge.createTask,buttonText:"Add New Request",onButtonClick:function(){return G(!X)},filters:(0,A.jsxs)("div",{children:[(0,A.jsx)(d.Z,{allowClear:!0,value:he||"",placeholder:"Search this board",onChange:function(e){var t,r;(pe(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value),e.target.value)?(N.set("searchTerm",null===e||void 0===e||null===(r=e.target)||void 0===r?void 0:r.value.toLowerCase()),C(N)):(N.delete("searchTerm"),C(N))},style:{width:220,borderRadius:"0.25rem"},suffix:(0,A.jsx)(m.Z,{})}),(0,A.jsx)("div",{children:(0,A.jsx)(u.C.Group,{maxCount:5,children:Q.map((function(e){var t;return(0,A.jsx)(c.Z,{overlayInnerStyle:{borderRadius:"0.25rem",fontSize:"var(--font-size-sm)"},title:"".concat(e.User.firstName," ").concat(e.User.lastName),children:(0,A.jsx)(u.C,{size:32,onClick:function(){var t,r,s,n,i=ce.userIds;null!==(t=i)&&void 0!==t&&t.some((function(t){return t===e.User.id}))?i=null===(s=i)||void 0===s?void 0:s.filter((function(t){return t!==e.User.id})):null===(n=i)||void 0===n||n.push(e.User.id);null!==(r=i)&&void 0!==r&&r.length?N.set("userIds",JSON.stringify(i)):N.delete("userIds"),C(N),Ze((0,a.Z)((0,a.Z)({},ce),{},{userIds:i})),ve((0,a.Z)((0,a.Z)({},ce),{},{userIds:i}))},style:{border:null!==(t=ce.userIds)&&void 0!==t&&t.includes(e.User.id)?"2px solid var(--color-primary-main)":"0.5px solid var(--color-light-200)",cursor:"pointer"},src:U.lj+e.User.profile,icon:(0,A.jsx)(v.Z,{})})},e.User.uuid)}))})}),(0,A.jsx)("div",{className:E,children:(0,A.jsx)(f.Xy,{type:"radio",label:"Sort By",name:"sortBy",options:Object.entries(p.$g).map((function(e){var t=(0,o.Z)(e,2);return{label:t[0],value:t[1]}})),value:null===ce||void 0===ce?void 0:ce.sortByField,onChange:function(e){return ve((0,a.Z)((0,a.Z)({},ce),{},{sortByField:e.target.value}))},onReset:function(){var e=(0,a.Z)((0,a.Z)({},ce),{},{sortByField:void 0});ve(e),Ze(e)},onUpdate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ce;Ze((0,a.Z)((0,a.Z)({},e),{},{sortByField:ce.sortByField,sortOrder:e.sortOrder}))},withSort:!0})})]})}),(0,A.jsx)(M,{tasks:se,setTasks:ne,searchParams:N,setSearchParams:C,searchTerm:he,meta:oe,setMeta:le,openDetailModal:O,setOpenDetailModal:P,setSelectedTask:Y,isLoading:r,module:k}),V&&(0,A.jsx)(g.X,{openModal:O,onCancel:function(){P(!O),N.delete("taskId"),C(N)},id:V,onUpdate:Ze}),X&&(0,A.jsx)(D.t,{reloadTableData:Ze,onCancel:function(){return G(!X)},openModal:X,permissions:ge})]})}}}]);