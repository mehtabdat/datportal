"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[3254],{83254:function(e,n,t){t.r(n),t.d(n,{default:function(){return _}});var o=t(93433),r=t(1413),i=t(29439),a=t(47313),d=t(69309),c=t(25019),s=t(55291),l=t(31513),u=t(98276),h=t(82626),f=t(3113),p=t(49355),v=t(46646),m=t(40169),g=t(42623),Z=t(51812),x=t(84825),y=t(70816),b=t.n(y),k=t(46417),j=d.Z.TimePicker,I=function(e){var n,t=e.openModal,y=e.onCancel,I=e.type,P=e.record,C=e.reloadTableData,S=e.permissions,w=S.createAttendance,N=S.updateAttendance,A=e.employeeId,R=e.date,z=c.Z.useForm(),L=(0,i.Z)(z,1)[0],O=new Z.s,T=(0,a.useState)(),D=(0,i.Z)(T,2),F=D[0],E=D[1],M=(0,a.useState)(""),_=(0,i.Z)(M,2),U=_[0],Y=_[1],B=(0,g.N)(U,500),H=(0,a.useState)([]),V=(0,i.Z)(H,2),q=V[0],W=V[1],X=(0,a.useMemo)((function(){return new x.z}),[]),Q=(0,a.useCallback)((function(){B&&X.getAllRecords({name:B}).then((function(e){W((function(n){var t,r,i=null===e||void 0===e||null===(t=e.data)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.filter((function(e){return!(null!==n&&void 0!==n&&n.find((function(n){return n.id===e.id})))}));return[].concat((0,o.Z)(n),(0,o.Z)(i))}))})).catch((function(e){s.ZP.error(e.response.data.message)}))}),[B]);(0,a.useEffect)((function(){Q()}),[Q]);var $=function(e){var n=(0,m.P)(e);if("string"==typeof n.message)E((0,r.Z)((0,r.Z)({},F),{},{error:n.message}));else{var t=(0,v.O)(n.message,[]);L.setFields(t),E((0,r.Z)((0,r.Z)({},F),{},{error:""}))}},K=(0,a.useCallback)((function(){O.getRecordById(P).then((function(e){var n,t,o=null===e||void 0===e||null===(n=e.data)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.userId;e.data&&e.data.data&&(L.setFieldsValue((0,r.Z)((0,r.Z)({},e.data.data),{},{userId:o,checkIn:b()(e.data.data.checkIn),checkOut:b()(e.data.data.checkOut),date:b()(e.data.data.checkIn)})),E((0,r.Z)((0,r.Z)({},e.data),{},{loading:!1})),o&&X.getRecordById(o).then((function(e){var n;W([null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data])})).catch((function(e){s.ZP.error(e.response.data.message)})))})).catch((function(e){$(e)}))}),[L,P,O]);(0,a.useEffect)((function(){"edit"===I?(E({loading:!0}),K()):L.resetFields()}),[]),(0,a.useEffect)((function(){A&&(X.getRecordById(A).then((function(e){W([null===e||void 0===e?void 0:e.data.data])})).catch((function(e){console.log(e)})),L.setFieldValue("userId",A)),R&&L.setFieldValue("date",b()(R).add(1,"d"))}),[A,R]);return(0,k.jsx)(h.P0,{visible:t,closable:!0,onCancel:y,titleText:"edit"===I?"Edit Attendance":"Add New Attendance",showFooter:!1,children:null!==F&&void 0!==F&&F.loading?(0,k.jsx)(p.Z,{items:3}):(0,k.jsxs)(c.Z,{className:f.Z.form,onFinish:function(e){E((0,r.Z)((0,r.Z)({},F),{},{buttonLoading:!0}));var n={};switch(e.checkIn&&(n.checkIn=e.date._d.toISOString().substring(0,10)+e.checkIn._d.toISOString().substring(10)),e.checkOut&&(n.checkOut=e.date._d.toISOString().substring(0,10)+e.checkOut._d.toISOString().substring(10)),I){case"edit":!0===N?O.updateRecord((0,r.Z)((0,r.Z)({},e),n),P).then((function(e){C(),y(),E((function(e){return(0,r.Z)((0,r.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){$(e),E((function(e){return(0,r.Z)((0,r.Z)({},e),{},{buttonLoading:!1})}))})):(E((function(e){return(0,r.Z)((0,r.Z)({},e),{},{buttonLoading:!1})})),s.ZP.error("You don't have permission to update this record"));break;case"new":!0===w?O.createRecord((0,r.Z)((0,r.Z)({},e),n)).then((function(e){C(),y(),E((function(e){return(0,r.Z)((0,r.Z)({},e),{},{buttonLoading:!1})}))})).catch((function(e){$(e),E((function(e){return(0,r.Z)((0,r.Z)({},e),{},{buttonLoading:!1})}))})):(E((function(e){return(0,r.Z)((0,r.Z)({},e),{},{buttonLoading:!1})})),s.ZP.error("You don't have permission to create this record"))}},form:L,children:[(null===F||void 0===F?void 0:F.error)&&(0,k.jsx)(h.EQ,{description:null===F||void 0===F?void 0:F.error,isClosable:!0,onClose:function(){E((0,r.Z)((0,r.Z)({},F),{},{error:""}))}}),"new"===I&&(0,k.jsx)("div",{children:(0,k.jsxs)(c.Z.Item,{name:"userId",rules:[{required:!0,message:"Please select an employee"}],children:[(0,k.jsxs)("label",{className:"font-size-sm",children:["Employee  ",(0,k.jsx)("span",{className:"color-red-yp",children:"*"})]}),(0,k.jsx)(l.Z,{allowClear:!0,style:{width:"100%"},defaultValue:(null===F||void 0===F||null===(n=F.data)||void 0===n?void 0:n.userId)||A,placeholder:"Search for the employee",className:"selectAntdCustom",onChange:function(e){return L.setFieldsValue({userId:e})},showSearch:!0,onSearch:function(e){return Y(e)},optionFilterProp:"label",options:null===q||void 0===q?void 0:q.map((function(e){return{label:e.firstName+" "+e.lastName,value:e.id}})),notFoundContent:(0,k.jsx)(u.Z,{image:"https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg",imageStyle:{height:100},description:(0,k.jsx)("span",{children:"No data found, Please search for the employee"})})})]})}),(0,k.jsx)("div",{children:(0,k.jsx)(c.Z.Item,{name:"note",children:(0,k.jsx)(h.t7,{size:"w100",label:"Note",type:"text",placeHolder:"Enter note"})})}),(0,k.jsxs)("div",{style:{width:"100%"},children:[(0,k.jsxs)("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-dark-main)",width:"33%"},children:["Date",(0,k.jsx)("span",{style:{color:"var(--color-red-yp)"},children:" *"}),(0,k.jsx)(c.Z.Item,{name:"date",rules:[{required:!0,message:"Please select date "}],children:(0,k.jsx)(d.Z,{style:{borderRadius:"0.25rem",borderWidth:2,width:"100%",borderColor:"var(--color-border)"}})})]}),(0,k.jsxs)("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-dark-main)",width:"33%"},children:["Check in time",(0,k.jsx)("span",{style:{color:"var(--color-red-yp)"},children:" *"}),(0,k.jsx)(c.Z.Item,{name:"checkIn",rules:[{required:!0,message:"Please select date "}],children:(0,k.jsx)(j,{showSecond:!1,style:{borderRadius:"0.25rem",borderWidth:2,width:"100%",borderColor:"var(--color-border)"}})})]}),(0,k.jsxs)("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-dark-main)",width:"33%"},children:["Check out time",(0,k.jsx)("span",{style:{color:"var(--color-red-yp)"},children:" *"}),(0,k.jsx)(c.Z.Item,{name:"checkOut",rules:[{required:!0,message:"Please select date "}],children:(0,k.jsx)(j,{showSecond:!1,style:{borderRadius:"0.25rem",borderWidth:2,width:"100%",borderColor:"var(--color-border)"}})})]})]}),(0,k.jsxs)("div",{className:"d-flex justify-end",children:[(0,k.jsx)(h.op,{size:"normal",fontSize:"sm",onClick:y,type:"plain",children:"Cancel"}),(0,k.jsx)(h.op,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:null===F||void 0===F?void 0:F.buttonLoading,children:"edit"===I?"Edit Attendance":"Add Attendance"})]})]})})},P=t(5900),C=t(41586),S=t(98676),w=t(3109),N=t(85554),A=t(98505),R=t(3798),z=t(37936),L=function(e){var n=e.record,t=e.onEditIconClick,o=e.reloadTableData,d=e.permissions.deleteAttendance,c=(0,a.useState)({confirmLoading:!1,openPopConfirm:!1}),l=(0,i.Z)(c,2),u=l[0],h=l[1],p=new Z.s;return(0,k.jsxs)("div",{className:f.Z.actions,children:[(0,k.jsx)("span",{onClick:function(){return t(n)},children:(0,k.jsx)("img",{src:"/images/editicon.svg",alt:""})}),(0,k.jsx)(P.Z,{open:u.openPopConfirm,placement:"top",title:"Are you sure?",onConfirm:function(){if(h((0,r.Z)((0,r.Z)({},u),{},{confirmLoading:!0})),!1===d)return s.ZP.error("You don't have permission to delete this record, please contact your admin."),void h((0,r.Z)((0,r.Z)({},u),{},{openPopConfirm:!1}));p.deleteRecord(n.id).then((function(e){h((0,r.Z)((0,r.Z)({},u),{},{openPopConfirm:!1,confirmLoading:!1})),o()})).catch((function(e){h((0,r.Z)((0,r.Z)({},u),{},{confirmLoading:!1}))}))},onCancel:function(){return h((0,r.Z)((0,r.Z)({},u),{},{openPopConfirm:!1}))},okButtonProps:{loading:u.confirmLoading},okText:"Yes",cancelText:"No",onOpenChange:function(e){e||h((0,r.Z)((0,r.Z)({},u),{},{openPopConfirm:!1}))},children:(0,k.jsx)(S.Z,{className:f.Z.bg__red,onClick:function(){h((0,r.Z)((0,r.Z)({},u),{},{openPopConfirm:!0}))}})})]})};function O(e){var n=e.tableData,t=e.tableLoading,o=e.onEditIconClick,r=e.reloadTableData,d=e.meta,c=(0,N.v9)((function(e){return e.usersReducer})).userPermissions,s=(0,a.useState)({page:(null===d||void 0===d?void 0:d.page)||1,perPage:(null===d||void 0===d?void 0:d.perPage)||25}),l=(0,i.Z)(s,2),u=l[0],h=l[1];(0,a.useEffect)((function(){h({page:(null===d||void 0===d?void 0:d.page)||1,perPage:(null===d||void 0===d?void 0:d.perPage)||25})}),[d]);new Z.s;var p=[{title:"S.No",dataIndex:"index",key:"index",render:function(e,n,t){return(0,R.k7)(t,u)},width:"5%"},{title:"Name",dataIndex:"name",key:"name",render:function(e,n){var t,o;return(0,k.jsx)(w.Z,{color:"dark-main",size:"sm",weight:"bold",children:(null===n||void 0===n||null===(t=n.User)||void 0===t?void 0:t.firstName)+" "+(null===n||void 0===n||null===(o=n.User)||void 0===o?void 0:o.lastName)})}},{title:"Date",dataIndex:"checkIn",key:"checkIn",render:function(e,n){return(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(w.Z,{color:"dark-main",size:"sm",weight:"bold",children:n.isOnLeave?"(Not applicable)":(0,A.Ny)(n.checkIn,"dd M,yy")})})}},{title:"Check in",dataIndex:"checkIn",key:"checkIn",render:function(e,n){var t;return(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(w.Z,{color:"dark-main",size:"sm",weight:"bold",children:n.isOnLeave?"(Not applicable)":null===(t=(0,A.Ny)(n.checkIn,"dd M,yy-t"))||void 0===t?void 0:t.substring(15)})})}},{title:"Check out",dataIndex:"checkOut",key:"checkOut",render:function(e,n){var t;return(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(w.Z,{color:"dark-main",size:"sm",weight:"bold",children:n.isOnLeave?"(Not applicable)":null===(t=(0,A.Ny)(n.checkOut,"dd M,yy-t"))||void 0===t?void 0:t.substring(15)})})}},{title:"Status",dataIndex:"staus",key:"status",render:function(e,n){return(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(w.Z,{style:{color:z.vo[e-1]},size:"sm",weight:"bold",children:(0,R.H8)(new Date,n.day)?"-":(0,R.kC)(z.H8[e])})})}},{title:"Note",dataIndex:"note",key:"note",render:function(e){return(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(w.Z,{color:"dark-main",size:"sm",weight:"bold",children:e})})}},{title:"Type",dataIndex:"type",key:"type",render:function(e){return(0,k.jsx)(k.Fragment,{children:Object.entries(z.gc).map((function(n){var t=(0,i.Z)(n,2),o=t[0];return t[1]==e&&(0,k.jsx)(w.Z,{color:"dark-main",size:"sm",weight:"bold",children:(0,R.kC)(o.replace("_"," "))})}))})}},{title:"Actions",dataIndex:"actions",key:"actions",render:function(e,n){return(0,k.jsx)(L,{record:n,onEditIconClick:o,reloadTableData:r,permissions:c})}}];return(0,k.jsx)("div",{className:f.Z.antdTableWrapper,children:(0,k.jsx)(C.Z,{sticky:!0,dataSource:n,columns:p,pagination:!1,scroll:{x:991},loading:t,rowKey:function(e){return"Attendance-type-".concat(e.id)}})})}var T=t(18515),D=t(29079),F=t(59109),E=t(7532),M=[{text:"Home",isLink:!0,path:"/"},{isLink:!0,text:"Site Settings",path:"/siteSettings"},{isLink:!1,text:"Attendance"}];var _=function(){var e,n,t=(0,R.aY)(F.L),d=(0,N.v9)((function(e){return e.usersReducer})).userPermissions,c=d.readAttendance,l=d.createAttendance,u=d.updateAttendance,f=(0,a.useState)({perPage:25,type:void 0,fromDate:void 0,toDate:void 0,userId:void 0}),p=(0,i.Z)(f,2),v=p[0],m=p[1],y=(0,a.useState)({editType:"new",recordId:0,openModal:!1}),b=(0,i.Z)(y,2),j=b[0],P=b[1],C=new Z.s,S=(0,D.$5)({method:C.getAllRecords,initialQuery:{perPage:25}}),w=S.data,A=S.meta,L=S.onRefresh,_=(S.setData,S.loading),U=function(){!1!==l?P((0,r.Z)((0,r.Z)({},j),{},{openModal:!j.openModal,editType:"new"})):s.ZP.error("You don't have permission to create new record")},Y=(0,a.useState)(""),B=(0,i.Z)(Y,2),H=B[0],V=B[1],q=(0,g.N)(H,500),W=(0,a.useState)([]),X=(0,i.Z)(W,2),Q=X[0],$=X[1],K=(0,a.useMemo)((function(){return new x.z}),[]),G=(0,a.useCallback)((function(){q&&K.getAllRecords({name:q}).then((function(e){$((function(n){var t,r,i=null===e||void 0===e||null===(t=e.data)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.filter((function(e){return!(null!==n&&void 0!==n&&n.find((function(n){return n.id===e.id})))}));return[].concat((0,o.Z)(n),(0,o.Z)(i))}))})).catch((function(e){s.ZP.error(e.response.data.message)}))}),[q]);return(0,a.useEffect)((function(){G()}),[G]),(0,k.jsxs)(E.default,{permissionSlug:t,children:[(0,k.jsx)(h.mr,{heading:"Attendance",buttonText:"Add Attendance",onButtonClick:U,breadCrumbData:M,showAdd:!0===l,filters:(0,k.jsxs)("div",{children:[(0,k.jsx)("div",{children:(0,k.jsx)(h.Xy,{type:"radio",label:"Employee",name:"userId",withSearch:!0,options:null===Q||void 0===Q?void 0:Q.map((function(e){return{label:e.firstName+" "+e.lastName,value:e.id.toString()}})),onChange:function(e){var n=(0,r.Z)((0,r.Z)({},v),{},{userId:e.target.value});m(n)},value:null===(e=v.userId)||void 0===e?void 0:e.toString(),onReset:function(){var e=(0,r.Z)((0,r.Z)({},v),{},{userId:void 0});m(e),L(e),V("")},onUpdate:function(){return L(v)},searchTerm:H,onSearch:function(e){return V(e.currentTarget.value)}})}),(0,k.jsx)("div",{children:(0,k.jsx)(h.Xy,{type:"radio",label:"Type",name:"type",withSearch:!1,options:Object.entries(z.gc).map((function(e){var n=(0,i.Z)(e,2),t=n[0],o=n[1];return{label:(0,R.kC)(t),value:o.toString()}})),onChange:function(e){var n=(0,r.Z)((0,r.Z)({},v),{},{type:Number(e.target.value)});m(n)},value:null===(n=v.type)||void 0===n?void 0:n.toString(),onReset:function(){var e=(0,r.Z)((0,r.Z)({},v),{},{type:void 0});m(e),L(e)},onUpdate:function(){return L(v)}})}),(0,k.jsx)("div",{children:(0,k.jsx)(h.Xy,{type:"datepicker",label:"Date",name:"dateRange",onChange:function(e){var n,t,o,i,a=(0,r.Z)((0,r.Z)({},v),{},{fromDate:e?null===(n=e[0])||void 0===n||null===(t=n._d)||void 0===t?void 0:t.toISOString().substring(0,10):void 0,toDate:e?null===(o=e[1])||void 0===o||null===(i=o._d)||void 0===i?void 0:i.toISOString().substring(0,10):void 0});m(a)},onReset:function(){var e=(0,r.Z)((0,r.Z)({},v),{},{fromDate:void 0,toDate:void 0});m(e),L(e)},onUpdate:function(){return L(v)}})})]})}),!0===c&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(O,{tableData:w,tableLoading:_,meta:A,onEditIconClick:function(e){!1!==u?P((0,r.Z)((0,r.Z)({},j),{},{editType:"edit",recordId:e.id,openModal:!0})):s.ZP.error("You don't have permission to update this record")},reloadTableData:function(){return L()}}),(0,k.jsx)(h.tl,{total:null===A||void 0===A?void 0:A.total,current:null===A||void 0===A?void 0:A.page,defaultPageSize:null!==A&&void 0!==A&&A.perPage?null===A||void 0===A?void 0:A.perPage:25,pageSizeOptions:[10,25,50,100],onChange:function(e,n){var t=(0,r.Z)((0,r.Z)({},v),{},{page:e,perPage:n});L(t)}})]}),!1===c&&(0,k.jsx)(T.a$,{mainMessage:"You don't have permission to view this data"}),j.openModal&&(0,k.jsx)(I,{record:j.recordId,type:j.editType,reloadTableData:function(){return L()},onCancel:U,openModal:j.openModal,permissions:d})]})}},51812:function(e,n,t){t.d(n,{s:function(){return a}});var o=t(43144),r=t(15671),i=t(49075),a=(0,o.Z)((function e(){var n=this;(0,r.Z)(this,e),this.endPoint="attendance",this.getAllRecords=function(e){return i.Z.get(n.endPoint,{params:e})},this.getRecordById=function(e){return i.Z.get("".concat(n.endPoint,"/").concat(e))},this.getUserAttendance=function(e){return i.Z.get(n.endPoint+"/getUserAttendance",{params:e})},this.findUserAttendanceForPayroll=function(e){return i.Z.get(n.endPoint+"/findUserAttendanceForPayroll",{params:e})},this.findPublished=function(e){return i.Z.get("".concat(n.endPoint,"/published"),{params:e})},this.deleteRecord=function(e){return i.Z.delete("".concat(n.endPoint,"/").concat(e))},this.createRecord=function(e){return i.Z.post(n.endPoint,e)},this.updateRecord=function(e,t){return i.Z.patch("".concat(n.endPoint,"/").concat(t),e)},this.generateReport=function(e){return i.Z.post("".concat(n.endPoint,"/generateReport"),e,{responseType:"blob"})}}))}}]);