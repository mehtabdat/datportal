"use strict";(self.webpackChunkdat_projects=self.webpackChunkdat_projects||[]).push([[1518],{64952:function(e,n,t){t.r(n);var o=t(93433),a=t(4942),i=t(1413),r=t(29439),d=t(47313),l=t(2135),u=t(55291),c=t(70638),s=t(85554),v=t(54060),p=t(29079),f=t(82626),g=t(18515),h=t(98505),m=t(3798),Z=t(37936),j=t(42623),I=t(72333),b=t(5883),y=t(69591),w=t(96723),C=t(16468),x=t(3113),S=t(6027),T=t(48297),N=t(84943),k=t(46417),P=[{text:"Home",isLink:!0,path:"/"},{isLink:!1,text:"Invoices"}];n.default=function(){var e,n,t,_=(0,m.aY)(b.H),R=(0,s.v9)((function(e){return e.usersReducer})).userPermissions,D=R.readInvoice,Y=R.createInvoice,A=R.updateInvoice,E=(0,l.lr)(),U=(0,r.Z)(E,2),z=U[0],M=U[1],H=z.get("id"),V=z.get("actionType"),X=z.get("projectId"),L=(0,d.useMemo)((function(){return new I.b}),[]),$=(0,d.useMemo)((function(){return new S.i}),[]),B=(0,d.useMemo)((function(){return new y.Q}),[]),G=(0,d.useMemo)((function(){return new T.V}),[]),Q={active:[Z.UY.Generated,Z.UY.Sent],paid:[Z.UY.Paid],canceled:[Z.UY.Canceled],draft:[Z.UY.Generated]},W=(0,p.$5)({method:L.getAllRecords,initialQuery:{__status:V?void 0:Q.active,projectId:X?Number(X):void 0}}),q=W.data,F=W.onRefresh,O=W.meta,J=W.loading,K=(0,p.$5)({method:L.getCounts}),ee=K.data,ne=K.onRefresh,te=(0,d.useState)("active"),oe=(0,r.Z)(te,2),ae=oe[0],ie=oe[1],re=(0,d.useState)(""),de=(0,r.Z)(re,2),le=de[0],ue=de[1],ce=(0,j.N)(le,500),se=(0,d.useState)(""),ve=(0,r.Z)(se,2),pe=ve[0],fe=ve[1],ge=(0,j.N)(pe,500),he=(0,d.useState)(""),me=(0,r.Z)(he,2),Ze=me[0],je=me[1],Ie=(0,j.N)(Ze,500),be=(0,d.useState)({data:[],loading:!1}),ye=(0,r.Z)(be,2),we=ye[0],Ce=ye[1],xe=(0,d.useState)({data:[],loading:!1}),Se=(0,r.Z)(xe,2),Te=Se[0],Ne=Se[1],ke=(0,d.useState)({data:[],loading:!1}),Pe=(0,r.Z)(ke,2),_e=Pe[0],Re=Pe[1],De=(0,p.bH)(),Ye=De.drawer,Ae=De.setDrawer,Ee=(0,d.useState)({type:"notes",recordId:0,open:!1}),Ue=(0,r.Z)(Ee,2),ze=Ue[0],Me=Ue[1],He=(0,d.useState)({dateRange:[""],__status:Q.active}),Ve=(0,r.Z)(He,2),Xe=Ve[0],Le=Ve[1],$e=(0,d.useState)(!1),Be=(0,r.Z)($e,2),Ge=Be[0],Qe=Be[1],We=(0,d.useState)([]),qe=(0,r.Z)(We,2),Fe=qe[0],Oe=qe[1],Je=function(e){var n=null===e||void 0===e?void 0:e.target,t=n.name,o=n.value;if(("clientId"===t||"projectTypeId"===t||"projectId"===t)&&!(0,m.hj)(o)){var r="";switch(t){case"clientId":r="Client ID";break;case"projectTypeId":r="Project Type ID";break;case"projectId":r="Project ID"}return u.ZP.error("".concat(r," should be a number"))}Le((function(e){return(0,i.Z)((0,i.Z)({},e),{},(0,a.Z)({},t,o))}))},Ke=(0,d.useCallback)((function(e,n){e&&(Qe(!0),Le((0,i.Z)((0,i.Z)({},Xe),{},(0,a.Z)({},e,n))))}),[Xe]),en=function(e){!1!==Y?Ae({type:"create",open:!0,id:void 0,quotation:void 0,projectId:null===e||void 0===e?void 0:e.projectId}):u.ZP.error("You don't have permission to create new record")},nn=function(e){!1!==A?Ae({open:!0,id:e,type:"edit",projectId:Number(X)}):u.ZP.error("You don't have permission to update record")},tn=(0,d.useCallback)((function(e){var n,t,o=(null===(n=Xe.dateRange)||void 0===n?void 0:n[0])||"",a=(null===(t=Xe.dateRange)||void 0===t?void 0:t[1])||"",r=o?(0,h.Ny)(o,"yy-mm-dd"):void 0,d=a?(0,h.Ny)(a,"yy-mm-dd"):void 0,l=(0,i.Z)({fromDate:r,toDate:d,__status:Xe.__status||void 0,clientId:Xe.clientId||void 0,projectTypeId:Xe.projectTypeId||void 0,projectId:Xe.projectId||void 0},e);F(l),ne()}),[Xe]),on=function(e){var n=e.title,t=e.ids;Ce((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!0})})),B.getAllRecords({title:n,ids:t}).then((function(e){var n=(null===e||void 0===e?void 0:e.data).data;Ce((function(e){return(0,i.Z)((0,i.Z)({},e),{},{data:n,loading:!1})}))})).finally((function(){Ce((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!1})}))}))},an=(0,d.useCallback)((function(){ge&&(Ne((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!0})})),G.findPublished({name:ge}).then((function(e){var n,t=null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data;Ne((function(e){var n=null===t||void 0===t?void 0:t.filter((function(n){var t;return!(null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.find((function(e){return e.id===n.id})))}));return{data:[].concat((0,o.Z)(e.data),(0,o.Z)(n)),loading:!1}}))})).catch((function(e){var n=(0,m.S3)(e);u.ZP.error(n||"Something went wrong, please try again later."),Ne((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!1})}))})))}),[ge]),rn=(0,d.useCallback)((function(){Ie&&(Re((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!0})})),$.getPublishRecords({title:Ie}).then((function(e){var n,t=null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data;Re((function(e){var n=null===t||void 0===t?void 0:t.filter((function(n){var t;return!(null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.find((function(e){return e.id===n.id})))}));return{data:[].concat((0,o.Z)(e.data),(0,o.Z)(n)),loading:!1}}))})).catch((function(e){var n=(0,m.S3)(e);u.ZP.error(n||"Something went wrong, please try again later."),Re((function(e){return(0,i.Z)((0,i.Z)({},e),{},{loading:!1})}))})))}),[Ie]);(0,d.useEffect)((function(){Ge&&tn();var e=setTimeout((function(){Qe(!1)}),2e3);return function(){return clearTimeout(e)}}),[Ge,Xe,tn]);var dn=(0,d.useCallback)((function(){if(q&&q.length>0){var e=null===q||void 0===q?void 0:q.map((function(e){return{}}));Oe(e)}}),[q]);(0,d.useEffect)((function(){dn()}),[dn]),(0,d.useEffect)((function(){an()}),[an]),(0,d.useEffect)((function(){rn()}),[rn]),(0,d.useEffect)((function(){var e=function(){ie("all"),Le((function(e){return(0,i.Z)((0,i.Z)({},e),{},{projectId:Number(X)})})),on({ids:[Number(X)]})};switch(V){case"create":X&&(e(),en({projectId:Number(X)}),(0,m.nA)(["projectId","actionType"],M));break;case"edit":H&&X&&(e(),nn(Number(H)),(0,m.nA)(["id","actionType","projectId"],M));break;case"preview":H&&X&&(e(),Ae({open:!0,id:Number(H),type:"preview"}),(0,m.nA)(["id","actionType","projectId"],M))}}),[V,X,H]),(0,d.useEffect)((function(){ce&&on({title:ce})}),[ce]);var ln=[{label:"All (".concat((null===ee||void 0===ee?void 0:ee.all)||0,")"),value:"all"},{label:"Active (".concat((null===ee||void 0===ee?void 0:ee.active)||0,")"),value:"active"},{label:"Has Concerns (".concat((null===ee||void 0===ee?void 0:ee.hasConcerns)||0,")"),value:"hasConcerns"},{label:"Paid (".concat((null===ee||void 0===ee?void 0:ee.paid)||0,")"),value:"paid"},{label:"Draft (".concat((null===ee||void 0===ee?void 0:ee.draft)||0,")"),value:"draft"},{label:"Canceled (".concat((null===ee||void 0===ee?void 0:ee.canceled)||0,")"),value:"canceled"}];return(0,k.jsxs)(v.Z,{permissionSlug:_,children:[(0,k.jsx)(f.mr,{heading:"Invoices",breadCrumbData:P,showAdd:!0===R.createInvoice,buttonText:"Add Invoice",onButtonClick:en,positionChildren:"new-line",filters:D?(0,k.jsxs)("div",{className:x.Z.filterWrapper,children:[(0,k.jsx)("div",{style:{overflow:"auto"},children:(0,k.jsx)(c.Z,{size:"middle",style:{fontSize:"var(--font-size-sm)"},options:ln.map((function(e){return(0,i.Z)((0,i.Z)({},e),{},{title:e.label,value:e.value})})),value:ae,onChange:function(e){if("all"===e)Ke("__status",""),Le((function(e){return(0,i.Z)((0,i.Z)({},e),{},{__status:[]})}));else if("hasConcerns"===e)tn({hasConcerns:!0,__status:void 0});else{var n=e;tn({__status:Q[n]}),Le((function(e){return(0,i.Z)((0,i.Z)({},e),{},{__status:Q[n]})}))}ie(e)}})}),(0,k.jsx)("div",{children:(0,k.jsx)(f.Xy,{type:"radio",label:"Client",name:"clientId",withSearch:!0,options:null===Te||void 0===Te||null===(e=Te.data)||void 0===e?void 0:e.map((function(e){return{label:e.name,value:"".concat(e.id)}})),onChange:Je,value:Number(null===Xe||void 0===Xe?void 0:Xe.clientId)>0?String(null===Xe||void 0===Xe?void 0:Xe.clientId):"",onReset:function(){Ke("clientId",0),fe("")},onUpdate:tn,loading:null===Te||void 0===Te?void 0:Te.loading,searchTerm:pe,onSearch:function(e){return fe(e.currentTarget.value)}})}),(0,k.jsx)("div",{children:(0,k.jsx)(f.Xy,{type:"datepicker",label:"Date",name:"dateRange",onChange:function(e){return Le((function(n){return(0,i.Z)((0,i.Z)({},n),{},{dateRange:e})}))},onReset:function(){return Ke("dateRange",[])},onUpdate:tn})}),(0,k.jsx)("div",{children:(0,k.jsx)(f.Xy,{type:"radio",label:"Project",name:"projectId",withSearch:!0,options:null===we||void 0===we||null===(n=we.data)||void 0===n?void 0:n.map((function(e){return{label:"".concat(e.referenceNumber," | ").concat(e.title),value:"".concat(e.id)}})),onChange:Je,value:Number(null===Xe||void 0===Xe?void 0:Xe.projectId)>0?String(null===Xe||void 0===Xe?void 0:Xe.projectId):"",onReset:function(){Ke("projectId",0),ue("")},onUpdate:tn,loading:null===we||void 0===we?void 0:we.loading,searchTerm:le,onSearch:function(e){return ue(e.currentTarget.value)},defaultValue:Number(null===Xe||void 0===Xe?void 0:Xe.projectId)>0?String(null===Xe||void 0===Xe?void 0:Xe.projectId):""})}),(0,k.jsx)("div",{children:(0,k.jsx)(f.Xy,{type:"radio",label:"Project Type",name:"projectTypeId",withSearch:!0,options:null===_e||void 0===_e||null===(t=_e.data)||void 0===t?void 0:t.map((function(e){return{label:e.title,value:"".concat(e.id)}})),onChange:Je,value:Number(null===Xe||void 0===Xe?void 0:Xe.projectTypeId)>0?String(null===Xe||void 0===Xe?void 0:Xe.projectTypeId):"",onReset:function(){Ke("projectTypeId",0),je("")},onUpdate:tn,loading:null===_e||void 0===_e?void 0:_e.loading,searchTerm:Ze,onSearch:function(e){return je(e.currentTarget.value)}})})]}):null,excelExport:!0===D&&(null===q||void 0===q?void 0:q.length)>0&&(0,k.jsx)(f.jY,{fileName:"Invoice",headers:[{label:"Name",key:"name"},{label:"Email",key:"email"}],data:Fe,icon:(0,k.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",className:"mr-1",children:(0,k.jsx)("path",{fill:"#42526E",d:"M16.19 2H7.81C4.17 2 2 4.17 2 7.81v8.37C2 19.83 4.17 22 7.81 22h8.37c3.64 0 5.81-2.17 5.81-5.81V7.81C22 4.17 19.83 2 16.19 2zm1.06 10.33c0 .41-.34.75-.75.75s-.75-.34-.75-.75V9.31l-7.72 7.72c-.15.15-.34.22-.53.22s-.38-.07-.53-.22a.754.754 0 010-1.06l7.72-7.72h-3.02c-.41 0-.75-.34-.75-.75s.34-.75.75-.75h4.83c.41 0 .75.34.75.75v4.83z"})})})}),!0===D&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:x.Z.antdTableWrapper,children:(0,k.jsx)(w.Z,{tableData:q,tableLoading:J,permissions:R,setDrawer:Ae,onEditIconClick:nn,onAddNoteClick:function(e){!1!==A?Me({type:"notes",open:!0,recordId:null===e||void 0===e?void 0:e.id}):u.ZP.error("You don't have permission to add notes")},reloadTableData:function(){tn({perPage:(null===O||void 0===O?void 0:O.perPage)||10,page:(null===O||void 0===O?void 0:O.page)||1})}})}),(0,k.jsx)(f.tl,{total:null===O||void 0===O?void 0:O.total,current:null===O||void 0===O?void 0:O.page,defaultPageSize:null!==O&&void 0!==O&&O.perPage?null===O||void 0===O?void 0:O.perPage:10,pageSizeOptions:[10,20,50,100],onChange:function(e,n){return tn({page:e,perPage:n})}})]}),!1===D&&(0,k.jsx)(g.a$,{mainMessage:"You don't have permission to view this data"}),Ye.open&&(0,k.jsx)(C.Z,{drawer:Ye,setDrawer:Ae,onRefresh:F,permissions:R}),ze.open&&(0,k.jsx)(N.Z,{open:ze.open,permissions:R,invoiceId:ze.recordId,onRefresh:function(){F(),ne()},onCancel:function(){Me({type:"new",recordId:0,open:!1})}})]})}}}]);